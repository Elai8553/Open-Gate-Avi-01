;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="bcab3178-9cb0-283b-23f2-8ad2ddd7e789")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,764767,(e,t,n)=>{"use strict";var r=e.i(148382),i=function(e){if(e=e||{},this.Promise=e.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=e.domainReentrant||!1,this.domainReentrant){if(void 0===r.default||void 0===r.default.domain)throw Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.domains=Object.create(null)}this.timeout=e.timeout||i.DEFAULT_TIMEOUT,this.maxOccupationTime=e.maxOccupationTime||i.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=e.maxExecutionTime||i.DEFAULT_MAX_EXECUTION_TIME,e.maxPending===1/0||Number.isInteger(e.maxPending)&&e.maxPending>=0?this.maxPending=e.maxPending:this.maxPending=i.DEFAULT_MAX_PENDING};i.DEFAULT_TIMEOUT=0,i.DEFAULT_MAX_OCCUPATION_TIME=0,i.DEFAULT_MAX_EXECUTION_TIME=0,i.DEFAULT_MAX_PENDING=1e3,i.prototype.acquire=function(e,t,n,i){if(Array.isArray(e))return this._acquireBatch(e,t,n,i);if("function"!=typeof t)throw Error("You must pass a function to execute");var o=null,a=null,s=null;"function"!=typeof n&&(i=n,n=null,s=new this.Promise(function(e,t){o=e,a=t})),i=i||{};var l=!1,p=null,u=null,c=null,d=this,y=function(t,r,i){u&&(clearTimeout(u),u=null),c&&(clearTimeout(c),c=null),t&&(d.queues[e]&&0===d.queues[e].length&&delete d.queues[e],d.domainReentrant&&delete d.domains[e]),l||(s?r?a(r):o(i):"function"==typeof n&&n(r,i),l=!0),t&&d.queues[e]&&d.queues[e].length>0&&d.queues[e].shift()()},T=function(n){if(l)return y(n);p&&(clearTimeout(p),p=null),d.domainReentrant&&n&&(d.domains[e]=r.default.domain);var o=i.maxExecutionTime||d.maxExecutionTime;if(o&&(c=setTimeout(function(){d.queues[e]&&y(n,Error("Maximum execution time is exceeded "+e))},o)),1===t.length){var a=!1;try{t(function(e,t){a||(a=!0,y(n,e,t))})}catch(e){a||(a=!0,y(n,e))}}else d._promiseTry(function(){return t()}).then(function(e){y(n,void 0,e)},function(e){y(n,e)})};d.domainReentrant&&r.default.domain&&(T=r.default.domain.bind(T));var f=i.maxPending||d.maxPending;if(d.queues[e])if(d.domainReentrant&&r.default.domain&&r.default.domain===d.domains[e])T(!1);else if(d.queues[e].length>=f)y(!1,Error("Too many pending tasks in queue "+e));else{var g=function(){T(!0)};i.skipQueue?d.queues[e].unshift(g):d.queues[e].push(g);var h=i.timeout||d.timeout;h&&(p=setTimeout(function(){p=null,y(!1,Error("async-lock timed out in queue "+e))},h))}else d.queues[e]=[],T(!0);var v=i.maxOccupationTime||d.maxOccupationTime;if(v&&(u=setTimeout(function(){d.queues[e]&&y(!1,Error("Maximum occupation time is exceeded in queue "+e))},v)),s)return s},i.prototype._acquireBatch=function(e,t,n,r){"function"!=typeof n&&(r=n,n=null);var i=this,o=e.reduceRight(function(e,t){return function(n){i.acquire(t,e,n,r)}},t);if("function"!=typeof n)return new this.Promise(function(e,t){1===o.length?o(function(n,r){n?t(n):e(r)}):e(o())});o(n)},i.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},i.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(e){return this.Promise.reject(e)}},t.exports=i},650392,(e,t,n)=>{"use strict";t.exports=e.r(764767)},267710,644464,17886,e=>{"use strict";var t=e.i(297083),n=e.i(817556),r=e.i(862927),i=e.i(650392),o=e.i(830675);function a(e,t){return"string"==typeof e&&(e=Error(e)),o.withScope(function(n){n.setTag("ai-chat",!0),t&&n.setExtras(t),o.captureException(e)}),e}e.s(["sendErrorToSentry",()=>a],644464);var s=e.i(960933);e.i(837399),s.Type.Object({replId:s.Type.Union([s.Type.String(),s.Type.Null()]),orgId:s.Type.Optional(s.Type.String())}),s.Type.Object({userId:s.Type.Number(),orgId:s.Type.Optional(s.Type.String()),replId:s.Type.Optional(s.Type.String())});var l=s.Type.Object({token:s.Type.String()}),p=s.Type.Object({isAuthorized:s.Type.Literal(!0),code:s.Type.Literal("authorized"),message:s.Type.String()}),u=s.Type.Object({isAuthorized:s.Type.Literal(!1),code:s.Type.Union([s.Type.Literal("feature_disabled"),s.Type.Literal("feature_unsupported_for_non_teams"),s.Type.Literal("feature_unsupported_for_replit_teams"),s.Type.Literal("feature_unsupported_for_teams_edu"),s.Type.Literal("feature_unsupported_for_teams_pro"),s.Type.Literal("feature_unsupported_for_teams_free"),s.Type.Literal("insufficient_permissions"),s.Type.Literal("insufficient_quota"),s.Type.Literal("insufficient_budget"),s.Type.Literal("requires_payment_method"),s.Type.Literal("requires_active_subscription")]),message:s.Type.String()}),c=s.Type.Union([p,u]);s.Type.Object({basicModel:c,advancedModel:c,paidAgent:c,freeAgent:c,basicAssistant:c,advancedAssistant:c,modelFarm:c,openRouter:c,openAI:c,anthropic:c,gemini:c});var d={},y=new i.default;function T(e,i,o){return(0,t._)(function(){return(0,n._)(this,function(s){return[2,y.acquire(null!=e?e:"non-repl-key",function(){return(0,t._)(function(){var s,p,u;return(0,n._)(this,function(c){switch(c.label){case 0:if((s=d[i])&&new Date().getTime()<s.expiration)return[2,s.token];return[4,(0,t._)(function(){var t;return(0,n._)(this,function(n){switch(n.label){case 0:return[4,fetch("/ai/auth",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({replId:e,orgId:o})})];case 1:return[4,n.sent().json()];case 2:if(t=n.sent(),!r.Value.Check(l,t))throw a("Authentication to chat service failed",{detail:t});return[2,t.token]}})})()];case 1:return p=c.sent(),u=new Date().getTime()+18e5,d[i]={token:p,expiration:u},[2,p]}})})()})]})})()}e.s(["auth",()=>T],267710);var f=function(){var e=window.location.hostname;return e.includes("replit.com")&&!e.includes("staging.replit.com")};e.s(["isEnvProduction",()=>f],17886)},660670,711566,806240,230153,351677,187822,943673,170039,813702,281128,957410,e=>{"use strict";e.i(227062);var t,n,r,i,o,a,s,l,p,u,c,d,y,T,f,g,h,v,m,S,E,b,R,C,I,O,A,_,k,U,N,D,w,P,M,j,L,x,B,F,G,q,$,V,W,H,K,z,Y,Q,X,J,Z,ee,et,en,er,ei,eo,ea,es=e.i(627922),el=e.i(878420),ep=e.i(64386),eu=e.i(960933),ec="SERVER",ed={codec:es.BinaryCodec,heartbeatIntervalMs:2500,heartbeatsUntilDead:40,enableTransparentSessionReconnects:!0,sessionDisconnectGraceMs:15e3,connectionTimeoutMs:1e4,handshakeTimeoutMs:1e4};(0,el._)({},ed);var ey=(0,ep._)((0,el._)({},ed),{baseIntervalMs:250,maxJitterMs:500,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:2e3}),eT=eu.Type.Object({token:eu.Type.String()});e.s(["ChortRiverHandshakeRequestSchema",()=>eT,"RIVER_CLIENT_TRANSPORT_OPTIONS",()=>ey,"RIVER_SERVER_ID",()=>ec],711566);var ef=((t={})[t.AGENT_STATE_UNKNOWN=0]="AGENT_STATE_UNKNOWN",t[t.AGENT_STATE_RUNNING=1]="AGENT_STATE_RUNNING",t[t.AGENT_STATE_PAUSING=2]="AGENT_STATE_PAUSING",t[t.AGENT_STATE_PAUSED=3]="AGENT_STATE_PAUSED",t[t.AGENT_STATE_NOT_STARTED=4]="AGENT_STATE_NOT_STARTED",t),eg=((n={})[n.AGENT_FEEDBACK_UNKNOWN=0]="AGENT_FEEDBACK_UNKNOWN",n[n.AGENT_FEEDBACK_THUMB_UP=1]="AGENT_FEEDBACK_THUMB_UP",n[n.AGENT_FEEDBACK_THUMB_DOWN=2]="AGENT_FEEDBACK_THUMB_DOWN",n),eh=((r={})[r.SECRET_UNKNOWN=0]="SECRET_UNKNOWN",r[r.SECRET_COMPLETED=1]="SECRET_COMPLETED",r[r.SECRET_IGNORED=2]="SECRET_IGNORED",r),ev=((i={})[i.UNKNOWN=0]="UNKNOWN",i[i.LOVABLE=1]="LOVABLE",i[i.BOLT=2]="BOLT",i[i.REPLIT=3]="REPLIT",i[i.OTHER_GITHUB=4]="OTHER_GITHUB",i[i.FIGMA=5]="FIGMA",i[i.VERCEL=6]="VERCEL",i[i.BITBUCKET=7]="BITBUCKET",i),em=((o={})[o.UNSPECIFIED=0]="UNSPECIFIED",o[o.PENDING=1]="PENDING",o[o.IN_PROGRESS=2]="IN_PROGRESS",o[o.COMPLETED=3]="COMPLETED",o[o.COMPLETED_PENDING_REVIEW=4]="COMPLETED_PENDING_REVIEW",o),eS=((a={})[a.UNKNOWN=0]="UNKNOWN",a[a.PYTHON=1]="PYTHON",a),eE=((s={})[s.UNKNOWN=0]="UNKNOWN",s[s.STDOUT=1]="STDOUT",s[s.STDERR=2]="STDERR",s),eb=((l={})[l.STEP_UNKNOWN=0]="STEP_UNKNOWN",l[l.STEP_NOT_STARTED=1]="STEP_NOT_STARTED",l[l.STEP_IN_PROGRESS=2]="STEP_IN_PROGRESS",l[l.STEP_COMPLETE=3]="STEP_COMPLETE",l[l.STEP_FAILED=4]="STEP_FAILED",l[l.STEP_ABORTED=5]="STEP_ABORTED",l),eR=((p={})[p.UNKNOWN=0]="UNKNOWN",p[p.NEON_DATABASE=1]="NEON_DATABASE",p),eC=((u={})[u.UNKNOWN_TRIGGER_TYPE=0]="UNKNOWN_TRIGGER_TYPE",u[u.SLACK_MESSAGE=1]="SLACK_MESSAGE",u[u.TELEGRAM_MESSAGE=2]="TELEGRAM_MESSAGE",u[u.TIME_BASED=3]="TIME_BASED",u[u.CONNECTOR_TRIGGER=4]="CONNECTOR_TRIGGER",u),eI=((c={})[c.UNSPECIFIED=0]="UNSPECIFIED",c[c.FEATURE=1]="FEATURE",c[c.STACK=2]="STACK",c[c.STYLING=3]="STYLING",c),eO=((d={})[d.UNSPECIFIED=0]="UNSPECIFIED",d[d.GENERAL=1]="GENERAL",d[d.REPLIT_DOCUMENTATION=2]="REPLIT_DOCUMENTATION",d[d.MASTRA_DOCUMENTATION=3]="MASTRA_DOCUMENTATION",d),eA=((y={})[y.UNSPECIFIED=0]="UNSPECIFIED",y[y.RECENT=1]="RECENT",y[y.LAST_DEPLOYED=2]="LAST_DEPLOYED",y[y.RECOMMENDED=3]="RECOMMENDED",y),e_=((T={})[T.UNKNOWN=0]="UNKNOWN",T[T.SUCCESSFUL=1]="SUCCESSFUL",T[T.RECURSION_LIMIT_REACHED=2]="RECURSION_LIMIT_REACHED",T[T.EXCEPTION=3]="EXCEPTION",T),ek=((f={})[f.UNKNOWN=0]="UNKNOWN",f[f.REPL_CREATION_V1=1]="REPL_CREATION_V1",f),eU=((g={})[g.UNSPECIFIED=0]="UNSPECIFIED",g[g.URL_SCREENSHOT=1]="URL_SCREENSHOT",g[g.URL_CRAWL_CONTENT=2]="URL_CRAWL_CONTENT",g[g.URL_AS_PROMPT=3]="URL_AS_PROMPT",g[g.URL_CRAWL_HTML=4]="URL_CRAWL_HTML",g[g.URL_CRAWL_BRANDING=5]="URL_CRAWL_BRANDING",g),eN=((h={})[h.GENERATION_STATE_UNKNOWN=0]="GENERATION_STATE_UNKNOWN",h[h.GENERATION_IN_PROGRESS=1]="GENERATION_IN_PROGRESS",h[h.GENERATION_REGENERATING=2]="GENERATION_REGENERATING",h[h.GENERATION_COMPLETE=3]="GENERATION_COMPLETE",h[h.GENERATION_ERROR=4]="GENERATION_ERROR",h),eD=((v={})[v.UNKNOWN=0]="UNKNOWN",v[v.ENGLISH=1]="ENGLISH",v[v.CRON=2]="CRON",v),ew=((m={})[m.UNKNOWN=0]="UNKNOWN",m[m.BASIC=1]="BASIC",m[m.ADVANCED=2]="ADVANCED",m[m.OVERRIDE=3]="OVERRIDE",m),eP=((S={})[S.UNKNOWN=0]="UNKNOWN",S[S.FILE=1]="FILE",S[S.INLINE=2]="INLINE",S),eM=((E={})[E.UNKNOWN=0]="UNKNOWN",E[E.CONSOLE=1]="CONSOLE",E[E.LSP=2]="LSP",E),ej=((b={})[b.UNKNOWN=0]="UNKNOWN",b[b.IN_PROGRESS=1]="IN_PROGRESS",b[b.COMPLETE=2]="COMPLETE",b),eL=((R={})[R.UNKNOWN=0]="UNKNOWN",R[R.EXPLAIN_CODE=1]="EXPLAIN_CODE",R[R.DEBUGGER=2]="DEBUGGER",R[R.GENERATE_CODE=3]="GENERATE_CODE",R[R.TRANSFORM_CODE=4]="TRANSFORM_CODE",R),ex=((C={})[C.UNKNOWN=0]="UNKNOWN",C[C.USER=1]="USER",C[C.AI=2]="AI",C[C.SERVICE=3]="SERVICE",C),eB=((I={})[I.UNKNOWN=0]="UNKNOWN",I[I.CHAT=1]="CHAT",I[I.INLINE_CHAT=2]="INLINE_CHAT",I[I.SINGLE_USE_SESSION=3]="SINGLE_USE_SESSION",I[I.REPL_CREATION=4]="REPL_CREATION",I[I.AGENT_SESSION=5]="AGENT_SESSION",I[I.HOSTING_DEBUG_SUMMARY=6]="HOSTING_DEBUG_SUMMARY",I[I.REPL_CREATION_V2=7]="REPL_CREATION_V2",I[I.REPL_CREATION_V3=8]="REPL_CREATION_V3",I[I.AGENT_REPLAY_SESSION=9]="AGENT_REPLAY_SESSION",I[I.SAMPLING_SESSION=10]="SAMPLING_SESSION",I[I.SUB_AGENT=11]="SUB_AGENT",I),eF=((O={})[O.UNKNOWN=0]="UNKNOWN",O[O.MAX_TOKENS=1]="MAX_TOKENS",O[O.STOP_TOKEN=2]="STOP_TOKEN",O[O.SAFETY=3]="SAFETY",O[O.RECITATION=4]="RECITATION",O[O.TOOL_CALLS=5]="TOOL_CALLS",O[O.CONTENT_FILTER=6]="CONTENT_FILTER",O),eG=((A={})[A.UNKNOWN=0]="UNKNOWN",A[A.NONE=1]="NONE",A[A.REPLIT_DOCS=2]="REPLIT_DOCS",A[A.GENERATE=3]="GENERATE",A[A.EXPLAIN=4]="EXPLAIN",A[A.TRANSFORM=5]="TRANSFORM",A[A.DEBUG=6]="DEBUG",A[A.FIND_INTENT=7]="FIND_INTENT",A[A.AGENT=8]="AGENT",A[A.ITERATIVE_AGENT=9]="ITERATIVE_AGENT",A),eq=((_={})[_.UNKNOWN=0]="UNKNOWN",_[_.FREE=1]="FREE",_[_.CORE=2]="CORE",_[_.TEAMS=3]="TEAMS",_),e$=((k={})[k.UNKNOWN=0]="UNKNOWN",k[k.MANUALLY_ABORTED=1]="MANUALLY_ABORTED",k[k.INCOMPLETE_UPDATE=2]="INCOMPLETE_UPDATE",k[k.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",k[k.USAGE_LIMIT=4]="USAGE_LIMIT",k[k.TEST_ERROR=5]="TEST_ERROR",k[k.INVALID_INPUT=6]="INVALID_INPUT",k[k.UNAUTHORIZED=7]="UNAUTHORIZED",k[k.AGENT_EXECUTION_ERROR=8]="AGENT_EXECUTION_ERROR",k[k.AI_QUOTA_ERROR_UNKNOWN=9]="AI_QUOTA_ERROR_UNKNOWN",k[k.AI_QUOTA_INSUFFICIENT_BUDGET=10]="AI_QUOTA_INSUFFICIENT_BUDGET",k[k.AI_QUOTA_NO_PAYMENT_METHOD=11]="AI_QUOTA_NO_PAYMENT_METHOD",k[k.AI_QUOTA_NO_SUBSCRIPTION=12]="AI_QUOTA_NO_SUBSCRIPTION",k),eV=((U={})[U.UNSPECIFIED=0]="UNSPECIFIED",U[U.GENERAL=1]="GENERAL",U[U.DISCUSSION=2]="DISCUSSION",U[U.INITIAL_PLANNING=3]="INITIAL_PLANNING",U[U.QUICK_EDIT=4]="QUICK_EDIT",U),eW=((N={})[N.UNSPECIFIED=0]="UNSPECIFIED",N[N.SYNC=1]="SYNC",N[N.ASYNC=2]="ASYNC",N[N.DESIGN=3]="DESIGN",N[N.BUILD=4]="BUILD",N),eH=((D={})[D.UNSPECIFIED=0]="UNSPECIFIED",D[D.LOW=1]="LOW",D[D.MEDIUM=2]="MEDIUM",D[D.HIGH=3]="HIGH",D[D.MAX=4]="MAX",D),eK=((w={})[w.UNSPECIFIED=0]="UNSPECIFIED",w[w.LITE=1]="LITE",w[w.PRO=2]="PRO",w),ez=((P={})[P.UNSPECIFIED=0]="UNSPECIFIED",P[P.REPLIT_UI=1]="REPLIT_UI",P[P.CHATGPT=2]="CHATGPT",P),eY=((M={})[M.UNSPECIFIED=0]="UNSPECIFIED",M[M.STANDARD=1]="STANDARD",M[M.ADVANCED=2]="ADVANCED",M),eQ=((j={})[j.SET=0]="SET",j[j.ADD=1]="ADD",j[j.CLEAR=2]="CLEAR",j[j.APPEND=3]="APPEND",j),eX=((L={})[L.UNSPECIFIED=0]="UNSPECIFIED",L[L.INSUFFICIENT_BUDGET=1]="INSUFFICIENT_BUDGET",L[L.REQUIRES_PAYMENT_METHOD=2]="REQUIRES_PAYMENT_METHOD",L[L.REQUIRES_ACTIVE_SUBSCRIPTION=3]="REQUIRES_ACTIVE_SUBSCRIPTION",L[L.AGENT_UNKNOWN_AUTHORIZATION_ERROR=4]="AGENT_UNKNOWN_AUTHORIZATION_ERROR",L[L.INSUFFICIENT_PERMISSIONS=5]="INSUFFICIENT_PERMISSIONS",L[L.INSUFFICIENT_QUOTA=6]="INSUFFICIENT_QUOTA",L[L.PAYMENT_DELINQUENT=7]="PAYMENT_DELINQUENT",L),eJ=((x={})[x.NULL_VALUE=0]="NULL_VALUE",x),eZ=((B={})[B.STRING=0]="STRING",B[B.INTEGER=1]="INTEGER",B),e0=((F={})[F.AGENT=0]="AGENT",F[F.USER=1]="USER",F[F.DEPLOYMENT=2]="DEPLOYMENT",F),e1=((G={})[G.UNSPECIFIED=0]="UNSPECIFIED",G[G.ZERO_RATED=1]="ZERO_RATED",G[G.NORMAL=2]="NORMAL",G),e2=((q={})[q.UNSPECIFIED=0]="UNSPECIFIED",q[q.RAPID_BUILD_FEEDBACK=1]="RAPID_BUILD_FEEDBACK",q[q.FEEDBACK_REQUESTED=2]="FEEDBACK_REQUESTED",q[q.AGENT_USAGE_MAX_THRESHOLD=3]="AGENT_USAGE_MAX_THRESHOLD",q[q.AGENT_USAGE_LIMIT_THRESHOLD=4]="AGENT_USAGE_LIMIT_THRESHOLD",q[q.USER_RESPONSE=5]="USER_RESPONSE",q[q.PROPOSE_PLAN_TOOL=6]="PROPOSE_PLAN_TOOL",q[q.LAST_MESSAGE=7]="LAST_MESSAGE",q[q.SESSION_START=8]="SESSION_START",q[q.NEON_DATABASE_EVENT=9]="NEON_DATABASE_EVENT",q[q.GENERATE_3D_MODEL=10]="GENERATE_3D_MODEL",q[q.CONTINUE_WITH_PLAN=11]="CONTINUE_WITH_PLAN",q[q.WORKSPACE_TRIGGERED_AGENT=12]="WORKSPACE_TRIGGERED_AGENT",q[q.WORKSPACE_TRIGGERED_USER=13]="WORKSPACE_TRIGGERED_USER",q[q.WORKSPACE_TRIGGERED_DEPLOYMENT=14]="WORKSPACE_TRIGGERED_DEPLOYMENT",q[q.PROPOSE_MVP_PLAN=15]="PROPOSE_MVP_PLAN",q[q.INTERMEDIATE_CHECKPOINT=16]="INTERMEDIATE_CHECKPOINT",q[q.PREREVERT=17]="PREREVERT",q[q.REVERT=18]="REVERT",q[q.TEST=19]="TEST",q[q.PLAN_APPROVED=20]="PLAN_APPROVED",q[q.REACT_LOOP_CAP_HIT=21]="REACT_LOOP_CAP_HIT",q[q.SUCCESS_TOOL=22]="SUCCESS_TOOL",q[q.LOOP_END=23]="LOOP_END",q[q.AGENT_PAUSE=24]="AGENT_PAUSE",q[q.COMPLETED_TASK=25]="COMPLETED_TASK",q[q.PLAN_TO_BUILD_TRANSITION=26]="PLAN_TO_BUILD_TRANSITION",q),e3=(($={})[$.DISCOUNTED_EFFORT_UNSPECIFIED=0]="DISCOUNTED_EFFORT_UNSPECIFIED",$[$.DISCOUNTED_EFFORT_FREE_HIGH_POWERED_MODE=1]="DISCOUNTED_EFFORT_FREE_HIGH_POWERED_MODE",$),e4=((V={})[V.REVERT_DATA_STAGE_UNKNOWN=0]="REVERT_DATA_STAGE_UNKNOWN",V[V.REVERT_DATA_STAGE_LOADING_PREVIOUS_STATE=1]="REVERT_DATA_STAGE_LOADING_PREVIOUS_STATE",V[V.REVERT_DATA_STAGE_SHUTTING_DOWN_WORKFLOWS=2]="REVERT_DATA_STAGE_SHUTTING_DOWN_WORKFLOWS",V[V.REVERT_DATA_STAGE_REVERTING_COMMIT=3]="REVERT_DATA_STAGE_REVERTING_COMMIT",V[V.REVERT_DATA_STAGE_RESTARTING_WORKFLOWS=4]="REVERT_DATA_STAGE_RESTARTING_WORKFLOWS",V[V.REVERT_DATA_STAGE_COMPLETE=5]="REVERT_DATA_STAGE_COMPLETE",V[V.REVERT_DATA_STAGE_ROLLING_BACK_DATABASE=6]="REVERT_DATA_STAGE_ROLLING_BACK_DATABASE",V[V.REVERT_DATA_STAGE_ROLLING_BACK_DEPLOYMENT=7]="REVERT_DATA_STAGE_ROLLING_BACK_DEPLOYMENT",V),e6=((W={})[W.MEDIA_TYPE_UNKNOWN=0]="MEDIA_TYPE_UNKNOWN",W[W.MEDIA_TYPE_IMAGE=1]="MEDIA_TYPE_IMAGE",W[W.MEDIA_TYPE_VIDEO=2]="MEDIA_TYPE_VIDEO",W[W.MEDIA_TYPE_3D_MODEL=3]="MEDIA_TYPE_3D_MODEL",W),e8=((H={})[H.UNSPECIFIED=0]="UNSPECIFIED",H[H.ONE=1]="ONE",H[H.ALL=2]="ALL",H),e5=((K={})[K.UNSPECIFIED=0]="UNSPECIFIED",K[K.PENDING=1]="PENDING",K[K.ACKNOWLEDGED_CONTINUE_CURRENT_STEP=2]="ACKNOWLEDGED_CONTINUE_CURRENT_STEP",K[K.ACKNOWLEDGED_ABORT_CURRENT_STEP=3]="ACKNOWLEDGED_ABORT_CURRENT_STEP",K),e7=((z={})[z.SUCCESS=0]="SUCCESS",z[z.FAILURE=1]="FAILURE",z[z.UNABLE=3]="UNABLE",z),e9=((Y={})[Y.UNKNOWN=0]="UNKNOWN",Y[Y.THOUGHTS_ONLY=1]="THOUGHTS_ONLY",Y[Y.ALL_EVENTS=2]="ALL_EVENTS",Y),te=((Q={})[Q.UNSPECIFIED=0]="UNSPECIFIED",Q[Q.ENVIRONMENT_SETUP=1]="ENVIRONMENT_SETUP",Q[Q.SAMPLING=2]="SAMPLING",Q[Q.RANKING=3]="RANKING",Q[Q.APPLYING=4]="APPLYING",Q[Q.CONCLUDED=5]="CONCLUDED",Q),tt=((X={})[X.UNSPECIFIED=0]="UNSPECIFIED",X[X.ENVIRONMENT_SETUP=5]="ENVIRONMENT_SETUP",X[X.IN_PROGRESS=1]="IN_PROGRESS",X[X.SUCCESSFUL=2]="SUCCESSFUL",X[X.FAILED=3]="FAILED",X[X.CHOSEN=4]="CHOSEN",X),tn=((J={})[J.VISUAL_STARTED=0]="VISUAL_STARTED",J[J.VISUAL_COMPLETE_PENDING_REVIEW=1]="VISUAL_COMPLETE_PENDING_REVIEW",J[J.VISUAL_COMPLETE=2]="VISUAL_COMPLETE",J[J.MVP_STARTED=3]="MVP_STARTED",J[J.MVP_COMPLETE_PENDING_REVIEW=4]="MVP_COMPLETE_PENDING_REVIEW",J[J.MVP_COMPLETE=5]="MVP_COMPLETE",J),tr=((Z={})[Z.UNKNOWN=0]="UNKNOWN",Z[Z.LOG_FILE=1]="LOG_FILE",Z),ti=((ee={})[ee.UNSPECIFIED=0]="UNSPECIFIED",ee[ee.INFO=1]="INFO",ee[ee.WARNING=2]="WARNING",ee[ee.ERROR=3]="ERROR",ee),to=((et={})[et.NONE=0]="NONE",et[et.OPEN_MCP_PANE=1]="OPEN_MCP_PANE",et),ta=((en={})[en.UNSPECIFIED=0]="UNSPECIFIED",en[en.DEVELOPMENT=1]="DEVELOPMENT",en[en.PRODUCTION=2]="PRODUCTION",en[en.SHARED=3]="SHARED",en),ts=((er={})[er.UNSPECIFIED=0]="UNSPECIFIED",er[er.ENV=1]="ENV",er[er.SECRET=2]="SECRET",er);e.s(["AgentAuthorizationFailedCode",()=>eX,"AgentInitialBuildMode",()=>eW,"AgentInitialBuildTier",()=>eK,"AgentMode",()=>eV,"AgentPlanStepStatus",()=>eb,"AgentRunState",()=>ef,"AgentStackTriggerType",()=>eC,"AgentUserFeedbackType",()=>eg,"AlertLevel",()=>ti,"AlertNextAction",()=>to,"AttachedFormType",()=>ek,"AutonomyLevel",()=>eH,"BYOPromptResponseParameterType",()=>eZ,"BenchmarkConclusionReason",()=>e_,"BlueprintCategory",()=>eI,"CheckpointSuggestionReason",()=>eA,"CheckpointTriggerReason",()=>e2,"CodeReferenceType",()=>eP,"CommitAuthor",()=>e0,"CommitBillingRate",()=>e1,"DebugErrorSource",()=>eM,"DiscountedEffortType",()=>e3,"EnvironmentType",()=>ta,"EnvironmentVariableType",()=>ts,"EventErrorType",()=>e$,"EventState",()=>ej,"FileChangeGenerationState",()=>eN,"GeneralSubagentEventFilter",()=>e9,"GeneratedMediaType",()=>e6,"InitialBuildPhase",()=>tn,"InlineMessageType",()=>eL,"MembershipType",()=>eq,"MessageAction",()=>eG,"MessageSource",()=>ez,"MessageStopReason",()=>eF,"ModelProfile",()=>eY,"ModelType",()=>ew,"NullValue",()=>eJ,"ProjectImportSource",()=>ev,"RequestFeatureAddType",()=>eR,"RevertStatus",()=>e4,"SamplingEventState",()=>te,"SandboxLanguage",()=>eS,"SandboxOutputType",()=>eE,"SessionType",()=>eB,"SpecialFileType",()=>tr,"StepTooComplexEventContentsState",()=>e5,"TaskStatus",()=>em,"TrajectoryState",()=>tt,"TranslationTarget",()=>eD,"UITestingSubagentResultType",()=>e7,"UpdateEventOperationType",()=>eQ,"UrlIntent",()=>eU,"UserSecretResponseStatus",()=>eh,"UserType",()=>ex,"WaitingForBackgroundJobType",()=>e8,"WebSearchType",()=>eO],806240);var tl=((ei={})[ei.NONE=0]="NONE",ei[ei.FLASK_VANILLA_JS=1]="FLASK_VANILLA_JS",ei[ei.PYTHON_API=2]="PYTHON_API",ei[ei.STREAMLIT=3]="STREAMLIT",ei[ei.FULLSTACK_JS=4]="FULLSTACK_JS",ei[ei.GAMESTACK_JS=5]="GAMESTACK_JS",ei[ei.CUSTOM=6]="CUSTOM",ei[ei.EXPO=7]="EXPO",ei[ei.AGENT=8]="AGENT",ei[ei.MOCKUP_JS=9]="MOCKUP_JS",ei[ei.BEST_EFFORT_FALLBACK=10]="BEST_EFFORT_FALLBACK",ei[ei.VIDEO_JS=11]="VIDEO_JS",ei),tp=eu.Type.Module({StackBlueprint:eu.Type.Enum(tl)}).Import("StackBlueprint"),tu=eu.Type.Module({AgentRunState:eu.Type.Enum(ef),AgentUserFeedbackType:eu.Type.Enum(eg),UserSecretResponseStatus:eu.Type.Enum(eh),ProjectImportSource:eu.Type.Enum(ev),TaskStatus:eu.Type.Enum(em),SandboxLanguage:eu.Type.Enum(eS),SandboxOutputType:eu.Type.Enum(eE),AgentPlanStepStatus:eu.Type.Enum(eb),RequestFeatureAddType:eu.Type.Enum(eR),AgentStackTriggerType:eu.Type.Enum(eC),BlueprintCategory:eu.Type.Enum(eI),WebSearchType:eu.Type.Enum(eO),CheckpointSuggestionReason:eu.Type.Enum(eA),BenchmarkConclusionReason:eu.Type.Enum(e_),AttachedFormType:eu.Type.Enum(ek),UrlIntent:eu.Type.Enum(eU),FileChangeGenerationState:eu.Type.Enum(eN),TranslationTarget:eu.Type.Enum(eD),ModelType:eu.Type.Enum(ew),CodeReferenceType:eu.Type.Enum(eP),DebugErrorSource:eu.Type.Enum(eM),EventState:eu.Type.Enum(ej),InlineMessageType:eu.Type.Enum(eL),UserType:eu.Type.Enum(ex),SessionType:eu.Type.Enum(eB),MessageStopReason:eu.Type.Enum(eF),MessageAction:eu.Type.Enum(eG),MembershipType:eu.Type.Enum(eq),EventErrorType:eu.Type.Enum(e$),AgentMode:eu.Type.Enum(eV),AgentInitialBuildMode:eu.Type.Enum(eW),AutonomyLevel:eu.Type.Enum(eH),AgentInitialBuildTier:eu.Type.Enum(eK),MessageSource:eu.Type.Enum(ez),ModelProfile:eu.Type.Enum(eY),UpdateEventOperationType:eu.Type.Enum(eQ),AgentAuthorizationFailedCode:eu.Type.Enum(eX),NullValue:eu.Type.Enum(eJ),BYOPromptResponseParameterType:eu.Type.Enum(eZ),CommitAuthor:eu.Type.Enum(e0),CommitBillingRate:eu.Type.Enum(e1),CheckpointTriggerReason:eu.Type.Enum(e2),DiscountedEffortType:eu.Type.Enum(e3),RevertStatus:eu.Type.Enum(e4),GeneratedMediaType:eu.Type.Enum(e6),WaitingForBackgroundJobType:eu.Type.Enum(e8),StepTooComplexEventContentsState:eu.Type.Enum(e5),UITestingSubagentResultType:eu.Type.Enum(e7),GeneralSubagentEventFilter:eu.Type.Enum(e9),SamplingEventState:eu.Type.Enum(te),TrajectoryState:eu.Type.Enum(tt),InitialBuildPhase:eu.Type.Enum(tn),SpecialFileType:eu.Type.Enum(tr),AlertLevel:eu.Type.Enum(ti),AlertNextAction:eu.Type.Enum(to),EnvironmentType:eu.Type.Enum(ta),EnvironmentVariableType:eu.Type.Enum(ts),RevertToCommitRequest:eu.Type.Object({replId:eu.Type.String(),targetCommitId:eu.Type.String(),newSessionTitle:eu.Type.String(),originalSessionId:eu.Type.String(),databaseRollbackTimestamp:eu.Type.String(),deploymentBuildId:eu.Type.String(),rollbackDatabase:eu.Type.Boolean(),revertedToSessionId:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),revertedToEventId:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()]))}),RevertToCommitResponse:eu.Type.Object({revertedSessionId:eu.Type.String()}),CloneSessionRequest:eu.Type.Object({sessionId:eu.Type.String(),newReplId:eu.Type.String(),sessionType:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("SessionType"),eu.Type.Undefined()]))}),CloneSessionResponse:eu.Type.Object({clonedSessionId:eu.Type.String()}),Ping:eu.Type.Object({}),Pong:eu.Type.Object({}),Event:eu.Type.Object({id:eu.Type.String(),parentEventId:eu.Type.String(),contents:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventContents"),eu.Type.Undefined()])),context:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventContext"),eu.Type.Undefined()])),state:eu.Type.Ref("EventState"),created:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()])),updated:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()])),sender:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("UserContext"),eu.Type.Undefined()])),sessionId:eu.Type.String(),updateEventOperations:eu.Type.Array(eu.Type.Ref("UpdateEventOperation")),typedUpdateEventOperations:eu.Type.Array(eu.Type.Ref("TypedUpdateEventOperation")),error:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventError"),eu.Type.Undefined()])),agentStepId:eu.Type.String()}),EventShape:eu.Type.Object({id:eu.Type.String(),parentEventId:eu.Type.String(),created:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()]))}),AgentUserFeedback:eu.Type.Object({type:eu.Type.Ref("AgentUserFeedbackType"),comment:eu.Type.String()}),SubmitAgentUserFeedbackRequest:eu.Type.Object({sessionId:eu.Type.String(),sourceEventId:eu.Type.String(),feedback:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentUserFeedback"),eu.Type.Undefined()])),sessionType:eu.Type.Ref("SessionType")}),SubmitAgentUserFeedbackResponse:eu.Type.Object({}),ReplAgentState:eu.Type.Object({activeAgentSessionId:eu.Type.String()}),Session:eu.Type.Object({id:eu.Type.String(),title:eu.Type.String(),sessionType:eu.Type.Ref("SessionType"),replId:eu.Type.String(),events:eu.Type.Array(eu.Type.Ref("Event")),sessionCreationEventId:eu.Type.String(),archived:eu.Type.Boolean(),lastEventTime:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()])),created:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()])),updated:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()])),activeEventId:eu.Type.String(),readOnly:eu.Type.Boolean(),taskId:eu.Type.String(),revertedToSessionId:eu.Type.String(),revertedToEventId:eu.Type.String()}),Secret:eu.Type.Object({description:eu.Type.String(),key:eu.Type.String()}),SecretRequestAction:eu.Type.Object({secrets:eu.Type.Array(eu.Type.Ref("Secret"))}),UserSecretResponse:eu.Type.Object({key:eu.Type.String(),status:eu.Type.Ref("UserSecretResponseStatus")}),DeployRequest:eu.Type.Object({}),DeployResponse:eu.Type.Object({success:eu.Type.Boolean()}),MessageButton:eu.Type.Object({name:eu.Type.String(),description:eu.Type.String(),responseText:eu.Type.String()}),DeployRequestAction:eu.Type.Object({}),MessageButtonAction:eu.Type.Object({buttons:eu.Type.Array(eu.Type.Ref("MessageButton"))}),AgentUserSecretsRequest:eu.Type.Object({secrets:eu.Type.Array(eu.Type.Ref("Secret")),message:eu.Type.String()}),AgentUserSecretsResponse:eu.Type.Object({providedSecrets:eu.Type.Array(eu.Type.Ref("UserSecretResponse"))}),AgentDebugRequest:eu.Type.Object({enabled:eu.Type.Boolean(),isSelected:eu.Type.Boolean()}),AgentDebugResponse:eu.Type.Object({accepted:eu.Type.Boolean()}),AgentContinueRequest:eu.Type.Object({enabled:eu.Type.Boolean(),isSelected:eu.Type.Boolean()}),AgentContinueResponse:eu.Type.Object({accepted:eu.Type.Boolean()}),AgentNewFeatureRequest:eu.Type.Object({featureName:eu.Type.String(),id:eu.Type.Number(),isSelected:eu.Type.Boolean()}),UserMessageContents:eu.Type.Object({content:eu.Type.String(),uploadedFiles:eu.Type.Array(eu.Type.Ref("UploadedFile")),attachedUrls:eu.Type.Array(eu.Type.Ref("AttachedUrl"))}),AgentNewFeatureResponse:eu.Type.Object({selectedFeatureId:eu.Type.Number(),featureName:eu.Type.String(),userMessage:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("UserMessageContents"),eu.Type.Undefined()]))}),AgentDeployRequest:eu.Type.Object({}),AgentDeployResponse:eu.Type.Object({}),AgentAction:eu.Type.Object({optionType:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("messageButtonAction"),value:eu.Type.Ref("MessageButtonAction")}),eu.Type.Object({$case:eu.Type.Literal("secretRequestAction"),value:eu.Type.Ref("SecretRequestAction")}),eu.Type.Object({$case:eu.Type.Literal("deployRequestAction"),value:eu.Type.Ref("DeployRequestAction")}),eu.Type.Undefined()]))}),AgentNextStepRequest:eu.Type.Object({newFeatureRequests:eu.Type.Array(eu.Type.Ref("AgentNewFeatureRequest")),debugRequest:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentDebugRequest"),eu.Type.Undefined()])),keepWorkingRequest:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentContinueRequest"),eu.Type.Undefined()]))}),AgentNextStepResponse:eu.Type.Object({response:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("newFeatureResponse"),value:eu.Type.Ref("AgentNewFeatureResponse")}),eu.Type.Object({$case:eu.Type.Literal("debugResponse"),value:eu.Type.Ref("AgentDebugResponse")}),eu.Type.Object({$case:eu.Type.Literal("keepWorkingResponse"),value:eu.Type.Ref("AgentContinueResponse")}),eu.Type.Undefined()]))}),AgentQueryBoolean:eu.Type.Object({question:eu.Type.String(),confirmText:eu.Type.String(),rejectText:eu.Type.String(),allowAutoConfirm:eu.Type.Boolean()}),AgentQueryChoice:eu.Type.Object({question:eu.Type.String(),options:eu.Type.Array(eu.Type.String())}),AgentQueryText:eu.Type.Object({question:eu.Type.String(),responsePlaceholderText:eu.Type.String()}),AgentQuery:eu.Type.Object({queryType:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("booleanQuery"),value:eu.Type.Ref("AgentQueryBoolean")}),eu.Type.Object({$case:eu.Type.Literal("choiceQuery"),value:eu.Type.Ref("AgentQueryChoice")}),eu.Type.Object({$case:eu.Type.Literal("textQuery"),value:eu.Type.Ref("AgentQueryText")}),eu.Type.Undefined()]))}),AgentQueryBooleanResponse:eu.Type.Object({response:eu.Type.Boolean(),reason:eu.Type.String()}),AgentQueryChoiceResponse:eu.Type.Object({response:eu.Type.String(),reason:eu.Type.String()}),AgentQueryTextResponse:eu.Type.Object({response:eu.Type.String()}),AgentQueryNoResponse:eu.Type.Object({}),AgentQueryResponse:eu.Type.Object({responseType:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("booleanResponse"),value:eu.Type.Ref("AgentQueryBooleanResponse")}),eu.Type.Object({$case:eu.Type.Literal("choiceResponse"),value:eu.Type.Ref("AgentQueryChoiceResponse")}),eu.Type.Object({$case:eu.Type.Literal("textResponse"),value:eu.Type.Ref("AgentQueryTextResponse")}),eu.Type.Object({$case:eu.Type.Literal("noResponse"),value:eu.Type.Ref("AgentQueryNoResponse")}),eu.Type.Undefined()]))}),QueryResponseContent:eu.Type.Object({responses:eu.Type.Array(eu.Type.Ref("AgentQueryResponse"))}),QueryRequestContent:eu.Type.Object({contextSummary:eu.Type.String(),queries:eu.Type.Array(eu.Type.Ref("AgentQuery"))}),MarkTaskCompleteRequest:eu.Type.Object({taskId:eu.Type.String()}),UserMarkedTaskComplete:eu.Type.Object({taskId:eu.Type.String()}),ApproveTaskListRequest:eu.Type.Object({taskListEventId:eu.Type.String()}),ApproveTaskListResponse:eu.Type.Object({taskListEventId:eu.Type.String(),approved:eu.Type.Boolean(),tasks:eu.Type.Array(eu.Type.Ref("Task")),agentConfig:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentConfig"),eu.Type.Undefined()]))}),ApproveInitialBuildMVPRequest:eu.Type.Object({taskListEventId:eu.Type.String(),userSecretsRequest:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentUserSecretsRequest"),eu.Type.Undefined()])),addingIntegrationRequest:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AddingIntegrationsRequest"),eu.Type.Undefined()]))}),ApproveInitialBuildMVPResponse:eu.Type.Object({approved:eu.Type.Boolean(),userSecretsResponse:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentUserSecretsResponse"),eu.Type.Undefined()])),addingIntegrationsResponse:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AddingIntegrationsResponse"),eu.Type.Undefined()])),agentConfig:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentConfig"),eu.Type.Undefined()]))}),ApproveInitialBuildVisualPhaseRequest:eu.Type.Object({userSecretsRequest:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentUserSecretsRequest"),eu.Type.Undefined()])),addingIntegrationRequest:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AddingIntegrationsRequest"),eu.Type.Undefined()]))}),ApproveInitialBuildVisualPhaseResponse:eu.Type.Object({approved:eu.Type.Boolean(),userSecretsResponse:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentUserSecretsResponse"),eu.Type.Undefined()])),addingIntegrationsResponse:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AddingIntegrationsResponse"),eu.Type.Undefined()])),agentConfig:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentConfig"),eu.Type.Undefined()]))}),ApproveSqlQueryRequest:eu.Type.Object({sqlQuery:eu.Type.String(),executionReason:eu.Type.String()}),ApproveSqlQueryResponse:eu.Type.Object({sqlQueryEventId:eu.Type.String(),approved:eu.Type.Boolean()}),ApproveBlueprintRequest:eu.Type.Object({blueprintName:eu.Type.String(),blueprintDisplayName:eu.Type.String()}),ApproveBlueprintResponse:eu.Type.Object({blueprintEventId:eu.Type.String(),approved:eu.Type.Boolean(),blueprintName:eu.Type.String()}),ConvertMockupToAppRequest:eu.Type.Object({}),ConvertMockupToAppResponse:eu.Type.Object({approved:eu.Type.Boolean(),additionalComments:eu.Type.String()}),AgentAskUserForActionRequest:eu.Type.Object({request:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("nextStepRequest"),value:eu.Type.Ref("AgentNextStepRequest")}),eu.Type.Object({$case:eu.Type.Literal("userSecretsRequest"),value:eu.Type.Ref("AgentUserSecretsRequest")}),eu.Type.Object({$case:eu.Type.Literal("deployRequest"),value:eu.Type.Ref("AgentDeployRequest")}),eu.Type.Object({$case:eu.Type.Literal("queryRequest"),value:eu.Type.Ref("QueryRequestContent")}),eu.Type.Object({$case:eu.Type.Literal("markTaskCompleteRequest"),value:eu.Type.Ref("MarkTaskCompleteRequest")}),eu.Type.Object({$case:eu.Type.Literal("approveTaskListRequest"),value:eu.Type.Ref("ApproveTaskListRequest")}),eu.Type.Object({$case:eu.Type.Literal("approveSqlQueryRequest"),value:eu.Type.Ref("ApproveSqlQueryRequest")}),eu.Type.Object({$case:eu.Type.Literal("addingIntegrationRequest"),value:eu.Type.Ref("AddingIntegrationsRequest")}),eu.Type.Object({$case:eu.Type.Literal("approveInitialBuildMvpRequest"),value:eu.Type.Ref("ApproveInitialBuildMVPRequest")}),eu.Type.Object({$case:eu.Type.Literal("approveInitialBuildVisualPhaseRequest"),value:eu.Type.Ref("ApproveInitialBuildVisualPhaseRequest")}),eu.Type.Object({$case:eu.Type.Literal("approveBlueprintRequest"),value:eu.Type.Ref("ApproveBlueprintRequest")}),eu.Type.Object({$case:eu.Type.Literal("environmentConfigRequest"),value:eu.Type.Ref("EnvironmentConfigRequest")}),eu.Type.Object({$case:eu.Type.Literal("convertMockupToAppRequest"),value:eu.Type.Ref("ConvertMockupToAppRequest")}),eu.Type.Undefined()])),message:eu.Type.String()}),AgentAskUserForActionResponse:eu.Type.Object({response:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("nextStepResponse"),value:eu.Type.Ref("AgentNextStepResponse")}),eu.Type.Object({$case:eu.Type.Literal("userSecretsResponse"),value:eu.Type.Ref("AgentUserSecretsResponse")}),eu.Type.Object({$case:eu.Type.Literal("deployResponse"),value:eu.Type.Ref("AgentDeployResponse")}),eu.Type.Object({$case:eu.Type.Literal("queryResponse"),value:eu.Type.Ref("QueryResponseContent")}),eu.Type.Object({$case:eu.Type.Literal("userMarkedTaskComplete"),value:eu.Type.Ref("UserMarkedTaskComplete")}),eu.Type.Object({$case:eu.Type.Literal("approveTaskListResponse"),value:eu.Type.Ref("ApproveTaskListResponse")}),eu.Type.Object({$case:eu.Type.Literal("approveSqlQueryResponse"),value:eu.Type.Ref("ApproveSqlQueryResponse")}),eu.Type.Object({$case:eu.Type.Literal("addingIntegrationsResponse"),value:eu.Type.Ref("AddingIntegrationsResponse")}),eu.Type.Object({$case:eu.Type.Literal("approveInitialBuildMvpResponse"),value:eu.Type.Ref("ApproveInitialBuildMVPResponse")}),eu.Type.Object({$case:eu.Type.Literal("approveInitialBuildVisualPhaseResponse"),value:eu.Type.Ref("ApproveInitialBuildVisualPhaseResponse")}),eu.Type.Object({$case:eu.Type.Literal("approveBlueprintResponse"),value:eu.Type.Ref("ApproveBlueprintResponse")}),eu.Type.Object({$case:eu.Type.Literal("envVarsResponse"),value:eu.Type.Ref("EnvironmentConfigResponse")}),eu.Type.Object({$case:eu.Type.Literal("convertMockupToAppResponse"),value:eu.Type.Ref("ConvertMockupToAppResponse")}),eu.Type.Undefined()])),requestEventId:eu.Type.String()}),SetupImportedProjectEventContents:eu.Type.Object({importSource:eu.Type.Ref("ProjectImportSource"),agentConfig:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentConfig"),eu.Type.Undefined()]))}),ProjectImportCompletedData:eu.Type.Object({}),MemoryCompressionData:eu.Type.Object({}),TaskListData:eu.Type.Object({tasks:eu.Type.Array(eu.Type.Ref("Task")),commitData:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("CommitData"),eu.Type.Undefined()])),agentMode:eu.Type.Ref("AgentMode"),estimatedUsageCents:eu.Type.Number()}),Task:eu.Type.Object({id:eu.Type.String(),content:eu.Type.String(),status:eu.Type.Ref("TaskStatus"),oldStatus:eu.Type.Ref("TaskStatus"),updated:eu.Type.Boolean(),summary:eu.Type.String(),extraDetails:eu.Type.String()}),EventContents:eu.Type.Object({contents:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("sessionCreationEventContents"),value:eu.Type.Ref("SessionCreationEventContents")}),eu.Type.Object({$case:eu.Type.Literal("messageEventContents"),value:eu.Type.Ref("MessageEventContents")}),eu.Type.Object({$case:eu.Type.Literal("inlineActionEventContents"),value:eu.Type.Ref("InlineActionEventContents")}),eu.Type.Object({$case:eu.Type.Literal("localShellExecutionEventContents"),value:eu.Type.Ref("LocalShellExecutionEventContents")}),eu.Type.Object({$case:eu.Type.Literal("shellSuggestionEventContents"),value:eu.Type.Ref("ShellSuggestionEventContents")}),eu.Type.Object({$case:eu.Type.Literal("translateEventContents"),value:eu.Type.Ref("TranslateEventContents")}),eu.Type.Object({$case:eu.Type.Literal("byoPromptEventContents"),value:eu.Type.Ref("BYOPromptEventContents")}),eu.Type.Object({$case:eu.Type.Literal("agentPlanEventContents"),value:eu.Type.Ref("AgentPlanEventContents")}),eu.Type.Object({$case:eu.Type.Literal("agentTimelineEventContents"),value:eu.Type.Ref("AgentTimelineEventContents")}),eu.Type.Object({$case:eu.Type.Literal("benchmarkConclusion"),value:eu.Type.Ref("BenchmarkConclusionEventContents")}),eu.Type.Object({$case:eu.Type.Literal("revertEventContents"),value:eu.Type.Ref("RevertEventContents")}),eu.Type.Object({$case:eu.Type.Literal("hostingDebugSummaryEventContents"),value:eu.Type.Ref("HostingDebugSummaryEventContents")}),eu.Type.Object({$case:eu.Type.Literal("approvePlanEventContents"),value:eu.Type.Ref("ApprovePlanEventContents")}),eu.Type.Object({$case:eu.Type.Literal("userSecretsResponseEventContents"),value:eu.Type.Ref("UserSecretsResponseEventContents")}),eu.Type.Object({$case:eu.Type.Literal("replCreationEventContents"),value:eu.Type.Ref("ReplCreationEventContents")}),eu.Type.Object({$case:eu.Type.Literal("iterativeAgentEventContents"),value:eu.Type.Ref("IterativeAgentEventContents")}),eu.Type.Object({$case:eu.Type.Literal("stepTooComplexEventContents"),value:eu.Type.Ref("StepTooComplexEventContents")}),eu.Type.Object({$case:eu.Type.Literal("stepTooComplexAcknowledgementEventContents"),value:eu.Type.Ref("StepTooComplexAcknowledgementEventContents")}),eu.Type.Object({$case:eu.Type.Literal("agentAskUserForActionRequest"),value:eu.Type.Ref("AgentAskUserForActionRequest")}),eu.Type.Object({$case:eu.Type.Literal("agentAskUserForActionResponse"),value:eu.Type.Ref("AgentAskUserForActionResponse")}),eu.Type.Object({$case:eu.Type.Literal("integrationTestEventContents"),value:eu.Type.Ref("IntegrationTestEventContents")}),eu.Type.Object({$case:eu.Type.Literal("contextComplexityEventContents"),value:eu.Type.Ref("ContextComplexityEventContents")}),eu.Type.Object({$case:eu.Type.Literal("eventTooLargeEventContents"),value:eu.Type.Ref("EventTooLargeEventContents")}),eu.Type.Object({$case:eu.Type.Literal("startRapidBuildEventContents"),value:eu.Type.Ref("StartRapidBuildEventContents")}),eu.Type.Object({$case:eu.Type.Literal("databaseNudgeEventContents"),value:eu.Type.Ref("DatabaseNudgeEventContents")}),eu.Type.Object({$case:eu.Type.Literal("rapidBuildConcluded"),value:eu.Type.Ref("RapidBuildConcludedData")}),eu.Type.Object({$case:eu.Type.Literal("versionMigrated"),value:eu.Type.Ref("VersionMigratedData")}),eu.Type.Object({$case:eu.Type.Literal("rapidBuildStarted"),value:eu.Type.Ref("RapidBuildStartedData")}),eu.Type.Object({$case:eu.Type.Literal("requestFeatureAddData"),value:eu.Type.Ref("RequestFeatureAdd")}),eu.Type.Object({$case:eu.Type.Literal("triggerCheckpointEventContents"),value:eu.Type.Ref("TriggerCheckpointEventContents")}),eu.Type.Object({$case:eu.Type.Literal("setupImportedProjectEventContents"),value:eu.Type.Ref("SetupImportedProjectEventContents")}),eu.Type.Object({$case:eu.Type.Literal("tipRecommendation"),value:eu.Type.Ref("UserTipRecommendationData")}),eu.Type.Object({$case:eu.Type.Literal("subagentRunning"),value:eu.Type.Ref("SubagentRunningData")}),eu.Type.Object({$case:eu.Type.Literal("uiTestingSubagentExecutionEventContents"),value:eu.Type.Ref("UITestingSubagentExecutionEventContents")}),eu.Type.Object({$case:eu.Type.Literal("initialBuildStateUpdateEventContents"),value:eu.Type.Ref("InitialBuildStateUpdateEventContents")}),eu.Type.Object({$case:eu.Type.Literal("agentConfigUpdateEventContents"),value:eu.Type.Ref("AgentConfigUpdateEventContents")}),eu.Type.Object({$case:eu.Type.Literal("cloudBudgetExceededEventContents"),value:eu.Type.Ref("CloudBudgetExceededEventContents")}),eu.Type.Object({$case:eu.Type.Literal("executedSandboxedCodeData"),value:eu.Type.Ref("ExecutedSandboxedCodeEventData")}),eu.Type.Undefined()])),benchmarkParameters:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("BenchmarkParameters"),eu.Type.Undefined()]))}),EventContext:eu.Type.Object({metadata:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("sessionCreationEventContext"),value:eu.Type.Ref("SessionCreationEventContext")}),eu.Type.Object({$case:eu.Type.Literal("messageEventContext"),value:eu.Type.Ref("MessageEventContext")}),eu.Type.Object({$case:eu.Type.Literal("inlineActionEventContext"),value:eu.Type.Ref("InlineActionEventContext")}),eu.Type.Object({$case:eu.Type.Literal("localShellExecutionEventContext"),value:eu.Type.Ref("LocalShellExecutionEventContext")}),eu.Type.Object({$case:eu.Type.Literal("shellSuggestionEventContext"),value:eu.Type.Ref("ShellSuggestionEventContext")}),eu.Type.Object({$case:eu.Type.Literal("translateEventContext"),value:eu.Type.Ref("TranslateEventContext")}),eu.Type.Object({$case:eu.Type.Literal("byoPromptEventContext"),value:eu.Type.Ref("BYOPromptEventContext")}),eu.Type.Object({$case:eu.Type.Literal("agentPlanEventContext"),value:eu.Type.Ref("AgentPlanEventContext")}),eu.Type.Object({$case:eu.Type.Literal("agentTimelineEventContext"),value:eu.Type.Ref("AgentTimelineEventContext")}),eu.Type.Object({$case:eu.Type.Literal("hostingDebugSummaryEventContext"),value:eu.Type.Ref("HostingDebugSummaryEventContext")}),eu.Type.Object({$case:eu.Type.Literal("replCreationEventContext"),value:eu.Type.Ref("ReplCreationEventContext")}),eu.Type.Object({$case:eu.Type.Literal("userSecretsResponseEventContext"),value:eu.Type.Ref("UserSecretsResponseEventContext")}),eu.Type.Object({$case:eu.Type.Literal("revertEventContext"),value:eu.Type.Ref("RevertEventContext")}),eu.Type.Object({$case:eu.Type.Literal("iterativeAgentEventContext"),value:eu.Type.Ref("IterativeAgentEventContext")}),eu.Type.Object({$case:eu.Type.Literal("integrationTestEventContext"),value:eu.Type.Ref("IntegrationTestEventContext")}),eu.Type.Undefined()]))}),StartRapidBuildEventContents:eu.Type.Object({mvpObjective:eu.Type.String(),stack:eu.Type.String(),followupSteps:eu.Type.Array(eu.Type.String()),uploadedFiles:eu.Type.Array(eu.Type.Ref("UploadedRapidBuildFile")),extraDetails:eu.Type.String(),techStack:eu.Type.String(),mvpSuccessCriteria:eu.Type.String()}),RapidBuildStartedData:eu.Type.Object({}),SessionCreationEventContents:eu.Type.Object({}),DatabaseNudgeEventContents:eu.Type.Object({}),CloudBudgetExceededEventContents:eu.Type.Object({serviceName:eu.Type.String()}),SkillLoadedEventData:eu.Type.Object({skillName:eu.Type.String()}),ExecutedSandboxedCodeEventData:eu.Type.Object({language:eu.Type.Ref("SandboxLanguage"),code:eu.Type.String(),stdout:eu.Type.String(),stderr:eu.Type.String(),description:eu.Type.String(),output:eu.Type.Array(eu.Type.Ref("SandboxOutput"))}),SandboxOutput:eu.Type.Object({type:eu.Type.Ref("SandboxOutputType"),output:eu.Type.String()}),AddExecutedSandboxedCodeOutput:eu.Type.Object({output:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("SandboxOutput"),eu.Type.Undefined()]))}),CodeChangeStats:eu.Type.Object({linesAdded:eu.Type.Number(),linesRemoved:eu.Type.Number(),commitId:eu.Type.String()}),AgentPlanStep:eu.Type.Recursive(function(e){return eu.Type.Object({id:eu.Type.String(),name:eu.Type.String(),status:eu.Type.Ref("AgentPlanStepStatus"),message:eu.Type.String(),metadata:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("codeChangeStats"),value:eu.Type.Ref("CodeChangeStats")}),eu.Type.Undefined()])),timelineEventId:eu.Type.String(),subSteps:eu.Type.Array(e),blueprints:eu.Type.Array(eu.Type.String()),blueprintData:eu.Type.Array(eu.Type.Ref("BlueprintData")),mode:eu.Type.String(),commitId:eu.Type.String()})}),BlueprintsSetup:eu.Type.Object({blueprintData:eu.Type.Array(eu.Type.Ref("BlueprintData"))}),RequestFeatureAdd:eu.Type.Object({type:eu.Type.Ref("RequestFeatureAddType")}),AgentPlanObjective:eu.Type.Object({description:eu.Type.String()}),AgentPlanEventContents:eu.Type.Object({planId:eu.Type.String(),objective:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentPlanObjective"),eu.Type.Undefined()])),step:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentPlanStep"),eu.Type.Undefined()])),requiresApproval:eu.Type.Boolean(),initialCommitId:eu.Type.String(),approver:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("UserContext"),eu.Type.Undefined()])),stackBlueprint:tp,designReferenceFilePaths:eu.Type.Array(eu.Type.String()),approvedDesignReferenceFilePath:eu.Type.String(),customStackReplId:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),userSecretsRequest:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentUserSecretsRequest"),eu.Type.Undefined()])),agentStackTriggerType:eu.Type.Ref("AgentStackTriggerType")}),AgentPlanEventContext:eu.Type.Object({}),RevertEventContext:eu.Type.Object({}),BlueprintData:eu.Type.Object({category:eu.Type.Ref("BlueprintCategory"),displayName:eu.Type.String(),name:eu.Type.String(),secrets:eu.Type.Array(eu.Type.Ref("Secret"))}),ShellExecutionData:eu.Type.Object({command:eu.Type.String(),shellId:eu.Type.String(),stdout:eu.Type.String(),stderr:eu.Type.String(),exitCode:eu.Type.Number(),processId:eu.Type.String(),isExecuting:eu.Type.Boolean(),output:eu.Type.String()}),FileEditData:eu.Type.Object({filePath:eu.Type.String(),diff:eu.Type.String(),removedLines:eu.Type.Number(),addedLines:eu.Type.Number()}),CreateFileData:eu.Type.Object({filePath:eu.Type.String(),content:eu.Type.String()}),ReadFileData:eu.Type.Object({filePath:eu.Type.String(),content:eu.Type.String(),startLine:eu.Type.Number(),endLine:eu.Type.Number()}),ReadDirData:eu.Type.Object({path:eu.Type.String(),paths:eu.Type.Array(eu.Type.String())}),PackagerInstallData:eu.Type.Object({inputLanguage:eu.Type.String(),inputPackages:eu.Type.Array(eu.Type.String()),output:eu.Type.String(),processId:eu.Type.String(),isExecuting:eu.Type.Boolean()}),PackagerUninstallData:eu.Type.Object({inputLanguage:eu.Type.String(),inputPackages:eu.Type.Array(eu.Type.String())}),SearchFilesystemData:eu.Type.Object({queryDescription:eu.Type.String(),filePaths:eu.Type.Array(eu.Type.String()),classNames:eu.Type.Array(eu.Type.String()),functionNames:eu.Type.Array(eu.Type.String()),resultFileNames:eu.Type.Array(eu.Type.String()),resultFileSummaries:eu.Type.Array(eu.Type.String())}),WebSearchResultPage:eu.Type.Object({title:eu.Type.String(),url:eu.Type.String()}),GoogleSuggestedSearch:eu.Type.Object({webSearchQueries:eu.Type.Array(eu.Type.String())}),WebSearchData:eu.Type.Object({query:eu.Type.String(),response:eu.Type.String(),pageResults:eu.Type.Array(eu.Type.Ref("WebSearchResultPage")),googleSuggestedSearch:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("GoogleSuggestedSearch"),eu.Type.Undefined()])),searchType:eu.Type.Ref("WebSearchType")}),WebPageVisitData:eu.Type.Object({url:eu.Type.String(),title:eu.Type.String(),snippet:eu.Type.String(),favicon:eu.Type.String()}),ScreenshotData:eu.Type.Object({port:eu.Type.Number(),path:eu.Type.String(),imageUrl:eu.Type.String()}),ToolchainInstallData:eu.Type.Object({modules:eu.Type.Array(eu.Type.String())}),WorkflowsGetOutputToolData:eu.Type.Object({name:eu.Type.String(),output:eu.Type.String()}),WorkflowsRemoveRunConfigToolData:eu.Type.Object({name:eu.Type.String()}),WorkflowsRestartToolData:eu.Type.Object({name:eu.Type.String()}),WorkflowsSetRunConfigToolData:eu.Type.Object({name:eu.Type.String(),command:eu.Type.String()}),WorkflowsStartToolData:eu.Type.Object({name:eu.Type.String()}),WorkflowsStopToolData:eu.Type.Object({name:eu.Type.String()}),CheckpointSuggestions:eu.Type.Object({recommended:eu.Type.Boolean(),commitData:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("CommitData"),eu.Type.Undefined()])),suggestionReason:eu.Type.Ref("CheckpointSuggestionReason"),rollbackDatabase:eu.Type.Boolean(),rollbackRepl:eu.Type.Boolean()}),SuggestRollbackData:eu.Type.Object({suggestRollbackReason:eu.Type.String(),checkpointCommitSha:eu.Type.String(),checkpointSuggestions:eu.Type.Array(eu.Type.Ref("CheckpointSuggestions"))}),AgentStoppedData:eu.Type.Object({checkpointSuggestions:eu.Type.Array(eu.Type.Ref("CheckpointSuggestions"))}),PresentResultsToolData:eu.Type.Object({resultType:eu.Type.String(),shellCommand:eu.Type.String(),websitePort:eu.Type.Number(),shellCommandWorkflowName:eu.Type.String(),websiteRoute:eu.Type.String()}),SearchFileData:eu.Type.Object({filePath:eu.Type.String(),query:eu.Type.String()}),SuggestGeneralBuildModeData:eu.Type.Object({message:eu.Type.String(),suggestedAutonomyLevel:eu.Type.Ref("AutonomyLevel")}),AgentTimelineEventContents:eu.Type.Object({toolName:eu.Type.String(),planStepId:eu.Type.String(),message:eu.Type.String(),toolData:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("shellExecutionData"),value:eu.Type.Ref("ShellExecutionData")}),eu.Type.Object({$case:eu.Type.Literal("fileEditData"),value:eu.Type.Ref("FileEditData")}),eu.Type.Object({$case:eu.Type.Literal("createFileData"),value:eu.Type.Ref("CreateFileData")}),eu.Type.Object({$case:eu.Type.Literal("readFileData"),value:eu.Type.Ref("ReadFileData")}),eu.Type.Object({$case:eu.Type.Literal("packagerInstallData"),value:eu.Type.Ref("PackagerInstallData")}),eu.Type.Object({$case:eu.Type.Literal("searchFilesystemData"),value:eu.Type.Ref("SearchFilesystemData")}),eu.Type.Object({$case:eu.Type.Literal("messageData"),value:eu.Type.Ref("MessageEventContents")}),eu.Type.Object({$case:eu.Type.Literal("packagerUninstallData"),value:eu.Type.Ref("PackagerUninstallData")}),eu.Type.Object({$case:eu.Type.Literal("screenshotData"),value:eu.Type.Ref("ScreenshotData")}),eu.Type.Object({$case:eu.Type.Literal("toolchainInstallData"),value:eu.Type.Ref("ToolchainInstallData")}),eu.Type.Object({$case:eu.Type.Literal("workflowsGetOutputToolData"),value:eu.Type.Ref("WorkflowsGetOutputToolData")}),eu.Type.Object({$case:eu.Type.Literal("workflowsRemoveRunConfigToolData"),value:eu.Type.Ref("WorkflowsRemoveRunConfigToolData")}),eu.Type.Object({$case:eu.Type.Literal("workflowsRestartToolData"),value:eu.Type.Ref("WorkflowsRestartToolData")}),eu.Type.Object({$case:eu.Type.Literal("workflowsSetRunConfigToolData"),value:eu.Type.Ref("WorkflowsSetRunConfigToolData")}),eu.Type.Object({$case:eu.Type.Literal("workflowsStartToolData"),value:eu.Type.Ref("WorkflowsStartToolData")}),eu.Type.Object({$case:eu.Type.Literal("workflowsStopToolData"),value:eu.Type.Ref("WorkflowsStopToolData")}),eu.Type.Object({$case:eu.Type.Literal("planProgressData"),value:eu.Type.Ref("PlanProgressData")}),eu.Type.Object({$case:eu.Type.Literal("summarizeObjectiveData"),value:eu.Type.Ref("SummarizeObjectiveData")}),eu.Type.Object({$case:eu.Type.Literal("presentResultsToolData"),value:eu.Type.Ref("PresentResultsToolData")}),eu.Type.Object({$case:eu.Type.Literal("searchFileData"),value:eu.Type.Ref("SearchFileData")}),eu.Type.Object({$case:eu.Type.Literal("systemDependencyInstallData"),value:eu.Type.Ref("SystemDependencyInstallData")}),eu.Type.Object({$case:eu.Type.Literal("systemDependencyUninstallData"),value:eu.Type.Ref("SystemDependencyUninstallData")}),eu.Type.Object({$case:eu.Type.Literal("deployData"),value:eu.Type.Ref("DeployData")}),eu.Type.Object({$case:eu.Type.Literal("revertData"),value:eu.Type.Ref("RevertData")}),eu.Type.Object({$case:eu.Type.Literal("deployConfigData"),value:eu.Type.Ref("DeployConfigData")}),eu.Type.Object({$case:eu.Type.Literal("agentPlanStepBegin"),value:eu.Type.Ref("AgentPlanStepBeginData")}),eu.Type.Object({$case:eu.Type.Literal("acknowledgeUserMessage"),value:eu.Type.Ref("AcknowledgeUserMessage")}),eu.Type.Object({$case:eu.Type.Literal("createPostgresqlDatabaseData"),value:eu.Type.Ref("CreatePostgreSQLDatabaseData")}),eu.Type.Object({$case:eu.Type.Literal("sqlExecutionData"),value:eu.Type.Ref("SqlExecutionData")}),eu.Type.Object({$case:eu.Type.Literal("newSessionNudge"),value:eu.Type.Ref("NewSessionNudge")}),eu.Type.Object({$case:eu.Type.Literal("commitData"),value:eu.Type.Ref("CommitData")}),eu.Type.Object({$case:eu.Type.Literal("readDirData"),value:eu.Type.Ref("ReadDirData")}),eu.Type.Object({$case:eu.Type.Literal("thoughts"),value:eu.Type.Ref("AgentThoughtsData")}),eu.Type.Object({$case:eu.Type.Literal("blueprintsSetup"),value:eu.Type.Ref("BlueprintsSetup")}),eu.Type.Object({$case:eu.Type.Literal("webPageVisitData"),value:eu.Type.Ref("WebPageVisitData")}),eu.Type.Object({$case:eu.Type.Literal("webSearchData"),value:eu.Type.Ref("WebSearchData")}),eu.Type.Object({$case:eu.Type.Literal("imageGenerationData"),value:eu.Type.Ref("ImageGenerationData")}),eu.Type.Object({$case:eu.Type.Literal("projectImportCompleted"),value:eu.Type.Ref("ProjectImportCompletedData")}),eu.Type.Object({$case:eu.Type.Literal("memoryCompressionData"),value:eu.Type.Ref("MemoryCompressionData")}),eu.Type.Object({$case:eu.Type.Literal("suggestRollbackData"),value:eu.Type.Ref("SuggestRollbackData")}),eu.Type.Object({$case:eu.Type.Literal("taskListData"),value:eu.Type.Ref("TaskListData")}),eu.Type.Object({$case:eu.Type.Literal("samplingEvent"),value:eu.Type.Ref("SamplingEvent")}),eu.Type.Object({$case:eu.Type.Literal("setupObjectStorageData"),value:eu.Type.Ref("SetupObjectStorageData")}),eu.Type.Object({$case:eu.Type.Literal("endOfRunSummaryData"),value:eu.Type.Ref("EndOfRunSummaryData")}),eu.Type.Object({$case:eu.Type.Literal("stockImageData"),value:eu.Type.Ref("StockImageData")}),eu.Type.Object({$case:eu.Type.Literal("searchIntegrationsData"),value:eu.Type.Ref("SearchIntegrationsData")}),eu.Type.Object({$case:eu.Type.Literal("viewIntegrationData"),value:eu.Type.Ref("ViewIntegrationData")}),eu.Type.Object({$case:eu.Type.Literal("setupModelfarmData"),value:eu.Type.Ref("SetupModelfarmData")}),eu.Type.Object({$case:eu.Type.Literal("viewLogsData"),value:eu.Type.Ref("ViewLogsData")}),eu.Type.Object({$case:eu.Type.Literal("uiTestingSubagentTakeOverData"),value:eu.Type.Ref("UITestingSubagentTakeOverData")}),eu.Type.Object({$case:eu.Type.Literal("viewSpecialFiles"),value:eu.Type.Ref("ViewSpecialFilesData")}),eu.Type.Object({$case:eu.Type.Literal("designGuidelinesData"),value:eu.Type.Ref("DesignGuidelinesData")}),eu.Type.Object({$case:eu.Type.Literal("mcpToolData"),value:eu.Type.Ref("MCPToolData")}),eu.Type.Object({$case:eu.Type.Literal("alertData"),value:eu.Type.Ref("AlertData")}),eu.Type.Object({$case:eu.Type.Literal("viewEnvVarData"),value:eu.Type.Ref("ViewEnvVarData")}),eu.Type.Object({$case:eu.Type.Literal("setEnvVarData"),value:eu.Type.Ref("SetEnvVarData")}),eu.Type.Object({$case:eu.Type.Literal("deleteEnvVarData"),value:eu.Type.Ref("DeleteEnvVarData")}),eu.Type.Object({$case:eu.Type.Literal("videoGenerationData"),value:eu.Type.Ref("VideoGenerationData")}),eu.Type.Object({$case:eu.Type.Literal("generateMediaData"),value:eu.Type.Ref("GenerateMediaData")}),eu.Type.Object({$case:eu.Type.Literal("waitingForBackgroundJobsData"),value:eu.Type.Ref("WaitingForBackgroundJobsData")}),eu.Type.Object({$case:eu.Type.Literal("suggestGeneralBuildModeData"),value:eu.Type.Ref("SuggestGeneralBuildModeData")}),eu.Type.Object({$case:eu.Type.Literal("messagedBackgroundAgent"),value:eu.Type.Ref("MessagedBackgroundAgentData")}),eu.Type.Object({$case:eu.Type.Literal("subagentReportResultData"),value:eu.Type.Ref("SubagentReportResultData")}),eu.Type.Object({$case:eu.Type.Literal("reportAgentIssueData"),value:eu.Type.Ref("ReportAgentIssueData")}),eu.Type.Object({$case:eu.Type.Literal("agentStoppedData"),value:eu.Type.Ref("AgentStoppedData")}),eu.Type.Object({$case:eu.Type.Literal("createAutomationPreviewData"),value:eu.Type.Ref("CreateAutomationPreviewData")}),eu.Type.Object({$case:eu.Type.Literal("skillLoadedData"),value:eu.Type.Ref("SkillLoadedEventData")}),eu.Type.Object({$case:eu.Type.Literal("executedSandboxedCodeData"),value:eu.Type.Ref("ExecutedSandboxedCodeEventData")}),eu.Type.Undefined()]))}),AgentPlanStepBeginData:eu.Type.Object({planStep:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentPlanStep"),eu.Type.Undefined()])),starts:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()]))}),SummarizeObjectiveData:eu.Type.Object({summarizedObjective:eu.Type.String()}),AgentThoughtsData:eu.Type.Object({thoughts:eu.Type.String(),redactedThoughtsMarkers:eu.Type.Array(eu.Type.Ref("RedactedThoughtsMarker")),totalTimeTakenMs:eu.Type.Number(),summary:eu.Type.String()}),RedactedThoughtsMarker:eu.Type.Object({index:eu.Type.Number()}),RapidBuildConcludedData:eu.Type.Object({willContinueWorking:eu.Type.Boolean()}),VersionMigratedData:eu.Type.Object({version:eu.Type.Number()}),PlanProgressData:eu.Type.Object({updatedPlanStep:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentPlanStep"),eu.Type.Undefined()]))}),BenchmarkConclusionEventContents:eu.Type.Object({completionReason:eu.Type.Ref("BenchmarkConclusionReason"),steps:eu.Type.Number(),exception:eu.Type.String(),datasetId:eu.Type.String(),instanceId:eu.Type.String(),runId:eu.Type.String(),metrics:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("BenchmarkMetrics"),eu.Type.Undefined()]))}),BenchmarkMetrics:eu.Type.Object({increment:eu.Type.Array(eu.Type.Ref("Metric")),decrement:eu.Type.Array(eu.Type.Ref("Metric")),gauge:eu.Type.Array(eu.Type.Ref("Metric")),histogram:eu.Type.Array(eu.Type.Ref("Metric")),distribution:eu.Type.Array(eu.Type.Ref("Metric")),timing:eu.Type.Array(eu.Type.Ref("Metric"))}),Metric:eu.Type.Object({name:eu.Type.String(),metrics:eu.Type.Array(eu.Type.Ref("MetricByTag"))}),MetricByTag:eu.Type.Object({tags:eu.Type.Array(eu.Type.String()),values:eu.Type.Array(eu.Type.Number())}),AgentTimelineEventContext:eu.Type.Object({}),Range:eu.Type.Object({indexFrom:eu.Type.Number(),indexTo:eu.Type.Number(),lineFrom:eu.Type.Number(),lineTo:eu.Type.Number()}),CodeReference:eu.Type.Object({code:eu.Type.String(),filePath:eu.Type.String(),fileVersion:eu.Type.Number(),fileContent:eu.Type.String(),range:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("Range"),eu.Type.Undefined()])),language:eu.Type.String(),referenceType:eu.Type.Ref("CodeReferenceType")}),MessageEventContents:eu.Type.Object({content:eu.Type.String(),intent:eu.Type.Ref("MessageAction"),stopReason:eu.Type.Ref("MessageStopReason"),debugFullPrompt:eu.Type.String(),codeReference:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("CodeReference"),eu.Type.Undefined()])),debugErrorSource:eu.Type.Ref("DebugErrorSource"),media:eu.Type.Array(eu.Type.Ref("MediaReference")),usedModelSelector:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelSelector"),eu.Type.Undefined()])),sources:eu.Type.Array(eu.Type.Ref("Source")),extraActions:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("suggestedTemplates"),value:eu.Type.Ref("SuggestedTemplates")}),eu.Type.Object({$case:eu.Type.Literal("proposedFileChanges"),value:eu.Type.Ref("ProposedFileChanges")}),eu.Type.Undefined()])),benchmarkMode:eu.Type.Boolean(),benchmarkParameters:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("BenchmarkParameters"),eu.Type.Undefined()])),agentAction:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentAction"),eu.Type.Undefined()])),uploadedFiles:eu.Type.Array(eu.Type.Ref("UploadedFile")),attachedUrls:eu.Type.Array(eu.Type.Ref("AttachedUrl")),commitId:eu.Type.String(),lastSeenWebviewLogTimestamp:eu.Type.Number(),assistantProposedActions:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AssistantProposedActions"),eu.Type.Undefined()])),ragContext:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("SelectedRagContext"),eu.Type.Undefined()])),attachedForm:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AttachedForm"),eu.Type.Undefined()])),enableDeepThinking:eu.Type.Boolean(),targetedElement:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("TargetedElement"),eu.Type.Undefined()])),requestedStackBlueprint:tp,quickEdit:eu.Type.Boolean(),agentConfig:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentConfig"),eu.Type.Undefined()])),customStackReplId:eu.Type.String(),themeConfig:eu.Type.String(),agentStackTriggerType:eu.Type.Ref("AgentStackTriggerType")}),TargetedElement:eu.Type.Object({filePath:eu.Type.String(),lineNumber:eu.Type.Number(),componentName:eu.Type.String(),textContent:eu.Type.String(),imageSourceUrl:eu.Type.String(),hasChildElements:eu.Type.Boolean(),siblingCount:eu.Type.Number(),parent:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("RelatedElement"),eu.Type.Undefined()])),nextSibling:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("RelatedElement"),eu.Type.Undefined()])),grandparent:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("RelatedElement"),eu.Type.Undefined()]))}),RelatedElement:eu.Type.Object({tagName:eu.Type.String(),className:eu.Type.String(),textContent:eu.Type.String(),id:eu.Type.String()}),AttachedForm:eu.Type.Object({formType:eu.Type.Ref("AttachedFormType"),fields:eu.Type.Array(eu.Type.Ref("AttachedFormField"))}),AttachedFormField:eu.Type.Object({path:eu.Type.String(),formType:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("string"),value:eu.Type.Ref("AttachedFormStringField")}),eu.Type.Object({$case:eu.Type.Literal("files"),value:eu.Type.Ref("AttachedFormFilesField")}),eu.Type.Undefined()]))}),AttachedFormStringField:eu.Type.Object({value:eu.Type.String()}),AttachedFormFilesField:eu.Type.Object({files:eu.Type.Array(eu.Type.Ref("AttachedFormFiles"))}),AttachedFormFiles:eu.Type.Object({name:eu.Type.String(),url:eu.Type.String(),mimeType:eu.Type.String()}),UpdateAttachedFormStringFieldSet:eu.Type.Object({path:eu.Type.String(),value:eu.Type.String()}),UpdateAttachedFormStringFieldAppend:eu.Type.Object({path:eu.Type.String(),value:eu.Type.String()}),SelectedRagContext:eu.Type.Object({replitDocumentationQuery:eu.Type.String(),fileSearchQuery:eu.Type.String(),selectedFiles:eu.Type.String(),selectedClasses:eu.Type.String()}),AssistantProposedActions:eu.Type.Object({summary:eu.Type.String(),commitId:eu.Type.String(),shellCommands:eu.Type.Array(eu.Type.Ref("ProposedShellCommand")),fileChanges:eu.Type.Array(eu.Type.Ref("ProposedFileChange")),workspaceToolNudges:eu.Type.Array(eu.Type.Ref("ProposedWorkspaceToolNudge")),packageInstalls:eu.Type.Array(eu.Type.Ref("ProposedPackageInstall")),didCreateCheckpoint:eu.Type.Boolean(),didCountEditRequest:eu.Type.Boolean(),runConfigurations:eu.Type.Array(eu.Type.Ref("ProposedRunConfiguration")),deploymentConfigurations:eu.Type.Array(eu.Type.Ref("ProposedDeploymentConfiguration")),workflowConfigurations:eu.Type.Array(eu.Type.Ref("ProposedWorkflowConfiguration"))}),IntegrationTestEventContents:eu.Type.Object({expectedResponseString:eu.Type.String(),streamedResponse:eu.Type.Boolean(),timeBetweenChunks:eu.Type.Number()}),ContextComplexityEventContents:eu.Type.Object({fullness:eu.Type.Number()}),EventTooLargeEventContents:eu.Type.Object({}),IntegrationTestEventContext:eu.Type.Object({}),AttachedUrl:eu.Type.Object({url:eu.Type.String(),intent:eu.Type.Ref("UrlIntent")}),UploadedFile:eu.Type.Object({path:eu.Type.String(),mimeType:eu.Type.String()}),UploadedRapidBuildFile:eu.Type.Object({fileName:eu.Type.String(),downloadUrl:eu.Type.String()}),BenchmarkParameters:eu.Type.Object({datasetId:eu.Type.String(),instanceId:eu.Type.String(),runId:eu.Type.String(),replDescription:eu.Type.String(),disableSandbox:eu.Type.Boolean(),commandPrefix:eu.Type.Array(eu.Type.String()),overrideShellExecuteTimeoutSeconds:eu.Type.Number(),overrideMaxSteps:eu.Type.Number()}),SuggestedTemplates:eu.Type.Object({suggestedTemplates:eu.Type.Array(eu.Type.Ref("SuggestedTemplate"))}),SuggestedTemplate:eu.Type.Object({name:eu.Type.String(),replId:eu.Type.String(),description:eu.Type.String(),icon:eu.Type.String(),language:eu.Type.String(),id:eu.Type.String(),ownerUsername:eu.Type.String(),slug:eu.Type.String()}),ProposedFileChanges:eu.Type.Object({changes:eu.Type.Array(eu.Type.Ref("ProposedFileChange")),commitId:eu.Type.String(),summary:eu.Type.String()}),ProposedFileChange:eu.Type.Object({filePath:eu.Type.String(),content:eu.Type.String(),changeSummary:eu.Type.String(),state:eu.Type.Ref("FileChangeGenerationState"),messageContentsOffset:eu.Type.Number(),diff:eu.Type.String()}),ProposedShellCommand:eu.Type.Object({messageContentsOffset:eu.Type.Number(),command:eu.Type.String(),workingDirectory:eu.Type.String(),isDangerous:eu.Type.Boolean()}),ProposedPackageInstall:eu.Type.Object({messageContentsOffset:eu.Type.Number(),language:eu.Type.String(),packageList:eu.Type.Array(eu.Type.String())}),ProposedWorkspaceToolNudge:eu.Type.Object({messageContentsOffset:eu.Type.Number(),toolName:eu.Type.String(),reason:eu.Type.String(),description:eu.Type.String()}),ProposedRunConfiguration:eu.Type.Object({messageContentsOffset:eu.Type.Number(),workflowName:eu.Type.String(),setRunButton:eu.Type.Boolean(),oldCommand:eu.Type.String(),newCommand:eu.Type.String()}),ProposedWorkflowConfiguration:eu.Type.Object({messageContentsOffset:eu.Type.Number(),workflowName:eu.Type.String(),commands:eu.Type.Array(eu.Type.String()),setRunButton:eu.Type.Boolean(),mode:eu.Type.String()}),ProposedDeploymentConfiguration:eu.Type.Object({messageContentsOffset:eu.Type.Number(),buildCommand:eu.Type.String(),runCommand:eu.Type.String()}),Source:eu.Type.Object({url:eu.Type.String(),contents:eu.Type.String(),lineNumber:eu.Type.Number(),id:eu.Type.String()}),InlineActionEventContents:eu.Type.Object({messageType:eu.Type.Ref("InlineMessageType"),debugErrorSource:eu.Type.Ref("DebugErrorSource"),content:eu.Type.String(),codeReference:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("CodeReference"),eu.Type.Undefined()])),usedModelSelector:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelSelector"),eu.Type.Undefined()])),media:eu.Type.Array(eu.Type.Ref("MediaReference")),sources:eu.Type.Array(eu.Type.Ref("Source"))}),ShellSuggestionEventContents:eu.Type.Object({content:eu.Type.String()}),SessionCreationEventContext:eu.Type.Object({}),TranslateEventContents:eu.Type.Object({inputTarget:eu.Type.Ref("TranslationTarget"),outputTarget:eu.Type.Ref("TranslationTarget"),content:eu.Type.String()}),TranslateEventContext:eu.Type.Object({modelSelector:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelSelector"),eu.Type.Undefined()]))}),LocalShellExecutionEventContents:eu.Type.Object({command:eu.Type.String(),result:eu.Type.String(),eventId:eu.Type.String(),index:eu.Type.Number(),exitCode:eu.Type.Number(),channelName:eu.Type.String(),executed:eu.Type.Boolean()}),LocalShellExecutionEventContext:eu.Type.Object({}),ShellSuggestionEventContext:eu.Type.Object({modelSelector:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelSelector"),eu.Type.Undefined()]))}),ModelSelector:eu.Type.Object({type:eu.Type.Ref("ModelType"),overrideModelName:eu.Type.String()}),EventError:eu.Type.Object({type:eu.Type.Ref("EventErrorType"),message:eu.Type.String(),shortMessage:eu.Type.String()}),MediaReference:eu.Type.Object({identifier:eu.Type.String(),url:eu.Type.String(),mimeType:eu.Type.String()}),AgentConfig:eu.Type.Object({maxSteps:eu.Type.Number(),enablePlanMode:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),enableHumanInLoop:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),thinkingEnabled:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),modelProfile:eu.Type.Ref("ModelProfile"),enableAutomatedTesting:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),samplingRate:eu.Type.Number(),webSearchEnabled:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),agentMode:eu.Type.Ref("AgentMode"),imageGenerationEnabled:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),initialBuildMode:eu.Type.Ref("AgentInitialBuildMode"),maxAutonomyEnabled:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),autonomyLevel:eu.Type.Ref("AutonomyLevel"),agentInitialBuildTier:eu.Type.Ref("AgentInitialBuildTier"),headlessMode:eu.Type.Boolean(),workspaceLessMode:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),enableAutoCheckpointing:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()]))}),MessageEventContext:eu.Type.Object({mostRecentFile:eu.Type.String(),fileContext:eu.Type.Array(eu.Type.Ref("CodeReference")),modelSelector:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelSelector"),eu.Type.Undefined()])),intent:eu.Type.Ref("MessageAction"),extraResources:eu.Type.Array(eu.Type.String()),useRag:eu.Type.Boolean(),agentConfig:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentConfig"),eu.Type.Undefined()])),messageSource:eu.Type.Ref("MessageSource")}),InlineActionEventContext:eu.Type.Object({mostRecentFile:eu.Type.String(),fileContext:eu.Type.Array(eu.Type.Ref("CodeReference")),modelSelector:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelSelector"),eu.Type.Undefined()])),extraResources:eu.Type.Array(eu.Type.String()),useRag:eu.Type.Boolean()}),UpdateEventOperation:eu.Type.Object({id:eu.Type.String(),operationType:eu.Type.Ref("UpdateEventOperationType"),key:eu.Type.String(),value:eu.Type.String(),intValue:eu.Type.Number(),boolValue:eu.Type.Boolean(),protobufValue:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("Any"),eu.Type.Undefined()])),structValue:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("Struct"),eu.Type.Undefined()]))}),TypedUpdateEventOperation:eu.Type.Object({id:eu.Type.String(),operation:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("messageContentsUpdate"),value:eu.Type.Ref("MessageContentsUpdate")}),eu.Type.Object({$case:eu.Type.Literal("shellSuggestionContentsUpdate"),value:eu.Type.Ref("ShellSuggestionContentsUpdate")}),eu.Type.Object({$case:eu.Type.Literal("addSourcesUpdate"),value:eu.Type.Ref("AddSourcesUpdate")}),eu.Type.Object({$case:eu.Type.Literal("addSuggestedTemplatesUpdate"),value:eu.Type.Ref("AddSuggestedTemplatesUpdate")}),eu.Type.Object({$case:eu.Type.Literal("byoPromptResultUpdate"),value:eu.Type.Ref("BYOPromptResultUpdate")}),eu.Type.Object({$case:eu.Type.Literal("messageContentsSet"),value:eu.Type.Ref("MessageContentsSet")}),eu.Type.Object({$case:eu.Type.Literal("agentTimelineEventSet"),value:eu.Type.Ref("AgentTimelineEventSet")}),eu.Type.Object({$case:eu.Type.Literal("hostingDebugSummaryEventSet"),value:eu.Type.Ref("HostingDebugSummaryEventSet")}),eu.Type.Object({$case:eu.Type.Literal("replCreationEventSet"),value:eu.Type.Ref("ReplCreationEventSet")}),eu.Type.Object({$case:eu.Type.Literal("localShellExecutionEventSet"),value:eu.Type.Ref("LocalShellExecutionEventSet")}),eu.Type.Object({$case:eu.Type.Literal("agentTimelineEventCreateFileAddContent"),value:eu.Type.Ref("AgentTimelineEventCreateFileAddContent")}),eu.Type.Object({$case:eu.Type.Literal("addProposedFileChange"),value:eu.Type.Ref("AddProposedFileChange")}),eu.Type.Object({$case:eu.Type.Literal("updateProposedFileChange"),value:eu.Type.Ref("UpdateProposedFileChange")}),eu.Type.Object({$case:eu.Type.Literal("addProposedFileChangesMetadata"),value:eu.Type.Ref("AddProposedFileChangesMetadata")}),eu.Type.Object({$case:eu.Type.Literal("addProposedShellCommand"),value:eu.Type.Ref("AddProposedShellCommand")}),eu.Type.Object({$case:eu.Type.Literal("addProposedActionsMetadata"),value:eu.Type.Ref("AddProposedActionsMetadata")}),eu.Type.Object({$case:eu.Type.Literal("agentAskUserForActionRequestSet"),value:eu.Type.Ref("AgentAskUserForActionRequestSet")}),eu.Type.Object({$case:eu.Type.Literal("addRagContext"),value:eu.Type.Ref("AddRagContext")}),eu.Type.Object({$case:eu.Type.Literal("addProposedWorkspaceToolNudge"),value:eu.Type.Ref("AddProposedWorkspaceToolNudge")}),eu.Type.Object({$case:eu.Type.Literal("integrationTestEventContents"),value:eu.Type.Ref("IntegrationTestEventContentsUpdate")}),eu.Type.Object({$case:eu.Type.Literal("addProposedPackageInstall"),value:eu.Type.Ref("AddProposedPackageInstall")}),eu.Type.Object({$case:eu.Type.Literal("updateRevertStatus"),value:eu.Type.Ref("UpdateRevertStatus")}),eu.Type.Object({$case:eu.Type.Literal("updateAttachedFormStringFieldSet"),value:eu.Type.Ref("UpdateAttachedFormStringFieldSet")}),eu.Type.Object({$case:eu.Type.Literal("updateAttachedFormStringFieldAppend"),value:eu.Type.Ref("UpdateAttachedFormStringFieldAppend")}),eu.Type.Object({$case:eu.Type.Literal("addProposedRunConfiguration"),value:eu.Type.Ref("AddProposedRunConfiguration")}),eu.Type.Object({$case:eu.Type.Literal("addProposedDeploymentConfiguration"),value:eu.Type.Ref("AddProposedDeploymentConfiguration")}),eu.Type.Object({$case:eu.Type.Literal("appendTimelineMessageContentsUpdate"),value:eu.Type.Ref("AppendTimelineMessageContentsUpdate")}),eu.Type.Object({$case:eu.Type.Literal("appendThoughtContentsUpdate"),value:eu.Type.Ref("AppendThoughtContentsUpdate")}),eu.Type.Object({$case:eu.Type.Literal("appendRedactedThoughtsMarker"),value:eu.Type.Ref("AppendRedactedThoughtsMarkerUpdate")}),eu.Type.Object({$case:eu.Type.Literal("addProposedWorkflowConfiguration"),value:eu.Type.Ref("AddProposedWorkflowConfiguration")}),eu.Type.Object({$case:eu.Type.Literal("updateFileEditLineCounts"),value:eu.Type.Ref("UpdateFileEditLineCountsUpdate")}),eu.Type.Object({$case:eu.Type.Literal("addDesignReferenceFile"),value:eu.Type.Ref("AddDesignReferenceFile")}),eu.Type.Object({$case:eu.Type.Literal("updatePlanContents"),value:eu.Type.Ref("UpdatePlanContents")}),eu.Type.Object({$case:eu.Type.Literal("updatePlanApprovalStatus"),value:eu.Type.Ref("UpdatePlanApprovalStatus")}),eu.Type.Object({$case:eu.Type.Literal("newThoughtSummaryUpdate"),value:eu.Type.Ref("NewThoughtSummaryUpdate")}),eu.Type.Object({$case:eu.Type.Literal("samplingEventUpdate"),value:eu.Type.Ref("SamplingEventUpdate")}),eu.Type.Object({$case:eu.Type.Literal("samplingEventStateUpdate"),value:eu.Type.Ref("SamplingEventStateUpdate")}),eu.Type.Object({$case:eu.Type.Literal("uiTestingSubagentExecutionEventUpdate"),value:eu.Type.Ref("UITestingSubagentExecutionEventContentsUpdate")}),eu.Type.Object({$case:eu.Type.Literal("subagentRunningDataUpdate"),value:eu.Type.Ref("SubagentRunningDataUpdate")}),eu.Type.Object({$case:eu.Type.Literal("upsertGeneratedMediaData"),value:eu.Type.Ref("UpsertGeneratedMediaData")}),eu.Type.Object({$case:eu.Type.Literal("subagentReportResultUpdate"),value:eu.Type.Ref("SubagentReportResultUpdate")}),eu.Type.Object({$case:eu.Type.Literal("messagedBackgroundAgentDataUpdate"),value:eu.Type.Ref("MessagedBackgroundAgentDataUpdate")}),eu.Type.Object({$case:eu.Type.Literal("stoppedSubagentRunningUpdate"),value:eu.Type.Ref("StoppedSubagentRunningUpdate")}),eu.Type.Object({$case:eu.Type.Literal("addExecutedSandboxedCodeOutput"),value:eu.Type.Ref("AddExecutedSandboxedCodeOutput")}),eu.Type.Undefined()]))}),AppendTimelineMessageContentsUpdate:eu.Type.Object({content:eu.Type.String()}),AppendThoughtContentsUpdate:eu.Type.Object({content:eu.Type.String(),totalTimeTakenMs:eu.Type.Number()}),NewThoughtSummaryUpdate:eu.Type.Object({summary:eu.Type.String()}),AppendRedactedThoughtsMarkerUpdate:eu.Type.Object({marker:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("RedactedThoughtsMarker"),eu.Type.Undefined()]))}),AgentTimelineEventSet:eu.Type.Object({contents:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentTimelineEventContents"),eu.Type.Undefined()]))}),HostingDebugSummaryEventSet:eu.Type.Object({contents:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("HostingDebugSummaryEventContents"),eu.Type.Undefined()]))}),ReplCreationEventSet:eu.Type.Object({contents:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ReplCreationEventContents"),eu.Type.Undefined()]))}),MessageContentsUpdate:eu.Type.Object({content:eu.Type.String()}),IntegrationTestEventContentsUpdate:eu.Type.Object({content:eu.Type.String()}),AgentAskUserForActionRequestSet:eu.Type.Object({request:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentAskUserForActionRequest"),eu.Type.Undefined()]))}),MessageContentsSet:eu.Type.Object({content:eu.Type.String()}),ShellSuggestionContentsUpdate:eu.Type.Object({content:eu.Type.String()}),LocalShellExecutionEventSet:eu.Type.Object({contents:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("LocalShellExecutionEventContents"),eu.Type.Undefined()]))}),AgentTimelineEventCreateFileAddContent:eu.Type.Object({content:eu.Type.String()}),AddSourcesUpdate:eu.Type.Object({sources:eu.Type.Array(eu.Type.Ref("Source"))}),AddSuggestedTemplatesUpdate:eu.Type.Object({templates:eu.Type.Array(eu.Type.Ref("SuggestedTemplate"))}),AddProposedActionsMetadata:eu.Type.Object({summary:eu.Type.String(),commitId:eu.Type.String(),didCreateCheckpoint:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),didCountEditRequest:eu.Type.Boolean()}),AddRagContext:eu.Type.Object({newContext:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("SelectedRagContext"),eu.Type.Undefined()]))}),AddProposedFileChangesMetadata:eu.Type.Object({summary:eu.Type.String()}),AddProposedFileChange:eu.Type.Object({change:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ProposedFileChange"),eu.Type.Undefined()])),commitId:eu.Type.String()}),UpdateProposedFileChange:eu.Type.Object({update:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ProposedFileChange"),eu.Type.Undefined()])),replacement:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ProposedFileChange"),eu.Type.Undefined()]))}),AddProposedShellCommand:eu.Type.Object({command:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ProposedShellCommand"),eu.Type.Undefined()]))}),AddProposedPackageInstall:eu.Type.Object({packageInstalls:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ProposedPackageInstall"),eu.Type.Undefined()]))}),UpdateRevertStatus:eu.Type.Object({newStatus:eu.Type.Ref("RevertStatus")}),AddProposedWorkspaceToolNudge:eu.Type.Object({nudge:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ProposedWorkspaceToolNudge"),eu.Type.Undefined()]))}),AddProposedRunConfiguration:eu.Type.Object({runConfiguration:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ProposedRunConfiguration"),eu.Type.Undefined()]))}),AddProposedWorkflowConfiguration:eu.Type.Object({workflowConfiguration:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ProposedWorkflowConfiguration"),eu.Type.Undefined()]))}),UpdateFileEditLineCountsUpdate:eu.Type.Object({removedLines:eu.Type.Number(),addedLines:eu.Type.Number()}),AddProposedDeploymentConfiguration:eu.Type.Object({deploymentConfiguration:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ProposedDeploymentConfiguration"),eu.Type.Undefined()]))}),AddDesignReferenceFile:eu.Type.Object({filePath:eu.Type.String()}),UpdatePlanContents:eu.Type.Object({planId:eu.Type.String(),step:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentPlanStep"),eu.Type.Undefined()])),objective:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentPlanObjective"),eu.Type.Undefined()])),initialCommitId:eu.Type.String(),stackBlueprint:tp,agentStackTriggerType:eu.Type.Ref("AgentStackTriggerType")}),UpdatePlanApprovalStatus:eu.Type.Object({requiresApproval:eu.Type.Boolean()}),BYOPromptResultUpdate:eu.Type.Object({jsonResult:eu.Type.String()}),GovalToken:eu.Type.Object({token:eu.Type.String(),gurl:eu.Type.String()}),AuthToken:eu.Type.Object({user:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("UserContext"),eu.Type.Undefined()])),replIds:eu.Type.Array(eu.Type.String()),issuer:eu.Type.String(),overrideGovalToken:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("GovalToken"),eu.Type.Undefined()])),forkReplId:eu.Type.String()}),UserContext:eu.Type.Object({type:eu.Type.Ref("UserType"),id:eu.Type.String(),username:eu.Type.String(),membership:eu.Type.Ref("MembershipType"),roles:eu.Type.Array(eu.Type.String()),isTeam:eu.Type.Boolean(),orgId:eu.Type.String(),timeCreated:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()])),flaggingContext:eu.Type.String(),modelfarmDisabled:eu.Type.Boolean(),openrouterDisabled:eu.Type.Boolean(),openaiDisabled:eu.Type.Boolean(),anthropicDisabled:eu.Type.Boolean(),geminiDisabled:eu.Type.Boolean(),isEnterprise:eu.Type.Boolean(),flagOverrides:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()]))}),CreateEventRequest:eu.Type.Object({parentEventId:eu.Type.String(),sessionId:eu.Type.String(),state:eu.Type.Ref("EventState"),contents:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventContents"),eu.Type.Undefined()])),context:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventContext"),eu.Type.Undefined()])),eventId:eu.Type.String(),error:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventError"),eu.Type.Undefined()])),isActive:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),addToChild:eu.Type.Boolean()}),CreateEventResponse:eu.Type.Object({eventId:eu.Type.String(),parentEventId:eu.Type.String(),created:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()]))}),CreateEventRequestWithUser:eu.Type.Object({request:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("CreateEventRequest"),eu.Type.Undefined()])),user:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("UserContext"),eu.Type.Undefined()]))}),BatchCreateEventsRequest:eu.Type.Object({events:eu.Type.Array(eu.Type.Ref("CreateEventRequestWithUser"))}),BatchCreateEventsResponse:eu.Type.Object({eventIds:eu.Type.Array(eu.Type.String())}),UpdateEventRequest:eu.Type.Object({eventId:eu.Type.String(),operations:eu.Type.Array(eu.Type.Ref("UpdateEventOperation")),typedOperations:eu.Type.Array(eu.Type.Ref("TypedUpdateEventOperation")),state:eu.Type.Ref("EventState"),error:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventError"),eu.Type.Undefined()])),requireCompletion:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()]))}),UpdateEventResponse:eu.Type.Object({}),UpdateAgentStateRequest:eu.Type.Object({replId:eu.Type.String(),sessionId:eu.Type.String(),runState:eu.Type.Ref("AgentRunState"),transitionReason:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentStateTransitionReason"),eu.Type.Undefined()]))}),GetAgentStateRequest:eu.Type.Object({replId:eu.Type.String(),sessionId:eu.Type.String()}),GetAgentStateResponse:eu.Type.Object({runState:eu.Type.Ref("AgentRunState"),transitionReason:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentStateTransitionReason"),eu.Type.Undefined()]))}),UpdateAgentStateResponse:eu.Type.Object({runState:eu.Type.Ref("AgentRunState"),transitionReason:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentStateTransitionReason"),eu.Type.Undefined()]))}),UpdateAgentStateMessage:eu.Type.Object({replId:eu.Type.String(),sessionId:eu.Type.String(),runState:eu.Type.Ref("AgentRunState"),transitionReason:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentStateTransitionReason"),eu.Type.Undefined()]))}),BroadcastAgentStateRequest:eu.Type.Object({replId:eu.Type.String(),sessionId:eu.Type.String(),runState:eu.Type.Ref("AgentRunState"),transitionReason:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentStateTransitionReason"),eu.Type.Undefined()]))}),BroadcastAgentStateResponse:eu.Type.Object({}),AgentStateTransitionReason:eu.Type.Object({reasons:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("userPaused"),value:eu.Type.Ref("AgentStateTransitionReasonUserPaused")}),eu.Type.Object({$case:eu.Type.Literal("stepLimitExceeded"),value:eu.Type.Ref("AgentStateTransitionReasonStepLimitExceeded")}),eu.Type.Object({$case:eu.Type.Literal("rateLimited"),value:eu.Type.Ref("AgentStateTransitionReasonRateLimited")}),eu.Type.Object({$case:eu.Type.Literal("waitingOnUserResponse"),value:eu.Type.Ref("AgentStateTransitionReasonWaitingOnUserResponse")}),eu.Type.Object({$case:eu.Type.Literal("waitingOnPlanApproval"),value:eu.Type.Ref("AgentStateTransitionReasonWaitingOnPlanApproval")}),eu.Type.Object({$case:eu.Type.Literal("requestedSecrets"),value:eu.Type.Ref("AgentStateTransitionReasonRequestedSecrets")}),eu.Type.Object({$case:eu.Type.Literal("testConcluded"),value:eu.Type.Ref("AgentStateTransitionReasonTestConcluded")}),eu.Type.Object({$case:eu.Type.Literal("error"),value:eu.Type.Ref("AgentStateTransitionReasonError")}),eu.Type.Object({$case:eu.Type.Literal("planConcluded"),value:eu.Type.Ref("AgentStateTransitionReasonPlanConcluded")}),eu.Type.Object({$case:eu.Type.Literal("reverted"),value:eu.Type.Ref("AgentStateTransitionReasonReverted")}),eu.Type.Object({$case:eu.Type.Literal("authorizationFailed"),value:eu.Type.Ref("AgentStateTransitionReasonAuthorizationFailed")}),eu.Type.Object({$case:eu.Type.Literal("stepTooComplex"),value:eu.Type.Ref("AgentStateTransitionReasonStepTooComplex")}),eu.Type.Object({$case:eu.Type.Literal("triggerCheckpoint"),value:eu.Type.Ref("AgentStateTransitionReasonTriggerCheckpoint")}),eu.Type.Undefined()]))}),AgentStateTransitionReasonUserPaused:eu.Type.Object({}),AgentStateTransitionReasonStepLimitExceeded:eu.Type.Object({maxSteps:eu.Type.Number()}),AgentStateTransitionReasonRateLimited:eu.Type.Object({timeWhenReset:eu.Type.String()}),AgentStateTransitionReasonAuthorizationFailed:eu.Type.Object({code:eu.Type.Ref("AgentAuthorizationFailedCode"),message:eu.Type.String()}),AgentStateTransitionReasonWaitingOnUserResponse:eu.Type.Object({}),AgentStateTransitionReasonRequestedSecrets:eu.Type.Object({}),AgentStateTransitionReasonWaitingOnPlanApproval:eu.Type.Object({}),AgentStateTransitionReasonTestConcluded:eu.Type.Object({}),AgentStateTransitionReasonPlanConcluded:eu.Type.Object({}),AgentStateTransitionReasonError:eu.Type.Object({}),AgentStateTransitionReasonReverted:eu.Type.Object({}),AgentStateTransitionReasonStepTooComplex:eu.Type.Object({}),AgentStateTransitionReasonTriggerCheckpoint:eu.Type.Object({}),ReprocessEventRequest:eu.Type.Object({eventId:eu.Type.String(),context:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventContext"),eu.Type.Undefined()]))}),ReprocessEventResponse:eu.Type.Object({}),GetResourceUploadUrlRequest:eu.Type.Object({mimeType:eu.Type.String()}),GetResourceUploadUrlResponse:eu.Type.Object({uploadUrl:eu.Type.String(),downloadUrl:eu.Type.String(),identifier:eu.Type.String()}),GetUrlScreenshotRequest:eu.Type.Object({url:eu.Type.String()}),GetUrlScreenshotResponse:eu.Type.Object({imageDownloadUrl:eu.Type.String()}),GetUrlScrapedContentRequest:eu.Type.Object({url:eu.Type.String()}),GetUrlScrapedContentResponse:eu.Type.Object({content:eu.Type.String()}),GetUrlBrandingRequest:eu.Type.Object({url:eu.Type.String()}),GetUrlBrandingResponse:eu.Type.Object({branding:eu.Type.String()}),AbortEventRequest:eu.Type.Object({eventId:eu.Type.String()}),AbortEventResponse:eu.Type.Object({eventId:eu.Type.String()}),GetReplSessionsRequest:eu.Type.Object({beforeTimestamp:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()])),limit:eu.Type.Number(),includeFirstSessionEvents:eu.Type.Boolean(),firstSessionEventsLimit:eu.Type.Number(),replId:eu.Type.String(),sessionTypes:eu.Type.Array(eu.Type.Ref("SessionType")),archived:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()]))}),GetReplSessionsResponse:eu.Type.Object({hasMore:eu.Type.Boolean(),sessions:eu.Type.Array(eu.Type.Ref("Session")),replAgentState:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ReplAgentState"),eu.Type.Undefined()]))}),EnhanceAgentPromptRequest:eu.Type.Object({userPrompt:eu.Type.String(),uploadedFiles:eu.Type.Array(eu.Type.Ref("UploadedFile")),attachedUrls:eu.Type.Array(eu.Type.Ref("AttachedUrl")),selectedTheme:eu.Type.String()}),EnhanceAgentPromptResponse:eu.Type.Object({enhancedPrompt:eu.Type.String()}),GetSessionEventsRequest:eu.Type.Object({sessionId:eu.Type.String(),limit:eu.Type.Number(),excludeContents:eu.Type.Boolean(),afterTimestamp:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()]))}),GetSessionEventsResponse:eu.Type.Object({events:eu.Type.Array(eu.Type.Ref("Event")),session:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("Session"),eu.Type.Undefined()]))}),BatchGetEventsRequest:eu.Type.Object({sessionId:eu.Type.String(),eventIds:eu.Type.Array(eu.Type.String())}),BatchGetEventsResponse:eu.Type.Object({events:eu.Type.Array(eu.Type.Ref("Event"))}),CreateSessionRequest:eu.Type.Object({replId:eu.Type.String(),sessionType:eu.Type.Ref("SessionType"),title:eu.Type.String(),seededAiFirstEventContents:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventContents"),eu.Type.Undefined()])),taskId:eu.Type.String(),revertedToSessionId:eu.Type.String(),revertedToEventId:eu.Type.String()}),CreateSessionResponse:eu.Type.Object({sessionId:eu.Type.String(),sessionCreationEventId:eu.Type.String(),seededAiFirstEventId:eu.Type.String()}),GetEventListRequest:eu.Type.Object({sessionId:eu.Type.String(),limit:eu.Type.Number(),ancestorsOf:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),afterTimestamp:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()]))}),GetEventListResponse:eu.Type.Object({shapes:eu.Type.Array(eu.Type.Ref("EventShape")),hasMore:eu.Type.Boolean()}),SubscribeToReplEventsRequest:eu.Type.Object({replId:eu.Type.String()}),ReplEventsSubscriptionMessage:eu.Type.Object({sender:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("UserContext"),eu.Type.Undefined()])),seqno:eu.Type.Number(),message:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("subscriptionStatusMessage"),value:eu.Type.Ref("SubscriptionStatusMessage")}),eu.Type.Object({$case:eu.Type.Literal("createEventMessage"),value:eu.Type.Ref("CreateEventMessage")}),eu.Type.Object({$case:eu.Type.Literal("createSessionMessage"),value:eu.Type.Ref("CreateSessionMessage")}),eu.Type.Object({$case:eu.Type.Literal("updateEventMessage"),value:eu.Type.Ref("UpdateEventMessage")}),eu.Type.Object({$case:eu.Type.Literal("updateSessionMessage"),value:eu.Type.Ref("UpdateSessionMessage")}),eu.Type.Object({$case:eu.Type.Literal("abortEventMessage"),value:eu.Type.Ref("AbortEventMessage")}),eu.Type.Object({$case:eu.Type.Literal("updateAgentStateMessage"),value:eu.Type.Ref("UpdateAgentStateMessage")}),eu.Type.Undefined()]))}),SubscriptionStatusMessage:eu.Type.Object({}),CreateEventMessage:eu.Type.Object({eventId:eu.Type.String(),parentEventId:eu.Type.String(),sessionId:eu.Type.String(),state:eu.Type.Ref("EventState"),contents:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventContents"),eu.Type.Undefined()])),sender:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("UserContext"),eu.Type.Undefined()])),error:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventError"),eu.Type.Undefined()])),isActive:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),created:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()]))}),CreateSessionMessage:eu.Type.Object({sessionId:eu.Type.String(),title:eu.Type.String(),replId:eu.Type.String(),sessionCreationEventId:eu.Type.String(),sessionType:eu.Type.Ref("SessionType"),archived:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),taskId:eu.Type.String(),revertedToSessionId:eu.Type.String(),revertedToEventId:eu.Type.String()}),UpdateEventMessage:eu.Type.Object({sessionId:eu.Type.String(),eventId:eu.Type.String(),operations:eu.Type.Array(eu.Type.Ref("UpdateEventOperation")),typedOperations:eu.Type.Array(eu.Type.Ref("TypedUpdateEventOperation")),state:eu.Type.Ref("EventState"),error:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventError"),eu.Type.Undefined()]))}),UpdateSessionMessage:eu.Type.Object({sessionId:eu.Type.String(),title:eu.Type.String(),sessionType:eu.Type.Ref("SessionType"),archived:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),replId:eu.Type.String(),activeEventId:eu.Type.String(),isActiveAgentSession:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),readOnly:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),taskId:eu.Type.String()}),AbortEventMessage:eu.Type.Object({replId:eu.Type.String(),sessionId:eu.Type.String(),eventId:eu.Type.String()}),Limit:eu.Type.Object({limit:eu.Type.Number(),usage:eu.Type.Number(),resetTime:eu.Type.Optional(eu.Type.Union([eu.Type.Date(),eu.Type.Undefined()]))}),GetAvailableModelRequest:eu.Type.Object({overrideModel:eu.Type.String()}),ModelName:eu.Type.Object({readable:eu.Type.String(),qualified:eu.Type.String()}),GetAvailableModelsResponse:eu.Type.Object({basicModel:eu.Type.Array(eu.Type.Ref("ModelName")),advancedModel:eu.Type.Array(eu.Type.Ref("ModelName")),overrideModel:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelName"),eu.Type.Undefined()]))}),UpdateSessionRequest:eu.Type.Object({id:eu.Type.String(),title:eu.Type.String(),sessionType:eu.Type.Ref("SessionType"),archived:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),replId:eu.Type.String(),activeEventId:eu.Type.String(),isActiveAgentSession:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),readOnly:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()])),taskId:eu.Type.String()}),UpdateSessionResponse:eu.Type.Object({}),ProcessEventRequest:eu.Type.Object({replId:eu.Type.String(),contents:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventContents"),eu.Type.Undefined()])),context:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("EventContext"),eu.Type.Undefined()])),sessionId:eu.Type.String()}),ProcessEventResponseMessage:eu.Type.Object({message:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("startMessage"),value:eu.Type.Ref("ProcessEventStartMessage")}),eu.Type.Object({$case:eu.Type.Literal("createEventMessage"),value:eu.Type.Ref("CreateEventMessage")}),eu.Type.Object({$case:eu.Type.Literal("updateEventMessage"),value:eu.Type.Ref("UpdateEventMessage")}),eu.Type.Undefined()]))}),ProcessEventStartMessage:eu.Type.Object({rootId:eu.Type.String()}),GenerateReplNameRequest:eu.Type.Object({replId:eu.Type.String(),prompt:eu.Type.String()}),GenerateReplNameResponse:eu.Type.Object({replName:eu.Type.String()}),GenerateIconRequest:eu.Type.Object({replId:eu.Type.String(),prompt:eu.Type.String()}),GenerateIconResponse:eu.Type.Object({imageUrl:eu.Type.String()}),Any:eu.Type.Object({typeUrl:eu.Type.String(),value:eu.Type.Uint8Array()}),Struct:eu.Type.Object({fields:eu.Type.Array(eu.Type.Ref("StructField")),type:eu.Type.String()}),StructField:eu.Type.Object({key:eu.Type.String(),value:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("Value"),eu.Type.Undefined()]))}),Value:eu.Type.Object({kind:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("nullValue"),value:eu.Type.Ref("NullValue")}),eu.Type.Object({$case:eu.Type.Literal("numberValue"),value:eu.Type.Number()}),eu.Type.Object({$case:eu.Type.Literal("stringValue"),value:eu.Type.String()}),eu.Type.Object({$case:eu.Type.Literal("boolValue"),value:eu.Type.Boolean()}),eu.Type.Object({$case:eu.Type.Literal("structValue"),value:eu.Type.Ref("Struct")}),eu.Type.Object({$case:eu.Type.Literal("listValue"),value:eu.Type.Ref("ListValue")}),eu.Type.Undefined()]))}),ListValue:eu.Type.Object({values:eu.Type.Array(eu.Type.Ref("Value"))}),BYOPromptMessage:eu.Type.Object({role:eu.Type.String(),content:eu.Type.String()}),BYOPromptResponseParameter:eu.Type.Object({name:eu.Type.String(),required:eu.Type.Boolean(),parameterType:eu.Type.Ref("BYOPromptResponseParameterType"),description:eu.Type.String(),enums:eu.Type.Array(eu.Type.String())}),BYOPromptEventContents:eu.Type.Object({historicalPrompt:eu.Type.String(),messages:eu.Type.Array(eu.Type.Ref("BYOPromptMessage")),parameters:eu.Type.Array(eu.Type.Ref("BYOPromptResponseParameter")),result:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("Struct"),eu.Type.Undefined()])),jsonResult:eu.Type.String(),forceJson:eu.Type.Boolean(),promptName:eu.Type.String()}),BYOPromptEventContext:eu.Type.Object({modelSelector:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelSelector"),eu.Type.Undefined()]))}),RevertEventContents:eu.Type.Object({commitId:eu.Type.String(),message:eu.Type.String(),eventIdBeforeRevert:eu.Type.String(),originalSessionId:eu.Type.String(),databaseRollbackTimestamp:eu.Type.String(),deploymentBuildId:eu.Type.String(),rollbackDatabase:eu.Type.Boolean(),revertedToSessionId:eu.Type.String(),revertedToEventId:eu.Type.String()}),TriggerCheckpointEventContents:eu.Type.Object({description:eu.Type.String(),onlyIfDiff:eu.Type.Boolean(),author:eu.Type.Ref("CommitAuthor"),deploymentBuildId:eu.Type.String()}),StepTooComplexAcknowledgementEventContents:eu.Type.Object({cancelCurrentStep:eu.Type.Boolean()}),AgentCapabilityUsage:eu.Type.Object({standardModelProfileLlmCalls:eu.Type.Number(),advancedModelProfileLlmCalls:eu.Type.Number(),thinkingEnabledLlmCalls:eu.Type.Number(),webSearchCalls:eu.Type.Number(),rapidBuild:eu.Type.Boolean(),testingSubagentRuns:eu.Type.Number(),architectSubagentRuns:eu.Type.Number(),generalSubagentRuns:eu.Type.Number()}),TaskEffort:eu.Type.Object({taskId:eu.Type.String(),description:eu.Type.String()}),GeneralEffort:eu.Type.Object({}),AgentInitializationEffort:eu.Type.Object({}),FreeQuickEditEffort:eu.Type.Object({}),DiscountedEffort:eu.Type.Object({effortType:eu.Type.Ref("DiscountedEffortType")}),RelatedEffortBreakdown:eu.Type.Object({effortType:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("task"),value:eu.Type.Ref("TaskEffort")}),eu.Type.Object({$case:eu.Type.Literal("general"),value:eu.Type.Ref("GeneralEffort")}),eu.Type.Object({$case:eu.Type.Literal("initialization"),value:eu.Type.Ref("AgentInitializationEffort")}),eu.Type.Object({$case:eu.Type.Literal("freeQuickEdit"),value:eu.Type.Ref("FreeQuickEditEffort")}),eu.Type.Object({$case:eu.Type.Literal("discountedEffort"),value:eu.Type.Ref("DiscountedEffort")}),eu.Type.Undefined()])),commitId:eu.Type.String(),usageCents:eu.Type.Number(),workDurationSeconds:eu.Type.Number(),numLocRead:eu.Type.Number(),numFilesRead:eu.Type.Number(),addedLinesOfCode:eu.Type.Number(),removedLinesOfCode:eu.Type.Number()}),CommitData:eu.Type.Object({commitId:eu.Type.String(),screenshotUrl:eu.Type.String(),description:eu.Type.String(),billingRate:eu.Type.Ref("CommitBillingRate"),author:eu.Type.Ref("CommitAuthor"),progressSummary:eu.Type.String(),usageCents:eu.Type.Number(),workDurationSeconds:eu.Type.Number(),addedLinesOfCode:eu.Type.Number(),removedLinesOfCode:eu.Type.Number(),toolCalls:eu.Type.Number(),triggerReason:eu.Type.Ref("CheckpointTriggerReason"),capabilityUsage:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentCapabilityUsage"),eu.Type.Undefined()])),ubbV2:eu.Type.Boolean(),numLocRead:eu.Type.Number(),numFilesRead:eu.Type.Number(),refunded:eu.Type.Boolean(),relatedEffortBreakdowns:eu.Type.Array(eu.Type.Ref("RelatedEffortBreakdown")),heliumCheckpointCreated:eu.Type.Boolean()}),ApprovePlanEventContents:eu.Type.Object({planEventId:eu.Type.String(),approver:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("UserContext"),eu.Type.Undefined()])),initialBuildMode:eu.Type.Ref("AgentInitialBuildMode"),userSecretsResponse:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentUserSecretsResponse"),eu.Type.Undefined()])),agentConfig:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentConfig"),eu.Type.Undefined()]))}),ApprovePlanEventContext:eu.Type.Object({}),UserSecretsResponseEventContents:eu.Type.Object({response:eu.Type.Array(eu.Type.Ref("UserSecretResponse"))}),HostingDebugSummaryErrorPorts:eu.Type.Object({exposeLocalhost:eu.Type.Boolean(),localPort:eu.Type.String(),externalPort:eu.Type.String()}),HostingDebugSummaryError:eu.Type.Object({provider:eu.Type.String(),buildCommand:eu.Type.String(),runCommand:eu.Type.String(),publicDir:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),appType:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),logs:eu.Type.Array(eu.Type.String()),envKeys:eu.Type.Array(eu.Type.String()),ports:eu.Type.Array(eu.Type.Ref("HostingDebugSummaryErrorPorts")),entrypointFilePath:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()]))}),HostingDebugSummarySuggestion:eu.Type.Object({name:eu.Type.String(),type:eu.Type.String(),description:eu.Type.String(),before:eu.Type.String(),after:eu.Type.String(),file:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()]))}),HostingDebugSummaryResult:eu.Type.Object({errors:eu.Type.Array(eu.Type.String()),suggestions:eu.Type.Array(eu.Type.Ref("HostingDebugSummarySuggestion"))}),HostingDebugSummaryEventContents:eu.Type.Object({error:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("HostingDebugSummaryError"),eu.Type.Undefined()])),result:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("HostingDebugSummaryResult"),eu.Type.Undefined()])),usedModelSelector:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelSelector"),eu.Type.Undefined()]))}),HostingDebugSummaryEventContext:eu.Type.Object({modelSelector:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelSelector"),eu.Type.Undefined()]))}),ReplCreationEventContents:eu.Type.Object({errors:eu.Type.Array(eu.Type.String()),generatedReplName:eu.Type.String(),isAgentRecommended:eu.Type.Boolean(),bestTemplate:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("SuggestedTemplate"),eu.Type.Undefined()])),matchedPlanNames:eu.Type.Array(eu.Type.String()),scaffoldTemplateName:eu.Type.String()}),ReplCreationEventContext:eu.Type.Object({modelSelector:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("ModelSelector"),eu.Type.Undefined()]))}),UserSecretsResponseEventContext:eu.Type.Object({}),IterativeAgentEventContents:eu.Type.Object({contents:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("appliedFileChanges"),value:eu.Type.Ref("IterativeAgentAppliedFileChanges")}),eu.Type.Object({$case:eu.Type.Literal("revertedFileChanges"),value:eu.Type.Ref("IterativeAgentRevertedFileChanges")}),eu.Type.Object({$case:eu.Type.Literal("installingPackages"),value:eu.Type.Ref("IterativeAgentInstallingPackages")}),eu.Type.Object({$case:eu.Type.Literal("installedPackages"),value:eu.Type.Ref("IterativeAgentInstalledPackages")}),eu.Type.Object({$case:eu.Type.Literal("startedShellExecution"),value:eu.Type.Ref("IterativeAgentStartedShellExecution")}),eu.Type.Object({$case:eu.Type.Literal("finishedShellExecution"),value:eu.Type.Ref("IterativeAgentFinishedShellExecution")}),eu.Type.Object({$case:eu.Type.Literal("appliedRunConfiguration"),value:eu.Type.Ref("IterativeAgentAppliedRunConfiguration")}),eu.Type.Object({$case:eu.Type.Literal("appliedDeploymentConfiguration"),value:eu.Type.Ref("IterativeAgentAppliedDeploymentConfiguration")}),eu.Type.Object({$case:eu.Type.Literal("appliedWorkflowConfiguration"),value:eu.Type.Ref("IterativeAgentAppliedWorkflowConfiguration")}),eu.Type.Undefined()]))}),IterativeAgentAppliedFileChanges:eu.Type.Object({eventWhichProposedChanges:eu.Type.String(),appliedChanges:eu.Type.Array(eu.Type.Ref("AppliedFileChange")),commitHash:eu.Type.String()}),IterativeAgentRevertedFileChanges:eu.Type.Object({eventWhichProposedChanges:eu.Type.String(),eventWhichAppliedChanges:eu.Type.String(),revertedChanges:eu.Type.Array(eu.Type.Ref("RevertedFileChange"))}),IterativeAgentInstallingPackages:eu.Type.Object({eventWhichProposedPackageInstall:eu.Type.String(),messageContentsOffset:eu.Type.Number(),processId:eu.Type.String()}),IterativeAgentInstalledPackages:eu.Type.Object({eventWhichProposedPackageInstall:eu.Type.String(),messageContentsOffset:eu.Type.Number(),installationOutput:eu.Type.String(),processId:eu.Type.String(),exitCode:eu.Type.Number()}),AppliedFileChange:eu.Type.Object({filePath:eu.Type.String(),linesAdded:eu.Type.Number(),linesRemoved:eu.Type.Number(),changeSummary:eu.Type.String()}),RevertedFileChange:eu.Type.Object({filePath:eu.Type.String(),changeSummary:eu.Type.String()}),IterativeAgentStartedShellExecution:eu.Type.Object({eventWhichProposedShellExecution:eu.Type.String(),messageContentsOffset:eu.Type.Number(),processId:eu.Type.String()}),IterativeAgentFinishedShellExecution:eu.Type.Object({eventWhichProposedShellExecution:eu.Type.String(),messageContentsOffset:eu.Type.Number(),processId:eu.Type.String(),commandOutput:eu.Type.String(),exitCode:eu.Type.Number()}),IterativeAgentAppliedRunConfiguration:eu.Type.Object({eventWhichProposedRunConfiguration:eu.Type.String(),messageContentsOffset:eu.Type.Number()}),IterativeAgentAppliedWorkflowConfiguration:eu.Type.Object({eventWhichProposedWorkflowConfiguration:eu.Type.String(),messageContentsOffset:eu.Type.Number()}),IterativeAgentAppliedDeploymentConfiguration:eu.Type.Object({eventWhichProposedDeploymentConfiguration:eu.Type.String(),messageContentsOffset:eu.Type.Number()}),IterativeAgentEventContext:eu.Type.Object({}),SystemDependencyInstallData:eu.Type.Object({deps:eu.Type.Array(eu.Type.String())}),SystemDependencyUninstallData:eu.Type.Object({deps:eu.Type.Array(eu.Type.String())}),DeployConfigData:eu.Type.Object({deploymentTarget:eu.Type.String(),run:eu.Type.Array(eu.Type.String()),build:eu.Type.Array(eu.Type.String()),publicDir:eu.Type.String(),ignorePorts:eu.Type.Boolean()}),DeployData:eu.Type.Object({}),RevertData:eu.Type.Object({eventIdBeforeRevert:eu.Type.String(),checkpointCommit:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),status:eu.Type.Ref("RevertStatus"),originalSessionId:eu.Type.String(),checkpointTitle:eu.Type.String()}),AcknowledgeUserMessage:eu.Type.Object({eventIds:eu.Type.Array(eu.Type.String())}),CreatePostgreSQLDatabaseData:eu.Type.Object({}),SqlExecutionData:eu.Type.Object({command:eu.Type.String(),output:eu.Type.String(),status:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("isExecuting"),value:eu.Type.Boolean()}),eu.Type.Object({$case:eu.Type.Literal("exitCode"),value:eu.Type.Number()}),eu.Type.Undefined()]))}),ImageGenerationData:eu.Type.Object({imagePath:eu.Type.String(),imageDescription:eu.Type.String()}),VideoGenerationData:eu.Type.Object({videoPath:eu.Type.String(),videoDescription:eu.Type.String()}),GeneratedMedia:eu.Type.Object({id:eu.Type.String(),path:eu.Type.String(),description:eu.Type.String(),mediaType:eu.Type.Ref("GeneratedMediaType"),error:eu.Type.String()}),GenerateMediaData:eu.Type.Object({media:eu.Type.Array(eu.Type.Ref("GeneratedMedia")),asynchronous:eu.Type.Boolean()}),UpsertGeneratedMediaData:eu.Type.Object({media:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("GeneratedMedia"),eu.Type.Undefined()]))}),WaitingForBackgroundJobsData:eu.Type.Object({waitingType:eu.Type.Ref("WaitingForBackgroundJobType"),maxWaitTimeSeconds:eu.Type.Number(),actualWaitTimeSeconds:eu.Type.Number()}),NewSessionNudge:eu.Type.Object({}),StepTooComplexEventContents:eu.Type.Object({stepId:eu.Type.String(),state:eu.Type.Ref("StepTooComplexEventContentsState")}),UserTipRecommendationData:eu.Type.Object({tipId:eu.Type.String(),title:eu.Type.String(),recommendedReason:eu.Type.String()}),EndOfRunSummaryData:eu.Type.Object({runId:eu.Type.String(),usageCents:eu.Type.Number(),preDiscountsUsageCents:eu.Type.Number(),workDurationSeconds:eu.Type.Number(),addedLinesOfCode:eu.Type.Number(),removedLinesOfCode:eu.Type.Number(),toolCalls:eu.Type.Number(),capabilityUsage:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("AgentCapabilityUsage"),eu.Type.Undefined()])),numLocRead:eu.Type.Number(),numFilesRead:eu.Type.Number(),refunded:eu.Type.Boolean(),relatedEffortBreakdowns:eu.Type.Array(eu.Type.Ref("RelatedEffortBreakdown")),rollbackCheckpointSha:eu.Type.String(),hasUncommittedChanges:eu.Type.Optional(eu.Type.Union([eu.Type.Boolean(),eu.Type.Undefined()]))}),UITestingSubagentEventContents:eu.Type.Object({testingPlan:eu.Type.String(),finalSummary:eu.Type.String(),title:eu.Type.String(),resultType:eu.Type.Ref("UITestingSubagentResultType")}),GeneralSubagentEventContents:eu.Type.Object({task:eu.Type.String(),taskSummary:eu.Type.String(),result:eu.Type.String(),resultSummary:eu.Type.String(),taskTitle:eu.Type.String(),eventFilter:eu.Type.Ref("GeneralSubagentEventFilter")}),SubagentStateTransitionReasonCompletedSuccessfully:eu.Type.Object({}),SubagentStateTransitionReasonPaused:eu.Type.Object({}),SubagentStateTransitionReason:eu.Type.Object({reasons:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("completedSuccessfully"),value:eu.Type.Ref("SubagentStateTransitionReasonCompletedSuccessfully")}),eu.Type.Object({$case:eu.Type.Literal("paused"),value:eu.Type.Ref("SubagentStateTransitionReasonPaused")}),eu.Type.Undefined()]))}),SubagentRunningData:eu.Type.Object({subagentId:eu.Type.String(),childSessionId:eu.Type.String(),totalExecutionTimeSeconds:eu.Type.Number(),subagentName:eu.Type.String(),transitionReason:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("SubagentStateTransitionReason"),eu.Type.Undefined()])),contents:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("uiTestingSubagentEventContents"),value:eu.Type.Ref("UITestingSubagentEventContents")}),eu.Type.Object({$case:eu.Type.Literal("generalSubagentEventContents"),value:eu.Type.Ref("GeneralSubagentEventContents")}),eu.Type.Undefined()]))}),UITestingSubagentExecutionEventContents:eu.Type.Object({gcsDownloadUrl:eu.Type.String(),mimeType:eu.Type.String(),narration:eu.Type.String(),miniNarration:eu.Type.String()}),UITestingSubagentTakeOverResultSuccess:eu.Type.Object({userNotes:eu.Type.String()}),UITestingSubagentTakeOverResultDeclined:eu.Type.Object({}),UITestingSubagentTakeOverResultTimedOut:eu.Type.Object({}),UITestingSubagentTakeOverData:eu.Type.Object({userInstructions:eu.Type.String(),result:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("success"),value:eu.Type.Ref("UITestingSubagentTakeOverResultSuccess")}),eu.Type.Object({$case:eu.Type.Literal("declined"),value:eu.Type.Ref("UITestingSubagentTakeOverResultDeclined")}),eu.Type.Object({$case:eu.Type.Literal("timedOut"),value:eu.Type.Ref("UITestingSubagentTakeOverResultTimedOut")}),eu.Type.Undefined()]))}),AgentConfigUpdateEventContents:eu.Type.Object({operation:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("automatedTesting"),value:eu.Type.Ref("AgentConfigUpdateAutomatedTesting")}),eu.Type.Undefined()]))}),AgentConfigUpdateAutomatedTesting:eu.Type.Object({enabled:eu.Type.Boolean(),reason:eu.Type.String()}),SamplingTrajectory:eu.Type.Object({id:eu.Type.String(),contents:eu.Type.String(),state:eu.Type.Ref("TrajectoryState")}),SamplingEvent:eu.Type.Object({state:eu.Type.Ref("SamplingEventState"),trajectories:eu.Type.Array(eu.Type.Ref("SamplingTrajectory"))}),SamplingEventUpdate:eu.Type.Object({trajectoryId:eu.Type.String(),contents:eu.Type.String(),state:eu.Type.Ref("TrajectoryState")}),SamplingEventStateUpdate:eu.Type.Object({state:eu.Type.Ref("SamplingEventState")}),UITestingSubagentExecutionEventContentsUpdate:eu.Type.Object({state:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("UITestingSubagentExecutionEventContents"),eu.Type.Undefined()]))}),SubagentRunningDataUpdate:eu.Type.Object({state:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("SubagentRunningData"),eu.Type.Undefined()])),totalExecutionTimeSeconds:eu.Type.Number()}),StoppedSubagentRunningUpdate:eu.Type.Object({totalExecutionTimeSeconds:eu.Type.Number(),transitionReason:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("SubagentStateTransitionReason"),eu.Type.Undefined()]))}),SetupObjectStorageData:eu.Type.Object({bucketName:eu.Type.String(),bucketId:eu.Type.String()}),MoveEventsBetweenSessionsRequest:eu.Type.Object({sourceSessionId:eu.Type.String(),destinationSessionId:eu.Type.String()}),MoveEventsBetweenSessionsResponse:eu.Type.Object({}),AbortSubagentRequest:eu.Type.Object({replId:eu.Type.String(),sessionId:eu.Type.String(),subagentId:eu.Type.String()}),AbortSubagentResponse:eu.Type.Object({}),WarmAgentRequest:eu.Type.Object({replId:eu.Type.String(),sessionId:eu.Type.String()}),WarmAgentResponse:eu.Type.Object({}),StockImageData:eu.Type.Object({imageDescription:eu.Type.String(),numberOfImages:eu.Type.Number(),imageUrls:eu.Type.Array(eu.Type.String())}),AddingIntegrationsRequest:eu.Type.Object({connectorIds:eu.Type.Array(eu.Type.String()),connectionIds:eu.Type.Array(eu.Type.String())}),AddingIntegrationsResponse:eu.Type.Object({connectionIds:eu.Type.Array(eu.Type.String()),rejectedConnectionIds:eu.Type.Array(eu.Type.String()),rejectedConnectorIds:eu.Type.Array(eu.Type.String())}),InitialBuildStateUpdateEventContents:eu.Type.Object({phase:eu.Type.Ref("InitialBuildPhase")}),SearchIntegrationsData:eu.Type.Object({query:eu.Type.String(),numResults:eu.Type.Number()}),ViewIntegrationData:eu.Type.Object({name:eu.Type.String()}),ViewLogsData:eu.Type.Object({webviewConsole:eu.Type.Boolean(),workflows:eu.Type.Boolean(),deployment:eu.Type.Boolean(),lsp:eu.Type.Boolean()}),SetupModelfarmData:eu.Type.Object({}),ViewSpecialFilesData:eu.Type.Object({fileType:eu.Type.Ref("SpecialFileType")}),DesignGuidelinesData:eu.Type.Object({}),MCPToolData:eu.Type.Object({toolName:eu.Type.String(),serverName:eu.Type.String(),parameters:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("Struct"),eu.Type.Undefined()])),result:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("MCPToolResult"),eu.Type.Undefined()])),progress:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("MCPToolProgress"),eu.Type.Undefined()])),insecureError:eu.Type.String()}),MCPToolParameter:eu.Type.Object({key:eu.Type.String(),value:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("Any"),eu.Type.Undefined()]))}),MCPToolResult:eu.Type.Object({content:eu.Type.String(),contentBlocks:eu.Type.Array(eu.Type.Ref("MCPContentBlock")),structuredContent:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("Struct"),eu.Type.Undefined()])),isError:eu.Type.Boolean()}),MCPToolProgress:eu.Type.Object({progress:eu.Type.Number(),total:eu.Type.Optional(eu.Type.Union([eu.Type.Number(),eu.Type.Undefined()])),message:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()]))}),MCPContentBlock:eu.Type.Object({block:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("textContent"),value:eu.Type.Ref("MCPContentBlockTextContent")}),eu.Type.Object({$case:eu.Type.Literal("imageContent"),value:eu.Type.Ref("MCPContentBlockImageContent")}),eu.Type.Object({$case:eu.Type.Literal("audioContent"),value:eu.Type.Ref("MCPContentBlockAudioContent")}),eu.Type.Object({$case:eu.Type.Literal("resourceLink"),value:eu.Type.Ref("MCPContentBlockResourceLink")}),eu.Type.Object({$case:eu.Type.Literal("embeddedResource"),value:eu.Type.Ref("MCPContentBlockEmbeddedResource")}),eu.Type.Undefined()]))}),MCPAnnotations:eu.Type.Object({audience:eu.Type.Array(eu.Type.String()),priority:eu.Type.Optional(eu.Type.Union([eu.Type.Number(),eu.Type.Undefined()]))}),MCPContentBlockTextContent:eu.Type.Object({text:eu.Type.String(),annotations:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("MCPAnnotations"),eu.Type.Undefined()])),meta:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()]))}),MCPContentBlockImageContent:eu.Type.Object({data:eu.Type.String(),mimeType:eu.Type.String(),annotations:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("MCPAnnotations"),eu.Type.Undefined()])),meta:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()]))}),MCPContentBlockAudioContent:eu.Type.Object({data:eu.Type.String(),mimeType:eu.Type.String(),annotations:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("MCPAnnotations"),eu.Type.Undefined()])),meta:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()]))}),MCPContentBlockResourceLink:eu.Type.Object({name:eu.Type.String(),title:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),uri:eu.Type.String(),description:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),mimeType:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),size:eu.Type.Optional(eu.Type.Union([eu.Type.Number(),eu.Type.Undefined()])),annotations:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("MCPAnnotations"),eu.Type.Undefined()])),meta:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()]))}),MCPResourceContents:eu.Type.Object({uri:eu.Type.String(),mimeType:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),meta:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()])),contents:eu.Type.Optional(eu.Type.Union([eu.Type.Object({$case:eu.Type.Literal("text"),value:eu.Type.String()}),eu.Type.Object({$case:eu.Type.Literal("blob"),value:eu.Type.String()}),eu.Type.Undefined()]))}),MCPContentBlockEmbeddedResource:eu.Type.Object({resource:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("MCPResourceContents"),eu.Type.Undefined()])),annotations:eu.Type.Optional(eu.Type.Union([eu.Type.Ref("MCPAnnotations"),eu.Type.Undefined()])),meta:eu.Type.Optional(eu.Type.Union([eu.Type.String(),eu.Type.Undefined()]))}),AlertData:eu.Type.Object({alertLevel:eu.Type.Ref("AlertLevel"),message:eu.Type.String(),nextAction:eu.Type.Ref("AlertNextAction")}),EnvVar:eu.Type.Object({key:eu.Type.String(),environment:eu.Type.Ref("EnvironmentType")}),EnvironmentConfigRequest:eu.Type.Object({envVars:eu.Type.Array(eu.Type.Ref("EnvVar")),message:eu.Type.String()}),ProvidedEnvVar:eu.Type.Object({key:eu.Type.String(),value:eu.Type.String(),environment:eu.Type.Ref("EnvironmentType")}),EnvironmentConfigResponse:eu.Type.Object({providedEnvVars:eu.Type.Array(eu.Type.Ref("ProvidedEnvVar"))}),ViewEnvVarData:eu.Type.Object({type:eu.Type.Ref("EnvironmentVariableType"),environment:eu.Type.Ref("EnvironmentType"),keys:eu.Type.Array(eu.Type.String())}),SetEnvVarData:eu.Type.Object({type:eu.Type.Ref("EnvironmentVariableType"),environment:eu.Type.Ref("EnvironmentType"),keys:eu.Type.Array(eu.Type.String())}),DeleteEnvVarData:eu.Type.Object({type:eu.Type.Ref("EnvironmentVariableType"),environment:eu.Type.Ref("EnvironmentType"),keys:eu.Type.Array(eu.Type.String())}),ClassifyInitialUserPromptRequest:eu.Type.Object({userPrompt:eu.Type.String(),uploadedFiles:eu.Type.Array(eu.Type.Ref("UploadedFile"))}),ClassifyInitialUserPromptResponse:eu.Type.Object({stackType:tp,agentInitialBuildTier:eu.Type.Ref("AgentInitialBuildTier")}),MessagedBackgroundAgentData:eu.Type.Object({message:eu.Type.String(),summary:eu.Type.String()}),MessagedBackgroundAgentDataUpdate:eu.Type.Object({delta:eu.Type.String()}),SubagentReportResultData:eu.Type.Object({result:eu.Type.String()}),SubagentReportResultUpdate:eu.Type.Object({delta:eu.Type.String()}),ReportAgentIssueData:eu.Type.Object({}),CreateAutomationPreviewData:eu.Type.Object({result:eu.Type.String()})});tu.Import("AgentRunState"),tu.Import("AgentUserFeedbackType"),tu.Import("UserSecretResponseStatus"),tu.Import("ProjectImportSource"),tu.Import("TaskStatus"),tu.Import("SandboxLanguage"),tu.Import("SandboxOutputType"),tu.Import("AgentPlanStepStatus"),tu.Import("RequestFeatureAddType"),tu.Import("AgentStackTriggerType"),tu.Import("BlueprintCategory"),tu.Import("WebSearchType"),tu.Import("CheckpointSuggestionReason"),tu.Import("BenchmarkConclusionReason"),tu.Import("AttachedFormType"),tu.Import("UrlIntent"),tu.Import("FileChangeGenerationState"),tu.Import("TranslationTarget"),tu.Import("ModelType"),tu.Import("CodeReferenceType"),tu.Import("DebugErrorSource"),tu.Import("EventState"),tu.Import("InlineMessageType"),tu.Import("UserType");var tc=tu.Import("SessionType");tu.Import("MessageStopReason"),tu.Import("MessageAction"),tu.Import("MembershipType"),tu.Import("EventErrorType"),tu.Import("AgentMode"),tu.Import("AgentInitialBuildMode"),tu.Import("AutonomyLevel"),tu.Import("AgentInitialBuildTier"),tu.Import("MessageSource"),tu.Import("ModelProfile"),tu.Import("UpdateEventOperationType"),tu.Import("AgentAuthorizationFailedCode"),tu.Import("NullValue"),tu.Import("BYOPromptResponseParameterType"),tu.Import("CommitAuthor"),tu.Import("CommitBillingRate"),tu.Import("CheckpointTriggerReason"),tu.Import("DiscountedEffortType"),tu.Import("RevertStatus"),tu.Import("GeneratedMediaType"),tu.Import("WaitingForBackgroundJobType"),tu.Import("StepTooComplexEventContentsState"),tu.Import("UITestingSubagentResultType"),tu.Import("GeneralSubagentEventFilter"),tu.Import("SamplingEventState"),tu.Import("TrajectoryState"),tu.Import("InitialBuildPhase"),tu.Import("SpecialFileType"),tu.Import("AlertLevel"),tu.Import("AlertNextAction"),tu.Import("EnvironmentType"),tu.Import("EnvironmentVariableType"),tu.Import("RevertToCommitRequest"),tu.Import("RevertToCommitResponse"),tu.Import("CloneSessionRequest"),tu.Import("CloneSessionResponse"),tu.Import("Ping"),tu.Import("Pong"),tu.Import("Event"),tu.Import("EventShape"),tu.Import("AgentUserFeedback"),tu.Import("SubmitAgentUserFeedbackRequest"),tu.Import("SubmitAgentUserFeedbackResponse"),tu.Import("ReplAgentState"),tu.Import("Session"),tu.Import("Secret"),tu.Import("SecretRequestAction"),tu.Import("UserSecretResponse"),tu.Import("DeployRequest"),tu.Import("DeployResponse"),tu.Import("MessageButton"),tu.Import("DeployRequestAction"),tu.Import("MessageButtonAction"),tu.Import("AgentUserSecretsRequest"),tu.Import("AgentUserSecretsResponse"),tu.Import("AgentDebugRequest"),tu.Import("AgentDebugResponse"),tu.Import("AgentContinueRequest"),tu.Import("AgentContinueResponse"),tu.Import("AgentNewFeatureRequest"),tu.Import("UserMessageContents"),tu.Import("AgentNewFeatureResponse"),tu.Import("AgentDeployRequest"),tu.Import("AgentDeployResponse"),tu.Import("AgentAction"),tu.Import("AgentNextStepRequest"),tu.Import("AgentNextStepResponse"),tu.Import("AgentQueryBoolean"),tu.Import("AgentQueryChoice"),tu.Import("AgentQueryText"),tu.Import("AgentQuery"),tu.Import("AgentQueryBooleanResponse"),tu.Import("AgentQueryChoiceResponse"),tu.Import("AgentQueryTextResponse"),tu.Import("AgentQueryNoResponse"),tu.Import("AgentQueryResponse"),tu.Import("QueryResponseContent"),tu.Import("QueryRequestContent"),tu.Import("MarkTaskCompleteRequest"),tu.Import("UserMarkedTaskComplete"),tu.Import("ApproveTaskListRequest"),tu.Import("ApproveTaskListResponse"),tu.Import("ApproveInitialBuildMVPRequest"),tu.Import("ApproveInitialBuildMVPResponse"),tu.Import("ApproveInitialBuildVisualPhaseRequest"),tu.Import("ApproveInitialBuildVisualPhaseResponse"),tu.Import("ApproveSqlQueryRequest"),tu.Import("ApproveSqlQueryResponse"),tu.Import("ApproveBlueprintRequest"),tu.Import("ApproveBlueprintResponse"),tu.Import("ConvertMockupToAppRequest"),tu.Import("ConvertMockupToAppResponse"),tu.Import("AgentAskUserForActionRequest"),tu.Import("AgentAskUserForActionResponse"),tu.Import("SetupImportedProjectEventContents"),tu.Import("ProjectImportCompletedData"),tu.Import("MemoryCompressionData"),tu.Import("TaskListData"),tu.Import("Task"),tu.Import("EventContents"),tu.Import("EventContext"),tu.Import("StartRapidBuildEventContents"),tu.Import("RapidBuildStartedData"),tu.Import("SessionCreationEventContents"),tu.Import("DatabaseNudgeEventContents"),tu.Import("CloudBudgetExceededEventContents"),tu.Import("SkillLoadedEventData"),tu.Import("ExecutedSandboxedCodeEventData"),tu.Import("SandboxOutput"),tu.Import("AddExecutedSandboxedCodeOutput"),tu.Import("CodeChangeStats"),tu.Import("AgentPlanStep"),tu.Import("BlueprintsSetup"),tu.Import("RequestFeatureAdd"),tu.Import("AgentPlanObjective"),tu.Import("AgentPlanEventContents"),tu.Import("AgentPlanEventContext"),tu.Import("RevertEventContext"),tu.Import("BlueprintData"),tu.Import("ShellExecutionData"),tu.Import("FileEditData"),tu.Import("CreateFileData"),tu.Import("ReadFileData"),tu.Import("ReadDirData"),tu.Import("PackagerInstallData"),tu.Import("PackagerUninstallData"),tu.Import("SearchFilesystemData"),tu.Import("WebSearchResultPage"),tu.Import("GoogleSuggestedSearch"),tu.Import("WebSearchData"),tu.Import("WebPageVisitData"),tu.Import("ScreenshotData"),tu.Import("ToolchainInstallData"),tu.Import("WorkflowsGetOutputToolData"),tu.Import("WorkflowsRemoveRunConfigToolData"),tu.Import("WorkflowsRestartToolData"),tu.Import("WorkflowsSetRunConfigToolData"),tu.Import("WorkflowsStartToolData"),tu.Import("WorkflowsStopToolData"),tu.Import("CheckpointSuggestions"),tu.Import("SuggestRollbackData"),tu.Import("AgentStoppedData"),tu.Import("PresentResultsToolData"),tu.Import("SearchFileData"),tu.Import("SuggestGeneralBuildModeData"),tu.Import("AgentTimelineEventContents"),tu.Import("AgentPlanStepBeginData"),tu.Import("SummarizeObjectiveData"),tu.Import("AgentThoughtsData"),tu.Import("RedactedThoughtsMarker"),tu.Import("RapidBuildConcludedData"),tu.Import("VersionMigratedData"),tu.Import("PlanProgressData"),tu.Import("BenchmarkConclusionEventContents"),tu.Import("BenchmarkMetrics"),tu.Import("Metric"),tu.Import("MetricByTag"),tu.Import("AgentTimelineEventContext"),tu.Import("Range"),tu.Import("CodeReference");var td=tu.Import("MessageEventContents");tu.Import("TargetedElement"),tu.Import("RelatedElement"),tu.Import("AttachedForm"),tu.Import("AttachedFormField"),tu.Import("AttachedFormStringField"),tu.Import("AttachedFormFilesField"),tu.Import("AttachedFormFiles"),tu.Import("UpdateAttachedFormStringFieldSet"),tu.Import("UpdateAttachedFormStringFieldAppend"),tu.Import("SelectedRagContext"),tu.Import("AssistantProposedActions"),tu.Import("IntegrationTestEventContents"),tu.Import("ContextComplexityEventContents"),tu.Import("EventTooLargeEventContents"),tu.Import("IntegrationTestEventContext"),tu.Import("AttachedUrl"),tu.Import("UploadedFile"),tu.Import("UploadedRapidBuildFile"),tu.Import("BenchmarkParameters"),tu.Import("SuggestedTemplates"),tu.Import("SuggestedTemplate"),tu.Import("ProposedFileChanges"),tu.Import("ProposedFileChange"),tu.Import("ProposedShellCommand"),tu.Import("ProposedPackageInstall"),tu.Import("ProposedWorkspaceToolNudge"),tu.Import("ProposedRunConfiguration"),tu.Import("ProposedWorkflowConfiguration"),tu.Import("ProposedDeploymentConfiguration"),tu.Import("Source"),tu.Import("InlineActionEventContents"),tu.Import("ShellSuggestionEventContents"),tu.Import("SessionCreationEventContext"),tu.Import("TranslateEventContents"),tu.Import("TranslateEventContext"),tu.Import("LocalShellExecutionEventContents"),tu.Import("LocalShellExecutionEventContext"),tu.Import("ShellSuggestionEventContext"),tu.Import("ModelSelector"),tu.Import("EventError"),tu.Import("MediaReference");var ty=tu.Import("AgentConfig");tu.Import("MessageEventContext"),tu.Import("InlineActionEventContext"),tu.Import("UpdateEventOperation"),tu.Import("TypedUpdateEventOperation"),tu.Import("AppendTimelineMessageContentsUpdate"),tu.Import("AppendThoughtContentsUpdate"),tu.Import("NewThoughtSummaryUpdate"),tu.Import("AppendRedactedThoughtsMarkerUpdate"),tu.Import("AgentTimelineEventSet"),tu.Import("HostingDebugSummaryEventSet"),tu.Import("ReplCreationEventSet"),tu.Import("MessageContentsUpdate"),tu.Import("IntegrationTestEventContentsUpdate"),tu.Import("AgentAskUserForActionRequestSet"),tu.Import("MessageContentsSet"),tu.Import("ShellSuggestionContentsUpdate"),tu.Import("LocalShellExecutionEventSet"),tu.Import("AgentTimelineEventCreateFileAddContent"),tu.Import("AddSourcesUpdate"),tu.Import("AddSuggestedTemplatesUpdate"),tu.Import("AddProposedActionsMetadata"),tu.Import("AddRagContext"),tu.Import("AddProposedFileChangesMetadata"),tu.Import("AddProposedFileChange"),tu.Import("UpdateProposedFileChange"),tu.Import("AddProposedShellCommand"),tu.Import("AddProposedPackageInstall"),tu.Import("UpdateRevertStatus"),tu.Import("AddProposedWorkspaceToolNudge"),tu.Import("AddProposedRunConfiguration"),tu.Import("AddProposedWorkflowConfiguration"),tu.Import("UpdateFileEditLineCountsUpdate"),tu.Import("AddProposedDeploymentConfiguration"),tu.Import("AddDesignReferenceFile"),tu.Import("UpdatePlanContents"),tu.Import("UpdatePlanApprovalStatus"),tu.Import("BYOPromptResultUpdate"),tu.Import("GovalToken"),tu.Import("AuthToken"),tu.Import("UserContext"),tu.Import("CreateEventRequest"),tu.Import("CreateEventResponse"),tu.Import("CreateEventRequestWithUser"),tu.Import("BatchCreateEventsRequest"),tu.Import("BatchCreateEventsResponse"),tu.Import("UpdateEventRequest"),tu.Import("UpdateEventResponse"),tu.Import("UpdateAgentStateRequest"),tu.Import("GetAgentStateRequest"),tu.Import("GetAgentStateResponse"),tu.Import("UpdateAgentStateResponse"),tu.Import("UpdateAgentStateMessage"),tu.Import("BroadcastAgentStateRequest"),tu.Import("BroadcastAgentStateResponse"),tu.Import("AgentStateTransitionReason"),tu.Import("AgentStateTransitionReasonUserPaused"),tu.Import("AgentStateTransitionReasonStepLimitExceeded"),tu.Import("AgentStateTransitionReasonRateLimited"),tu.Import("AgentStateTransitionReasonAuthorizationFailed"),tu.Import("AgentStateTransitionReasonWaitingOnUserResponse"),tu.Import("AgentStateTransitionReasonRequestedSecrets"),tu.Import("AgentStateTransitionReasonWaitingOnPlanApproval"),tu.Import("AgentStateTransitionReasonTestConcluded"),tu.Import("AgentStateTransitionReasonPlanConcluded"),tu.Import("AgentStateTransitionReasonError"),tu.Import("AgentStateTransitionReasonReverted"),tu.Import("AgentStateTransitionReasonStepTooComplex"),tu.Import("AgentStateTransitionReasonTriggerCheckpoint"),tu.Import("ReprocessEventRequest"),tu.Import("ReprocessEventResponse"),tu.Import("GetResourceUploadUrlRequest"),tu.Import("GetResourceUploadUrlResponse"),tu.Import("GetUrlScreenshotRequest"),tu.Import("GetUrlScreenshotResponse"),tu.Import("GetUrlScrapedContentRequest"),tu.Import("GetUrlScrapedContentResponse"),tu.Import("GetUrlBrandingRequest"),tu.Import("GetUrlBrandingResponse"),tu.Import("AbortEventRequest"),tu.Import("AbortEventResponse"),tu.Import("GetReplSessionsRequest"),tu.Import("GetReplSessionsResponse"),tu.Import("EnhanceAgentPromptRequest"),tu.Import("EnhanceAgentPromptResponse"),tu.Import("GetSessionEventsRequest"),tu.Import("GetSessionEventsResponse"),tu.Import("BatchGetEventsRequest"),tu.Import("BatchGetEventsResponse"),tu.Import("CreateSessionRequest"),tu.Import("CreateSessionResponse"),tu.Import("GetEventListRequest"),tu.Import("GetEventListResponse"),tu.Import("SubscribeToReplEventsRequest"),tu.Import("ReplEventsSubscriptionMessage"),tu.Import("SubscriptionStatusMessage"),tu.Import("CreateEventMessage"),tu.Import("CreateSessionMessage"),tu.Import("UpdateEventMessage"),tu.Import("UpdateSessionMessage"),tu.Import("AbortEventMessage"),tu.Import("Limit"),tu.Import("GetAvailableModelRequest"),tu.Import("ModelName"),tu.Import("GetAvailableModelsResponse"),tu.Import("UpdateSessionRequest"),tu.Import("UpdateSessionResponse"),tu.Import("ProcessEventRequest"),tu.Import("ProcessEventResponseMessage"),tu.Import("ProcessEventStartMessage"),tu.Import("GenerateReplNameRequest"),tu.Import("GenerateReplNameResponse"),tu.Import("GenerateIconRequest"),tu.Import("GenerateIconResponse"),tu.Import("Any"),tu.Import("Struct"),tu.Import("StructField"),tu.Import("Value"),tu.Import("ListValue"),tu.Import("BYOPromptMessage"),tu.Import("BYOPromptResponseParameter"),tu.Import("BYOPromptEventContents"),tu.Import("BYOPromptEventContext"),tu.Import("RevertEventContents"),tu.Import("TriggerCheckpointEventContents"),tu.Import("StepTooComplexAcknowledgementEventContents"),tu.Import("AgentCapabilityUsage"),tu.Import("TaskEffort"),tu.Import("GeneralEffort"),tu.Import("AgentInitializationEffort"),tu.Import("FreeQuickEditEffort"),tu.Import("DiscountedEffort"),tu.Import("RelatedEffortBreakdown"),tu.Import("CommitData"),tu.Import("ApprovePlanEventContents"),tu.Import("ApprovePlanEventContext"),tu.Import("UserSecretsResponseEventContents"),tu.Import("HostingDebugSummaryErrorPorts"),tu.Import("HostingDebugSummaryError"),tu.Import("HostingDebugSummarySuggestion"),tu.Import("HostingDebugSummaryResult"),tu.Import("HostingDebugSummaryEventContents"),tu.Import("HostingDebugSummaryEventContext"),tu.Import("ReplCreationEventContents"),tu.Import("ReplCreationEventContext"),tu.Import("UserSecretsResponseEventContext"),tu.Import("IterativeAgentEventContents"),tu.Import("IterativeAgentAppliedFileChanges"),tu.Import("IterativeAgentRevertedFileChanges"),tu.Import("IterativeAgentInstallingPackages"),tu.Import("IterativeAgentInstalledPackages"),tu.Import("AppliedFileChange"),tu.Import("RevertedFileChange"),tu.Import("IterativeAgentStartedShellExecution"),tu.Import("IterativeAgentFinishedShellExecution"),tu.Import("IterativeAgentAppliedRunConfiguration"),tu.Import("IterativeAgentAppliedWorkflowConfiguration"),tu.Import("IterativeAgentAppliedDeploymentConfiguration"),tu.Import("IterativeAgentEventContext"),tu.Import("SystemDependencyInstallData"),tu.Import("SystemDependencyUninstallData"),tu.Import("DeployConfigData"),tu.Import("DeployData"),tu.Import("RevertData"),tu.Import("AcknowledgeUserMessage"),tu.Import("CreatePostgreSQLDatabaseData"),tu.Import("SqlExecutionData"),tu.Import("ImageGenerationData"),tu.Import("VideoGenerationData"),tu.Import("GeneratedMedia"),tu.Import("GenerateMediaData"),tu.Import("UpsertGeneratedMediaData"),tu.Import("WaitingForBackgroundJobsData"),tu.Import("NewSessionNudge"),tu.Import("StepTooComplexEventContents"),tu.Import("UserTipRecommendationData"),tu.Import("EndOfRunSummaryData"),tu.Import("UITestingSubagentEventContents"),tu.Import("GeneralSubagentEventContents"),tu.Import("SubagentStateTransitionReasonCompletedSuccessfully"),tu.Import("SubagentStateTransitionReasonPaused"),tu.Import("SubagentStateTransitionReason"),tu.Import("SubagentRunningData"),tu.Import("UITestingSubagentExecutionEventContents"),tu.Import("UITestingSubagentTakeOverResultSuccess"),tu.Import("UITestingSubagentTakeOverResultDeclined"),tu.Import("UITestingSubagentTakeOverResultTimedOut"),tu.Import("UITestingSubagentTakeOverData"),tu.Import("AgentConfigUpdateEventContents"),tu.Import("AgentConfigUpdateAutomatedTesting"),tu.Import("SamplingTrajectory"),tu.Import("SamplingEvent"),tu.Import("SamplingEventUpdate"),tu.Import("SamplingEventStateUpdate"),tu.Import("UITestingSubagentExecutionEventContentsUpdate"),tu.Import("SubagentRunningDataUpdate"),tu.Import("StoppedSubagentRunningUpdate"),tu.Import("SetupObjectStorageData"),tu.Import("MoveEventsBetweenSessionsRequest"),tu.Import("MoveEventsBetweenSessionsResponse"),tu.Import("AbortSubagentRequest"),tu.Import("AbortSubagentResponse"),tu.Import("WarmAgentRequest"),tu.Import("WarmAgentResponse"),tu.Import("StockImageData"),tu.Import("AddingIntegrationsRequest"),tu.Import("AddingIntegrationsResponse"),tu.Import("InitialBuildStateUpdateEventContents"),tu.Import("SearchIntegrationsData"),tu.Import("ViewIntegrationData"),tu.Import("ViewLogsData"),tu.Import("SetupModelfarmData"),tu.Import("ViewSpecialFilesData"),tu.Import("DesignGuidelinesData"),tu.Import("MCPToolData"),tu.Import("MCPToolParameter"),tu.Import("MCPToolResult"),tu.Import("MCPToolProgress"),tu.Import("MCPContentBlock"),tu.Import("MCPAnnotations"),tu.Import("MCPContentBlockTextContent"),tu.Import("MCPContentBlockImageContent"),tu.Import("MCPContentBlockAudioContent"),tu.Import("MCPContentBlockResourceLink"),tu.Import("MCPResourceContents"),tu.Import("MCPContentBlockEmbeddedResource"),tu.Import("AlertData"),tu.Import("EnvVar"),tu.Import("EnvironmentConfigRequest"),tu.Import("ProvidedEnvVar"),tu.Import("EnvironmentConfigResponse"),tu.Import("ViewEnvVarData"),tu.Import("SetEnvVarData"),tu.Import("DeleteEnvVarData"),tu.Import("ClassifyInitialUserPromptRequest"),tu.Import("ClassifyInitialUserPromptResponse"),tu.Import("MessagedBackgroundAgentData"),tu.Import("MessagedBackgroundAgentDataUpdate"),tu.Import("SubagentReportResultData"),tu.Import("SubagentReportResultUpdate"),tu.Import("ReportAgentIssueData"),tu.Import("CreateAutomationPreviewData"),e.s(["AgentConfigSchema",()=>ty,"MessageEventContentsSchema",()=>td,"SessionTypeSchema",()=>tc],230153);var tT=e.i(297083),tf=e.i(817556),tg=e.i(862927),th=e.i(904851),tv=e.i(90659),tm=e.i(167626),tS=e.i(530658);Error("timeout while waiting for mutex to become available"),Error("mutex already locked");var tE=Error("request for lock canceled"),tb=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tE;(0,th._)(this,e),this._value=t,this._cancelError=n,this._queue=[],this._weightedWaiters=[]}return(0,tv._)(e,[{key:"acquire",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t<=0)throw Error("invalid weight ".concat(t,": must be positive"));return new Promise(function(r,i){var o={resolve:r,reject:i,weight:t,priority:n},a=tR(e._queue,function(e){return n<=e.priority});-1===a&&t<=e._value?e._dispatchItem(o):e._queue.splice(a+1,0,o)})}},{key:"runExclusive",value:function(e){var t,n,r,i;return t=this,n=arguments,r=void 0,i=function(e){var t,n,r,i,o,a=arguments;return(0,tf._)(this,function(s){switch(s.label){case 0:return t=a.length>1&&void 0!==a[1]?a[1]:1,n=a.length>2&&void 0!==a[2]?a[2]:0,[4,this.acquire(t,n)];case 1:i=(r=tS._.apply(void 0,[s.sent(),2]))[0],o=r[1],s.label=2;case 2:return s.trys.push([2,,4,5]),[4,e(i)];case 3:return[2,s.sent()];case 4:return o(),[7];case 5:return[2]}})},new(r||(r=Promise))(function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,(0,tm._)(n,r)?n:new r(function(e){e(n)})).then(a,s)}l((i=i.apply(t,n||[])).next())})}},{key:"waitForUnlock",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t<=0)throw Error("invalid weight ".concat(t,": must be positive"));return this._couldLockImmediately(t,n)?Promise.resolve():new Promise(function(r){var i,o,a;e._weightedWaiters[t-1]||(e._weightedWaiters[t-1]=[]),i=e._weightedWaiters[t-1],o={resolve:r,priority:n},a=tR(i,function(e){return o.priority<=e.priority}),i.splice(a+1,0,o)})}},{key:"isLocked",value:function(){return this._value<=0}},{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e){this._value=e,this._dispatchQueue()}},{key:"release",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e<=0)throw Error("invalid weight ".concat(e,": must be positive"));this._value+=e,this._dispatchQueue()}},{key:"cancel",value:function(){var e=this;this._queue.forEach(function(t){return t.reject(e._cancelError)}),this._queue=[]}},{key:"_dispatchQueue",value:function(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}},{key:"_dispatchItem",value:function(e){var t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}},{key:"_newReleaser",value:function(e){var t=this,n=!1;return function(){n||(n=!0,t.release(e))}}},{key:"_drainUnlockWaiters",value:function(){if(0===this._queue.length)for(var e=this._value;e>0;e--){var t=this._weightedWaiters[e-1];t&&(t.forEach(function(e){return e.resolve()}),this._weightedWaiters[e-1]=[])}else for(var n=this._queue[0].priority,r=this._value;r>0;r--){var i=this._weightedWaiters[r-1];if(i){var o=i.findIndex(function(e){return e.priority<=n});(-1===o?i:i.splice(0,o)).forEach(function(e){return e.resolve()})}}}},{key:"_couldLockImmediately",value:function(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}]),e}();function tR(e,t){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return n;return -1}var tC=function(){function e(t){(0,th._)(this,e),this._semaphore=new tb(1,t)}return(0,tv._)(e,[{key:"acquire",value:function(){var e,t,n,r;return e=this,t=arguments,n=void 0,r=function(){var e,t=arguments;return(0,tf._)(this,function(n){switch(n.label){case 0:return e=t.length>0&&void 0!==t[0]?t[0]:0,[4,this._semaphore.acquire(1,e)];case 1:return[2,tS._.apply(void 0,[n.sent(),2])[1]]}})},new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,(0,tm._)(t,n)?t:new n(function(e){e(t)})).then(a,s)}l((r=r.apply(e,t||[])).next())})}},{key:"runExclusive",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._semaphore.runExclusive(function(){return e()},1,t)}},{key:"isLocked",value:function(){return this._semaphore.isLocked()}},{key:"waitForUnlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._semaphore.waitForUnlock(1,e)}},{key:"release",value:function(){this._semaphore.isLocked()&&this._semaphore.release()}},{key:"cancel",value:function(){return this._semaphore.cancel()}}]),e}(),tI=new Map,tO=new tC;function tA(e,t){return(0,tT._)(function(e,t){var n,r,i,o,a,s=arguments;return(0,tf._)(this,function(l){switch(l.label){case 0:return i=void 0===(r=(n=s.length>2&&void 0!==s[2]?s[2]:{}).path)?"/ai/chort/auth":r,a=void 0===(o=n.cache)||o,[4,tO.runExclusive(function(){return(0,tT._)(function(){var n,r,o,s,l,p;return(0,tf._)(this,function(u){switch(u.label){case 0:if(n="".concat(e,"-").concat(null!=t?t:"none","-").concat(i),a&&(r=tI.get(n))&&r.expiration>Date.now())return[2,r.token];return[4,fetch(i,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t?{repl:{id:t}}:{})})];case 1:if(!(o=u.sent()).ok)throw Error("Failed to fetch Chort auth token: ".concat(o.status));return[4,o.json()];case 2:return s=u.sent(),l=tg.Value.Decode(eT,s),a&&(p=Date.now()+18e5,tI.set(n,{token:l,expiration:p})),[2,l]}})})()})];case 1:return[2,l.sent()]}})}).apply(this,arguments)}e.s(["fetchChortAuthToken",()=>tA],351677);var t_=e.i(721281);let tk="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);for(var tU=new Uint8Array(16),tN=[],tD=0;tD<256;++tD)tN.push((tD+256).toString(16).slice(1));let tw=function(e,t,n){if(tk&&!t&&!e)return tk();var r,i,o,a=null!=(o=null!=(i=(e=e||{}).random)?i:null==(r=e.rng)?void 0:r.call(e))?o:function(){if(!eo){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");eo=crypto.getRandomValues.bind(crypto)}return eo(tU)}();if(a.length<16)throw Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((n=n||0)<0||n+16>t.length)throw RangeError("UUID byte range ".concat(n,":").concat(n+15," is out of buffer bounds"));for(var s=0;s<16;++s)t[n+s]=a[s];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(tN[e[t+0]]+tN[e[t+1]]+tN[e[t+2]]+tN[e[t+3]]+"-"+tN[e[t+4]]+tN[e[t+5]]+"-"+tN[e[t+6]]+tN[e[t+7]]+"-"+tN[e[t+8]]+tN[e[t+9]]+"-"+tN[e[t+10]]+tN[e[t+11]]+tN[e[t+12]]+tN[e[t+13]]+tN[e[t+14]]+tN[e[t+15]]).toLowerCase()}(a)};e.i(242933);var tP=e.i(790164),tM=e.i(792129),tj=e.i(562563),tL=function(){function e(t){var n=this,r=t.userId,i=t.connectImmediately,o=t.logger,a=t.getEndpoint,s=t.getToken,l=t.overrideWebsocket,p=t.onProtocolError,u=t.onRetriesExceeded;(0,th._)(this,e),(0,t_._)(this,"clientId",void 0),(0,t_._)(this,"serverId",void 0),(0,t_._)(this,"log",void 0),(0,t_._)(this,"status",void 0),(0,t_._)(this,"transport",void 0),(0,t_._)(this,"client",void 0),(0,t_._)(this,"dispose",null),this.clientId="".concat(r,"-").concat(tw()),this.serverId=ec,this.log=null!=o?o:null,this.status=new tP.ObservableState("disconnected"),this.transport=new tj.WebSocketClientTransport(l?function(){return(0,tT._)(function(){return(0,tf._)(this,function(e){switch(e.label){case 0:return[4,a()];case 1:return[2,l.apply(void 0,[e.sent().toString()])]}})})()}:function(){return(0,tT._)(function(){var e;return(0,tf._)(this,function(t){switch(t.label){case 0:return e=WebSocket.bind,[4,a()];case 1:return[2,new(e.apply(WebSocket,[void 0,t.sent().toString()]))]}})})()},this.clientId,ey),o&&this.transport.bindLogger(o,"info"),this.client=(0,tM.createClient)(this.transport,this.serverId,{eagerlyConnect:!1,connectOnInvoke:!1,handshakeOptions:(0,tM.createClientHandshakeOptions)(eT,function(){return(0,tT._)(function(){return(0,tf._)(this,function(e){switch(e.label){case 0:return[4,s()];case 1:return[2,e.sent()]}})})()})});var c=new Set;this.transport.addEventListener("sessionTransition",function(e){n.is("closed","error")||("NoConnection"!==e.state&&c.delete(e.id),"Connected"===e.state?n.status.set("connected"):n.transport.reconnectOnConnectionDrop?n.status.set("connecting"):n.status.set("disconnected"))}),this.transport.addEventListener("sessionStatus",function(e){if(!n.is("closed","error")){if("created"===e.status)c.add(e.session.id);else if("closed"===e.status){if(c.has(e.session.id)&&"closed"!==n.transport.getStatus()){var t;null==(t=n.log)||t.call(n,"detected zombie session",{clientId:n.clientId,sessionId:e.session.id},"error")}c.delete(e.session.id),n.transport.reconnectOnConnectionDrop?n.status.set("connecting"):n.status.set("disconnected")}}}),this.transport.addEventListener("protocolError",function(e){var t,r;if(e.type===es.ProtocolError.HandshakeFailed){null==(t=n.log)||t.call(n,"river handshake failed",{clientId:n.clientId},"error");return}if(e.type===es.ProtocolError.RetriesExceeded){null==(r=n.log)||r.call(n,"river retry limit exceeded",{clientId:n.clientId},"error"),n.close(),null==u||u(e);return}n.error(),null==p||p(e)});var d=window.navigator.onLine,y=function(){return!n.is("closed","error")&&"visible"===document.visibilityState&&d},T=function(){var e=n.transport.reconnectOnConnectionDrop,t=y();n.transport.reconnectOnConnectionDrop=t,e&&!t&&n.is("connecting")&&n.status.set("disconnected"),t&&n.is("disconnected")&&n.connect()},f=function(){T()},g=function(){d=!0,T()},h=function(){d=!1,T()};this.transport.reconnectOnConnectionDrop=y(),document.addEventListener("visibilitychange",f),window.addEventListener("online",g),window.addEventListener("offline",h),this.dispose=function(){document.removeEventListener("visibilitychange",f),window.removeEventListener("online",g),window.removeEventListener("offline",h)},y()&&!1!==i&&this.connect(),d||this.testConnection().then(function(e){if(e&&!d){var t;null==(t=n.log)||t.call(n,"got false negative navigator.onLine",{clientId:n.clientId},"warn"),g()}}),!0===i&&this.connect()}return(0,tv._)(e,[{key:"testConnection",value:function(){return(0,tT._)(function(){return(0,tf._)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,fetch("/",{method:"OPTIONS"})];case 1:return e.sent(),[2,!0];case 2:return e.sent(),[2,!1];case 3:return[2]}})})()}},{key:"is",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.includes(this.status.current)}},{key:"connect",value:function(){if(this.is("closed","error"))throw Error("Cannot connect to a ".concat(this.status.current," ChortRiverConnection"));this.is("connected","connecting")||(this.status.set("connecting"),this.transport.connect(this.serverId))}},{key:"error",value:function(){if(!this.is("closed","error")){var e;this.status.set("error"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}},{key:"drained",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return(0,tT._)(function(){var t,n,r,i,o,a,s;return(0,tf._)(this,function(l){switch(l.label){case 0:t=setTimeout(function(){t=null},e),l.label=1;case 1:if(null===t||0===this.transport.sessions.size)return[3,4];n=!1,r=!0,i=!1,o=void 0;try{for(a=this.transport.sessions.values()[Symbol.iterator]();!(r=(s=a.next()).done);r=!0)if(s.value.sendBuffer.some(function(e){return(1&e.controlFlags)!=1})){n=!0;break}}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}if(!n)return[3,3];return[4,new Promise(function(e){return setTimeout(e,100)})];case 2:return l.sent(),[3,1];case 3:return[3,4];case 4:return clearTimeout(t),[2,null!==t]}})}).call(this)}},{key:"close",value:function(){if(!this.is("closed","error")){var e;this.status.set("closed"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}}]),e}();e.s(["ChortRiverConnection",()=>tL],187822);var tx=e.i(386962),tB=function(){function e(t){var n=this,r=t.userId,i=t.logger,o=t.getEndpoint,a=t.getToken,s=t.overrideWebsocket,l=t.onProtocolError,p=t.onRetriesExceeded,u=t.noBgReconnectEnabled;(0,th._)(this,e),(0,t_._)(this,"clientId",void 0),(0,t_._)(this,"serverId",void 0),(0,t_._)(this,"log",void 0),(0,t_._)(this,"status",void 0),(0,t_._)(this,"transport",void 0),(0,t_._)(this,"client",void 0),(0,t_._)(this,"dispose",null),(0,t_._)(this,"connect",void 0),this.clientId="".concat(r,"-").concat(tw()),this.serverId=ec,this.log=null!=i?i:null,this.status=new tP.ObservableState("disconnected"),this.transport=new tj.WebSocketClientTransport(s?function(){return(0,tT._)(function(){return(0,tf._)(this,function(e){switch(e.label){case 0:return[4,o()];case 1:return[2,s.apply(void 0,[e.sent().toString()])]}})})()}:function(){return(0,tT._)(function(){var e;return(0,tf._)(this,function(t){switch(t.label){case 0:return e=WebSocket.bind,[4,o()];case 1:return[2,new(e.apply(WebSocket,[void 0,t.sent().toString()]))]}})})()},this.clientId,ey),i&&this.transport.bindLogger(i,"info"),this.client=(0,tM.createClient)(this.transport,this.serverId,{eagerlyConnect:!1,connectOnInvoke:!1,handshakeOptions:(0,tM.createClientHandshakeOptions)(eT,function(){return(0,tT._)(function(){return(0,tf._)(this,function(e){switch(e.label){case 0:return[4,a()];case 1:return[2,e.sent()]}})})()})}),this.transport.addEventListener("sessionTransition",function(e){n.is("closed","error")||("Connected"===e.state?n.status.set("connected"):"NoConnection"===e.state?n.status.set("disconnected"):n.status.set("connecting"))});var c=(0,tx.setupRiverTransport)({logContext:{target:"chort"},transport:this.transport,serverId:this.serverId,onRetryBudgetExhausted:function(){n.close(),null==p||p({type:es.ProtocolError.RetriesExceeded,message:"Retry budget exhausted"})},onProtocolError:function(e){n.error(),null==l||l(e)},noBgReconnectEnabled:u,log:i});this.dispose=c.dispose,this.connect=c.connect}return(0,tv._)(e,[{key:"is",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.includes(this.status.current)}},{key:"error",value:function(){if(!this.is("closed","error")){var e;this.status.set("error"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}},{key:"drained",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return(0,tT._)(function(){var t,n,r,i,o,a,s;return(0,tf._)(this,function(l){switch(l.label){case 0:t=setTimeout(function(){t=null},e),l.label=1;case 1:if(null===t||0===this.transport.sessions.size)return[3,4];n=!1,r=!0,i=!1,o=void 0;try{for(a=this.transport.sessions.values()[Symbol.iterator]();!(r=(s=a.next()).done);r=!0)if(s.value.sendBuffer.some(function(e){return(1&e.controlFlags)!=1})){n=!0;break}}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}if(!n)return[3,3];return[4,new Promise(function(e){return setTimeout(e,100)})];case 2:return l.sent(),[3,1];case 3:return[3,4];case 4:return clearTimeout(t),[2,null!==t]}})}).call(this)}},{key:"close",value:function(){if(!this.is("closed","error")){var e;this.status.set("closed"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}}]),e}();e.s(["ChortRiverConnection",()=>tB],943673);var tF=e.i(148382).default.env.CHORT_HOST_OVERRIDE||null,tG="chort-development-endpoint-override",tq="chort-use-ai-chat-proxy",t$={production:"wss://production-chort.replit.com/api/river",staging:"wss://staging-chort.replit.com/api/river",development:"ws://127.0.0.1:8100/api/river"};function tV(e){try{e?window.localStorage.setItem(tG,e):window.localStorage.removeItem(tG)}catch(e){}}function tW(){try{return window.localStorage.getItem(tG)||null}catch(e){return null}}function tH(){try{var e=window.localStorage.getItem(tq);if(null===e)return null;return"true"===e}catch(e){return null}}function tK(e){try{null===e?window.localStorage.removeItem(tq):window.localStorage.setItem(tq,e?"true":"false")}catch(e){}}function tz(e){if(tF)return console.warn("chort: using environment endpoint override",tF),"ws://".concat(tF,":8100/api/river");var t=tW();return t?(console.warn("chort: using development endpoint override",t),t):t$[e]}function tY(e){return tz(e).replace("/api/river","/api/river-chat")}e.s(["CHORT_ENDPOINTS",()=>t$,"CHORT_ENVIRONMENT_HOST_OVERRIDE",()=>tF,"getChatProxyEndpoint",()=>tY,"getChortEndpoint",()=>tz,"getChortLocalEndpointOverride",()=>tW,"getUseChatProxyOverride",()=>tH,"setChortLocalEndpointOverride",()=>tV,"setUseChatProxyOverride",()=>tK],170039);var tQ=e.i(693482),tX=e.i(452723),tJ=eu.Type.Object({path:eu.Type.Union([eu.Type.String(),eu.Type.Array(eu.Type.Union([eu.Type.Number(),eu.Type.String()]))]),op:eu.Type.Union([eu.Type.Literal("replace"),eu.Type.Literal("add"),eu.Type.Literal("remove")]),value:eu.Type.Optional(eu.Type.Any())});function tZ(e){return(0,tT._)(function(){var t,n;return(0,tf._)(this,function(r){switch(r.label){case 0:return[4,(t=e.resReadable[Symbol.asyncIterator]()).next()];case 1:if((n=r.sent()).done)throw Error("Unexpected: initial result is done");if(n.value.ok&&"delta"in n.value.payload)throw Error("Unexpected: initial result is not a snapshot");return[2,{snapshot:n.value.ok?(0,tM.Ok)(n.value.payload.snapshot):(0,tM.Err)(n.value.payload),deltas:(0,t_._)({},Symbol.asyncIterator,function(){return(0,tX._)(function(){var e;return(0,tf._)(this,function(n){switch(n.label){case 0:return[4,(0,tQ._)(t.next())];case 1:if((e=n.sent()).done)return[3,5];if(e.value.ok)return[3,3];return[4,(0,tM.Err)(e.value.payload)];case 2:case 4:return n.sent(),[3,0];case 3:return[4,(0,tM.Ok)(e.value.payload.delta)];case 5:return[2]}})})()})}]}})})()}eu.Type.Array(tJ),e.s(["getSyncResult",()=>tZ],813702);var t0=e.i(346715),t1=e.i(119468),t2="remove",t3="replace",t4=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),t6=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),t8=Symbol.iterator,t5={mutable:"mutable",immutable:"immutable"},t7={};function t9(e,t){return(0,tm._)(e,Map)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function ne(e,t){if(t in e)for(var n=Reflect.getPrototypeOf(e);n;){var r=Reflect.getOwnPropertyDescriptor(n,t);if(r)return r;n=Reflect.getPrototypeOf(n)}}function nt(e){return Object.getPrototypeOf(e)===Set.prototype}function nn(e){return Object.getPrototypeOf(e)===Map.prototype}function nr(e){var t;return null!=(t=e.copy)?t:e.original}function ni(e){return!!no(e)}function no(e){return(void 0===e?"undefined":(0,t1._)(e))!=="object"?null:null==e?void 0:e[t4]}function na(e){var t,n=no(e);return n?null!=(t=n.copy)?t:n.original:e}function ns(e,t){var n;return!!e&&(void 0===e?"undefined":(0,t1._)(e))==="object"&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e)||(0,tm._)(e,Map)||(0,tm._)(e,Set)||!!(null==t?void 0:t.mark)&&((n=t.mark(e,t5))===t5.immutable||"function"==typeof n))}function nl(e){return Array.isArray(e)?1:(0,tm._)(e,Map)?2:3*!!(0,tm._)(e,Set)}function np(e,t){return 2===nl(e)?e.get(t):e[t]}function nu(e,t,n){2===nl(e)?e.set(t,n):e[t]=n}function nc(e,t){var n=no(e);return(n?nr(n):e)[t]}function nd(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function ny(e){if(e)for(;e.finalities.revoke.length>0;)e.finalities.revoke.pop()()}function nT(e,t){return t?e:[""].concat(e).map(function(e){var t="".concat(e);return -1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}var nf=Object.prototype.propertyIsEnumerable;function ng(e,t){if(Array.isArray(e))return Array.prototype.concat.call(e);if((0,tm._)(e,Set))return nt(e)?Set.prototype.difference?Set.prototype.difference.call(e,new Set):new Set(e.values()):new(Object.getPrototypeOf(e)).constructor(e.values());if((0,tm._)(e,Map))return nn(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e);if((null==t?void 0:t.mark)&&void 0!==(n=t.mark(e,t5))&&n!==t5.mutable){if(n===t5.immutable)return r=Object.create(Object.getPrototypeOf(e)),Reflect.ownKeys(e).forEach(function(t){var n=Reflect.getOwnPropertyDescriptor(e,t);if(n.enumerable&&n.configurable&&n.writable){r[t]=e[t];return}n.writable||(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(n={configurable:!0,writable:!0,enumerable:n.enumerable,value:e[t]}),Reflect.defineProperty(r,t,n)}),r;if("function"==typeof n){if(t.enablePatches||t.enableAutoFreeze)throw Error("You can't use mark and patches or auto freeze together.");return n()}throw Error("Unsupported mark result: ".concat(n))}if((void 0===e?"undefined":(0,t1._)(e))==="object"&&Object.getPrototypeOf(e)===Object.prototype){var n,r,i={};return Object.keys(e).forEach(function(t){i[t]=e[t]}),Object.getOwnPropertySymbols(e).forEach(function(t){nf.call(e,t)&&(i[t]=e[t])}),i}else throw Error("Please check mark() to ensure that it is a stable marker draftable function.")}function nh(e){e.copy||(e.copy=ng(e.original,e.options))}function nv(e){if(!ns(e))return na(e);if(Array.isArray(e))return e.map(nv);if((0,tm._)(e,Map)){var t=Array.from(e.entries()).map(function(e){var t=(0,tS._)(e,2);return[t[0],nv(t[1])]});return nn(e)?new Map(t):new(Object.getPrototypeOf(e)).constructor(t)}if((0,tm._)(e,Set)){var n=Array.from(e).map(nv);return nt(e)?new Set(n):new(Object.getPrototypeOf(e)).constructor(n)}var r=Object.create(Object.getPrototypeOf(e));for(var i in e)r[i]=nv(e[i]);return r}function nm(e){return ni(e)?nv(e):e}function nS(e){var t;e.assignedMap=null!=(t=e.assignedMap)?t:new Map,!e.operated&&(e.operated=!0,e.parent&&nS(e.parent))}function nE(){throw Error("Cannot modify frozen object")}function nb(e,t){var n=nl(e);if(0===n)Reflect.ownKeys(e).forEach(function(n){t(n,e[n],e)});else if(1===n){var r=0,i=!0,o=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var p=s.value;t(r,p,e),r+=1}}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}}else e.forEach(function(n,r){return t(r,n,e)})}function nR(e){3===e.type&&e.copy&&(e.copy.clear(),e.setMap.forEach(function(t){e.copy.add(na(t))}))}function nC(e,t,n,r){if(e.operated&&e.assignedMap&&e.assignedMap.size>0&&!e.finalized){if(n&&r){var i=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(Object.hasOwnProperty.call(t,"key")){var r=t.parent.copy,i=no(np(r,t.key));if(null!==i&&(null==i?void 0:i.original)!==t.original)return null;var o=3===t.parent.type,a=o?Array.from(t.parent.setMap.keys()).indexOf(t.key):t.key;if(!(o&&r.size>a||t9(r,a)))return null;n.push(a)}if(t.parent)return e(t.parent,n);n.reverse();try{for(var s=t.copy,l=n,p=0;p<l.length-1;p+=1){var u=l[p];if((void 0===(s=np(3===nl(s)?Array.from(s):s,u))?"undefined":(0,t1._)(s))!=="object")throw Error("Cannot resolve patch at '".concat(l.join("/"),"'."))}}catch(e){return null}return n}(e);i&&t(e,i,n,r)}e.finalized=!0}}function nI(e,t,n,r){var i=no(n);i&&(i.callbacks||(i.callbacks=[]),i.callbacks.push(function(o,a){var s,l=3===e.type?e.setMap:e.copy;if(nd(np(l,t),n)){var p=i.original;i.copy&&(p=i.copy),nR(e),nC(e,r,o,a),e.options.enableAutoFreeze&&(e.options.updatedValues=null!=(s=e.options.updatedValues)?s:new WeakMap,e.options.updatedValues.set(p,i.original)),nu(l,t,p)}}),e.options.enableAutoFreeze&&i.finalities!==e.finalities&&(e.options.enableAutoFreeze=!1)),ns(n,e.options)&&e.finalities.draft.push(function(){var r;nd(np(3===e.type?e.setMap:e.copy,t),n)&&(r=3===e.type?e.setMap:e.copy,e.finalities.revoke.length>1&&e.assignedMap.get(t)&&r&&function e(t,n,r){if(!(ni(t)||!ns(t,r)||n.has(t)||Object.isFrozen(t))){var i=(0,tm._)(t,Set),o=i?new Map:void 0;if(n.add(t),nb(t,function(a,s){var l;if(ni(s)){var p=no(s);nh(p),nu(i?o:t,a,(null==(l=p.assignedMap)?void 0:l.size)||p.operated?p.copy:p.original)}else e(s,n,r)}),o){var a=Array.from(t);t.clear(),a.forEach(function(e){t.add(o.has(e)?o.get(e):e)})}}}(np(r,t),e.finalities.handledSet,e.options))})}function nO(e,t,n,r){var i,o,a,s,l,p=e.options.enablePatches.pathAsArray,u=void 0===p||p;switch(e.type){case 0:case 2:return i=e.original,o=e.copy,void e.assignedMap.forEach(function(e,a){var s=np(i,a),l=nm(np(o,a)),p=e?t9(i,a)?t3:"add":t2;if(!nd(s,l)||p!==t3){var c=nT(t.concat(a),u);n.push(p===t2?{op:p,path:c}:{op:p,path:c,value:l}),r.push("add"===p?{op:t2,path:c}:p===t2?{op:"add",path:c,value:s}:{op:t3,path:c,value:s})}});case 1:return function(e,t,n,r,i){var o,a,s=e.original,l=e.assignedMap,p=e.options,u=e.copy;u.length<s.length&&(s=(o=[u,s])[0],u=o[1],n=(a=[r,n])[0],r=a[1]);for(var c=0;c<s.length;c+=1)if(l.get(c.toString())&&u[c]!==s[c]){var d=nT(t.concat([c]),i);n.push({op:t3,path:d,value:nm(u[c])}),r.push({op:t3,path:d,value:nm(s[c])})}for(var y=s.length;y<u.length;y+=1){var T=nT(t.concat([y]),i);n.push({op:"add",path:T,value:nm(u[y])})}if(s.length<u.length){var f=p.enablePatches.arrayLengthAssignment;if(void 0===f||f){var g=nT(t.concat(["length"]),i);r.push({op:t3,path:g,value:s.length})}else for(var h=u.length;s.length<h;h-=1){var v=nT(t.concat([h-1]),i);r.push({op:t2,path:v})}}}(e,t,n,r,u);case 3:return a=e.original,s=e.copy,l=0,void(a.forEach(function(e){if(!s.has(e)){var i=nT(t.concat([l]),u);n.push({op:t2,path:i,value:e}),r.unshift({op:"add",path:i,value:e})}l+=1}),l=0,s.forEach(function(e){if(!a.has(e)){var i=nT(t.concat([l]),u);n.push({op:"add",path:i,value:e}),r.unshift({op:t2,path:i,value:e})}l+=1}))}}var nA=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((void 0===e?"undefined":(0,t1._)(e))==="object"&&null!==e&&(!ns(e,t)||n)&&1)throw Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},n_=(0,t_._)({get size(){return nr(no(this)).size},has:function(e){return nr(no(this)).has(e)},set:function(e,t){var n=no(this),r=nr(n);return r.has(e)&&nd(r.get(e),t)||(nh(n),nS(n),n.assignedMap.set(e,!0),n.copy.set(e,t),nI(n,e,t,nO)),this},delete:function(e){if(!this.has(e))return!1;var t=no(this);return nh(t),nS(t),t.original.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.copy.delete(e),!0},clear:function(){var e=no(this);if(this.size){nh(e),nS(e),e.assignedMap=new Map;var t=!0,n=!1,r=void 0;try{for(var i,o=e.original[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=(0,tS._)(i.value,1)[0];e.assignedMap.set(a,!1)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}e.copy.clear()}},forEach:function(e,t){var n=this;nr(no(this)).forEach(function(r,i){e.call(t,n.get(i),i,n)})},get:function(e){var t,n,r=no(this),i=nr(r).get(e),o=(null==(n=(t=r.options).mark)?void 0:n.call(t,i,t5))===t5.mutable;if(r.options.strict&&nA(i,r.options,o),o||r.finalized||!ns(i,r.options)||i!==r.original.get(e))return i;var a=t7.createDraft({original:i,parentDraft:r,key:e,finalities:r.finalities,options:r.options});return nh(r),r.copy.set(e,a),a},keys:function(){return nr(no(this)).keys()},values:function(){var e,t=this,n=this.keys();return e={},(0,t_._)(e,t8,function(){return t.values()}),(0,t_._)(e,"next",function(){var e=n.next();return e.done?e:{done:!1,value:t.get(e.value)}}),e},entries:function(){var e,t=this,n=this.keys();return e={},(0,t_._)(e,t8,function(){return t.entries()}),(0,t_._)(e,"next",function(){var e=n.next();if(e.done)return e;var r=t.get(e.value);return{done:!1,value:[e.value,r]}}),e}},t8,function(){return this.entries()}),nk=Reflect.ownKeys(n_),nU=function(e,t,n){var r=n.isValuesIterator;return function(){var n,i,o=t.next();if(o.done)return o;var a=o.value,s=e.setMap.get(a),l=no(s),p=(null==(i=(n=e.options).mark)?void 0:i.call(n,s,t5))===t5.mutable;if(e.options.strict&&nA(a,e.options,p),!p&&!l&&ns(a,e.options)&&!e.finalized&&e.original.has(a)){var u=t7.createDraft({original:a,parentDraft:e,key:a,finalities:e.finalities,options:e.options});e.setMap.set(a,u),s=u}else l&&(s=l.proxy);return{done:!1,value:r?s:[s,s]}}},nN=(ea={get size(){return no(this).setMap.size},has:function(e){var t=no(this);if(t.setMap.has(e))return!0;nh(t);var n=no(e);return!!(n&&t.setMap.has(n.original))},add:function(e){var t=no(this);return this.has(e)||(nh(t),nS(t),t.assignedMap.set(e,!0),t.setMap.set(e,e),nI(t,e,e,nO)),this},delete:function(e){if(!this.has(e))return!1;var t=no(this);nh(t),nS(t);var n=no(e);return n&&t.setMap.has(n.original)?(t.assignedMap.set(n.original,!1),t.setMap.delete(n.original)):(!n&&t.setMap.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.setMap.delete(e))},clear:function(){if(this.size){var e=no(this);nh(e),nS(e);var t=!0,n=!1,r=void 0;try{for(var i,o=e.original[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;e.assignedMap.set(a,!1)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}e.setMap.clear()}},values:function(){var e,t=this,n=no(this);nh(n);var r=n.setMap.keys();return e={},(0,t_._)(e,Symbol.iterator,function(){return t.values()}),(0,t_._)(e,"next",nU(n,r,{isValuesIterator:!0})),e},entries:function(){var e,t=this,n=no(this);nh(n);var r=n.setMap.keys();return e={},(0,t_._)(e,Symbol.iterator,function(){return t.entries()}),(0,t_._)(e,"next",nU(n,r,{isValuesIterator:!1})),e},keys:function(){return this.values()}},(0,t_._)(ea,t8,function(){return this.values()}),(0,t_._)(ea,"forEach",function(e,t){for(var n=this.values(),r=n.next();!r.done;)e.call(t,r.value,r.value,this),r=n.next()}),ea);Set.prototype.difference&&Object.assign(nN,{intersection:function(e){return Set.prototype.intersection.call(new Set(this.values()),e)},union:function(e){return Set.prototype.union.call(new Set(this.values()),e)},difference:function(e){return Set.prototype.difference.call(new Set(this.values()),e)},symmetricDifference:function(e){return Set.prototype.symmetricDifference.call(new Set(this.values()),e)},isSubsetOf:function(e){return Set.prototype.isSubsetOf.call(new Set(this.values()),e)},isSupersetOf:function(e){return Set.prototype.isSupersetOf.call(new Set(this.values()),e)},isDisjointFrom:function(e){return Set.prototype.isDisjointFrom.call(new Set(this.values()),e)}});var nD=Reflect.ownKeys(nN),nw=new WeakSet,nP={get:function(e,t,n){var r,i,o,a=null==(r=e.copy)?void 0:r[t];if(a&&nw.has(a))return a;if(t===t4)return e;if(e.options.mark){var s="size"===t&&((0,tm._)(e.original,Map)||(0,tm._)(e.original,Set))?Reflect.get(e.original,t):Reflect.get(e.original,t,n);if((o=e.options.mark(s,t5))===t5.mutable)return e.options.strict&&nA(s,e.options,!0),s}var l=nr(e);if((0,tm._)(l,Map)&&nk.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(n_,"size").get.call(e.proxy);var p=n_[t];if(p)return p.bind(e.proxy)}if((0,tm._)(l,Set)&&nD.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(nN,"size").get.call(e.proxy);var u=nN[t];if(u)return u.bind(e.proxy)}if(!t9(l,t)){var c=ne(l,t);return c?"value"in c?c.value:null==(i=c.get)?void 0:i.call(e.proxy):void 0}var d=l[t];if(e.options.strict&&nA(d,e.options),e.finalized||!ns(d,e.options))return d;if(d===nc(e.original,t)){if(nh(e),e.copy[t]=nM({original:e.original[t],parentDraft:e,key:1===e.type?Number(t):t,finalities:e.finalities,options:e.options}),"function"==typeof o){var y=no(e.copy[t]);return nh(y),nS(y),y.copy}return e.copy[t]}return d},set:function(e,t,n){if(3===e.type||2===e.type)throw Error("Map/Set draft does not support any property assignment.");if(1===e.type&&"length"!==t&&!(Number.isInteger(i=Number(t))&&i>=0&&(0===t||0===i||String(i)===String(t))))throw Error("Only supports setting array indices and the 'length' property.");var r,i,o=ne(nr(e),t);if(null==o?void 0:o.set)return o.set.call(e.proxy,n),!0;var a=nc(nr(e),t),s=no(a);return s&&nd(s.original,n)?(e.copy[t]=n,e.assignedMap=null!=(r=e.assignedMap)?r:new Map,e.assignedMap.set(t,!1),!0):!!(nd(n,a)&&(void 0!==n||t9(e.original,t)))||(nh(e),nS(e),t9(e.original,t)&&nd(n,e.original[t])?e.assignedMap.delete(t):e.assignedMap.set(t,!0),e.copy[t]=n,nI(e,t,n,nO),!0)},has:function(e,t){return t in nr(e)},ownKeys:function(e){return Reflect.ownKeys(nr(e))},getOwnPropertyDescriptor:function(e,t){var n=nr(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},getPrototypeOf:function(e){return Reflect.getPrototypeOf(e.original)},setPrototypeOf:function(){throw Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty:function(){throw Error("Cannot call 'defineProperty()' on drafts")},deleteProperty:function(e,t){var n;return 1===e.type?nP.set.call(this,e,t,void 0,e.proxy):(void 0!==nc(e.original,t)||t in e.original?(nh(e),nS(e),e.assignedMap.set(t,!1)):(e.assignedMap=null!=(n=e.assignedMap)?n:new Map,e.assignedMap.delete(t)),e.copy&&delete e.copy[t],!0)}};function nM(e){var t=e.original,n=e.parentDraft,r=e.key,i=e.finalities,o=e.options,a=nl(t),s={type:a,finalized:!1,parent:n,original:t,copy:null,proxy:null,finalities:i,options:o,setMap:3===a?new Map(t.entries()):void 0};(r||"key"in e)&&(s.key=r);var l=Proxy.revocable(1===a?Object.assign([],s):s,nP),p=l.proxy,u=l.revoke;if(i.revoke.push(u),nw.add(p),s.proxy=p,n)n.finalities.draft.push(function(e,t){var i,o,a=no(p),s=3===n.type?n.setMap:n.copy,l=np(s,r),u=no(l);if(u){var c=u.original;u.operated&&(c=na(l)),nR(u),nC(u,nO,e,t),n.options.enableAutoFreeze&&(n.options.updatedValues=null!=(i=n.options.updatedValues)?i:new WeakMap,n.options.updatedValues.set(c,u.original)),nu(s,r,c)}null==(o=a.callbacks)||o.forEach(function(n){n(e,t)})});else{var c=no(p);c.finalities.draft.push(function(e,t){nR(c),nC(c,nO,e,t)})}return p}function nj(e){var t=e.rootDraft,n=e.value,r=e.useRawReturn,i=e.isRoot;nb(n,function(n,r,i){var o=no(r);if(o&&t&&o.finalities===t.finalities){e.isContainDraft=!0;var a=o.original;if((0,tm._)(i,Set)){var s=Array.from(i);i.clear(),s.forEach(function(e){return i.add(n===e?a:e)})}else nu(i,n,a)}else(void 0===r?"undefined":(0,t1._)(r))==="object"&&null!==r&&(e.value=r,e.isRoot=!1,nj(e))}),(void 0===i||i)&&(e.isContainDraft||console.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),void 0!==r&&r&&console.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function nL(e){if(!ni(e))throw Error("current() is only used for Draft, parameter: ".concat(e));return function e(t){var n,r,i=no(t);if(!ns(t,null==i?void 0:i.options))return t;var o=nl(t);if(i&&!i.operated)return i.original;function a(){r=2===o?nn(t)?new Map(t):new(Object.getPrototypeOf(t)).constructor(t):3===o?Array.from(i.setMap.values()):ng(t,null==i?void 0:i.options)}if(i){i.finalized=!0;try{a()}finally{i.finalized=!1}}else r=t;if(nb(r,function(n,o){if(!(i&&nd(np(i.original,n),o))){var s=e(o);s!==o&&(r===t&&a(),nu(r,n,s))}}),3===o){var s=null!=(n=null==i?void 0:i.original)?n:r;return nt(s)?new Set(r):new(Object.getPrototypeOf(s)).constructor(r)}return r}(e)}t7.createDraft=nM;var nx=function(e){if(void 0!==e&&"[object Object]"!==Object.prototype.toString.call(e))throw Error("Invalid options: ".concat(String(e),", 'options' should be an object."));return function t(n,r,i){if("function"==typeof n&&"function"!=typeof r)return function(e){for(var i,o=this,a=arguments.length,s=Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];return t(e,function(e){return(i=n).call.apply(i,[o,e].concat((0,t0._)(s)))},r)};var o,a,s,l,p,u,c,d,y,T=i;if("function"!=typeof r&&(T=r),void 0!==T&&"[object Object]"!==Object.prototype.toString.call(T))throw Error("Invalid options: ".concat(T,", 'options' should be an object."));T=Object.assign(Object.assign({},e),T);var f=ni(n)?nL(n):n,g=Array.isArray(T.mark)?function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=T.mark[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if("function"!=typeof s)throw Error("Invalid mark: ".concat(s,", 'mark' should be a function."));var l=s(e,t);if(l)return l}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}:T.mark,h=null!=(o=T.enablePatches)&&o,v=null!=(a=T.strict)&&a,m={enableAutoFreeze:null!=(s=T.enableAutoFreeze)&&s,mark:g,strict:v,enablePatches:h};if(!ns(f,m)&&(void 0===f?"undefined":(0,t1._)(f))==="object"&&null!==f)throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");var S=(0,tS._)((d={draft:[],revoke:[],handledSet:new WeakSet},m.enablePatches&&(u=[],c=[]),[y=(null==(p=m.mark)?void 0:p.call(m,f,t5))!==t5.mutable&&ns(f,m)?nM({original:f,parentDraft:null,finalities:d,options:m}):f,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,tS._)(function(e,t,n,r,i){var o,a=no(e),s=null!=(o=null==a?void 0:a.original)?o:e,l=!!t.length;if(null==a?void 0:a.operated)for(;a.finalities.draft.length>0;)a.finalities.draft.pop()(n,r);var p=l?t[0]:a?a.operated?a.copy:a.original:e;return a&&ny(a),i&&function e(t,n,r,i,o){r=null!=r?r:new WeakMap,i=null!=i?i:[],o=null!=o?o:[];var a=r.has(t)?r.get(t):t;if(i.length>0){var s=i.indexOf(a);if(a&&(void 0===a?"undefined":(0,t1._)(a))==="object"&&-1!==s){if(i[0]===a)throw Error("Forbids circular reference");throw Error("Forbids circular reference: ~/".concat(o.slice(0,s).map(function(e,t){if((void 0===e?"undefined":(0,t1._)(e))==="symbol")return"[".concat(e.toString(),"]");var n=i[t];return(void 0===e?"undefined":(0,t1._)(e))==="object"&&((0,tm._)(n,Map)||(0,tm._)(n,Set))?Array.from(n.keys()).indexOf(e):e}).join("/")))}i.push(a),o.push(n)}else i.push(a);if(Object.isFrozen(t)||ni(t)){i.pop(),o.pop();return}switch(nl(t)){case 2:var l=!0,p=!1,u=void 0;try{for(var c,d=t[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var y=(0,tS._)(c.value,2),T=y[0],f=y[1];e(T,T,r,i,o),e(f,T,r,i,o)}}catch(e){p=!0,u=e}finally{try{l||null==d.return||d.return()}finally{if(p)throw u}}t.set=t.clear=t.delete=nE;break;case 3:var g=!0,h=!1,v=void 0;try{for(var m,S=t[Symbol.iterator]();!(g=(m=S.next()).done);g=!0){var E=m.value;e(E,E,r,i,o)}}catch(e){h=!0,v=e}finally{try{g||null==S.return||S.return()}finally{if(h)throw v}}t.add=t.clear=t.delete=nE;break;case 1:Object.freeze(t);var b=0,R=!0,C=!1,I=void 0;try{for(var O,A=t[Symbol.iterator]();!(R=(O=A.next()).done);R=!0){var _=O.value;e(_,b,r,i,o),b+=1}}catch(e){C=!0,I=e}finally{try{R||null==A.return||A.return()}finally{if(C)throw I}}break;default:Object.freeze(t),Object.keys(t).forEach(function(n){e(t[n],n,r,i,o)})}i.pop(),o.pop()}(p,p,null==a?void 0:a.options.updatedValues),[p,n&&l?[{op:t3,path:[],value:t[0]}]:n,r&&l?[{op:t3,path:[],value:s}]:r]}(y,e,u,c,m.enableAutoFreeze),3),n=t[0],r=t[1],i=t[2];return m.enablePatches?[n,r,i]:n}]),2),E=S[0],b=S[1];if("function"!=typeof r){if(!ns(f,m))throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[E,b]}try{l=r(E)}catch(e){throw ny(no(E)),e}var R=function(e){var t=no(E);if(!ni(e)){if(void 0!==e&&!nd(e,E)&&(null==t?void 0:t.operated))throw Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");var n=null==e?void 0:e[t6];if(n){var r=n[0];return m.strict&&(void 0===e?"undefined":(0,t1._)(e))==="object"&&null!==e&&nj({rootDraft:t,value:e,useRawReturn:!0}),b([r])}if(void 0!==e)return(void 0===e?"undefined":(0,t1._)(e))==="object"&&null!==e&&nj({rootDraft:t,value:e}),b([e])}if(e===E||void 0===e)return b([]);var i=no(e);if(m===i.options){if(i.operated)throw Error("Cannot return a modified child draft.");return b([nL(e)])}return b([e])};return(0,tm._)(l,Promise)?l.then(R,function(e){throw ny(no(E)),e}):R(l)}}();function nB(e,t,n){for(r=t.length-1;r>=0;r-=1){var r,i=t[r],o=i.value,a=i.op,s=i.path;if(!s.length&&a===t3||""===s&&"add"===a){e=o;break}}r>-1&&(t=t.slice(r+1));var l=function(e){t.forEach(function(t){for(var n=t.path,r=t.op,i=Array.isArray(n)?n:n.split("/").map(function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}).slice(1),o=e,a=0;a<i.length-1;a+=1){var s=nl(o),l=i[a];if("string"!=typeof l&&"number"!=typeof l&&(l=String(l)),(0===s||1===s)&&("__proto__"===l||"constructor"===l)||"function"==typeof o&&"prototype"===l)throw Error("Patching reserved attributes like __proto__ and constructor is not allowed.");if((void 0===(o=np(3===s?Array.from(o):o,l))?"undefined":(0,t1._)(o))!=="object")throw Error("Cannot apply patch at '".concat(i.join("/"),"'."))}var p=nl(o),u=nv(t.value),c=i[i.length-1];switch(r){case t3:switch(p){case 2:return o.set(c,u);case 3:throw Error("Cannot apply replace patch to set.");default:return o[c]=u}case"add":switch(p){case 1:return"-"===c?o.push(u):o.splice(c,0,u);case 2:return o.set(c,u);case 3:return o.add(u);default:return o[c]=u}case t2:switch(p){case 1:return o.splice(c,1);case 2:return o.delete(c);case 3:return o.delete(t.value);default:return delete o[c]}default:throw Error("Unsupported patch operation: ".concat(r,"."))}})};if(ni(e)){if(void 0!==n)throw Error("Cannot apply patches with options to a draft.");return l(e),e}return nx(e,l,Object.assign(Object.assign({},n),{enablePatches:!1}))}Object.prototype.constructor.toString(),e.s(["apply",()=>nB,"create",()=>nx,"isDraftable",()=>ns],281128);var nF=eu.Type.Object({id:eu.Type.String(),title:eu.Type.String(),sessionType:tc,sessionCreationEventId:eu.Type.String(),archived:eu.Type.Boolean(),readOnly:eu.Type.Boolean(),taskId:eu.Type.String(),created:eu.Type.Date(),updated:eu.Type.Date()});e.s(["SessionDataSchema",()=>nF],957410),es.ProtocolError,e.s([],660670)},952098,e=>{"use strict";e.i(148382);var t=e.i(297083),n=e.i(878420),r=e.i(64386),i=e.i(530658),o=e.i(817556),a=e.i(389959),s=e.i(830675),l=e.i(131141),p=e.i(161322),u=e.i(17886);e.i(660670);var c=e.i(711566),c=c,d=e.i(792129),d=d,y=e.i(187822),T=e.i(943673),T=T,f=e.i(351677),g=e.i(170039),h=e.i(993796),v=e.i(98816),m=e.i(289074),S=e.i(664152),E=e.i(441329),b=window.location.search.includes("aiChatDebug=1"),R=function(e,t,n){var r;b&&console[null!=n?n:"info"]("[chort] "+e,t),S.logger[null!=n?n:"info"](e,{river:t,riverTarget:"chort",riverVersion:d.version}),(null==t||null==(r=t.tags)?void 0:r.includes("invariant-violation"))&&s.withScope(function(n){n.setTag("chort",!0),n.setExtras(t),s.captureException(Error(e))})};function C(){var e="production";return(0,u.isEnvProduction)()||(e="staging"),(0,g.getChortEndpoint)(e)}function I(){var e="production";return(0,u.isEnvProduction)()||(e="staging"),(0,g.getChatProxyEndpoint)(e)}function O(e){var s=e.replId,u=e.userId,d=e.onRetriesExceeded,g=e.onProtocolError,S=(0,i._)((0,a.useState)(null),2),b=S[0],I=S[1],O=(0,v.default)(d),A=(0,v.default)(g),_=(0,p.useSetAtom)(m.connectionKillActionsAtom),k=(0,h.useFlag)({controlName:"flag-new-connection-manager",type:"boolean",default:!1}),U=(0,E.useIsInMobileWorkspace)();return(0,a.useEffect)(function(){var e={userId:u,logger:R,getEndpoint:function(){return(0,t._)(function(){return(0,o._)(this,function(e){return[2,C()]})})()},getToken:function(){return(0,t._)(function(){return(0,o._)(this,function(e){return[2,(0,f.fetchChortAuthToken)(u,s)]})})()},onProtocolError:function(e){var t;null==(t=A.current)||t.call(A,e)},onRetriesExceeded:function(e){var t;null==(t=O.current)||t.call(O,e)}},i=k?new T.ChortRiverConnection((0,r._)((0,n._)({},e),{noBgReconnectEnabled:U})):new y.ChortRiverConnection(e);return I(i),_((0,l.produce)(function(e){e.chort={label:"Close WebSocket",action:function(){var e=i.transport.sessions.get(c.RIVER_SERVER_ID);(null==e?void 0:e.state)!=="Connected"?console.warn("Cannot close WebSocket: session is not connected"):(console.log("chort: closing WebSocket connection",e.conn.ws),e.conn.ws.close())}}})),function(){I(null),i.drained().then(function(){return i.close()}),_((0,l.produce)(function(e){e.chort=null}))}},[s,u,O,A,k,U,_]),b}e.s(["getCurrentChatProxyEndpoint",()=>I,"getCurrentChortEndpoint",()=>C,"useCreateChortRiverConnection",()=>O],952098)},435106,58828,35438,710961,e=>{"use strict";var t,n=e.i(297083),r=e.i(904851),i=e.i(711300),o=e.i(634203),a=e.i(35877),s=e.i(90659),l=e.i(721281),p=e.i(878420),u=e.i(64386),c=e.i(817556),d=e.i(179104);e.i(242933);var y=e.i(790164),T=e.i(845466),f=e.i(119468),g=e.i(167626),h=new TextEncoder,v=new TextDecoder,m=e.i(726753),S=e.i(770663),E={toBuffer:function(e){return(0,S.encode)(e,{ignoreUndefined:!0})},fromBuffer:function(e){try{var t=(0,m.decode)(e);if((void 0===t?"undefined":(0,f._)(t))!=="object")return null;return t}catch(e){return null}}};e.s(["BinaryCodec",()=>E],58828);var b=e.i(346715),R=e.i(886513),C={debug:-1,info:0,warn:1,error:2},I=function(e){return function(t,n){if(!(null==n?void 0:n.transportMessage))return void e(t,n);var r=n.transportMessage;r.payload,n.transportMessage=(0,R._)(r,["payload"]),e(t,n)}},O=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";(0,r._)(this,e),(0,l._)(this,"minLevel",void 0),(0,l._)(this,"output",void 0),this.minLevel=n,this.output=t}return(0,s._)(e,[{key:"debug",value:function(e,t){C[this.minLevel]<=C.debug&&this.output(e,null!=t?t:{},"debug")}},{key:"info",value:function(e,t){C[this.minLevel]<=C.info&&this.output(e,null!=t?t:{},"info")}},{key:"warn",value:function(e,t){C[this.minLevel]<=C.warn&&this.output(e,null!=t?t:{},"warn")}},{key:"error",value:function(e,t){C[this.minLevel]<=C.error&&this.output(e,null!=t?t:{},"error")}}]),e}(),A=function(e){return{debug:I(e.debug.bind(e)),info:I(e.info.bind(e)),warn:I(e.warn.bind(e)),error:I(e.error.bind(e))}},_=e.i(331762),k=e.i(399119),U=e.i(663355),N=e.i(862470),D=e.i(445789),w=e.i(892280),P=e.i(862927),M=e.i(884348),j={heartbeatIntervalMs:1e3,heartbeatsUntilDead:2,sessionDisconnectGraceMs:5e3,connectionTimeoutMs:2e3,handshakeTimeoutMs:1e3,enableTransparentSessionReconnects:!0,codec:{toBuffer:function(e){return h.encode(JSON.stringify(e,function(e){var t,n=this[e];return(0,g._)(n,Uint8Array)?{$t:(t="",n.forEach(function(e){t+=String.fromCharCode(e)}),btoa(t))}:n}))},fromBuffer:function(e){try{var t=JSON.parse(v.decode(e),function(e,t){return(null==t?void 0:t.$t)?function(e){for(var t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(t.$t):t});if((void 0===t?"undefined":(0,f._)(t))==="object")return t;return null}catch(e){return null}}}},L=(0,p._)({},j,{baseIntervalMs:150,maxJitterMs:200,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:200});(0,p._)({},j);var x=((t=x||{}).NoConnection="NoConnection",t.BackingOff="BackingOff",t.Connecting="Connecting",t.Handshaking="Handshaking",t.Connected="Connected",t.WaitingForHandshake="WaitingForHandshake",t),B="session state has been consumed and is no longer valid",F=function(e){function t(e){var n,i=e.from,o=e.options,a=e.log;return(0,r._)(this,t),n=(0,k._)(this,t),(0,l._)(n,"from",void 0),(0,l._)(n,"options",void 0),(0,l._)(n,"log",void 0),n.from=i,n.options=o,n.log=a,n}return(0,D._)(t,e),(0,s._)(t,[{key:"parseMsg",value:function(e){var t,n=this.options.codec.fromBuffer(e);if(null===n){var r,i=new TextDecoder().decode(_.Buffer.from(e));return null==(r=this.log)||r.error("received malformed msg: ".concat(i),this.loggingMetadata),null}return P.Value.Check(w.OpaqueTransportMessageSchema,n)?n:(null==(t=this.log)||t.error("received invalid msg: ".concat(JSON.stringify(n)),(0,u._)((0,p._)({},this.loggingMetadata),{validationErrors:(0,b._)(P.Value.Errors(w.OpaqueTransportMessageSchema,n))})),null)}}]),t}(function(){function e(){return(0,r._)(this,e),(0,l._)(this,"_isConsumed",void 0),this._isConsumed=!1,new Proxy(this,{get:function(e,t){if("_isConsumed"===t||"id"===t||"state"===t)return Reflect.get(e,t);if("_handleStateExit"===t)return function(){e._isConsumed=!0,e._handleStateExit()};if("_handleClose"===t)return function(){e._isConsumed=!0,e._handleStateExit(),e._handleClose()};if(e._isConsumed)throw Error("".concat(B,": getting ").concat(t.toString()," on consumed state"));return Reflect.get(e,t)},set:function(e,t,n){if(e._isConsumed)throw Error("".concat(B,": setting ").concat(t.toString()," on consumed state"));return Reflect.set(e,t,n)}})}return(0,s._)(e,[{key:"close",value:function(){this._handleClose()}}]),e}()),G=function(e){function t(e){(0,r._)(this,t);var n,i=e.id,o=e.to,a=e.seq,s=e.ack,p=e.sendBuffer,u=e.telemetry,c=e.log;return n=(0,k._)(this,t,[e]),(0,l._)(n,"id",void 0),(0,l._)(n,"telemetry",void 0),(0,l._)(n,"to",void 0),(0,l._)(n,"seq",void 0),(0,l._)(n,"ack",void 0),(0,l._)(n,"sendBuffer",void 0),n.id=i,n.to=o,n.seq=a,n.ack=s,n.sendBuffer=p,n.telemetry=u,n.log=c,n}return(0,D._)(t,e),(0,s._)(t,[{key:"loggingMetadata",get:function(){var e=this.telemetry.span.spanContext(),t={clientId:this.from,connectedTo:this.to,sessionId:this.id};return this.telemetry.span.isRecording()&&(t.telemetry={traceId:e.traceId,spanId:e.spanId}),t}},{key:"constructMsg",value:function(e){var t=(0,u._)((0,p._)({},e),{id:(0,w.generateId)(),to:this.to,from:this.from,seq:this.seq,ack:this.ack});return this.seq++,t}},{key:"nextSeq",value:function(){return this.sendBuffer.length>0?this.sendBuffer[0].seq:this.seq}},{key:"send",value:function(e){var t=this.constructMsg(e);return this.sendBuffer.push(t),t.id}},{key:"_handleStateExit",value:function(){}},{key:"_handleClose",value:function(){this.sendBuffer.length=0,this.telemetry.span.end()}}]),t}(F),q=function(e){function t(e){var n;return(0,r._)(this,t),n=(0,k._)(this,t,[e]),(0,l._)(n,"graceExpiryTime",void 0),(0,l._)(n,"gracePeriodTimeout",void 0),(0,l._)(n,"listeners",void 0),n.listeners=e.listeners,n.graceExpiryTime=e.graceExpiryTime,n.gracePeriodTimeout=setTimeout(function(){n.listeners.onSessionGracePeriodElapsed()},n.graceExpiryTime-Date.now()),n}return(0,D._)(t,e),(0,s._)(t,[{key:"_handleStateExit",value:function(){(0,U._)((0,N._)(t.prototype),"_handleStateExit",this).call(this),this.gracePeriodTimeout&&(clearTimeout(this.gracePeriodTimeout),this.gracePeriodTimeout=void 0)}},{key:"_handleClose",value:function(){(0,U._)((0,N._)(t.prototype),"_handleClose",this).call(this)}}]),t}(G),$=function(e){function t(e){var n;return(0,r._)(this,t),n=(0,k._)(this,t,[e]),(0,l._)(n,"state","Connecting"),(0,l._)(n,"connPromise",void 0),(0,l._)(n,"listeners",void 0),(0,l._)(n,"connectionTimeout",void 0),n.connPromise=e.connPromise,n.listeners=e.listeners,n.connPromise.then(function(e){n._isConsumed||n.listeners.onConnectionEstablished(e)},function(e){n._isConsumed||n.listeners.onConnectionFailed(e)}),n.connectionTimeout=setTimeout(function(){n.listeners.onConnectionTimeout()},n.options.connectionTimeoutMs),n}return(0,D._)(t,e),(0,s._)(t,[{key:"bestEffortClose",value:function(){var e=this.log,t=this.loggingMetadata;this.connPromise.then(function(n){n.close(),null==e||e.info("connection eventually resolved but session has transitioned, closed connection",(0,p._)({},t,n.loggingMetadata))}).catch(function(){})}},{key:"_handleStateExit",value:function(){(0,U._)((0,N._)(t.prototype),"_handleStateExit",this).call(this),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0)}},{key:"_handleClose",value:function(){this.bestEffortClose(),(0,U._)((0,N._)(t.prototype),"_handleClose",this).call(this)}}]),t}(q),V=function(e){function t(){var e;return(0,r._)(this,t),e=(0,k._)(this,t,arguments),(0,l._)(e,"state","NoConnection"),e}return(0,D._)(t,e),(0,s._)(t,[{key:"_handleClose",value:function(){(0,U._)((0,N._)(t.prototype),"_handleClose",this).call(this)}},{key:"_handleStateExit",value:function(){(0,U._)((0,N._)(t.prototype),"_handleStateExit",this).call(this)}}]),t}(q),W=function(e){function t(e){var n;return(0,r._)(this,t),n=(0,k._)(this,t,[e]),(0,l._)(n,"state","WaitingForHandshake"),(0,l._)(n,"conn",void 0),(0,l._)(n,"listeners",void 0),(0,l._)(n,"handshakeTimeout",void 0),(0,l._)(n,"onHandshakeData",function(e){var t=n.parseMsg(e);null===t?n.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE"):n.listeners.onHandshake(t)}),n.conn=e.conn,n.listeners=e.listeners,n.handshakeTimeout=setTimeout(function(){n.listeners.onHandshakeTimeout()},n.options.handshakeTimeoutMs),n.conn.addDataListener(n.onHandshakeData),n.conn.addErrorListener(n.listeners.onConnectionErrored),n.conn.addCloseListener(n.listeners.onConnectionClosed),n}return(0,D._)(t,e),(0,s._)(t,[{key:"loggingMetadata",get:function(){return(0,p._)({clientId:this.from,connId:this.conn.id},this.conn.loggingMetadata)}},{key:"sendHandshake",value:function(e){return this.conn.send(this.options.codec.toBuffer(e))}},{key:"_handleStateExit",value:function(){this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0}},{key:"_handleClose",value:function(){this.conn.close()}}]),t}(F),H=function(e){function t(e){var n;return(0,r._)(this,t),n=(0,k._)(this,t,[e]),(0,l._)(n,"state","Handshaking"),(0,l._)(n,"conn",void 0),(0,l._)(n,"listeners",void 0),(0,l._)(n,"handshakeTimeout",void 0),(0,l._)(n,"onHandshakeData",function(e){var t=n.parseMsg(e);null===t?n.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE"):n.listeners.onHandshake(t)}),n.conn=e.conn,n.listeners=e.listeners,n.handshakeTimeout=setTimeout(function(){n.listeners.onHandshakeTimeout()},n.options.handshakeTimeoutMs),n.conn.addDataListener(n.onHandshakeData),n.conn.addErrorListener(n.listeners.onConnectionErrored),n.conn.addCloseListener(n.listeners.onConnectionClosed),n}return(0,D._)(t,e),(0,s._)(t,[{key:"loggingMetadata",get:function(){return(0,p._)({},(0,U._)((0,N._)(t.prototype),"loggingMetadata",this),this.conn.loggingMetadata)}},{key:"sendHandshake",value:function(e){return this.conn.send(this.options.codec.toBuffer(e))}},{key:"_handleStateExit",value:function(){(0,U._)((0,N._)(t.prototype),"_handleStateExit",this).call(this),this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.handshakeTimeout&&(clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0)}},{key:"_handleClose",value:function(){(0,U._)((0,N._)(t.prototype),"_handleClose",this).call(this),this.conn.close()}}]),t}(q),K=function(e){function t(e){if((0,r._)(this,t),a=(0,k._)(this,t,[e]),(0,l._)(a,"state","Connected"),(0,l._)(a,"conn",void 0),(0,l._)(a,"listeners",void 0),(0,l._)(a,"heartbeatHandle",void 0),(0,l._)(a,"heartbeatMisses",0),(0,l._)(a,"isActivelyHeartbeating",void 0),(0,l._)(a,"onMessageData",function(e){var t=a.parseMsg(e);if(null===t)return void a.listeners.onInvalidMessage("could not parse message");if(t.seq!==a.ack){if(t.seq<a.ack)null==(i=a.log)||i.debug("received duplicate msg (got seq: ".concat(t.seq,", wanted seq: ").concat(a.ack,"), discarding"),(0,u._)((0,p._)({},a.loggingMetadata),{transportMessage:t}));else{var n,r,i,o,s="received out-of-order msg, closing connection (got seq: ".concat(t.seq,", wanted seq: ").concat(a.ack,")");null==(o=a.log)||o.warn(s,(0,u._)((0,p._)({},a.loggingMetadata),{transportMessage:t,tags:["invariant-violation"]})),a.telemetry.span.setStatus({code:M.SpanStatusCode.ERROR,message:s}),a.closeConnection()}return}(null==(n=a.log)||n.debug("received msg",(0,u._)((0,p._)({},a.loggingMetadata),{transportMessage:t})),a.updateBookkeeping(t.ack,t.seq),(0,w.isAck)(t.controlFlags))?(null==(r=a.log)||r.debug("discarding msg (ack bit set)",(0,u._)((0,p._)({},a.loggingMetadata),{transportMessage:t})),a.isActivelyHeartbeating||a.sendHeartbeat()):a.listeners.onMessage(t)}),a.conn=e.conn,a.listeners=e.listeners,a.conn.addDataListener(a.onMessageData),a.conn.addCloseListener(a.listeners.onConnectionClosed),a.conn.addErrorListener(a.listeners.onConnectionErrored),a.sendBuffer.length>0){null==(s=a.log)||s.info("sending ".concat(a.sendBuffer.length," buffered messages, starting at seq ").concat(a.nextSeq()),a.loggingMetadata);var n=!0,i=!1,o=void 0;try{for(var a,s,c,d=a.sendBuffer[Symbol.iterator]();!(n=(c=d.next()).done);n=!0){var y=c.value;a.conn.send(a.options.codec.toBuffer(y))}}catch(e){i=!0,o=e}finally{try{n||null==d.return||d.return()}finally{if(i)throw o}}}return a.isActivelyHeartbeating=!1,a.heartbeatHandle=setInterval(function(){var e,t=a.heartbeatMisses,n=t*a.options.heartbeatIntervalMs;if(t>=a.options.heartbeatsUntilDead){null==(e=a.log)||e.info("closing connection to ".concat(a.to," due to inactivity (missed ").concat(t," heartbeats which is ").concat(n,"ms)"),a.loggingMetadata),a.telemetry.span.addEvent("closing connection due to inactivity"),a.conn.close(),clearInterval(a.heartbeatHandle),a.heartbeatHandle=void 0;return}a.isActivelyHeartbeating&&a.sendHeartbeat(),a.heartbeatMisses++},a.options.heartbeatIntervalMs),a}return(0,D._)(t,e),(0,s._)(t,[{key:"updateBookkeeping",value:function(e,t){this.sendBuffer=this.sendBuffer.filter(function(t){return t.seq>=e}),this.ack=t+1,this.heartbeatMisses=0}},{key:"send",value:function(e){var t=this.constructMsg(e);return this.sendBuffer.push(t),this.conn.send(this.options.codec.toBuffer(t)),t.id}},{key:"loggingMetadata",get:function(){return(0,p._)({},(0,U._)((0,N._)(t.prototype),"loggingMetadata",this),this.conn.loggingMetadata)}},{key:"startActiveHeartbeat",value:function(){this.isActivelyHeartbeating=!0}},{key:"sendHeartbeat",value:function(){var e;null==(e=this.log)||e.debug("sending heartbeat",this.loggingMetadata),this.send({streamId:"heartbeat",controlFlags:1,payload:{type:"ACK"}})}},{key:"closeConnection",value:function(){this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.close()}},{key:"_handleStateExit",value:function(){(0,U._)((0,N._)(t.prototype),"_handleStateExit",this).call(this),this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.heartbeatHandle&&(clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0)}},{key:"_handleClose",value:function(){(0,U._)((0,N._)(t.prototype),"_handleClose",this).call(this),this.conn.close()}}]),t}(G),z=function(e){function t(e){var n;return(0,r._)(this,t),n=(0,k._)(this,t,[e]),(0,l._)(n,"state","BackingOff"),(0,l._)(n,"listeners",void 0),(0,l._)(n,"backoffTimeout",void 0),n.listeners=e.listeners,n.backoffTimeout=setTimeout(function(){n.listeners.onBackoffFinished()},e.backoffMs),n}return(0,D._)(t,e),(0,s._)(t,[{key:"_handleClose",value:function(){(0,U._)((0,N._)(t.prototype),"_handleClose",this).call(this)}},{key:"_handleStateExit",value:function(){(0,U._)((0,N._)(t.prototype),"_handleStateExit",this).call(this),this.backoffTimeout&&(clearTimeout(this.backoffTimeout),this.backoffTimeout=void 0)}}]),t}(q);function Y(e){return{id:e.id,from:e.from,to:e.to,seq:e.seq,ack:e.ack,sendBuffer:e.sendBuffer,telemetry:e.telemetry,options:e.options,log:e.log}}function Q(e){return(0,u._)((0,p._)({},Y(e)),{graceExpiryTime:e.graceExpiryTime})}var X=function(e,t,n,r,i){var o,a="session-".concat((0,w.generateId)()),s=(0,w.createSessionTelemetryInfo)(a,e,t),l=new V({listeners:n,id:a,from:t,to:e,seq:0,ack:0,graceExpiryTime:Date.now()+r.sessionDisconnectGraceMs,sendBuffer:[],telemetry:s,options:r,log:i});return null==(o=l.log)||o.info("session ".concat(l.id," created in NoConnection state"),(0,u._)((0,p._)({},l.loggingMetadata),{tags:["state-transition"]})),l},J={NoConnectionToBackingOff:function(e,t,n){var r,i=Q(e);e._handleStateExit();var o=new z((0,p._)({backoffMs:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from NoConnection to BackingOff"),(0,u._)((0,p._)({},o.loggingMetadata),{tags:["state-transition"]})),o},BackingOffToConnecting:function(e,t,n){var r,i=Q(e);e._handleStateExit();var o=new $((0,p._)({connPromise:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from BackingOff to Connecting"),(0,u._)((0,p._)({},o.loggingMetadata),{tags:["state-transition"]})),o},ConnectingToHandshaking:function(e,t,n){var r,i=Q(e);e._handleStateExit();var o=new H((0,p._)({conn:t,listeners:n},i));return null==(r=o.log)||r.info("session ".concat(o.id," transition from Connecting to Handshaking"),(0,u._)((0,p._)({},o.loggingMetadata),{tags:["state-transition"]})),o},HandshakingToConnected:function(e,t){var n,r=Y(e),i=e.conn;e._handleStateExit();var o=new K((0,p._)({conn:i,listeners:t},r));return null==(n=o.log)||n.info("session ".concat(o.id," transition from Handshaking to Connected"),(0,u._)((0,p._)({},o.loggingMetadata),{tags:["state-transition"]})),o},WaitingForHandshakeToConnected:function(e,t,n,r,i,o){var a,s=e.conn,l=e.from,c=e.options,d=t?Y(t):{id:n,from:l,to:r,seq:0,ack:0,sendBuffer:[],telemetry:(0,w.createSessionTelemetryInfo)(n,r,l,i),options:c,log:e.log};e._handleStateExit(),null==t||t._handleStateExit();var y=new K((0,p._)({conn:s,listeners:o},d));return null==(a=y.log)||a.info("session ".concat(y.id," transition from WaitingForHandshake to Connected"),(0,u._)((0,p._)({},y.loggingMetadata),{tags:["state-transition"]})),y},BackingOffToNoConnection:function(e,t){var n,r=Q(e);e._handleStateExit();var i=new V((0,p._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from BackingOff to NoConnection"),(0,u._)((0,p._)({},i.loggingMetadata),{tags:["state-transition"]})),i},ConnectingToNoConnection:function(e,t){var n,r=Q(e);e.bestEffortClose(),e._handleStateExit();var i=new V((0,p._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from Connecting to NoConnection"),(0,u._)((0,p._)({},i.loggingMetadata),{tags:["state-transition"]})),i},HandshakingToNoConnection:function(e,t){var n,r=Q(e);e.conn.close(),e._handleStateExit();var i=new V((0,p._)({listeners:t},r));return null==(n=i.log)||n.info("session ".concat(i.id," transition from Handshaking to NoConnection"),(0,u._)((0,p._)({},i.loggingMetadata),{tags:["state-transition"]})),i},ConnectedToNoConnection:function(e,t){var n,r=Y(e),i=Date.now()+e.options.sessionDisconnectGraceMs;e.conn.close(),e._handleStateExit();var o=new V((0,p._)({listeners:t,graceExpiryTime:i},r));return null==(n=o.log)||n.info("session ".concat(o.id," transition from Connected to NoConnection"),(0,u._)((0,p._)({},o.loggingMetadata),{tags:["state-transition"]})),o}},Z={entrypoint:X,transition:{NoConnectionToBackingOff:J.NoConnectionToBackingOff,BackingOffToConnecting:J.BackingOffToConnecting,ConnectingToHandshaking:J.ConnectingToHandshaking,HandshakingToConnected:J.HandshakingToConnected,BackingOffToNoConnection:J.BackingOffToNoConnection,ConnectingToNoConnection:J.ConnectingToNoConnection,HandshakingToNoConnection:J.HandshakingToNoConnection,ConnectedToNoConnection:J.ConnectedToNoConnection}};J.WaitingForHandshakeToConnected,J.ConnectedToNoConnection;var ee={RetriesExceeded:"conn_retry_exceeded",HandshakeFailed:"handshake_failed",MessageOrderingViolated:"message_ordering_violated",InvalidMessage:"invalid_message"},et=function(){function e(){(0,r._)(this,e),(0,l._)(this,"eventListeners",{})}return(0,s._)(e,[{key:"removeAllListeners",value:function(){this.eventListeners={}}},{key:"numberOfListeners",value:function(e){var t,n;return null!=(n=null==(t=this.eventListeners[e])?void 0:t.size)?n:0}},{key:"addEventListener",value:function(e,t){var n;this.eventListeners[e]||(this.eventListeners[e]=new Set),null==(n=this.eventListeners[e])||n.add(t)}},{key:"removeEventListener",value:function(e,t){var n;this.eventListeners[e]&&(null==(n=this.eventListeners[e])||n.delete(t))}},{key:"dispatchEvent",value:function(e,t){var n=this.eventListeners[e];if(n){var r=(0,b._)(n),i=!0,o=!1,a=void 0;try{for(var s,l=r[Symbol.iterator]();!(i=(s=l.next()).done);i=!0)(0,s.value)(t)}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}}}}]),e}(),en=function(){function e(t,n){(0,r._)(this,e),(0,l._)(this,"status",void 0),(0,l._)(this,"clientId",void 0),(0,l._)(this,"eventDispatcher",void 0),(0,l._)(this,"options",void 0),(0,l._)(this,"log",void 0),(0,l._)(this,"sessions",void 0),this.options=(0,p._)({},j,n),this.eventDispatcher=new et,this.clientId=t,this.status="open",this.sessions=new Map}return(0,s._)(e,[{key:"bindLogger",value:function(e,t){if("function"==typeof e){this.log=A(new O(e,t));return}this.log=A(e)}},{key:"handleMsg",value:function(e){"open"===this.getStatus()&&this.eventDispatcher.dispatchEvent("message",e)}},{key:"addEventListener",value:function(e,t){this.eventDispatcher.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.eventDispatcher.removeEventListener(e,t)}},{key:"protocolError",value:function(e){this.eventDispatcher.dispatchEvent("protocolError",e)}},{key:"close",value:function(){this.status="closed";var e=!0,t=!1,n=void 0;try{for(var r,i,o=this.sessions.values()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this.deleteSession(a)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.eventDispatcher.dispatchEvent("transportStatus",{status:this.status}),this.eventDispatcher.removeAllListeners(),null==(r=this.log)||r.info("manually closed transport",{clientId:this.clientId})}},{key:"getStatus",value:function(){return this.status}},{key:"updateSession",value:function(e){var t=this.sessions.get(e.to);if(t&&t.id!==e.id)throw Error("attempt to transition active session for ".concat(e.to," but active session (").concat(t.id,") is different from handle (").concat(e.id,")"));return this.sessions.set(e.to,e),t||this.eventDispatcher.dispatchEvent("sessionStatus",{status:"connect",session:e}),this.eventDispatcher.dispatchEvent("sessionTransition",{state:e.state,session:e}),e}},{key:"deleteSession",value:function(e,t){if(!e._isConsumed){var n,r=e.loggingMetadata;r.tags&&(null==t?void 0:t.unhealthy)&&r.tags.push("unhealthy-session"),null==(n=e.log)||n.info("closing session ".concat(e.id),r),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"disconnect",session:e});var i=e.to;e.close(),this.sessions.delete(i)}}},{key:"onSessionGracePeriodElapsed",value:function(e){var t;null==(t=this.log)||t.warn("session to ".concat(e.to," grace period elapsed, closing"),e.loggingMetadata),this.deleteSession(e)}},{key:"onConnectingFailed",value:function(e){var t=this,n=J.ConnectingToNoConnection(e,{onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(n)}});return this.updateSession(n)}},{key:"onConnClosed",value:function(e){var t,n=this;return t="Handshaking"===e.state?J.HandshakingToNoConnection(e,{onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(t)}}):J.ConnectedToNoConnection(e,{onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(t)}}),this.updateSession(t)}}]),e}(),er=function(){function e(){(0,r._)(this,e),(0,l._)(this,"id",void 0),(0,l._)(this,"telemetry",void 0),(0,l._)(this,"_dataListeners",new Set),(0,l._)(this,"_closeListeners",new Set),(0,l._)(this,"_errorListeners",new Set),this.id="conn-".concat((0,w.generateId)())}return(0,s._)(e,[{key:"loggingMetadata",get:function(){var e,t,n={connId:this.id},r=null==(e=this.telemetry)?void 0:e.span.spanContext();return(null==(t=this.telemetry)?void 0:t.span.isRecording())&&r&&(n.telemetry={traceId:r.traceId,spanId:r.spanId}),n}},{key:"dataListeners",get:function(){return(0,b._)(this._dataListeners)}},{key:"closeListeners",get:function(){return(0,b._)(this._closeListeners)}},{key:"errorListeners",get:function(){return(0,b._)(this._errorListeners)}},{key:"addDataListener",value:function(e){this._dataListeners.add(e)}},{key:"removeDataListener",value:function(e){this._dataListeners.delete(e)}},{key:"addCloseListener",value:function(e){this._closeListeners.add(e)}},{key:"removeCloseListener",value:function(e){this._closeListeners.delete(e)}},{key:"addErrorListener",value:function(e){this._errorListeners.add(e)}},{key:"removeErrorListener",value:function(e){this._errorListeners.delete(e)}}]),e}();e.s(["Connection",()=>er,"ProtocolError",()=>ee,"Transport",()=>en],35438);var ei=function(){function e(t){(0,r._)(this,e),(0,l._)(this,"budgetConsumed",void 0),(0,l._)(this,"intervalHandle",void 0),(0,l._)(this,"options",void 0),this.options=t,this.budgetConsumed=0}return(0,s._)(e,[{key:"getBackoffMs",value:function(){if(0===this.getBudgetConsumed())return 0;var e=Math.max(0,this.getBudgetConsumed()-1),t=Math.floor(Math.random()*this.options.maxJitterMs);return Math.min(this.options.baseIntervalMs*Math.pow(2,e),this.options.maxBackoffMs)+t}},{key:"totalBudgetRestoreTime",get:function(){return this.options.budgetRestoreIntervalMs*this.options.attemptBudgetCapacity}},{key:"consumeBudget",value:function(){this.stopLeak(),this.budgetConsumed=this.getBudgetConsumed()+1}},{key:"getBudgetConsumed",value:function(){return this.budgetConsumed}},{key:"hasBudget",value:function(){return this.getBudgetConsumed()<this.options.attemptBudgetCapacity}},{key:"startRestoringBudget",value:function(){var e=this;this.intervalHandle||(this.intervalHandle=setInterval(function(){var t=e.budgetConsumed;if(!t)return void e.stopLeak();var n=t-1;0!==n&&(e.budgetConsumed=n)},this.options.budgetRestoreIntervalMs))}},{key:"stopLeak",value:function(){this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=void 0)}},{key:"close",value:function(){this.stopLeak()}}]),e}(),eo=function(e){function t(e,n){var i;return(0,r._)(this,t),i=(0,k._)(this,t,[e,n]),(0,l._)(i,"options",void 0),(0,l._)(i,"retryBudget",void 0),(0,l._)(i,"reconnectOnConnectionDrop",!0),(0,l._)(i,"handshakeExtensions",void 0),(0,l._)(i,"sessions",void 0),i.sessions=new Map,i.options=(0,p._)({},L,n),i.retryBudget=new ei(i.options),i}return(0,D._)(t,e),(0,s._)(t,[{key:"extendHandshake",value:function(e){this.handshakeExtensions=e}},{key:"tryReconnecting",value:function(e){var t=this.sessions.get(e);!this.options.enableTransparentSessionReconnects&&t&&this.deleteSession(t),this.reconnectOnConnectionDrop&&"open"===this.getStatus()&&this.connect(e)}},{key:"send",value:function(e,t){if("closed"===this.getStatus()){var n,r="transport is closed, cant send";throw null==(n=this.log)||n.error(r,{clientId:this.clientId,transportMessage:t,tags:["invariant-violation"]}),Error(r)}var i=this.sessions.get(e);return i||(i=this.createUnconnectedSession(e)),i.send(t)}},{key:"createUnconnectedSession",value:function(e){var t=this,n=Z.entrypoint(e,this.clientId,{onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(n)}},this.options,this.log);return this.updateSession(n),n}},{key:"onConnectingFailed",value:function(e){var n=(0,U._)((0,N._)(t.prototype),"onConnectingFailed",this).call(this,e);return this.tryReconnecting(n.to),n}},{key:"onConnClosed",value:function(e){var n=(0,U._)((0,N._)(t.prototype),"onConnClosed",this).call(this,e);return this.tryReconnecting(n.to),n}},{key:"onConnectionEstablished",value:function(e,t){var n=this,r=Z.transition.ConnectingToHandshaking(e,t,{onConnectionErrored:function(e){var t,i=(0,w.coerceErrorString)(e);null==(t=n.log)||t.error("connection to ".concat(r.to," errored during handshake: ").concat(i),r.loggingMetadata)},onConnectionClosed:function(){var e;null==(e=n.log)||e.warn("connection to ".concat(r.to," closed during handshake"),r.loggingMetadata),n.onConnClosed(r)},onHandshake:function(e){n.onHandshakeResponse(r,e)},onInvalidHandshake:function(t,i){var o;null==(o=n.log)||o.error("invalid handshake: ".concat(t),r.loggingMetadata),n.deleteSession(e,{unhealthy:!0}),n.protocolError({type:ee.HandshakeFailed,code:i,message:t})},onHandshakeTimeout:function(){var e;null==(e=n.log)||e.error("connection to ".concat(r.to," timed out during handshake"),r.loggingMetadata),n.onConnClosed(r)},onSessionGracePeriodElapsed:function(){n.onSessionGracePeriodElapsed(r)}});return this.updateSession(r),this.sendHandshake(r),r}},{key:"rejectHandshakeResponse",value:function(e,t,n){var r,i;null==(r=e.conn.telemetry)||r.span.setStatus({code:M.SpanStatusCode.ERROR,message:t}),null==(i=this.log)||i.warn(t,n),this.deleteSession(e,{unhealthy:!0})}},{key:"onHandshakeResponse",value:function(e,t){var n,r=this;if(!P.Value.Check(w.ControlMessageHandshakeResponseSchema,t.payload))return void this.rejectHandshakeResponse(e,"received invalid handshake response",(0,u._)((0,p._)({},e.loggingMetadata),{transportMessage:t,validationErrors:(0,b._)(P.Value.Errors(w.ControlMessageHandshakeResponseSchema,t.payload))}));if(!t.payload.status.ok){var i=P.Value.Check(w.HandshakeErrorRetriableResponseCodes,t.payload.status.code),o="handshake failed: ".concat(t.payload.status.reason),a=e.to;this.rejectHandshakeResponse(e,o,(0,u._)((0,p._)({},e.loggingMetadata),{transportMessage:t})),i?this.tryReconnecting(a):this.protocolError({type:ee.HandshakeFailed,code:t.payload.status.code,message:o});return}if(t.payload.status.sessionId!==e.id){var s="session id mismatch: expected ".concat(e.id,", got ").concat(t.payload.status.sessionId);this.rejectHandshakeResponse(e,s,(0,u._)((0,p._)({},e.loggingMetadata),{transportMessage:t}));return}null==(n=this.log)||n.info("handshake from ".concat(t.from," ok"),(0,u._)((0,p._)({},e.loggingMetadata),{transportMessage:t}));var l=Z.transition.HandshakingToConnected(e,{onConnectionErrored:function(e){var t,n=(0,w.coerceErrorString)(e);null==(t=r.log)||t.warn("connection to ".concat(l.to," errored: ").concat(n),l.loggingMetadata)},onConnectionClosed:function(){var e;null==(e=r.log)||e.info("connection to ".concat(l.to," closed"),l.loggingMetadata),r.onConnClosed(l)},onMessage:function(e){return r.handleMsg(e)},onInvalidMessage:function(e){r.deleteSession(l,{unhealthy:!0}),r.protocolError({type:ee.InvalidMessage,message:e})}});this.updateSession(l),this.retryBudget.startRestoringBudget()}},{key:"connect",value:function(e){var t=this;if("open"!==this.getStatus()){null==(i=this.log)||i.info("transport state is no longer open, cancelling attempt to connect to ".concat(e));return}var n=this.sessions.get(e);if(null!=n||(n=this.createUnconnectedSession(e)),"NoConnection"!==n.state){null==(o=this.log)||o.debug("session to ".concat(e," has state ").concat(n.state,", skipping connect attempt"),n.loggingMetadata);return}if(!this.retryBudget.hasBudget()){var r,i,o,a,s=this.retryBudget.getBudgetConsumed(),l="tried to connect to ".concat(e," but retry budget exceeded (more than ").concat(s," attempts in the last ").concat(this.retryBudget.totalBudgetRestoreTime,"ms)");null==(a=this.log)||a.error(l,n.loggingMetadata),this.protocolError({type:ee.RetriesExceeded,message:l});return}var p=this.retryBudget.getBackoffMs();null==(r=this.log)||r.info("attempting connection to ".concat(e," (").concat(p,"ms backoff)"),n.loggingMetadata),this.retryBudget.consumeBudget();var u=Z.transition.NoConnectionToBackingOff(n,p,{onBackoffFinished:function(){t.onBackoffFinished(u)},onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(u)}});this.updateSession(u)}},{key:"onBackoffFinished",value:function(e){var t=this,r=w.tracing_default.startActiveSpan("connect",function(r){return(0,n._)(function(){var t,n;return(0,c._)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,3,4]),[4,this.createNewOutgoingConnection(e.to)];case 1:return[2,i.sent()];case 2:throw t=i.sent(),n=(0,w.coerceErrorString)(t),r.recordException(n),r.setStatus({code:M.SpanStatusCode.ERROR}),t;case 3:return r.end(),[7];case 4:return[2]}})}).call(t)}),i=Z.transition.BackingOffToConnecting(e,r,{onConnectionEstablished:function(e){var n;null==(n=t.log)||n.debug("connection to ".concat(i.to," established"),(0,p._)({},e.loggingMetadata,i.loggingMetadata)),t.onConnectionEstablished(i,e)},onConnectionFailed:function(e){var n,r=(0,w.coerceErrorString)(e);null==(n=t.log)||n.error("error connecting to ".concat(i.to,": ").concat(r),i.loggingMetadata),t.onConnectingFailed(i)},onConnectionTimeout:function(){var e;null==(e=t.log)||e.error("connection to ".concat(i.to," timed out"),i.loggingMetadata),t.onConnectingFailed(i)},onSessionGracePeriodElapsed:function(){t.onSessionGracePeriodElapsed(i)}});this.updateSession(i)}},{key:"sendHandshake",value:function(e){return(0,n._)(function(){var t,n,r;return(0,c._)(this,function(i){switch(i.label){case 0:if(n=void 0,!this.handshakeExtensions)return[3,2];return[4,this.handshakeExtensions.construct()];case 1:n=i.sent(),i.label=2;case 2:if(e._isConsumed)return[2];return r=(0,w.handshakeRequestMessage)({from:this.clientId,to:e.to,sessionId:e.id,expectedSessionState:{nextExpectedSeq:e.ack,nextSentSeq:e.nextSeq()},metadata:n,tracing:(0,w.getPropagationContext)(e.telemetry.ctx)}),null==(t=this.log)||t.debug("sending handshake request to ".concat(e.to),(0,u._)((0,p._)({},e.loggingMetadata),{transportMessage:r})),e.sendHandshake(r),[2]}})}).call(this)}},{key:"close",value:function(){this.retryBudget.close(),(0,U._)((0,N._)(t.prototype),"close",this).call(this)}}]),t}(en),ea=function(e){function t(e,n){(0,r._)(this,t),i=(0,k._)(this,t),(0,l._)(i,"ws",void 0),(0,l._)(i,"extras",void 0),i.ws=e,i.extras=n,i.ws.binaryType="arraybuffer";var i,o=!1;return i.ws.onerror=function(){o=!0},i.ws.onclose=function(e){var t=e.code,n=e.reason;if(o){var r=Error("websocket closed with code and reason: ".concat(t," - ").concat(n)),a=!0,s=!1,l=void 0;try{for(var p,u=i.errorListeners[Symbol.iterator]();!(a=(p=u.next()).done);a=!0)(0,p.value)(r)}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}}var c=!0,d=!1,y=void 0;try{for(var T,f=i.closeListeners[Symbol.iterator]();!(c=(T=f.next()).done);c=!0)(0,T.value)()}catch(e){d=!0,y=e}finally{try{c||null==f.return||f.return()}finally{if(d)throw y}}},i.ws.onmessage=function(e){var t=!0,n=!1,r=void 0;try{for(var o,a=i.dataListeners[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)(0,o.value)(e.data)}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}},i}return(0,D._)(t,e),(0,s._)(t,[{key:"loggingMetadata",get:function(){var e=(0,U._)((0,N._)(t.prototype),"loggingMetadata",this);return this.extras&&(e.extras=this.extras),e}},{key:"send",value:function(e){return this.ws.readyState===this.ws.OPEN&&(this.ws.send(e),!0)}},{key:"close",value:function(){this.ws.close(1e3)}}]),t}(er),es=function(e){function t(e,n,i){var o;return(0,r._)(this,t),o=(0,k._)(this,t,[n,i]),(0,l._)(o,"wsGetter",void 0),o.wsGetter=e,o}return(0,D._)(t,e),(0,s._)(t,[{key:"createNewOutgoingConnection",value:function(e){return(0,n._)(function(){var t,n,r,i;return(0,c._)(this,function(o){switch(o.label){case 0:return null==(t=this.log)||t.info("establishing a new websocket to ".concat(e),{clientId:this.clientId,connectedTo:e}),[4,this.wsGetter(e)];case 1:return r=o.sent(),[4,new Promise(function(e,t){r.readyState===r.OPEN?e():r.readyState===r.CLOSING||r.readyState===r.CLOSED?t(Error("ws is closing or closed")):(r.onopen=function(){e()},r.onclose=function(e){t(Error(e.reason))},r.onerror=function(e){t(Error(e.message))})})];case 2:return o.sent(),i=new ea(r),null==(n=this.log)||n.info("raw websocket to ".concat(e," ok"),(0,p._)({clientId:this.clientId,connectedTo:e},i.loggingMetadata)),[2,i]}})}).call(this)}}]),t}(eo);function el(e){throw Error("Unhandled discriminated union member: ".concat(JSON.stringify(e)))}e.s(["WebSocketClientTransport",()=>es],710961);var ep=(0,u._)((0,p._)({},{codec:E,heartbeatIntervalMs:2500,heartbeatsUntilDead:40,enableTransparentSessionReconnects:!1,connectionTimeoutMs:1e4,handshakeTimeoutMs:15e3,sessionDisconnectGraceMs:15e3}),{baseIntervalMs:250,maxJitterMs:500,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:2e3}),eu=new WeakMap,ec=new WeakMap,ed=function(){function e(t){var s=this,d=t.clientId,f=t.serverId,g=t.connectImmediately,h=t.logger,v=t.getEndpoint,m=t.overrideWebsocket,S=t.onProtocolError,E=t.onRetriesExceeded,b=t.noBgReconnectEnabled;(0,r._)(this,e),(0,l._)(this,"clientId",void 0),(0,l._)(this,"serverId",void 0),(0,l._)(this,"log",void 0),(0,l._)(this,"transport",void 0),(0,o._)(this,eu,{writable:!0,value:void 0}),(0,o._)(this,ec,{writable:!0,value:void 0}),(0,l._)(this,"session",void 0),(0,l._)(this,"dispose",null),this.clientId=d,this.serverId=f,this.log=null!=h?h:null;var R={};this.transport=new es(function(){return(0,n._)(function(){var e,t,n,r,i,o;return(0,c._)(this,function(a){switch(a.label){case 0:if(n=Date.now(),!m)return[3,2];return[4,v()];case 1:return i=m.apply(void 0,[a.sent().toString()]),[3,4];case 2:return o=WebSocket.bind,[4,v()];case 3:i=new(o.apply(WebSocket,[void 0,a.sent().toString()])),a.label=4;case 4:return r=i,null==(e=(t=this).log)||e.call(t,"ai-chat: ws open",{extras:{duration:Date.now()-n}}),[2,r]}})}).call(s)},this.clientId,ep),h&&this.transport.bindLogger(h,"info"),this.session=new y.ObservableState(null),(0,a._)(this,eu,new y.ObservableState("disconnected")),(0,a._)(this,ec,(0,T.createClient)(this.transport,f,{eagerlyConnect:!1,connectOnInvoke:!1}));var C=!1;this.transport.addEventListener("sessionTransition",function(e){var t,n,r,o,a;"NoConnection"!==e.state&&(C=!0),"BackingOff"===e.state||("Connecting"===e.state?(R.connectionStart=Date.now(),null==(t=s.log)||t.call(s,"ai-chat: connecting",{clientId:s.clientId})):"Handshaking"===e.state?(R.handshakeStart=Date.now(),null==(n=s.log)||n.call(s,"ai-chat: handshaking",{clientId:s.clientId})):"Connected"===e.state?(R.connectionStart&&R.handshakeStart&&(null==(r=s.log)||r.call(s,"ai-chat: connected",{clientId:s.clientId,extras:(0,u._)((0,p._)({},R),{connectionDuration:R.handshakeStart-R.connectionStart,handshakeDuration:Date.now()-R.handshakeStart,totalDuration:Date.now()-R.connectionStart})})),R.connectionStart=void 0,R.handshakeStart=void 0):"NoConnection"===e.state?(null==(o=s.log)||o.call(s,"ai-chat: no connection",{clientId:s.clientId}),R.connectionStart=void 0,R.handshakeStart=void 0):el(e)),s.is("closed","error")||("Connected"===e.state?(s.session.set(null!=(a=s.transport.sessions.values().next().value)?a:null),(0,i._)(s,eu).set("connected")):(s.session.set(null),s.transport.reconnectOnConnectionDrop?(0,i._)(s,eu).set("connecting"):(0,i._)(s,eu).set("disconnected")))}),this.transport.addEventListener("sessionStatus",function(e){var t,n,r;"connect"===e.status?(C=!1,R.sessionStart=Date.now(),null==(t=s.log)||t.call(s,"ai-chat: session started",{sessionId:e.session.id,clientId:s.clientId})):"disconnect"===e.status?(C||"closed"===s.transport.getStatus()||null==(n=s.log)||n.call(s,"detected zombie session",{clientId:s.clientId,sessionId:e.session.id},"error"),R.sessionStart&&(null==(r=s.log)||r.call(s,"ai-chat: session ended",{sessionId:e.session.id,clientId:s.clientId,extras:{sessionDuration:Date.now()-R.sessionStart}}))):el(e.status),s.is("closed","error")||"disconnect"===e.status&&(s.session.set(null),s.transport.reconnectOnConnectionDrop?s.status.set("connecting"):s.status.set("disconnected"))}),this.transport.addEventListener("protocolError",function(e){var t,n;e.type===ee.HandshakeFailed&&(null==(t=s.log)||t.call(s,"river handshake failed",{clientId:d},"error")),e.type===ee.RetriesExceeded?(null==(n=s.log)||n.call(s,"ai-chat: retry budget exhausted",{clientId:d},"error"),s.close(),null==E||E(e)):(s.error(),null==S||S(e))});var I=window.navigator.onLine,O=function(){return!s.is("closed","error")&&(!b||"visible"===document.visibilityState)&&I},A=function(){var e=s.transport.reconnectOnConnectionDrop,t=O();s.transport.reconnectOnConnectionDrop=t,e&&!t&&!s.session.current&&s.is("connecting")&&(0,i._)(s,eu).set("disconnected"),t&&s.is("disconnected")&&s.connect()},_=function(){A()},k=function(){I=!0,A()},U=function(){I=!1,A()};this.transport.reconnectOnConnectionDrop=O(),document.addEventListener("visibilitychange",_),window.addEventListener("online",k),window.addEventListener("offline",U),this.dispose=function(){document.removeEventListener("visibilitychange",_),window.removeEventListener("online",k),window.removeEventListener("offline",U)},O()&&!1!==g&&this.connect(),I||this.testConnection().then(function(e){e&&!I&&(null==h||h("got false negative navigator.onLine",{clientId:d},"warn"),k())}),!0===g&&this.connect()}return(0,s._)(e,[{key:"testConnection",value:function(){return(0,n._)(function(){return(0,c._)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,fetch("/",{method:"OPTIONS"})];case 1:return e.sent(),[2,!0];case 2:return e.sent(),[2,!1];case 3:return[2]}})})()}},{key:"status",get:function(){return(0,i._)(this,eu)}},{key:"service",get:function(){return(0,i._)(this,ec).chatService}},{key:"is",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.includes((0,i._)(this,eu).current)}},{key:"connect",value:function(){if(this.is("closed","error"))throw Error("Cannot connect to a ".concat((0,i._)(this,eu).current," ChatConnection"));this.is("connected","connecting")||((0,i._)(this,eu).set("connecting"),this.transport.connect(this.serverId))}},{key:"error",value:function(){if(!this.is("closed","error")){var e;(0,i._)(this,eu).set("error"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}},{key:"drained",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return(0,n._)(function(){var t,n,r,i,o,a,s;return(0,c._)(this,function(l){switch(l.label){case 0:t=setTimeout(function(){t=null},e),l.label=1;case 1:if(null===t||0===this.transport.sessions.size)return[3,4];n=!1,r=!0,i=!1,o=void 0;try{for(a=this.transport.sessions.values()[Symbol.iterator]();!(r=(s=a.next()).done);r=!0)if(s.value.sendBuffer.some(function(e){return(1&e.controlFlags)!=1})){n=!0;break}}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}if(!n)return[3,3];return[4,new Promise(function(e){return setTimeout(e,100)})];case 2:return l.sent(),[3,1];case 3:return[3,4];case 4:return clearTimeout(t),[2,null!==t]}})}).call(this)}},{key:"close",value:function(){if(!this.is("closed","error")){var e;(0,i._)(this,eu).set("closed"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}}]),e}();function ey(e){var t=e.currentUserId;return"chat-client-".concat(t,"-").concat((0,d.nanoid)())}e.s(["ChatConnection",()=>ed,"createClientId",()=>ey],435106)},600637,416143,63846,924908,885505,e=>{"use strict";var t=e.i(297083),n=e.i(530658),r=e.i(817556),i=e.i(389959),o=e.i(830675),a=e.i(131141),s=e.i(161322),l=e.i(435106),p=e.i(904851),u=e.i(711300),c=e.i(634203),d=e.i(35877),y=e.i(90659),T=e.i(721281),f=e.i(878420),g=e.i(64386);e.i(242933);var h=e.i(790164),v=e.i(845466),m=e.i(386962),S=e.i(58828),E=e.i(35438),b=e.i(710961),R={codec:S.BinaryCodec,heartbeatIntervalMs:2500,heartbeatsUntilDead:40,enableTransparentSessionReconnects:!1,connectionTimeoutMs:1e4,handshakeTimeoutMs:15e3,sessionDisconnectGraceMs:15e3},C=(0,g._)((0,f._)({},R),{baseIntervalMs:250,maxJitterMs:500,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:2e3}),I=new WeakMap,O=new WeakMap,A=function(){function e(n){var i=this,o=n.clientId,a=n.serverId,s=n.logger,l=n.getEndpoint,y=n.overrideWebsocket,f=n.onProtocolError,g=n.onRetriesExceeded,S=n.noBgReconnectEnabled;(0,p._)(this,e),(0,T._)(this,"clientId",void 0),(0,T._)(this,"serverId",void 0),(0,T._)(this,"log",void 0),(0,T._)(this,"transport",void 0),(0,c._)(this,I,{writable:!0,value:void 0}),(0,c._)(this,O,{writable:!0,value:void 0}),(0,T._)(this,"dispose",null),(0,T._)(this,"connect",void 0),this.clientId=o,this.serverId=a,this.log=null!=s?s:null,this.transport=new b.WebSocketClientTransport(function(){return(0,t._)(function(){var e,t,n,i,o,a;return(0,r._)(this,function(r){switch(r.label){case 0:if(n=Date.now(),!y)return[3,2];return[4,l()];case 1:return o=y.apply(void 0,[r.sent().toString()]),[3,4];case 2:return a=WebSocket.bind,[4,l()];case 3:o=new(a.apply(WebSocket,[void 0,r.sent().toString()])),r.label=4;case 4:return i=o,null==(e=(t=this).log)||e.call(t,"ai-chat: ws open",{extras:{duration:Date.now()-n}}),[2,i]}})}).call(i)},this.clientId,C),s&&this.transport.bindLogger(s,"info"),(0,d._)(this,I,new h.ObservableState("disconnected")),(0,d._)(this,O,(0,v.createClient)(this.transport,a,{eagerlyConnect:!1,connectOnInvoke:!1})),this.transport.addEventListener("sessionTransition",function(e){if(!i.is("closed","error"))switch(e.state){case"Connected":(0,u._)(i,I).set("connected");break;case"NoConnection":(0,u._)(i,I).set("disconnected");break;case"BackingOff":case"Connecting":case"Handshaking":(0,u._)(i,I).set("connecting")}});var R=(0,m.setupRiverTransport)({logContext:{target:"ai-chat"},transport:this.transport,serverId:this.serverId,onRetryBudgetExhausted:function(){i.close(),null==g||g({type:E.ProtocolError.RetriesExceeded,message:"Retry budget exhausted"})},onProtocolError:function(e){i.error(),null==f||f(e)},noBgReconnectEnabled:S,log:s});this.dispose=R.dispose,this.connect=R.connect}return(0,y._)(e,[{key:"status",get:function(){return(0,u._)(this,I)}},{key:"service",get:function(){return(0,u._)(this,O).chatService}},{key:"is",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.includes((0,u._)(this,I).current)}},{key:"error",value:function(){if(!this.is("closed","error")){var e;(0,u._)(this,I).set("error"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}},{key:"drained",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return(0,t._)(function(){var t,n,i,o,a,s,l;return(0,r._)(this,function(r){switch(r.label){case 0:t=setTimeout(function(){t=null},e),r.label=1;case 1:if(null===t||0===this.transport.sessions.size)return[3,4];n=!1,i=!0,o=!1,a=void 0;try{for(s=this.transport.sessions.values()[Symbol.iterator]();!(i=(l=s.next()).done);i=!0)if(l.value.sendBuffer.some(function(e){return(1&e.controlFlags)!=1})){n=!0;break}}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}if(!n)return[3,3];return[4,new Promise(function(e){return setTimeout(e,100)})];case 2:return r.sent(),[3,1];case 3:return[3,4];case 4:return clearTimeout(t),[2,null!==t]}})}).call(this)}},{key:"close",value:function(){if(!this.is("closed","error")){var e;(0,u._)(this,I).set("closed"),this.transport.close(),null==(e=this.dispose)||e.call(this),this.dispose=null}}}]),e}(),_=e.i(892280),_=_,k=e.i(267710),U=e.i(952098),N=e.i(148382),D=e.i(17886),w={production:"wss://production-ai-chat.replit.com/river",staging:"wss://staging-ai-chat.replit.com/river",development:"ws://127.0.0.1:8000/river"};e.s(["AiEndpoints",()=>w],416143);var P=e.i(282453),M="ghostwriter-chat-env",j=N.default.env.CHAT_SERVICE_OVERRIDE,L=P.default.get(M,"string"),x=function(){return j||L||((0,D.isEnvProduction)()?w.production:w.staging)};function B(e){P.default.set(M,e)}e.s(["endpointOverride",()=>j,"getAiEndpoint",()=>x,"setAiEndpoint",()=>B],63846),e.i(660670);var F=e.i(170039),G=e.i(993796),q=e.i(98816),$=e.i(289074),V=e.i(664152),W=e.i(441329),H="SERVER",K=window.location.search.includes("aiChatDebug=1");function z(e){var p=e.endpoint,u=e.replId,c=e.currentUserId,d=e.orgId,y=e.onRetriesExceeded,T=e.onProtocolError,f=(0,n._)((0,i.useState)(null),2),g=f[0],h=f[1],v=(0,q.default)(y),m=(0,q.default)(T),S=(0,G.useFlag)({controlName:"flag-new-connection-manager",type:"boolean",default:!1}),E=(0,G.useFlag)({controlName:"flag-use-chort-chat-proxy",type:"boolean",default:!1}),b=null!==(0,F.getUseChatProxyOverride)()?(0,F.getUseChatProxyOverride)():E,R=(0,W.useIsInMobileWorkspace)(),C=(0,s.useSetAtom)($.connectionKillActionsAtom);return(0,i.useEffect)(function(){b&&console.warn("[ai-chat] Creating connection with chat proxy enabled");var e=(0,l.createClientId)({currentUserId:c}),n={clientId:e,serverId:H,logger:function(e,t,n){var r;K&&console[null!=n?n:"info"]("[ai-chat]"+e,t),V.logger[null!=n?n:"info"](e,{river:t,riverTarget:"ai-chat",riverVersion:_.version,riverProxied:b}),(null==t||null==(r=t.tags)?void 0:r.includes("invariant-violation"))&&o.withScope(function(n){n.setTag("ai-chat",!0),n.setTag("ai-chat-proxy",b),n.setExtras(t),o.captureException(Error(e))})},getEndpoint:function(){return(0,t._)(function(){var t,n,i,o;return(0,r._)(this,function(r){switch(r.label){case 0:if(p)return[2,p];if(!b)return[3,2];return[4,(0,k.auth)(u,e,d)];case 1:return t=r.sent(),(n=new URL((0,U.getCurrentChatProxyEndpoint)())).searchParams.set("auth_token",t),[2,n];case 2:return[4,(0,k.auth)(u,e,d)];case 3:return i=r.sent(),(o=new URL(x())).searchParams.set("auth_token",i),[2,o]}})})()},onProtocolError:function(e){var t;null==(t=m.current)||t.call(m,e)},onRetriesExceeded:function(e){var t;null==(t=v.current)||t.call(v,e)},noBgReconnectEnabled:R},i=S?new A(n):new l.ChatConnection(n);return h(i),C((0,a.produce)(function(e){e["ai-chat"]={label:"Close WebSocket",action:function(){var e=i.transport.sessions.get(H);(null==e?void 0:e.state)!=="Connected"?console.warn("Cannot close WebSocket: session is not connected"):(console.log("ai-chat: closing WebSocket connection",e.conn.ws),e.conn.ws.close())}}})),function(){h(null),i.drained().then(function(){return i.close()}),C((0,a.produce)(function(e){e["ai-chat"]=null}))}},[p,u,c,d,v,m,b,S,R,C]),g}e.s(["AI_CHAT_SERVER_ID",()=>H,"useCreateChatConnection",()=>z],600637);var Y=e.i(276385),Q=e.i(719518);e.i(824359);var X=(0,i.createContext)(null);function J(e){var t=(0,i.useMemo)(function(){return{store:e.store,yapper:e.yapper}},[e.store,e.yapper]);return(0,Y.jsx)(X.Provider,{value:t,children:e.children})}function Z(){var e=(0,i.useContext)(X);if(!e)throw Error("Expected Yapper in context");return e.yapper}function ee(){var e=(0,i.useContext)(X);if(!e)throw Error("Expected Yapper in context");return e.yapper.chatter()}function et(e,t){var n=Z(),r=(0,i.useRef)(t);r.current=t,(0,i.useEffect)(function(){return n.hook(e,function(e){return r.current(e)})},[n,e])}function en(){var e=(0,i.useContext)(X);if(!e)throw Error("Expected store in context");return e.store}function er(e){return(0,s.useAtomValue)(e,{store:en()})}var ei=function(e){return(0,s.useSetAtom)(e,{store:en()})};function eo(e){return(0,Q.useAtomCallback)((0,i.useCallback)(function(t){return t(e)},[e]),{store:en()})}e.s(["StoreProvider",()=>J,"useChatHook",()=>et,"useChatter",()=>ee,"useGet",()=>eo,"useSet",()=>ei,"useValue",()=>er,"useYapper",()=>Z],924908);var ea=e.i(399119),es=e.i(445789),el=e.i(167626),ep=e.i(346715),eu=e.i(119468),ec=e.i(463348),ed=e.i(960933),ey=e.i(862927),eT=e.i(279606),ef=function e(t){(0,p._)(this,e),(0,T._)(this,"ok",!0),(0,T._)(this,"payload",void 0),this.payload=t},eg=ed.Type.Object({code:ed.Type.String(),message:ed.Type.Optional(ed.Type.String()),extras:ed.Type.Optional(ed.Type.Unknown())}),eh=ed.Type.Object({ok:ed.Type.Literal(!1),payload:eg}),ev=function(e){function t(e){(0,p._)(this,t);var n,r,i={code:"UNCAUGHT_ERROR",message:"An unexpected error occurred"};if((0,el._)(e,eT.CompletionError))i.code="UNEXPECTED_DISCONNECT",i.message="Unexpected disconnect",r=e.stack;else if((0,el._)(e,Error))i.message=e.message,r=e.stack;else if("UNEXPECTED_DISCONNECT"===e)i.code="UNEXPECTED_DISCONNECT",i.message="Unexpected disconnect";else if("UNCAUGHT_ERROR"===e)i.code="UNCAUGHT_ERROR",i.message="An unexpected error occurred";else if("string"==typeof e)i.message=e;else if(e&&(void 0===e?"undefined":(0,eu._)(e))==="object"){var o=null;ey.Value.Check(eg,e)?o=e:ey.Value.Check(eh,e)&&(o=e.payload),o&&(i.code=o.code,i.message=o.message,i.extras=o.extras)}return n=(0,ea._)(this,t,[i.message]),(0,T._)(n,"ok",!1),(0,T._)(n,"payload",void 0),(0,T._)(n,"input",void 0),(0,T._)(n,"reported",void 0),n.name="ChatError",n.payload=i,n.input=e,r&&(n.stack=r),n}return(0,es._)(t,e),t}((0,ec._)(Error));function em(e){return new ef(e)}function eS(e){return(0,el._)(e,ev)?e:new ev(e)}function eE(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?!e.ok&&n.includes(e.payload.code):!e.ok}function eb(e){if("function"==typeof e)try{var t,n=e();if((0,el._)(n,Promise))return n.then(function(e){return em(e)}).catch(function(e){return eS(e)});return em(n)}catch(e){return eS(e)}if((0,el._)(e,Promise))return e.then(function(e){return em(e)}).catch(function(e){return eS(e)});if(Array.isArray(e)){if(0===e.length)throw Error("At least one observable is required");return(t=eT.Observable).combine.apply(t,(0,ep._)(e)).once().then(function(e){return em(e)}).catch(function(e){return eS(e)})}return eT.Observable.from(e).once().then(function(e){return em(e)}).catch(function(e){return eS(e)})}e.s(["Err",()=>eS,"Ok",()=>em,"get",()=>eb,"isError",()=>eE],885505)},986194,e=>{"use strict";var t=e.i(721281),n=e.i(878420),r=e.i(119468);function i(e){if(!e.$kind)throw Error("Object has an empty or undefined $kind property");if(!Object.prototype.hasOwnProperty.call(e,e.$kind))throw Error("Object has a $kind property that does not match the object");return e[e.$kind]}function o(e){var t=i(e);if((void 0===t?"undefined":(0,r._)(t))!=="object"||null===t)throw Error("Contents is not an object");if("$kind"in t)throw Error("Contents has an unexpected $kind property");return(0,n._)({$kind:e.$kind},t)}function a(e,n){return(0,t._)({$kind:e},e,n)}function s(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e&&n.includes(e.$kind)}e.s(["isKind",()=>s,"unkind",()=>i,"unwrapKind",()=>o,"withKind",()=>a])},353838,e=>{"use strict";var t=e.i(346715),n=e.i(131141),r=e.i(986194),i=e.i(82259),o=e.i(634759),a={messageEventContents:{messageContentsUpdate:function(e,t){e.content+=t.content},messageContentsSet:function(e,t){e.content=t.content},addSourcesUpdate:function(e,n){var r;(r=e.sources).push.apply(r,(0,t._)(n.sources))},updateProposedFileChange:function(e,t){if((0,r.isKind)(e.extraActions,"proposedFileChanges")){var n=(0,r.unkind)(e.extraActions).changes,i=t.Update,o=t.Replacement;if(null!=i){var a=i.update,s=a.filePath,l=a.content,p=a.changeSummary,u=a.messageContentsOffset,c=a.state,d=n.find(function(e){return e.filePath===s});null!=d&&(d.content+=l,d.state=c,d.messageContentsOffset=u,p&&(d.changeSummary=p))}else if(null!=o){var y=o.replacement,T=y.filePath,f=y.content,g=y.changeSummary,h=y.state,v=y.messageContentsOffset,m=n.find(function(e){return e.filePath===T});null!=m&&(m.content=f,m.state=h,m.messageContentsOffset=v,g&&(m.changeSummary=g))}}},addProposedFileChange:function(e,t){(0,r.isKind)(e.extraActions,"proposedFileChanges")||(e.extraActions=(0,r.withKind)("proposedFileChanges",{changes:[],commitId:"",summary:""})),e.extraActions.proposedFileChanges.commitId=t.commitId,e.extraActions.proposedFileChanges.changes.push(t.change)},addProposedFileChangesMetadata:function(e,t){(0,r.isKind)(e.extraActions,"proposedFileChanges")&&(e.extraActions.proposedFileChanges.summary=t.summary)},addProposedShellCommand:function(e,t){e.assistantProposedActions.shellCommands.push(t.command)},addProposedPackageInstall:function(e,t){e.assistantProposedActions.packageInstalls.push(t.packageInstalls)},addProposedWorkspaceToolNudge:function(e,t){e.assistantProposedActions.workspaceToolNudges.push(t.nudge)},addProposedActionsMetadata:function(e,t){t.commitId&&(e.assistantProposedActions.commitId=t.commitId),t.summary&&(e.assistantProposedActions.summary=t.summary),void 0!==t.didCreateCheckpoint&&(e.assistantProposedActions.didCreateCheckpoint=t.didCreateCheckpoint),t.didCountEditRequest&&(e.assistantProposedActions.didCountEditRequest=!0),(0,r.isKind)(e.extraActions,"proposedFileChanges")&&(e.extraActions.proposedFileChanges.commitId=t.commitId,e.extraActions.proposedFileChanges.summary=t.summary)},addProposedRunConfiguration:function(e,t){e.assistantProposedActions.runConfigurations.push(t.runConfiguration)},addProposedDeploymentConfiguration:function(e,t){e.assistantProposedActions.deploymentConfigurations.push(t.deploymentConfiguration)},addProposedWorkflowConfiguration:function(e,t){e.assistantProposedActions.workflowConfigurations.push(t.workflowConfiguration)},updateAttachedFormStringFieldAppend:function(e,t){s(e,t,!0)},updateAttachedFormStringFieldSet:function(e,t){s(e,t,!1)},addRagContext:function(e,t){e.ragContext=t.newContext}},inlineActionEventContents:{messageContentsUpdate:function(e,t){e.content+=t.content},messageContentsSet:function(e,t){e.content=t.content},addSourcesUpdate:function(e,n){var r;(r=e.sources).push.apply(r,(0,t._)(n.sources))}},localShellExecutionEventContents:{localShellExecutionEventSet:function(e,t){return t.contents}},shellSuggestionEventContents:{shellSuggestionContentsUpdate:function(e,t){e.content+=t.content}},byoPromptEventContents:{byoPromptResultUpdate:function(e,t){e.jsonResult=t.jsonResult}},agentTimelineEventContents:{agentTimelineEventSet:function(e,t){return t.contents},agentTimelineEventCreateFileAddContent:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="createFileData"&&(e.toolData.createFileData.content+=t.content)},updateRevertStatus:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="revertData"&&(e.toolData.revertData.status=t.newStatus)},appendTimelineMessageContentsUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="messageData"&&(e.toolData.messageData.content+=t.content)},appendThoughtContentsUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="thoughts"&&(e.toolData.thoughts.thoughts+=t.content,e.toolData.thoughts.totalTimeTakenMs=t.totalTimeTakenMs)},newThoughtSummaryUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="thoughts"&&(e.toolData.thoughts.summary=t.summary)},appendRedactedThoughtsMarker:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="thoughts"&&e.toolData.thoughts.redactedThoughtsMarkers.push(t.marker)},upsertGeneratedMediaData:function(e,t){if((null==(n=e.toolData)?void 0:n.$kind)==="generateMediaData"){var n,r=e.toolData.generateMediaData.media,i=r.findIndex(function(e){return e.id===t.media.id});-1!==i?r[i]=t.media:r.push(t.media)}},subagentReportResultUpdate:function(e,t){var n;(null==(n=e.toolData)?void 0:n.$kind)==="subagentReportResultData"&&(e.toolData.subagentReportResultData.result+=t.delta)}},hostingDebugSummaryEventContents:{hostingDebugSummaryEventSet:function(e,t){return t.contents}},agentAskUserForActionRequest:{agentAskUserForActionRequestSet:function(e,t){return t.request}},integrationTestEventContents:{integrationTestEventContents:function(e,t){e.expectedResponseString+=t.content}},agentPlanEventContents:{addDesignReferenceFile:function(e,t){e.designReferenceFilePaths.push(t.filePath)},updatePlanContents:function(e,t){t.step&&(e.step=t.step),t.planId&&(e.planId=t.planId),t.objective&&t.objective.description&&(e.objective=t.objective),t.initialCommitId&&(e.initialCommitId=t.initialCommitId),void 0!==t.stackBlueprint&&t.stackBlueprint!==o.StackBlueprint.STACK_BLUEPRINT_NONE&&(e.stackBlueprint=t.stackBlueprint),void 0!==t.agentStackTriggerType&&t.agentStackTriggerType!==i.AgentStackTriggerType.UNKNOWN_TRIGGER_TYPE&&(e.agentStackTriggerType=t.agentStackTriggerType)}},subagentRunning:{subagentRunningDataUpdate:function(e,t){if(t.state){e.subagentId=t.state.subagentId,e.childSessionId=t.state.childSessionId,e.contents=t.state.contents;var n,r,i=Math.max(null!=(n=t.totalExecutionTimeSeconds)?n:0,null!=(r=t.state.totalExecutionTimeSeconds)?r:0);i>0&&(e.totalExecutionTimeSeconds=i)}}},uiTestingSubagentExecutionEventContents:{uiTestingSubagentExecutionEventUpdate:function(e,t){e.gcsDownloadUrl=t.state.gcsDownloadUrl,e.mimeType=t.state.mimeType,e.narration=t.state.narration,e.miniNarration=t.state.miniNarration}}};function s(e,t,n){if((null==(r=e.attachedForm)?void 0:r.formType)&&e.attachedForm.formType!==i.AttachedFormType.ATTACHED_FORM_TYPE_UNKNOWN){var r,o,a=e.attachedForm.fields.find(function(e){return e.path===t.path});a||(a={path:t.path,formType:{$kind:"string",string:{value:""}}},e.attachedForm.fields.push(a)),(null==(o=a.formType)?void 0:o.$kind)==="string"&&(a.formType.string.value=n?a.formType.string.value+t.value:t.value)}}function l(e,t){var n=new Set,i=!0,o=!1,s=void 0;try{for(var l,p=t[Symbol.iterator]();!(i=(l=p.next()).done);i=!0){var u,c,d=l.value;if(!(!d.operation||n.has(d.id))){n.add(d.id);var y=null==(c=a[e.$kind])||null==(u=c[d.operation.$kind])?void 0:u.call(c,(0,r.unkind)(e),(0,r.unkind)(d.operation));y&&(e[e.$kind]=y)}}}catch(e){o=!0,s=e}finally{try{i||null==p.return||p.return()}finally{if(o)throw s}}}function p(e){e.contents.contents&&e.typedUpdateEventOperations.length&&(l(e.contents.contents,e.typedUpdateEventOperations),e.typedUpdateEventOperations=[])}function u(e,t){var r=null;if(t.state!==e.state&&(null!=r||(r=Object.assign({},e)),r.state=t.state),(t.error.type!==e.error.type||t.error.message!==e.error.message)&&(null!=r||(r=Object.assign({},e)),r.error=t.error),!t.typedOperations.length||!e.contents.contents)return null!=r?r:e;var i=(0,n.createDraft)(e.contents.contents);l(i,t.typedOperations);var o=(0,n.finishDraft)(i);return o!==e.contents.contents&&(null!=r||(r=Object.assign({},e)),r.contents={benchmarkParameters:{datasetId:"",instanceId:"",runId:"",replDescription:"",disableSandbox:!1,commandPrefix:[],overrideShellExecuteTimeoutSeconds:0,overrideMaxSteps:0},contents:o}),null!=r?r:e}e.s(["applyEventOperations",()=>p,"applyEventUpdateMessage",()=>u])},910951,e=>{"use strict";var t=e.i(862927),n=e.i(131141),r=e.i(82259),i=e.i(878420),o=e.i(986194),a=e.i(119468),s=e.i(15053);function l(e){return(void 0===e?"undefined":(0,a._)(e))==="object"?e:"string"==typeof e?{type:r.ModelType.OVERRIDE,overrideModelName:e}:{type:e,overrideModelName:""}}var p=(0,n.freeze)(t.Value.Create(r.EventSchema),!0);function u(e){var t=e.session,n=e.parent,i=e.sender,o=e.contents,a=e.context,l=e.benchmark,u=(0,s.v4)(),c=new Date,d="localShellExecutionEventContents"===o.$kind?r.EventState.IN_PROGRESS:r.EventState.COMPLETE,y={type:r.EventErrorType.EVENT_ERROR_TYPE_UNKNOWN,message:"",shortMessage:""},T=Object.assign({},p);return T.id=u,T.parentEventId=n,T.sessionId=t,T.created=c,T.updated=c,T.state=d,T.error=y,T.sender=i,T.contents={benchmarkParameters:null!=l?l:{datasetId:"",instanceId:"",runId:"",replDescription:"",disableSandbox:!1,commandPrefix:[],overrideShellExecuteTimeoutSeconds:0,overrideMaxSteps:0},contents:o},T.context={metadata:a||void 0},T}var c={contents:(0,n.freeze)(t.Value.Create(r.AgentAskUserForActionRequestSchema),!0)},d={contents:(0,n.freeze)(t.Value.Create(r.AgentAskUserForActionResponseSchema),!0)},y={contents:(0,n.freeze)(t.Value.Create(r.AgentPlanEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.AgentPlanEventContextSchema),!0)},T={contents:(0,n.freeze)(t.Value.Create(r.ApprovePlanEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.ApprovePlanEventContextSchema),!0)},f={contents:(0,n.freeze)(t.Value.Create(r.BYOPromptEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.BYOPromptEventContextSchema),!0)},g={contents:(0,n.freeze)(t.Value.Create(r.InlineActionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.InlineActionEventContextSchema),!0),reference:(0,n.freeze)(t.Value.Create(r.CodeReferenceSchema),!0)},h=e.i(64386),v=e.i(886513),m={applied:(0,n.freeze)(t.Value.Create(r.IterativeAgentAppliedFileChangesSchema),!0),reverted:(0,n.freeze)(t.Value.Create(r.IterativeAgentRevertedFileChangesSchema),!0),contents:(0,n.freeze)(t.Value.Create(r.IterativeAgentEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.IterativeAgentEventContextSchema),!0)},S={contents:(0,n.freeze)(t.Value.Create(r.LocalShellExecutionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.LocalShellExecutionEventContextSchema),!0)},E={contents:(0,n.freeze)(t.Value.Create(r.MessageEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.MessageEventContextSchema),!0),reference:(0,n.freeze)(t.Value.Create(r.CodeReferenceSchema),!0),proposedFileChanges:(0,n.freeze)((0,o.withKind)("proposedFileChanges",{changes:[],commitId:"",summary:""}),!0)},b={contents:(0,n.freeze)(t.Value.Create(r.RevertEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.RevertEventContextSchema),!0)},R={contents:(0,n.freeze)(t.Value.Create(r.SetupImportedProjectEventContentsSchema),!0)},C={contents:(0,n.freeze)(t.Value.Create(r.ShellSuggestionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.ShellSuggestionEventContextSchema),!0)},I={contents:(0,n.freeze)(t.Value.Create(r.StepTooComplexEventContentsSchema),!0)},O={contents:(0,n.freeze)(t.Value.Create(r.TranslateEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(r.TranslateEventContextSchema),!0)},A={contents:(0,n.freeze)(t.Value.Create(r.TriggerCheckpointEventContentsSchema),!0)},_=(0,n.freeze)(t.Value.Create(r.CreateEventRequestSchema),!0);function k(e){var t=function(e){var t,n,a,s,p,_,k,U,N,D,w,P,M,j,L,x,B,F,G,q,$,V,W,H,K,z,Y,Q,X,J,Z,ee,et,en,er,ei,eo,ea,es,el,ep,eu,ec,ed,ey,eT,ef,eg,eh,ev,em,eS,eE,eb,eR,eC,eI,eO,eA,e_,ek,eU,eN,eD,ew,eP,eM,ej,eL,ex,eB,eF,eG,eq,e$,eV,eW,eH=e.session,eK=e.parent,ez=e.sender,eY=e.model,eQ=e.data,eX=e.benchmark;"type"in ez||(ez={id:ez.id.toString(),type:r.UserType.USER,isTeam:!1,roles:[],membership:ez.membership,orgId:"",username:"",timeCreated:ez.timeCreated,flaggingContext:"",modelfarmDisabled:!1,openrouterDisabled:!1,openaiDisabled:!1,anthropicDisabled:!1,geminiDisabled:!1,isEnterprise:!1});var eJ=(0,i._)({session:eH,parent:eK,sender:ez,model:eY,benchmark:eX},eQ);switch(eJ.kind){case"agentPlan":return(t=Object.assign({},y.contents)).planId=eJ.planId,t.objective=eJ.objective,t.step=eJ.step,t.stackBlueprint=eJ.stackBlueprint,t.requiresApproval=eJ.requiresApproval,t.Approver=eJ.approved?(0,o.withKind)("approver",eJ.sender):void 0,eJ.approvedDesignReferenceFilePath&&(t.approvedDesignReferenceFilePath=eJ.approvedDesignReferenceFilePath),eJ.agentStackTriggerType&&(t.agentStackTriggerType=eJ.agentStackTriggerType),u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("agentPlanEventContents",t),context:(0,o.withKind)("agentPlanEventContext",y.context)});case"approvePlan":return(a=Object.assign({},T.contents)).planEventId=eJ.planEventId,a.approver=eJ.approver,a.initialBuildMode=eJ.initialBuildMode,a.userSecretsResponse=null!=(n=eJ.userSecretsResponse)?n:{providedSecrets:[]},a.agentConfig=eJ.agentConfig,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("approvePlanEventContents",a),context:null});case"byoPrompt":return s=Object.assign({},f.contents),p=Object.assign({},f.context),_=l(eJ.model),s.messages=eJ.messages,s.parameters=eJ.parameters,s.forceJson=!1,p.modelSelector=_,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("byoPromptEventContents",s),context:(0,o.withKind)("byoPromptEventContext",p)});case"inlineAction":return w=Object.assign({},g.contents),P=Object.assign({},g.context),M=l(eJ.model),w.content=eJ.message,w.messageType=eJ.messageType,w.codeReference=null!=(k=eJ.codeReference)?k:g.reference,w.usedModelSelector=M,P.mostRecentFile=null!=(U=eJ.mostRecentFile)?U:"",P.fileContext=null!=(N=eJ.fileContext)?N:[],P.modelSelector=M,P.useRag=null!=(D=eJ.useRag)&&D,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("inlineActionEventContents",w),context:(0,o.withKind)("inlineActionEventContext",P)});case"iterativeAgent":return function(e){var t=Object.assign({},m.contents);if("appliedChanges"in e.action){var n=Object.assign({},m.applied);n.eventWhichProposedChanges=e.action.eventIdWhichProposedChanges,n.appliedChanges=e.action.appliedChanges,n.commitHash=e.action.commitHash,t.contents=(0,o.withKind)("appliedFileChanges",n)}else if("revertedChanges"in e.action){var r=Object.assign({},m.reverted);r.eventWhichProposedChanges=e.action.eventIdWhichProposedChanges,r.eventWhichAppliedChanges=e.action.eventIdWhichAppliedChanges,r.revertedChanges=e.action.revertedChanges,t.contents=(0,o.withKind)("revertedFileChanges",r)}else if("eventIdWhichProposedPackageInstall"in e.action)if("installationOutput"in e.action){var a=e.action,s=a.eventIdWhichProposedPackageInstall,l=(0,v._)(a,["eventIdWhichProposedPackageInstall"]);t.contents=(0,o.withKind)("installedPackages",(0,h._)((0,i._)({},l),{eventWhichProposedPackageInstall:s}))}else{var p=e.action,c=p.eventIdWhichProposedPackageInstall,d=(0,v._)(p,["eventIdWhichProposedPackageInstall"]);t.contents=(0,o.withKind)("installingPackages",(0,h._)((0,i._)({},d),{eventWhichProposedPackageInstall:c}))}else if("eventIdWhichProposedShellExecution"in e.action)if("commandOutput"in e.action){var y=e.action,T=y.eventIdWhichProposedShellExecution,f=(0,v._)(y,["eventIdWhichProposedShellExecution"]);t.contents=(0,o.withKind)("finishedShellExecution",(0,h._)((0,i._)({},f),{eventWhichProposedShellExecution:T}))}else{var g=e.action,S=g.eventIdWhichProposedShellExecution,E=(0,v._)(g,["eventIdWhichProposedShellExecution"]);t.contents=(0,o.withKind)("startedShellExecution",(0,h._)((0,i._)({},E),{eventWhichProposedShellExecution:S}))}else if("eventIdWhichProposedRunConfiguration"in e.action){var b=e.action,R=b.eventIdWhichProposedRunConfiguration,C=(0,v._)(b,["eventIdWhichProposedRunConfiguration"]);t.contents=(0,o.withKind)("appliedRunConfiguration",(0,h._)((0,i._)({},C),{eventWhichProposedRunConfiguration:R}))}else if("eventIdWhichProposedDeploymentConfiguration"in e.action){var I=e.action,O=I.eventIdWhichProposedDeploymentConfiguration,A=(0,v._)(I,["eventIdWhichProposedDeploymentConfiguration"]);t.contents=(0,o.withKind)("appliedDeploymentConfiguration",(0,h._)((0,i._)({},A),{eventWhichProposedDeploymentConfiguration:O}))}else if("eventIdWhichProposedWorkflowConfiguration"in e.action){var _=e.action,k=_.eventIdWhichProposedWorkflowConfiguration,U=(0,v._)(_,["eventIdWhichProposedWorkflowConfiguration"]);t.contents=(0,o.withKind)("appliedWorkflowConfiguration",(0,h._)((0,i._)({},U),{eventWhichProposedWorkflowConfiguration:k}))}return u({session:e.session,parent:e.parent,sender:e.sender,contents:(0,o.withKind)("iterativeAgentEventContents",t),context:(0,o.withKind)("iterativeAgentEventContext",m.context)})}(eJ);case"localShellExecution":return(j=Object.assign({},S.contents)).command=eJ.command,j.channelName=eJ.channelName,j.eventId=eJ.event,j.index=0,j.result="",j.exitCode=0,j.executed=!1,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("localShellExecutionEventContents",j),context:(0,o.withKind)("localShellExecutionEventContext",S.context)});case"message":return eN=Object.assign({},E.contents),eD=Object.assign({},E.context),ew=l(eJ.model),eN.content=eJ.message,eN.intent=eJ.intent,eN.media=null!=(Y=eJ.media)?Y:[],eN.codeReference=null!=(Q=eJ.codeReference)?Q:E.reference,eN.usedModelSelector=ew,eN.sources=null!=(X=eJ.sources)?X:[],eN.extraActions=null!=(J=eJ.extraActions)?J:E.proposedFileChanges,eN.agentAction=null!=(Z=eJ.agentAction)?Z:{},eN.uploadedFiles=null!=(ee=eJ.uploadedFiles)?ee:[],eN.attachedUrls=null!=(et=eJ.attachedUrls)?et:[],eJ.requestedStackBlueprint&&(eN.requestedStackBlueprint=eJ.requestedStackBlueprint),eJ.agentStackTriggerType&&(eN.agentStackTriggerType=eJ.agentStackTriggerType),eN.customStackReplId=null!=(en=eJ.customStackReplId)?en:"",eN.themeConfig=null!=(er=eJ.themeConfig)?er:"",eN.attachedForm=null!=(ei=eJ.attachedForm)?ei:{formType:r.AttachedFormType.ATTACHED_FORM_TYPE_UNKNOWN,fields:[]},eN.enableDeepThinking=null!=(eo=eJ.enableDeepThinking)&&eo,eD.intent=eJ.intent,eD.mostRecentFile=null!=(ea=eJ.mostRecentFile)?ea:"",eD.fileContext=null!=(es=eJ.fileContext)?es:[],eD.modelSelector=ew,eD.useRag=null!=(el=eJ.useRag)&&el,eD.extraResources=null!=(ep=eJ.extraResources)?ep:[],eD.messageSource=null!=(eu=eJ.messageSource)?eu:r.MessageSource.MESSAGE_SOURCE_REPLIT_UI,eD.agentConfig={maxSteps:0,modelProfile:null!=(ec=null==(L=eJ.agentConfig)?void 0:L.modelProfile)?ec:r.ModelProfile.MODEL_PROFILE_STANDARD,thinkingEnabled:null==(x=eJ.agentConfig)?void 0:x.thinkingEnabled,enableAutomatedTesting:null==(B=eJ.agentConfig)?void 0:B.enableAutomatedTesting,samplingRate:null!=(ed=null==(F=eJ.agentConfig)?void 0:F.samplingRate)?ed:0,webSearchEnabled:null!=(ey=null==(G=eJ.agentConfig)?void 0:G.webSearchEnabled)&&ey,imageGenerationEnabled:null!=(eT=null==(q=eJ.agentConfig)?void 0:q.imageGenerationEnabled)&&eT,agentMode:null!=(ef=null==($=eJ.agentConfig)?void 0:$.agentMode)?ef:r.AgentMode.AGENT_MODE_UNSPECIFIED,initialBuildMode:null!=(eg=null==(V=eJ.agentConfig)?void 0:V.initialBuildMode)?eg:r.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_UNSPECIFIED,maxAutonomyEnabled:null!=(eh=null==(W=eJ.agentConfig)?void 0:W.maxAutonomyEnabled)&&eh,autonomyLevel:null!=(ev=null==(H=eJ.agentConfig)?void 0:H.autonomyLevel)?ev:r.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED,agentInitialBuildTier:null!=(em=null==(K=eJ.agentConfig)?void 0:K.agentInitialBuildTier)?em:r.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_UNSPECIFIED,headlessMode:!1,workspaceLessMode:null==(z=eJ.agentConfig)?void 0:z.workspaceLessMode},eJ.webviewTargetedElement&&(eN.targetedElement=eJ.webviewTargetedElement),void 0!==eJ.quickEdit&&(eN.quickEdit=eJ.quickEdit),eJ.agentConfig&&(eN.agentConfig={maxSteps:0,modelProfile:null!=(eb=eJ.agentConfig.modelProfile)?eb:r.ModelProfile.MODEL_PROFILE_STANDARD,thinkingEnabled:eJ.agentConfig.thinkingEnabled,enableAutomatedTesting:eJ.agentConfig.enableAutomatedTesting,samplingRate:null!=(eR=eJ.agentConfig.samplingRate)?eR:0,webSearchEnabled:null!=(eC=null==(eS=eJ.agentConfig)?void 0:eS.webSearchEnabled)&&eC,imageGenerationEnabled:null!=(eI=null==(eE=eJ.agentConfig)?void 0:eE.imageGenerationEnabled)&&eI,agentMode:null!=(eO=eJ.agentConfig.agentMode)?eO:r.AgentMode.AGENT_MODE_UNSPECIFIED,initialBuildMode:null!=(eA=eJ.agentConfig.initialBuildMode)?eA:r.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_UNSPECIFIED,maxAutonomyEnabled:null!=(e_=eJ.agentConfig.maxAutonomyEnabled)&&e_,autonomyLevel:null!=(ek=eJ.agentConfig.autonomyLevel)?ek:r.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED,agentInitialBuildTier:null!=(eU=eJ.agentConfig.agentInitialBuildTier)?eU:r.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_UNSPECIFIED,headlessMode:!1,workspaceLessMode:eJ.agentConfig.workspaceLessMode}),u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("messageEventContents",eN),context:(0,o.withKind)("messageEventContext",eD)});case"revert":return(eP=Object.assign({},b.contents)).eventIdBeforeRevert=eJ.eventIdBeforeRevert,eP.commitId=eJ.commitHash,eP.message=eJ.commitMessage,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("revertEventContents",eP),context:(0,o.withKind)("revertEventContext",b.context)});case"shellSuggestion":return eM=Object.assign({},C.contents),ej=Object.assign({},C.context),eL=l(eJ.model),eM.content=eJ.message,ej.modelSelector=eL,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("shellSuggestionEventContents",eM),context:(0,o.withKind)("shellSuggestionEventContext",ej)});case"translate":return(ex=Object.assign({},O.contents)).content=eJ.content,ex.inputTarget=eJ.inputTarget,ex.outputTarget=eJ.outputTarget,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("translateEventContents",ex),context:(0,o.withKind)("translateEventContext",O.context)});case"stepTooComplex":return(eB=Object.assign({},I.contents)).state=eJ.state,eB.stepId=eJ.stepId,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("stepTooComplexEventContents",eB),context:null});case"agentAskUserForActionResponse":return(eF=Object.assign({},d.contents)).response=eJ.response,eF.requestEventId=eJ.requestEventId,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("agentAskUserForActionResponse",eF),context:null});case"agentAskUserForActionRequest":return(eG=Object.assign({},c.contents)).request=eJ.request,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("agentAskUserForActionRequest",eG),context:null});case"requestFeatureAdd":return u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:{$kind:"requestFeatureAddData",requestFeatureAddData:{type:eJ.feature}},context:null});case"triggerCheckpoint":return(eV=Object.assign({},A.contents)).description=eJ.description,eV.onlyIfDiff=null!=(eq=eJ.onlyIfDiff)&&eq,eV.author=null!=(e$=eJ.author)?e$:r.CommitAuthor.COMMIT_AUTHOR_AGENT,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("triggerCheckpointEventContents",eV),context:null});case"setupImportedProject":return(eW=Object.assign({},R.contents)).importSource=eJ.importSource,eW.agentConfig=eJ.agentConfig,u({session:eJ.session,parent:eJ.parent,sender:eJ.sender,contents:(0,o.withKind)("setupImportedProjectEventContents",eW),context:null})}}(e),n=Object.assign({},_);return n.addToChild=e.addToChild,n.state=t.state,n.sessionId=t.sessionId,n.parentEventId=t.parentEventId,n.eventId=t.id,n.context=t.context,n.contents=t.contents,{event:t,request:n}}e.s(["createEventRequest",()=>k],910951)},590225,e=>{"use strict";var t=e.i(862927),n=e.i(131141),r=e.i(82259),i=(0,n.freeze)(t.Value.Create(r.UpdateEventMessageSchema),!0);function o(e){var t,n,o=Object.assign({},i);return o.eventId=e.id,o.state=null!=(t=e.state)?t:r.EventState.COMPLETE,o.typedOperations=null!=(n=e.typedOperations)?n:[],o}e.s(["createUpdateEventRequest",()=>o])},576106,e=>{"use strict";var t=e.i(862927),n=e.i(131141);e.i(660670);var r=e.i(957410),i=e.i(986194),o=e.i(82259),a={session:(0,n.freeze)(t.Value.Create(o.SessionSchema),!0),data:(0,n.freeze)(t.Value.Create(r.SessionDataSchema),!0),create:(0,n.freeze)(t.Value.Create(o.CreateSessionRequestSchema),!0),update:(0,n.freeze)(t.Value.Create(o.UpdateSessionRequestSchema),!0)};function s(e){var t,n=Object.assign({},a.create);return n.title=null!=(t=e.title)?t:"",n.sessionType=e.sessionType,n.replId=e.replId,n.SeededAiFirstEventContents=e.seededEvent?(0,i.withKind)("seededAiFirstEventContents",{benchmarkParameters:{datasetId:"",instanceId:"",runId:"",replDescription:"",disableSandbox:!1,commandPrefix:[],overrideShellExecuteTimeoutSeconds:0,overrideMaxSteps:0},contents:e.seededEvent}):void 0,e.taskId&&(n.taskId=e.taskId),n}function l(e,t){var r=(0,n.produce)(e,function(e){var n,r,i,o,a;e.title=null!=(n=t.title)?n:e.title,e.sessionType=null!=(r=t.sessionType)?r:e.sessionType,e.archived=null!=(i=t.archived)?i:e.archived,e.readOnly=null!=(o=t.readOnly)?o:e.readOnly,e.taskId=null!=(a=t.taskId)?a:e.taskId}),i=Object.assign({},a.update);return i.id=r.id,i.title=r.title,i.sessionType=r.sessionType,i.replId=r.replId,i.activeEventId=r.activeEventId,void 0!==t.archived&&r.archived!==e.archived&&(i.archived=r.archived),void 0!==t.readOnly&&r.readOnly!==e.readOnly&&(i.readOnly=r.readOnly),void 0!==t.taskId&&r.taskId!==e.taskId&&(i.taskId=r.taskId),void 0!==t.isActiveAgentSession&&(i.isActiveAgentSession=t.isActiveAgentSession,r===e&&(r=Object.assign({},r))),{session:r,request:i}}function p(e){var t=Object.assign({},a.session),n=new Date;return t.id=e.sessionId,t.title=e.title,t.sessionType=e.sessionType,t.replId=e.replId,t.sessionCreationEventId=e.sessionCreationEventId,t.archived=!!e.archived,t.taskId=e.taskId,t.lastEventTime=n,t.created=n,t.updated=n,t.revertedToSessionId=e.revertedToSessionId,t.revertedToEventId=e.revertedToEventId,t}function u(e,t){return(0,n.produce)(e,function(e){var n,r;e.title=t.title,e.sessionType=t.sessionType,e.archived=null!=(n=t.archived)?n:e.archived,e.activeEventId=t.activeEventId,e.readOnly=null!=(r=t.readOnly)?r:e.readOnly})}function c(e,t){var n=Object.assign({},a.session);return n.id=t.id,n.title=t.title,n.sessionType=t.sessionType,n.replId=e,n.sessionCreationEventId=t.sessionCreationEventId,n.archived=t.archived,n.lastEventTime=t.created,n.created=t.created,n.updated=t.updated,n.readOnly=t.readOnly,n.taskId=t.taskId,n}function d(e){var t=Object.assign({},a.data);return t.id=e.id,t.title=e.title,t.sessionType=e.sessionType,t.sessionCreationEventId=e.sessionCreationEventId,t.archived=e.archived,t.readOnly=e.readOnly,t.taskId=e.taskId,t.created=e.created,t.updated=e.updated,t}e.s(["applySessionUpdateMessage",()=>u,"compatDataToSession",()=>c,"compatSessionToData",()=>d,"createSessionFromCreateSessionMessage",()=>p,"createSessionRequest",()=>s,"createUpdateSessionRequest",()=>l])},877212,51553,204203,970187,765695,334712,145864,165680,805763,e=>{"use strict";e.i(267710),e.i(148382);var t=e.i(530658),n=e.i(276385),r=e.i(389959),i=e.i(971131),o=e.i(830675),a=e.i(131141),s=e.i(541793),l=e.i(161322),p=e.i(82259),u=e.i(644464),c=e.i(952098),d=e.i(600637),y=e.i(924908),T=e.i(904851),f=e.i(90659),g=e.i(721281),h=e.i(297083),v=e.i(817556);e.i(242933);var m=e.i(424360),S=e.i(885505),E=e.i(394212),b=e.i(119468),R=e.i(281128);e.i(660670);var C=e.i(813702),I=e.i(353838),O=e.i(910951),A=e.i(590225),_=e.i(576106),k=e.i(986194);function U(e){return{state:e.runState,reason:e.transitionReason.reasons?(0,k.unwrapKind)(e.transitionReason.reasons):null}}var N=function(){function e(t,n){var r=this;(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"session",void 0),(0,g._)(this,"active",new m.Multicast(function(e){return r.api.currentAgentSession.select(function(e){return!!e&&e.id===r.session.id}).subscribe(e)})),(0,g._)(this,"state",new m.Multicast(function(e){var t=null,n=null,i=!1,o=r.api.state.register({snapshot:function(){return t},rollback:function(e){return t=e},notify:function(){return e.next(t)},update:function(e){var n=!1;if("agent-state-modified"===e.kind&&e.session===r.session.id&&(t=e.state,n=!0),e.optimistic||l(),n)return!0}}),a=function(){return(0,h._)(function(){var r,a,s,p;return(0,v._)(this,function(u){switch(u.label){case 0:n=null,i=!0,u.label=1;case 1:return u.trys.push([1,,3,4]),[4,this.api.service.getAgentState.rpc({replId:this.api.replId,sessionId:this.session.id})];case 2:if(r=u.sent(),(0,S.isError)(r,"UNEXPECTED_DISCONNECT"))return[2];if(!r.ok)return[2,this.api.error(r,e)];return(a=U(r.payload)).state!==(null==t?void 0:t.state)&&(null==(s=(p=this.api.logger).warn)||s.call(p,"state transition was manually corrected"),t=a,o.commit(),e.next(t)),[3,4];case 3:return i=!1,l(),[7];case 4:return[2]}})}).call(r)},s=function(){null!==n&&(clearTimeout(n),n=null)},l=function(){s(),i||(null==t?void 0:t.state)!==p.AgentRunState.AGENT_STATE_RUNNING||(n=setTimeout(a,1e4))},u=r.api.connected.lift(e,function(n){return(0,h._)(function(){var r,i;return(0,v._)(this,function(a){switch(a.label){case 0:return[4,(0,S.get)(this.active)];case 1:if(r=a.sent(),n.aborted||(0,S.isError)(r,"UNEXPECTED_DISCONNECT"))return[2];if(!r.ok)return[2,this.api.error(r,e)];if(!r.payload)return t=null,o.commit(),e.next(t),[2];return[4,this.api.service.getAgentState.rpc({replId:this.api.replId,sessionId:this.session.id})];case 2:if(i=a.sent(),n.aborted||(0,S.isError)(i,"UNEXPECTED_DISCONNECT"))return[2];if(!i.ok)return[2,this.api.error(i,e)];return t=U(i.payload),o.commit(),e.next(t),l(),[2]}})}).call(r)});return function(){s(),o.unsubscribe(),u.unsubscribe()}})),this.api=t,this.session=n}return(0,f._)(e,[{key:"update",value:function(e){return(0,h._)(function(){var n,r,i,o,a,s;return(0,v._)(this,function(l){switch(l.label){case 0:return[4,(0,S.get)(this.state)];case 1:if(!(n=l.sent()).ok)return[2,this.api.error(n)];if(!n.payload)return[2,this.api.error("session is not an agent session")];if(r=(0,R.create)(n.payload,function(t){t.state=e}),n.payload===r)return[2,(0,S.Ok)(n.payload)];return o=(i=(0,t._)(this.api.state.stage({kind:"agent-state-modified",session:this.session.id,state:{state:e,reason:null}}),2))[0],a=i[1],[4,this.api.service.updateAgentState.rpc({replId:this.api.replId,sessionId:this.session.id,runState:e,transitionReason:{}})];case 2:if(!(s=l.sent()).ok)return a(),[2,this.api.error(s)];if(s.payload.runState!==e)return a(),[2,(0,S.Ok)(U(s.payload))];return this.api.hooks.trigger("client-updated-agent-state",{session:this.session,prev:n.payload,next:r}),o(),[2,(0,S.Ok)(r)]}})}).call(this)}},{key:"warmup",value:function(){return(0,h._)(function(){var t,n,r,i,o;return(0,v._)(this,function(a){switch(a.label){case 0:if((t=e.lastWarmTimeMap.get(this.api))||(t=new Map,e.lastWarmTimeMap.set(this.api,t)),n=Date.now(),(r=t.get(this.session.id))&&n-r<24e4)return[2,(0,S.Ok)(null)];return[4,(0,S.get)(this.state)];case 1:if(!(i=a.sent()).ok)return[2,this.api.error(i)];if(!i.payload)return[2,this.api.error("session is not an agent session")];if(i.payload.state===p.AgentRunState.AGENT_STATE_RUNNING||i.payload.state===p.AgentRunState.AGENT_STATE_PAUSING)return[2,(0,S.Ok)(null)];return t.set(this.session.id,n),[4,this.api.service.warmAgent.rpc({replId:this.api.replId,sessionId:this.session.id})];case 2:if(!(o=a.sent()).ok)return[2,this.api.error(o)];return[2,(0,S.Ok)(null)]}})}).call(this)}},{key:"usage",value:function(e){return this.api.createUsageWatcher({sessionId:this.session.id,start:e})}}]),e}();(0,g._)(N,"lastWarmTimeMap",new WeakMap);var D=e.i(399119),w=e.i(445789),P=e.i(279606),M=function(){function e(n){if((0,T._)(this,e),(0,g._)(this,"forward",new Map),(0,g._)(this,"reverse",new Map),n){var r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=(0,t._)(a.value,2),p=l[0],u=l[1];this.set(p,u)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}}return(0,f._)(e,[{key:"size",get:function(){return this.forward.size}},{key:"keys",value:function(){return this.forward.keys()}},{key:"values",value:function(){return this.reverse.keys()}},{key:"entries",value:function(){return this.forward.entries()}},{key:"hasKey",value:function(e){return this.forward.has(e)}},{key:"hasValue",value:function(e){return this.reverse.has(e)}},{key:"getValue",value:function(e){var t=this.forward.get(e);if(void 0===t)throw Error("key does not exist");return t}},{key:"getKey",value:function(e){var t=this.reverse.get(e);if(void 0===t)throw Error("value does not exist");return t}},{key:"set",value:function(e,t){var n=this.reverse.get(t),r=this.forward.get(e);this.forward.set(e,t),this.reverse.set(t,e),void 0!==n&&n!==e&&this.forward.delete(n),void 0!==r&&r!==t&&this.reverse.delete(r)}},{key:"deleteKey",value:function(e){var t=this.forward.get(e);void 0!==t&&(this.forward.delete(e),this.reverse.delete(t))}},{key:"deleteValue",value:function(e){var t=this.reverse.get(e);void 0!==t&&(this.reverse.delete(e),this.forward.delete(t))}},{key:"clear",value:function(){this.forward.clear(),this.reverse.clear()}},{key:Symbol.iterator,value:function(){return this.forward.entries()}}]),e}(),j=function(){function e(t){if((0,T._)(this,e),(0,g._)(this,"map",new M),(0,g._)(this,"offset",0),(0,g._)(this,"length",0),t){for(var n=0;n<t.length;n++)this.map.set(n,t[n]);this.length=t.length}}return(0,f._)(e,[{key:"first",get:function(){return this.length?this.map.getValue(0+this.offset):null}},{key:"last",get:function(){return this.length?this.map.getValue(this.map.size-1+this.offset):null}},{key:"peek",value:function(e){return -1===e?this.first:this.last}},{key:"has",value:function(e){return"number"==typeof e?this.map.hasKey(e-this.offset):this.map.hasValue(e)}},{key:"index",value:function(e){return this.map.getKey(e)-this.offset}},{key:"id",value:function(e){return this.map.getValue(e+this.offset)}},{key:"dir",value:function(e,t){var n=this.map.getKey(e),r=this.map.getKey(t);return n<r?1:n>r?-1:0}},{key:"append",value:function(e){for(var t=0;t<e.length;t++)this.map.set(this.map.size+this.offset,e[t]);this.length=this.map.size}},{key:"prepend",value:function(e){for(var t=e.length-1;t>=0;t--)this.offset--,this.map.set(0+this.offset,e[t]);this.length=this.map.size}},{key:"pop",value:function(){if(!this.last)return null;var e=this.last;return this.map.deleteValue(e),this.length=this.map.size,this.offset=this.map.size?this.offset:0,e}},{key:"shift",value:function(){if(!this.first)return null;var e=this.first;return this.map.deleteValue(e),this.length=this.map.size,this.offset=this.map.size?this.offset+1:0,e}},{key:"parent",value:function(e){var t=this.map.getKey(e);return t!==0+this.offset?this.map.getValue(t-1):null}},{key:"child",value:function(e){var t=this.map.getKey(e);return t!==this.map.size-1+this.offset?this.map.getValue(t+1):null}},{key:"adjacent",value:function(e,t){return -1===t?this.parent(e):this.child(e)}},{key:"slice",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-1;if(0===this.length)return[];var r=0+this.offset,i=this.map.size-1+this.offset,o="number"==typeof t?Math.min(Math.max(t+this.offset,r),i):this.map.getKey(t),a="number"==typeof n?Math.max(Math.min(n+this.offset,i),r):this.map.getKey(n),s=o>a;s&&(o=(e=[a,o])[0],a=e[1]);for(var l=[],p=o;p<=a;p++)l.push(this.map.getValue(p));return s?l.reverse():l}},{key:"patch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.first,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.last;if(t&&!e.has(t)||n&&!e.has(n))throw Error("invalid merge");if(!t||!n){if(this.map.size){var r=Array.from(this.map.values());return this.clear(),{removed:r,added:[]}}return null}var i=e.slice(t,n),o=new Set(this.map.values()),a=new Set(o),s=new Set(i),l=!0,p=!1,u=void 0;try{for(var c,d=i[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var y=c.value;a.delete(y)}}catch(e){p=!0,u=e}finally{try{l||null==d.return||d.return()}finally{if(p)throw u}}var T=!0,f=!1,g=void 0;try{for(var h,v=o[Symbol.iterator]();!(T=(h=v.next()).done);T=!0){var m=h.value;s.delete(m)}}catch(e){f=!0,g=e}finally{try{T||null==v.return||v.return()}finally{if(f)throw g}}return a.size||s.size?(this.clear(),this.append(i),{removed:Array.from(a),added:Array.from(s)}):null}},{key:"clear",value:function(){this.map.clear(),this.offset=0,this.length=0}},{key:"clone",value:function(){var t=new e;return t.map=new M(this.map),t.offset=this.offset,t.length=this.length,t}}]),e}(),L=function(){function e(t){(0,T._)(this,e),(0,g._)(this,"ids",new j),(0,g._)(this,"events",new Map),(0,g._)(this,"incomplete",new Set),(0,g._)(this,"length",0),t&&this.append(t)}return(0,f._)(e,[{key:"set",value:function(e){this.events.set(e.id,e),e.state!==p.EventState.COMPLETE?this.incomplete.add(e.id):this.incomplete.delete(e.id)}},{key:"delete",value:function(e){this.events.delete(e),this.incomplete.delete(e)}},{key:"first",get:function(){return this.ids.first?this.get(this.ids.first):null}},{key:"last",get:function(){return this.ids.last?this.get(this.ids.last):null}},{key:"peek",value:function(e){return -1===e?this.first:this.last}},{key:"index",value:function(e){return this.ids.index(e)}},{key:"id",value:function(e){return this.ids.id(e)}},{key:"dir",value:function(e,t){return this.ids.dir(e,t)}},{key:"has",value:function(e){return this.ids.has(e)}},{key:"get",value:function(e){e="number"==typeof e?this.id(e):e;var t=this.events.get(e);if(!t)throw Error("event does not exist");return t}},{key:"append",value:function(e){this.ids.append(e.map(function(e){return e.id})),this.length=this.ids.length;var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.set(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"prepend",value:function(e){this.ids.prepend(e.map(function(e){return e.id})),this.length=this.ids.length;var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.set(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"pop",value:function(){var e,t=this.ids.pop(),n=t&&null!=(e=this.events.get(t))?e:null;if(t&&!n)throw Error("Unexpected null for popped event");return t&&n&&(this.delete(t),this.length--),n}},{key:"shift",value:function(){var e,t=this.ids.shift(),n=t&&null!=(e=this.events.get(t))?e:null;if(t&&!n)throw Error("Unexpected null for shifted event");return t&&n&&(this.delete(t),this.length--),n}},{key:"parent",value:function(e){var t=this.index(e);return t>0?this.get(t-1):null}},{key:"child",value:function(e){var t=this.index(e);return t<this.length-1?this.get(t+1):null}},{key:"adjacent",value:function(e,t){return -1===t?this.parent(e):this.child(e)}},{key:"slice",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-1;return this.ids.slice(t,n).map(function(t){return e.get(t)})}},{key:"patch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.ids.first,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.ids.last,r=this.ids.patch(e.ids,t,n);this.length=this.ids.length;var i=!this.events.size,o=null,a=null;if(r){null!=o||(o={removed:[],added:[],changed:[]});var s=!0,l=!1,u=void 0;try{for(var c,d=r.removed[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var y=c.value;o.removed.push(this.get(y)),this.delete(y)}}catch(e){l=!0,u=e}finally{try{s||null==d.return||d.return()}finally{if(l)throw u}}var T=!0,f=!1,g=void 0;try{for(var h,v=r.added[Symbol.iterator]();!(T=(h=v.next()).done);T=!0){var m=h.value,S=e.get(m);o.added.push(S),this.set(S),i||(null!=a||(a=new Set),a.add(m))}}catch(e){f=!0,g=e}finally{try{T||null==v.return||v.return()}finally{if(f)throw g}}}if(i)return o;for(var E=new Set(this.incomplete),b=this.length-1;b>=0;b--){var R=this.ids.id(b);if(E.delete(R),null==a||!a.has(R)){var C=e.events.get(R);if(C&&C!==this.events.get(R)){null!=o||(o={removed:[],added:[],changed:[]}),o.changed.push(C),this.set(C);continue}if(!E.size&&C&&C.state===p.EventState.COMPLETE)break}}return o}},{key:"adopt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.first,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.last;if(!n||!r){if(!this.length)return null;var i=Array.from(this.events.values());return this.clear(),{removed:i,added:[],changed:[],missing:[]}}if(!(null==t?void 0:t.size)&&!this.length)return{removed:[],added:[],changed:[],missing:e.slice(n,r)};for(var o=[],a=[],s=null,l=null,p=e.index(n),u=e.index(r),c=u;c>=p;c--){var d=e.id(c);if(!(null==t?void 0:t.has(d))&&!this.events.has(d)){o.push(d),l&&!s&&(s=e.child(d));continue}if(null!=l||(l=d),s){o.push(d);continue}if((null==t?void 0:t.has(d))&&this.events.has(d)){var y=null==t?void 0:t.get(d);y&&this.events.get(d)!==y&&(a.push(y),this.set(y))}}if(!l&&!s){if(!this.length&&!o.length)return null;var T=Array.from(this.events.values());return this.clear(),{removed:T,added:[],changed:[],missing:o}}s||(s=n),l||(l=r);var f=this.ids.patch(e,s,l);if(this.length=this.ids.length,!f)return o.length||a.length?{removed:[],added:[],changed:a,missing:o}:null;var g=[],h=[],v=!0,m=!1,S=void 0;try{for(var E,b=f.removed[Symbol.iterator]();!(v=(E=b.next()).done);v=!0){var R=E.value;g.push(this.get(R)),this.delete(R)}}catch(e){m=!0,S=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw S}}var C=!0,I=!1,O=void 0;try{for(var A,_=f.added[Symbol.iterator]();!(C=(A=_.next()).done);C=!0){var k=A.value,U=null==t?void 0:t.get(k);if(!U)throw Error("unexpected null");h.push(U),this.set(U)}}catch(e){I=!0,O=e}finally{try{C||null==_.return||_.return()}finally{if(I)throw O}}return{removed:g,added:h,changed:a,missing:o}}},{key:"clear",value:function(){this.ids.clear(),this.events.clear(),this.incomplete.clear(),this.length=0}},{key:"clone",value:function(){var t=new e;return t.ids=this.ids.clone(),t.events=new Map(this.events),t.incomplete=new Set(this.incomplete),t}}]),e}(),x=Object.prototype.hasOwnProperty;function B(e,t,n){var r=!0,i=!1,o=void 0;try{for(var a,s=e.keys()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0)if(n=a.value,F(n,t))return n}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}function F(e,t){var n,r,i;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((r=e.length)===t.length)for(;r--&&F(e[r],t[r]););return -1===r}if(n===Set){if(e.size!==t.size)return!1;var o=!0,a=!1,s=void 0;try{for(var l,p=e[Symbol.iterator]();!(o=(l=p.next()).done);o=!0)if((i=r=l.value)&&(void 0===i?"undefined":(0,b._)(i))==="object"&&!(i=B(t,i))||!t.has(i))return!1}catch(e){a=!0,s=e}finally{try{o||null==p.return||p.return()}finally{if(a)throw s}}return!0}if(n===Map){if(e.size!==t.size)return!1;var u=!0,c=!1,d=void 0;try{for(var y,T=e[Symbol.iterator]();!(u=(y=T.next()).done);u=!0)if((i=(r=y.value)[0])&&(void 0===i?"undefined":(0,b._)(i))==="object"&&!(i=B(t,i))||!F(r[1],t.get(i)))return!1}catch(e){c=!0,d=e}finally{try{u||null==T.return||T.return()}finally{if(c)throw d}}return!0}if(n===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(n===DataView){if((r=e.byteLength)===t.byteLength)for(;r--&&e.getInt8(r)===t.getInt8(r););return -1===r}if(ArrayBuffer.isView(e)){if((r=e.byteLength)===t.byteLength)for(;r--&&e[r]===t[r];);return -1===r}if(!n||(void 0===e?"undefined":(0,b._)(e))==="object"){for(n in r=0,e)if(x.call(e,n)&&++r&&!x.call(t,n)||!(n in t)||!F(e[n],t[n]))return!1;return Object.keys(t).length===r}}return e!=e&&t!=t}var G=function(){function e(t){var n=t.api,r=t.session,i=t.direction,o=t.initial,a=t.transducer;if((0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"session",void 0),(0,g._)(this,"direction",void 0),(0,g._)(this,"initial",void 0),(0,g._)(this,"transducer",void 0),this.api=n,this.session=r,this.direction=i,this.initial=o,this.transducer=a,!(0,R.isDraftable)(o))throw Error("state must be draftable")}return(0,f._)(e,[{key:"compute",value:function(e,n,r){var i=(0,t._)((0,R.create)([n,void 0]),2),o=i[0],a=i[1];o[1]=this.transducer(e,o[0]);var s=a();return s[0]!==n&&r&&F(s[0],r)&&(s[0]=r),s}},{key:"step",value:function(e,n,r){var i=r.id,o=-this.direction,a=e.peek(o);a&&(a=i===a||r===a?a:e.adjacent(i,o)),a&&(a="string"!=typeof a?a.id:a);var s=i===a?this.initial:a&&n.get(a),l=n.get(i);if(!s)throw Error("starting state not found");var p=(0,t._)(this.compute(r,s,l),2),u=p[0],c=p[1],d=u!==s||!l||u!==l;return d&&n.set(i,u),{ret:c,recomputing:d}}},{key:"indexed",value:function(e,t){for(var n=this,r=Array(t.length),i=0;i<t.length;i++){var o=t[i],a="string"==typeof o?o:o.id;r[i]=e.index(a)}return r.sort(function(e,t){return(e-t)*n.direction}),r}}]),e}(),q=((et=q||{})[et.PEEK=10]="PEEK",et[et.SCAN=150]="SCAN",et[et.TRAVERSE=500]="TRAVERSE",et),$=function(e){function t(e,n,r){var i,o;return(0,T._)(this,t),i=(0,D._)(this,t,[{api:e,session:n,direction:"forward"===r.direction?1:-1,initial:r.state,transducer:r.reducer}]),(0,g._)(i,"map",void 0),(0,g._)(i,"debug",void 0),(0,g._)(i,"result",new m.Multicast(function(e){var t=new j,n=new Set,r=new Map,o=null,a=null,s=10,l=function(){if(!n.size)return!1;for(var e=i.indexed(t,Array.from(n)),o=e[0],l=!1,p=0;o>=0&&o<t.length;){var u=t.id(o),c=o===e[0];if(p++,a&&a!==u&&t.dir(u,a)!==i.direction)break;var d=i.api.materializer.get(u);if(!d){if(n.add(u),l)switch(s){case 10:s=150;break;case 150:s=500}var y,T,f=Math.max(o+(s-1)*i.direction,0);c&&e.length>1&&(f=1===i.direction?Math.min(f,e[e.length-1]):Math.max(f,e[e.length-1]));var g=t.slice(o,f);return i.api.materializer.enqueue(i.session.id,g),i.debug&&(null==(y=(T=i.api.logger).info)||y.call(T,"ran reducer",{reducer:{name:i.debug.name,type:"global",done:!1,fetching:g.length,pending:n.size,invalidated:e.length,scanned:p}})),!1}c&&(e.shift(),n.delete(u));var h=i.step(t,r,d),v=h.ret,m=h.recomputing;if(l||(l=c||m||!1===v),!1===v){a=d.id;break}if(d.id===a&&(a=null),m||e.length){o=m?o+i.direction:e[0];continue}break}return n.size||(s=10),l},p=function(){var n;if(t.length){var s=null!=a?a:t.peek(i.direction);n=s?r.get(s):void 0}else n=i.initial;if(void 0===n)throw Error("unexpected undefined");o!==n&&(o=n,e.next(i.map(n)))},u=i.api.state.register({snapshot:function(){return{ids:t.clone(),pending:new Set(n),states:new Map(r),stop:a,batchSize:s}},rollback:function(e){t=e.ids,n=e.pending,r=e.states,a=e.stop,s=e.batchSize},notify:function(){return p()},update:function(e){if("event-modified"===e.kind&&t.has(e.event.id))return n.add(e.event.id),l()}}),c=i.api.materializer.events.lift(e,function(e){e.filter(function(e){var t=e.id;return n.has(t)}).length&&l()&&p()}),d=i.session.ids.lift(e,function(e){var i=t.patch(e);if(i){var o=!0,s=!1,u=void 0;try{for(var c,d=i.removed[Symbol.iterator]();!(o=(c=d.next()).done);o=!0){var y=c.value;r.delete(y),n.delete(y),y===a&&(a=null)}}catch(e){s=!0,u=e}finally{try{o||null==d.return||d.return()}finally{if(s)throw u}}var T=!0,f=!1,g=void 0;try{for(var h,v=i.added[Symbol.iterator]();!(T=(h=v.next()).done);T=!0){var m=h.value;n.add(m)}}catch(e){f=!0,g=e}finally{try{T||null==v.return||v.return()}finally{if(f)throw g}}l()&&p()}});return function(){u.unsubscribe(),c.unsubscribe(),d.unsubscribe()}})),(0,g._)(i,"subscribe",i.result.subscribe.bind(i.result)),i.map=null!=(o=r.map)?o:function(e){return e},i.debug=r.debug,i}return(0,w._)(t,e),(0,f._)(t,[{key:Symbol.observable,value:function(){return this.result}}]),t}(G),V=function(e){function n(e,r,i,o){var a,s;return(0,T._)(this,n),a=(0,D._)(this,n,[{api:e,session:r,direction:"forward"===i.direction?1:-1,initial:i.state,transducer:i.reducer}]),(0,g._)(a,"window",void 0),(0,g._)(a,"map",void 0),(0,g._)(a,"debug",void 0),(0,g._)(a,"exhaustive",new m.Multicast(function(e){return P.Observable.combine(a.session.ids.select(function(e){return e.length}),a.window.size).select(function(e){var n=(0,t._)(e,2);return n[0]<=n[1]}).subscribe(e)})),(0,g._)(a,"result",new m.Multicast(function(e){var t=new L,n=null,r=null,i=new Map,o=new Set,s=function(){if(o.size){for(var s=a.indexed(t,Array.from(o)),l=s[0],p=0;l>=0&&l<t.length;){var u=t.get(l),c=u.id,d=l===s[0];if(p++,r&&r!==c&&t.dir(c,r)!==a.direction)break;d&&(s.shift(),o.delete(u.id));var y=a.step(t,i,u),T=y.ret,f=y.recomputing;if(!1===T){r=u.id;break}if(c===r&&(r=null),f||s.length){l=f?l+a.direction:s[0];continue}break}a.debug&&p&&(p=0)}if(t.length){var g,h,v=null!=r?r:null==(h=t.peek(a.direction))?void 0:h.id;g=v?i.get(v):void 0}else g=a.initial;if(void 0===g)throw Error("unexpected undefined");n!==g&&(n=g,e.next(a.map(g)))},l=a.window.events.lift(e,function(e){var n=t.patch(e);if(n){var a=!0,l=!1,p=void 0;try{for(var u,c=n.removed[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var d=u.value;i.delete(d.id),o.delete(d.id),d.id===r&&(r=null)}}catch(e){l=!0,p=e}finally{try{a||null==c.return||c.return()}finally{if(l)throw p}}var y=!0,T=!1,f=void 0;try{for(var g,h=n.added[Symbol.iterator]();!(y=(g=h.next()).done);y=!0){var v=g.value;o.add(v.id)}}catch(e){T=!0,f=e}finally{try{y||null==h.return||h.return()}finally{if(T)throw f}}var m=!0,S=!1,E=void 0;try{for(var b,R=n.changed[Symbol.iterator]();!(m=(b=R.next()).done);m=!0){var C=b.value;o.add(C.id)}}catch(e){S=!0,E=e}finally{try{m||null==R.return||R.return()}finally{if(S)throw E}}s()}});return function(){l.unsubscribe()}})),(0,g._)(a,"subscribe",a.result.subscribe.bind(a.result)),a.window=a.session.window(o),a.map=null!=(s=i.map)?s:function(e){return e},a.debug=i.debug,a}return(0,w._)(n,e),(0,f._)(n,[{key:"size",get:function(){return this.window.size}},{key:Symbol.observable,value:function(){return this.result}}]),n}(G),W=e.i(377930),H=function(e){function n(e,r,i,o){var a;return(0,T._)(this,n),a=(0,D._)(this,n,[{api:e,session:r,direction:"forward"===i.direction?1:-1,initial:i.state,transducer:i.transformer}]),(0,g._)(a,"window",void 0),(0,g._)(a,"debug",void 0),(0,g._)(a,"exhaustive",new m.Multicast(function(e){return P.Observable.combine(a.session.ids.select(function(e){return e.length}),a.window.size).select(function(e){var n=(0,t._)(e,2);return n[0]<=n[1]}).subscribe(e)})),(0,g._)(a,"state",new m.Multicast(function(e){var t=new L,n=new Map,r=new Map;return a.window.events.lift(e,function(i){var o=t.patch(i);if(o){var s=!1,l=!1,p=0;if(!t.length){s||(s=!!(n.size||r.size)),l||(l=s),s&&(n.clear(),r.clear(),e.next({events:t,transformed:r,scaled:s}));return}var u=!0,c=!1,d=void 0;try{for(var y,T=o.removed[Symbol.iterator]();!(u=(y=T.next()).done);u=!0){var f=y.value;s||(s=r.has(f.id)),l||(l=s),n.delete(f.id),r.delete(f.id)}}catch(e){c=!0,d=e}finally{try{u||null==T.return||T.return()}finally{if(c)throw d}}if(o.added.length||o.changed.length)for(var g=a.indexed(t,o.added.concat(o.changed)),h=g[0];h>=0&&h<t.length;){var v=h===g[0];v&&g.shift();var m=t.get(h),S=r.get(m.id),E=a.step(t,n,m),b=E.ret,R=E.recomputing;if((R||v)&&(void 0!==b?r.set(m.id,b):void 0!==S&&r.delete(m.id)),s||(s=!!S!=!!b),l||(l=R||v||s),p++,R||g.length){h=R?h+a.direction:g[0];continue}break}a.debug&&p&&(p=0),(s||l)&&e.next({events:t,transformed:r,scaled:s})}})})),(0,g._)(a,"tuples",new m.Multicast(function(e){var t=new Map,n=!0;return a.state.lift(e,function(r){if(r.scaled||n){n=!1;for(var i=[],o=0;o<r.events.length;o++){var s=r.events.get(o);if(s&&r.transformed.has(s.id)){var l,p=null!=(l=t.get(s.id))?l:a.create(s.id);t.set(s.id,p),i.push([s.id,p])}}e.next(i)}})})),(0,g._)(a,"flat",new m.Multicast(function(e){return a.state.lift(e,function(t){for(var n=[],r=0;r<t.events.length;r++){var i=t.events.get(r),o=i&&t.transformed.get(i.id);void 0!==o&&n.push(o)}e.next(n)})})),(0,g._)(a,"mapped",a.tuples.map(function(e){return new Map(e)})),(0,g._)(a,"subscribe",a.tuples.subscribe.bind(a.tuples)),a.window=a.session.window(o),a.debug=i.debug,a}return(0,w._)(n,e),(0,f._)(n,[{key:"size",get:function(){return this.window.size}},{key:"create",value:function(e){var t=this;return new m.Multicast(function(n){var r=W.None;return t.state.lift(n,function(t){var i=t.transformed.get(e);if(void 0===i)return n.complete();r!==i&&(r=i,n.next(i))})})}},{key:"map",value:function(e){var t=this;return new m.Multicast(function(n){var r=new Map,i=W.None;return t.state.lift(n,function(o){for(var a=[],s=0;s<o.events.length;s++){var l,p=null==(l=o.events.get(s))?void 0:l.id,u=p&&o.transformed.get(p);if(p&&u){var c=r.get(p);c||(c=t.create(p),r.set(p,c)),a.push({id:p,value:u,observable:c})}}var d=e(a);F(d,i)||(i=d,n.next(d))})})}},{key:"chunked",value:function(e){var n=this;return new m.Multicast(function(r){var i=null;return P.Observable.combine(n.mapped,n.state).lift(r,function(n){for(var o=(0,t._)(n,2),a=o[0],s=o[1],l=[],p=function(e){if(e<0||e>=s.events.length)return null;var t=s.events.get(e),n=s.transformed.get(t.id);return a.has(t.id)&&n?{event:t,transformed:n}:null},u=[],c=null,d=0;d<s.events.length;d++){var y=p(d);if(y){for(var T=null,f=d+1;f<s.events.length;f++)if(a.has(s.events.get(f).id)){T=p(f);break}var g=e(y,c,T);switch(c=y,g){case"continue":u.push(y.event.id);break;case"break":u.length&&(l.push(u),u=[]),u.push(y.event.id);break;case"isolate":u.length&&(l.push(u),u=[]),l.push([y.event.id])}}}u.length&&l.push(u),F(l,i)||(i=l,r.next(l.map(function(e){return e.map(function(e){return[e,a.get(e)]})})))})})}},{key:Symbol.observable,value:function(){return this.tuples}}]),n}(G),K=function(){function e(){(0,T._)(this,e),(0,g._)(this,"nodes",new Set),(0,g._)(this,"up",new Map),(0,g._)(this,"down",new Map),(0,g._)(this,"leafs",new Map)}return(0,f._)(e,[{key:"size",get:function(){return this.nodes.size}},{key:"ids",value:function(){return new Set(this.nodes.keys())}},{key:"has",value:function(e){return this.nodes.has(e)}},{key:"parent",value:function(e){var t;return null!=(t=this.up.get(e))?t:null}},{key:"children",value:function(e){var t;return null!=(t=this.down.get(e))?t:null}},{key:"siblings",value:function(e){var t=this.parent(e);return t?this.children(t):null}},{key:"hierarchy",value:function(e){for(var t=[e],n=e;this.up.has(n);)t.unshift(n=this.up.get(n));return t}},{key:"isLeaf",value:function(e){return this.leafs.has(e)}},{key:"latest",value:function(){var e=null,n=-1,r=!0,i=!1,o=void 0;try{for(var a,s=this.leafs[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=(0,t._)(a.value,2),p=l[0],u=l[1];u>n&&(e=p,n=u)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return e}},{key:"walk",value:function(e,t){if(!this.nodes.has(e))throw Error("node not in graph");if(!1!==t(e,this.isLeaf(e))){for(var n=this.children(e);(null==n?void 0:n.size)===1;){if(!1===t(e=n.values().next().value,this.isLeaf(e)))return;n=this.children(e)}if(null==n?void 0:n.size){var r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;this.walk(l,t)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}}}},{key:"append",value:function(e){var t=this.nodes.size,n=new Set,r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;if(!n.has(l.id)&&this.nodes.has(l.id)){var p=this.up.get(l.id);if(p&&p!==l.parent)throw Error("parent mismatch");continue}if(this.nodes.add(l.id),n.add(l.id),this.down.has(l.id)||this.leafs.set(l.id,l.priority),l.parent){this.leafs.delete(l.parent);var u=this.down.get(l.parent);u||(u=new Set,this.down.set(l.parent,u),this.nodes.add(l.parent),n.add(l.parent)),this.up.set(l.id,l.parent),u.add(l.id)}}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return this.nodes.size!==t}},{key:"clone",value:function(){var n=new e;n.nodes=new Set(this.nodes),n.up=new Map(this.up),n.leafs=new Map(this.leafs);var r=!0,i=!1,o=void 0;try{for(var a,s=this.down[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=(0,t._)(a.value,2),p=l[0],u=l[1];n.down.set(p,new Set(u))}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}]),e}(),z=function(){function e(){(0,T._)(this,e),(0,g._)(this,"queue",[]),(0,g._)(this,"locked",!1)}return(0,f._)(e,[{key:"acquire",value:function(){var e=this;return this.locked?new Promise(function(t){e.queue.push(t)}):(this.locked=!0,Promise.resolve())}},{key:"release",value:function(){if(this.queue.length>0){var e=this.queue.shift();null==e||e()}else this.locked=!1}},{key:"run",value:function(e){return(0,h._)(function(){return(0,v._)(this,function(t){switch(t.label){case 0:return[4,this.acquire()];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,,4,5]),[4,e()];case 3:return[2,t.sent()];case 4:return this.release(),[7];case 5:return[2]}})}).call(this)}},{key:"clear",value:function(){this.queue.length=0,this.locked=!1}}]),e}(),Y=e.i(99145),Q=e.i(862927),X={messageEventContents:{$kind:"messageEventContext",messageEventContext:Q.Value.Create(p.MessageEventContextSchema)},inlineActionEventContents:{$kind:"inlineActionEventContext",inlineActionEventContext:Q.Value.Create(p.InlineActionEventContextSchema)},shellSuggestionEventContents:{$kind:"shellSuggestionEventContext",shellSuggestionEventContext:Q.Value.Create(p.ShellSuggestionEventContextSchema)},sessionCreationEventContents:{$kind:"sessionCreationEventContext",sessionCreationEventContext:Q.Value.Create(p.SessionCreationEventContextSchema)},localShellExecutionEventContents:{$kind:"localShellExecutionEventContext",localShellExecutionEventContext:Q.Value.Create(p.LocalShellExecutionEventContextSchema)},translateEventContents:{$kind:"translateEventContext",translateEventContext:Q.Value.Create(p.TranslateEventContextSchema)},byoPromptEventContents:{$kind:"byoPromptEventContext",byoPromptEventContext:Q.Value.Create(p.BYOPromptEventContextSchema)},agentPlanEventContents:{$kind:"agentPlanEventContext",agentPlanEventContext:Q.Value.Create(p.AgentPlanEventContextSchema)},agentTimelineEventContents:{$kind:"agentTimelineEventContext",agentTimelineEventContext:Q.Value.Create(p.AgentTimelineEventContextSchema)},iterativeAgentEventContents:{$kind:"iterativeAgentEventContext",iterativeAgentEventContext:Q.Value.Create(p.IterativeAgentEventContextSchema)}},J=!0,Z=!1,ee=void 0;try{for(var et,en,er=Object.values(X)[Symbol.iterator]();!(J=(en=er.next()).done);J=!0){var ei=en.value;(0,a.freeze)(ei,!0)}}catch(e){Z=!0,ee=e}finally{try{J||null==er.return||er.return()}finally{if(Z)throw ee}}var eo=(0,a.freeze)(Q.Value.Create(p.EventSchema),!0),ea=function(){function e(){var t=this;(0,T._)(this,e),(0,g._)(this,"stockpile",new Map),(0,g._)(this,"registry",new FinalizationRegistry(function(e){t.stockpile.delete(e)})),(0,g._)(this,"listeners",new Y.ListenerList)}return(0,f._)(e,[{key:"empty",get:function(){return 0===this.stockpile.size}},{key:"has",value:function(e){var t;return this.stockpile.has(e)&&(null==(t=this.stockpile.get(e))?void 0:t.deref())!==void 0}},{key:"get",value:function(e){var t,n;return null!=(n=null==(t=this.stockpile.get(e))?void 0:t.deref())?n:null}},{key:"add",value:function(e){var t,n=null==(t=this.stockpile.get(e.id))?void 0:t.deref();return n===e?n:(n&&this.registry.unregister(n),this.stockpile.set(e.id,new WeakRef(e)),this.registry.register(e,e.id,e),this.listeners.notify(e),e)}},{key:"emplace",value:function(e){var t,n=null==(t=this.stockpile.get(e.id))?void 0:t.deref();return n||(this.stockpile.set(e.id,new WeakRef(e)),this.registry.register(e,e.id,e),this.listeners.notify(e),e)}},{key:"delete",value:function(e){var t=this.stockpile.get(e);if(t){this.stockpile.delete(e);var n=t.deref();n&&this.registry.unregister(n)}}},{key:"store",value:function(e){var t=this;null!=e||(e=[]),"string"==typeof e&&(e=[e]);var n=new Set,r=new Map,i=!0,o=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var p=s.value;n.add(p),r.set(p,this.get(p))}}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}var u=!1,c=this.listeners.add(function(e){n.has(e.id)&&r.set(e.id,e)});return(0,g._)({has:function(e){return n.has(e)},get:function(e){var t;return null!=(t=r.get(e))?t:null},track:function(e){if(u)throw Error("Store has been released");e=Array.isArray(e)?e:[e];var i=!0,o=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var p=s.value;n.add(p),r.set(p,t.get(p))}}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}},untrack:function(e){if(u)throw Error("Store has been released");e=Array.isArray(e)?e:[e];var t=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var l=a.value;l="string"==typeof l?l:l.id,n.delete(l),r.delete(l)}}catch(e){i=!0,o=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw o}}},release:function(){u||(u=!0,c(),n.clear(),r.clear())}},Symbol.iterator,function(){var e,t,i,o,a,s,l,p;return(0,v._)(this,function(u){switch(u.label){case 0:e=!0,t=!1,i=void 0,u.label=1;case 1:u.trys.push([1,6,7,8]),o=n[Symbol.iterator](),u.label=2;case 2:if(e=(a=o.next()).done)return[3,5];if(s=a.value,!(l=r.get(s)))return[3,4];return[4,l];case 3:u.sent(),u.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return p=u.sent(),t=!0,i=p,[3,8];case 7:try{e||null==o.return||o.return()}finally{if(t)throw i}return[7];case 8:return[2]}})})}},{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.stockpile.keys()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.delete(o)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}]),e}(),es={events:new(function(e){function t(){return(0,T._)(this,t),(0,D._)(this,t,arguments)}return(0,w._)(t,e),(0,f._)(t,[{key:"invalidate",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.stockpile.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value.deref();o&&o.state!==p.EventState.COMPLETE&&this.delete(o.id)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"create",value:function(e){var t,n,r;return this.add(((n=Object.assign({},eo)).id=e.eventId,n.parentEventId=e.parentEventId,n.sessionId=e.sessionId,n.state=e.state,n.error=e.error,n.sender=e.sender,n.contents=e.contents,n.created=new Date,(r=null==(t=e.contents.contents)?void 0:t.$kind)&&X[r]&&(n.context={metadata:X[r]}),n))}},{key:"update",value:function(e){var t=this.get(e.eventId);return t?this.add((0,I.applyEventUpdateMessage)(t,e)):null}}]),t}(ea)),sessions:new(function(e){function t(){return(0,T._)(this,t),(0,D._)(this,t,arguments)}return(0,w._)(t,e),(0,f._)(t,[{key:"invalidate",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.stockpile.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value.deref();o&&!o.archived&&this.delete(o.id)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"create",value:function(e){return this.add((0,_.createSessionFromCreateSessionMessage)(e))}},{key:"update",value:function(e){var t=this.get(e.sessionId);return t?this.add((0,_.applySessionUpdateMessage)(t,e)):null}}]),t}(ea))},el=function(){function e(t,n,r,i,o){var a=this;(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"id",void 0),(0,g._)(this,"eventId",void 0),(0,g._)(this,"parent",void 0),(0,g._)(this,"session",void 0),(0,g._)(this,"event",new m.Multicast(function(e){var t=es.events.store(a.eventId),n=a.api.materializer.get(a.eventId);n&&e.next(n);var r=a.api.state.register({snapshot:function(){return n},rollback:function(e){return n=e},notify:function(){n&&e.next(n)},update:function(e){if("event-modified"===e.kind&&e.event.id===a.eventId)return n=e.event,!0}}),i=a.api.connected.lift(e,function(t){return(0,h._)(function(){var i,o,a;return(0,v._)(this,function(s){switch(s.label){case 0:return(i=es.events.get(this.eventId))&&n!==i&&(n=i,r.commit(),e.next(n)),[4,(0,S.get)(this.api.materializer.materialize(this.parent.id,[this.eventId]))];case 1:if(o=s.sent(),t.aborted||(0,S.isError)(o,"UNEXPECTED_DISCONNECT"))return[2];if(!o.ok)return[2,this.api.error(o,e)];return a=es.events.emplace(o.payload[0]),n!==a&&(n=a,r.commit(),e.next(n)),[2]}})}).call(a)});return function(){t.release(),r.unsubscribe(),i.unsubscribe()}})),(0,g._)(this,"data",this.event.select(function(e){return e.contents.contents.subagentRunning})),(0,g._)(this,"kind",this.data.filter(function(e){return void 0!==e.contents}).select(function(e){return e.contents.$kind})),(0,g._)(this,"running",this.event.select(function(e){return e.state!==p.EventState.COMPLETE})),(0,g._)(this,"totalExecutionTimeSeconds",this.data.select(function(e){return e.totalExecutionTimeSeconds})),this.api=t,this.id=n,this.eventId=r,this.parent=i,this.session=o}return(0,f._)(e,[{key:"contents",value:function(e){return this.data.filter(function(t){var n;return(null==(n=t.contents)?void 0:n.$kind)===e}).select(function(e){return(0,k.unkind)(e.contents)})}},{key:"abort",value:function(){return(0,h._)(function(){var e;return(0,v._)(this,function(t){switch(t.label){case 0:return[4,this.api.service.abortSubagent.rpc({replId:this.api.replId,sessionId:this.parent.id,subagentId:this.id})];case 1:if(!(e=t.sent()).ok)return[2,this.api.error(e)];return[2,(0,S.Ok)(null)]}})}).call(this)}}],[{key:"create",value:function(t,n,r,i,o){var a=this.subagents.get(t);a||(a=new Map,this.subagents.set(t,a));var s=a.get(n),l=null==s?void 0:s.deref();if(s&&l||(s=new WeakRef(l=new e(t,n,r,i,o)),a.set(n,s)),l.eventId!==r)throw Error("Subagent event ID mismatch");if(l.parent!==i)throw Error("Subagent parent mismatch");if(l.session!==o)throw Error("Subagent session mismatch");return l}}]),e}();(0,g._)(el,"subagents",new WeakMap);var ep=e.i(790164),eu=function(){function e(n,r,i){var o=this;(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"session",void 0),(0,g._)(this,"size",void 0),(0,g._)(this,"events",new m.Multicast(function(e){var n=new j,r=new L,i=function(e){var t=(null==e?void 0:e.length)?new Map(e.map(function(e){return[e.id,e]})):null,i=r.adopt(n,t);return!!i&&(i.missing.length&&o.api.materializer.enqueue(o.session.id,i.missing),!0)},a=o.api.state.register({snapshot:function(){return{ids:n.clone(),events:r.clone()}},rollback:function(e){n=e.ids,r=e.events},notify:function(){return e.next(r)},update:function(e){if("event-modified"===e.kind&&n.has(e.event.id))return i([e.event])}}),s=o.api.materializer.events.lift(e,function(t){var o=t.filter(function(e){var t=e.id;return n.has(t)});o.length&&i(o)&&e.next(r)}),l=P.Observable.combine(o.session.ids,o.size).lift(e,function(a){var s=(0,t._)(a,2),l=s[0],p=s[1],u=l.length?l.id(Math.max(0,l.length-p)):null,c=n.patch(l,u);c&&i(c.added.map(function(e){return o.api.materializer.get(e)}).filter(function(e){return null!==e}))&&e.next(r)});return function(){a.unsubscribe(),s.unsubscribe(),l.unsubscribe()}})),(0,g._)(this,"subscribe",this.events.subscribe.bind(this.events)),this.api=n,this.session=r,this.size=new ep.ObservableState(i)}return(0,f._)(e,[{key:Symbol.observable,value:function(){return this.events}}]),e}();function ec(e){var t=e.api,n=e.sessionId,r=e.tip,i=e.onGraphFetched;return new m.Multicast(function(e){var o=!0,a=!0,s=new K,l=function(){if(r&&!s.has(r))return t.error("Tip event ".concat(r," not found in graph"),e);var n=null!=r?r:s.latest();if(!n)return t.error("Unexpected empty graph",e);var i=s.hierarchy(n),o=new j;o.append(i),e.next(o)},p=t.state.register({snapshot:function(){return s.clone()},rollback:function(e){return s=e},notify:function(){return l()},update:function(e){if(!a&&"event-modified"===e.kind&&"created"===e.type&&e.event.sessionId===n)return s.append([{id:e.event.id,parent:e.event.parentEventId,priority:e.event.created.getTime()}])}}),u=t.connected.lift(e,function(u){return(0,h._)(function(){var c,d,y,T,f,g,h,m,E,b,R,C,I,O,A,_,k,U,N,D,w;return(0,v._)(this,function(v){switch(v.label){case 0:if(f=Date.now(),p.rollback(),a=!0,null==(c=(d=t.logger).info)||c.call(d,r?"Starting to fetch session graph from tip":"Starting to fetch session graph",{sessionId:n,tip:r}),g=0,h=!1,m=null!=r?r:null,E=[],!r)return[3,2];return[4,t.service.batchGetEvents.rpc({sessionId:n,eventIds:[r]})];case 1:if(b=v.sent(),u.aborted||(0,S.isError)(b,"UNEXPECTED_DISCONNECT"))return[2];if(!b.ok)return[2,t.error(b,e)];b.payload.events.length>0&&(R=b.payload.events[0],E.push({id:R.id,parent:R.parentEventId||null,priority:R.created.getTime()})),v.label=2;case 2:C=200,v.label=3;case 3:if(!(C>0))return[3,6];return g++,[4,t.service.getEventList.rpc({sessionId:n,limit:500,AncestorsOf:m?{$kind:"ancestorsOf",ancestorsOf:m}:void 0})];case 4:if(I=v.sent(),(u.aborted||!I.ok)&&(null==(O=(A=t.logger).info)||O.call(A,r?"Aborted fetching session graph from tip":"Aborted fetching session graph",{sessionId:n,tip:r,numPagesFetched:g,amountFetched:E.length,duration:Date.now()-f})),u.aborted||(0,S.isError)(I,"UNEXPECTED_DISCONNECT"))return[2];if(!I.ok)return[2,t.error(I,e)];_=!0,k=!1,U=void 0;try{for(N=I.payload.shapes[Symbol.iterator]();!(_=(D=N.next()).done);_=!0)w=D.value,E.push({id:w.id,parent:w.parentEventId||null,priority:w.created.getTime()})}catch(e){k=!0,U=e}finally{try{_||null==N.return||N.return()}finally{if(k)throw U}}if(I.payload.shapes.length<500||(m=I.payload.shapes[I.payload.shapes.length-1].id,s.has(m)))return[3,6];v.label=5;case 5:return C--,[3,3];case 6:return E.length&&(h=s.append(E)),a=!1,(h||o)&&(o=!1,p.commit(),l()),null==(y=(T=t.logger).info)||y.call(T,r?"Finished fetching session graph from tip":"Finished fetching session graph",{sessionId:n,tip:r,numPagesFetched:g,amountFetched:E.length,duration:Date.now()-f}),null==i||i(Date.now()-f,E.length),[2]}})})()});return function(){p.unsubscribe(),u.unsubscribe()}})}var ed=function(){function e(t,n,r){var i=this;(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"agent",void 0),(0,g._)(this,"id",void 0),(0,g._)(this,"created",void 0),(0,g._)(this,"mutex",new z),(0,g._)(this,"data",new m.Multicast(function(e){var t=null,n=es.sessions.get(i.id);n&&(t=(0,_.compatSessionToData)(n),e.next(n));var r=i.api.state.register({snapshot:function(){return t},rollback:function(e){return t=e},notify:function(){t&&e.next((0,_.compatDataToSession)(i.api.replId,t))},update:function(e){if(t&&e.optimistic&&"session-modified"===e.kind&&e.session.id===i.id){var n=(0,R.create)(t,function(t){t.title=e.session.title,t.archived=e.session.archived,t.readOnly=e.session.readOnly,t.taskId=e.session.taskId}),r=t!==n;return t=n,r&&(t.updated=new Date),r}}}),o=i.api.connected.lift(e,function(n){return(0,h._)(function(){var i,o,a,s,l,p,u,c,d,y,T,f,g;return(0,v._)(this,function(h){switch(h.label){case 0:return i=this,[4,(0,C.getSyncResult)(this.api.chort.sessions.data.subscribe({sessionId:this.id},{signal:n}))];case 1:if(a=(o=h.sent()).snapshot,s=o.deltas,(0,S.isError)(a,"UNEXPECTED_DISCONNECT","CANCEL"))return[2];if(!a.ok)return[2,this.api.error(a,e)];es.sessions.add((0,_.compatDataToSession)(this.api.replId,a.payload)),r.rollback(),r.rebase(function(){return t=a.payload,!0}),l=!1,p=!1,h.label=2;case 2:h.trys.push([2,7,8,13]),d=function(){var n=T.value;if((0,S.isError)(n,"UNEXPECTED_DISCONNECT","CANCEL"))return{v:void 0};if(!n.ok)return{v:c.api.error(n,e)};var o=n.payload;if(!t)return{v:c.api.error(Error("Unexpected: no data"),e)};r.rebase(function(){var e=(0,R.apply)(t,o),n=t!==e;return t=e,n&&es.sessions.add((0,_.compatDataToSession)(i.api.replId,t)),n})},y=(0,E._)(s),h.label=3;case 3:return[4,y.next()];case 4:if(!(l=!(T=h.sent()).done))return[3,6];if(c=this,f=d(),"object"===(0,b._)(f))return[2,f.v];h.label=5;case 5:return l=!1,[3,3];case 6:return[3,13];case 7:return g=h.sent(),p=!0,u=g,[3,13];case 8:if(h.trys.push([8,,11,12]),!(l&&null!=y.return))return[3,10];return[4,y.return()];case 9:h.sent(),h.label=10;case 10:return[3,12];case 11:if(p)throw u;return[7];case 12:return[7];case 13:return[2]}})}).call(i)});return function(){r.unsubscribe(),o.unsubscribe()}})),(0,g._)(this,"type",this.data.select(function(e){return e.sessionType})),(0,g._)(this,"ids",void 0),(0,g._)(this,"leaf",void 0),this.api=t,this.agent=new N(t,this),this.id=n,this.created=r,this.ids=ec({api:this.api,sessionId:this.id,onGraphFetched:function(e,t){i.api.hooks.trigger("session-graph-fetched",{session:i,duration:e,size:t})}}),this.leaf=this.ids.select(function(e){return e.last}).filter(function(e){return null!==e}),this.api.teardown(function(){return i.mutex.clear()})}return(0,f._)(e,[{key:"subagent",value:function(t,n,r,i){return el.create(this.api,t,n,this,e.create(this.api,r,i))}},{key:"window",value:function(e){return new eu(this.api,this,e)}},{key:"from",value:function(e){return new ey(this,e)}},{key:"reduce",value:function(e,t){return"global"===t?new $(this.api,this,e):new V(this.api,this,e,t)}},{key:"transform",value:function(e,t){return new H(this.api,this,e,t)}},{key:"updateSession",value:function(e){return(0,h._)(function(){var n,r,i,o,a,s,l,p,u;return(0,v._)(this,function(c){switch(c.label){case 0:return[4,(0,S.get)(this.data)];case 1:if(!(n=c.sent()).ok)return[2,this.api.error(n)];if(r=n.payload,o=(i=(0,_.createUpdateSessionRequest)(r,e)).session,a=i.request,r===o)return[2,(0,S.Ok)(r)];return l=(s=(0,t._)(this.api.state.stage({kind:"session-modified",type:"updated",session:o}),2))[0],p=s[1],[4,this.api.service.updateSession.rpc(a)];case 2:if(!(u=c.sent()).ok)return p(),[2,this.api.error(u)];return l(),this.api.hooks.trigger("client-updated-session",{session:this,request:a,prev:r,next:o}),[2,(0,S.Ok)(o)]}})}).call(this)}},{key:"updateEvent",value:function(e){var n=this;return this.mutex.run(function(){return(0,h._)(function(){var n,r,i,o,a,s,l,p,u,c,d,y;return(0,v._)(this,function(T){switch(T.label){case 0:return[4,(0,S.get)(this.ids.map(function(t){return t.has(e.id)}))];case 1:if(!(n=T.sent()).ok)return[2,this.api.error(n)];if(!n.payload)return[2,this.api.error("Event does not exist in the session")];return[4,(0,S.get)(this.api.materializer.materialize(this.id,[e.id]))];case 2:if(!(r=T.sent()).ok)return[2,this.api.error(r)];if(i=(0,t._)(r.payload,1)[0],o=(0,A.createUpdateEventRequest)(e),(a=(0,I.applyEventUpdateMessage)(i,o))===i)return[2,(0,S.Ok)(a)];return l=(s=(0,t._)(this.api.state.stage({kind:"event-modified",type:"updated",event:a}),2))[0],p=s[1],[4,this.api.service.updateEvent.upload()];case 3:return c=(u=t._.apply(void 0,[T.sent(),2]))[0],d=u[1],c.push(o),c.end(),[4,d];case 4:if(!(y=T.sent()).ok)return p(),[2,this.api.error(y)];return this.api.hooks.trigger("client-updated-event",{session:this,request:o,prev:i,next:a}),l(),[2,(0,S.Ok)(a)]}})}).call(n)})}},{key:"appendEvent",value:function(e,n){var r=this;return this.mutex.run(function(){return(0,h._)(function(){var r,i,o,a,s,l,u,c,d,y,T,f,g;return(0,v._)(this,function(h){switch(h.label){case 0:return[4,(0,S.get)([this.leaf,this.data.select(function(e){return e.sessionType})])];case 1:if(!(r=h.sent()).ok)return[2,this.api.error(r)];if(o=(i=(0,t._)(r.payload,2))[0],a=i[1],void 0!==e.modelType&&a===p.SessionType.AGENT_SESSION)return[2,this.api.error("Agent sessions do not support model type configuration")];if(s=p.ModelType.BASIC,e.modelType===p.ModelType.ADVANCED&&(s=this.api.hasAdvancedModel.current?this.api.overrideModel.current?{type:p.ModelType.OVERRIDE,overrideModelName:this.api.overrideModel.current}:p.ModelType.ADVANCED:p.ModelType.BASIC),e.modelType===p.ModelType.OVERRIDE){if(!this.api.overrideModel.current)return[2,this.api.error("No override model set")];s={type:p.ModelType.OVERRIDE,overrideModelName:this.api.overrideModel.current}}return u=(l=(0,O.createEventRequest)({session:this.id,sender:this.api.user.current,addToChild:!0,parent:o,model:s,data:e,benchmark:n})).event,c=l.request,y=(d=(0,t._)(this.api.state.stage({kind:"event-modified",type:"created",event:u,condition:function(e){return!("event-modified"===e.kind&&"created"===e.type&&(e.event.id===u.id?e.event.parentEventId!==u.parentEventId:e.event.parentEventId===u.parentEventId))}}),2))[0],T=d[1],[4,this.api.service.createEvent.rpc(c)];case 2:if(!(f=h.sent()).ok)return T(),[2,this.api.error(f)];if(f.payload.eventId===u.id&&f.payload.parentEventId===u.parentEventId)return[3,4];return T(),[4,(0,S.get)(this.api.materializer.materialize(this.id,[f.payload.eventId]))];case 3:if(!(g=h.sent()).ok)return[2,this.api.error(g)];return this.api.hooks.trigger("client-appended-event",{session:this,event:g.payload[0]}),[2,(0,S.Ok)(g.payload[0])];case 4:return y(),this.api.hooks.trigger("client-appended-event",{session:this,event:u}),[2,(0,S.Ok)(u)]}})}).call(r)})}},{key:"abortLastEvent",value:function(){var e=this;return this.mutex.run(function(){return(0,h._)(function(){var e,t;return(0,v._)(this,function(n){switch(n.label){case 0:return[4,(0,S.get)(this.leaf)];case 1:if(!(e=n.sent()).ok)return[2,this.api.error(e)];return[4,this.api.service.abortEvent.rpc({eventId:e.payload})];case 2:if(!(t=n.sent()).ok)return[2,this.api.error(t)];return[2,(0,S.Ok)(null)]}})}).call(e)})}},{key:"submitUserFeedback",value:function(e){return(0,h._)(function(){var n,r,i,o,a;return(0,v._)(this,function(s){switch(s.label){case 0:return[4,(0,S.get)([this.data.select(function(e){return e.sessionType}),this.leaf])];case 1:if(!(n=s.sent()).ok)return[2,this.api.error(n)];return i=(r=(0,t._)(n.payload,2))[0],o=r[1],[4,this.api.service.submitAgentUserFeedback.rpc({sessionId:this.id,sessionType:i,feedback:e,sourceEventId:o})];case 2:if(!(a=s.sent()).ok)return[2,this.api.error(a)];return[2,(0,S.Ok)(null)]}})}).call(this)}}],[{key:"create",value:function(t,n,r){var i=this.sessions.get(t);i||(i=new Map,this.sessions.set(t,i));var o=i.get(n),a=null==o?void 0:o.deref();return o&&a||(o=new WeakRef(a=new e(t,n,r)),i.set(n,o)),a}}]),e}();(0,g._)(ed,"sessions",new WeakMap);var ey=function(){function e(t,n){(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"id",void 0),(0,g._)(this,"tip",void 0),(0,g._)(this,"session",void 0),(0,g._)(this,"ids",void 0),this.api=t.api,this.id=t.id,this.tip=n,this.session=t,this.ids=ec({api:this.api,sessionId:this.id,tip:this.tip})}return(0,f._)(e,[{key:"window",value:function(e){return new eu(this.api,this,e)}},{key:"reduce",value:function(e,t){return"global"===t?new $(this.api,this,e):new V(this.api,this,e,t)}},{key:"transform",value:function(e,t){return new H(this.api,this,e,t)}}]),e}(),eT=function(){function e(t){var n,r,i,o,a=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"archived",void 0),(0,g._)(this,"readonly",void 0),(0,g._)(this,"limit",void 0),(0,g._)(this,"types",void 0),(0,g._)(this,"map",new m.Multicast(function(e){var t=!1,n=es.sessions.store(),r=new Map,i=a.api.state.register({snapshot:function(){return new Map(r)},rollback:function(e){r=new Map(e);var t=n;n=es.sessions.store(Array.from(r.keys())),t.release()},notify:function(){return e.next(new Map(r))},update:function(e){if(t&&"session-modified"===e.kind){var n=e.session,i=a.types.includes(n.sessionType)&&(null===a.archived||n.archived===a.archived)&&(null===a.readonly||n.readOnly===a.readonly);if(!r.has(n.id)&&i)return r.set(n.id,ed.create(a.api,n.id,n.created)),!0;if(r.has(n.id)&&!i)return r.delete(n.id),!0}}}),o=a.api.connected.lift(e,function(o){a.api.queryFetchCounter.scope(function(){return(0,h._)(function(){var a,s,l,p,u,c,d,y,T,f,g,h,m,E,b,R,C;return(0,v._)(this,function(v){switch(v.label){case 0:return[4,this.api.service.getReplSessions.rpc({beforeTimestamp:new Date("2099-01-01"),limit:this.limit,includeFirstSessionEvents:!1,firstSessionEventsLimit:1,replId:this.api.replId,sessionTypes:this.types,archived:null!=(a=this.archived)?a:void 0})];case 1:if(s=v.sent(),o.aborted||(0,S.isError)(s,"UNEXPECTED_DISCONNECT"))return[2];if(!s.ok)return[2,this.api.error(s,e)];i.rollback(),l=new Set(r.keys()),p=!1,u=!0,c=!1,d=void 0;try{for(y=s.payload.sessions[Symbol.iterator]();!(u=(T=y.next()).done);u=!0)(f=T.value).events=[],es.sessions.emplace(f),(null===this.readonly||f.readOnly===this.readonly)&&(l.delete(f.id),r.has(f.id)||(g=ed.create(this.api,f.id,f.created),n.track(f.id),r.set(f.id,g),p=!0))}catch(e){c=!0,d=e}finally{try{u||null==y.return||y.return()}finally{if(c)throw d}}h=!0,m=!1,E=void 0;try{for(b=l[Symbol.iterator]();!(h=(R=b.next()).done);h=!0)C=R.value,n.untrack(C),r.delete(C),p=!0}catch(e){m=!0,E=e}finally{try{h||null==b.return||b.return()}finally{if(m)throw E}}return(p||!t)&&(t=!0,i.commit(),e.next(new Map(r))),[2]}})}).call(a)})});return function(){n.release(),i.unsubscribe(),o.unsubscribe()}})),(0,g._)(this,"list",this.map.select(function(e){return Array.from(e.values()).sort(function(e,t){return t.created.getTime()-e.created.getTime()})},function(e,t){return e.length===t.length&&e.every(function(e,n){return e===t[n]})})),(0,g._)(this,"latest",this.map.select(function(e){var t=null,n=!0,r=!1,i=void 0;try{for(var o,a=e.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;(!t||s.created>t.created)&&(t=s)}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return t})),(0,g._)(this,"subscribe",this.map.subscribe.bind(this.map)),this.api=t,this.archived=null!=(n=s.archived)?n:null,this.readonly=null!=(r=s.readonly)?r:null,this.limit=null!=(i=s.limit)?i:1e3,this.types=null!=(o=s.types)?o:[p.SessionType.CHAT,p.SessionType.AGENT_SESSION]}return(0,f._)(e,[{key:Symbol.observable,value:function(){return this.map}}]),e}(),ef=e.i(167626),eg=e.i(878420),eh=e.i(64386),ev=e.i(886513),em=function(){function e(){(0,T._)(this,e),(0,g._)(this,"__brand",void 0)}return(0,f._)(e,[{key:"is",value:function(e){return"effect"===e.kind&&e.effect===this}}]),e}(),eS=function(){function e(n){var r=this;(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"handles",new Map),(0,g._)(this,"onUpdateHandlers",null),(0,g._)(this,"refs",new Set),(0,g._)(this,"buffer",[]),(0,g._)(this,"conditions",new Set),(0,g._)(this,"listeners",new Y.ListenerList),(0,g._)(this,"optimistic",!1),(0,g._)(this,"emitter",new P.Observable(function(e){return r.api.connected.lift(e,function(n){return(0,h._)(function(){var r,i,o,a,s,l,u,c,d,y,T,f,g,h,m,b,R,C,I,O,A,_,N,D,w;return(0,v._)(this,function(v){switch(v.label){case 0:return r=es.events.store(),i=es.sessions.store(),[4,this.api.service.subscribeToReplEvents.subscribe({replId:this.api.replId})];case 1:if(a=(o=t._.apply(void 0,[v.sent(),2]))[0],s=o[1],l=function(){s(),r.release(),i.release()},n.aborted)return[2,l()];n.addEventListener("abort",s),u=!1,c=!1,v.label=2;case 2:v.trys.push([2,7,8,13]),y=(0,E._)(a),v.label=3;case 3:return[4,y.next()];case 4:if(!(u=!(T=v.sent()).done)||(f=T.value,n.aborted||(0,S.isError)(f,"UNEXPECTED_DISCONNECT")))return[3,6];if(!f.ok)return this.api.error(f,e),[3,6];if(!f.payload.message)return[3,5];if(g=void 0,h=(0,k.unwrapKind)(f.payload.message),f.payload.sender.type!==p.UserType.USER)switch(h.$kind){case"createEventMessage":case"updateEventMessage":this.api.hooks.trigger("agent-activity",{type:"modify-event"});break;case"createSessionMessage":case"updateSessionMessage":this.api.hooks.trigger("agent-activity",{type:"modify-session"});break;case"updateAgentStateMessage":this.api.hooks.trigger("agent-activity",{type:"modify-state"})}switch(h.$kind){case"subscriptionStatusMessage":case"abortEventMessage":return[3,5];case"createEventMessage":(m=es.events.create(h)).state===p.EventState.COMPLETE?this.api.hooks.trigger("received-completed-event",{event:m}):this.api.hooks.has("received-completed-event")&&r.track(m.id),void 0===m.contents.contents&&this.api.hooks.has("received-event")?i.track(m.id):this.api.hooks.trigger("received-event",{event:m}),g={kind:"event-modified",optimistic:!1,type:"created",event:m};break;case"updateEventMessage":if(!(b=es.events.update(h)))return[3,5];r.has(b.id)&&b.state===p.EventState.COMPLETE&&(r.untrack(b.id),this.api.hooks.trigger("received-completed-event",{event:b})),i.has(b.id)&&void 0!==b.contents.contents&&(i.untrack(b.id),this.api.hooks.trigger("received-event",{event:b})),g={kind:"event-modified",optimistic:!1,type:"updated",event:b};break;case"createSessionMessage":g={kind:"session-modified",optimistic:!1,type:"created",session:es.sessions.create(h)};break;case"updateSessionMessage":if(!(R=es.sessions.update(h)))return[3,5];g={kind:"session-modified",optimistic:!1,type:"updated",session:R};break;case"updateAgentStateMessage":C=U(h),this.api.hooks.trigger("agent-state-changed",{sessionId:h.sessionId,state:C}),g={kind:"agent-state-modified",optimistic:!1,session:h.sessionId,state:C}}I=!0,O=!1,A=void 0;try{for(_=this.conditions[Symbol.iterator]();!(I=(N=_.next()).done);I=!0)if(D=N.value,!1===D(g)){this.rollback();break}}catch(e){O=!0,A=e}finally{try{I||null==_.return||_.return()}finally{if(O)throw A}}e.next(g),v.label=5;case 5:return u=!1,[3,3];case 6:return[3,13];case 7:return w=v.sent(),c=!0,d=w,[3,13];case 8:if(v.trys.push([8,,11,12]),!(u&&null!=y.return))return[3,10];return[4,y.return()];case 9:v.sent(),v.label=10;case 10:return[3,12];case 11:if(c)throw d;return[7];case 12:return[7];case 13:return n.removeEventListener("abort",l),l(),[2]}})}).call(r)})})),(0,g._)(this,"updates",new m.StatelessMulticast(function(e){var t=r.listeners.add(function(t){e.next(t)}),n=r.emitter.subscribe(e);return function(){t(),n.unsubscribe()}})),this.api=n;var i=this.api.status.subscribe(function(e){"connected"!==e&&(es.events.invalidate(),es.sessions.invalidate(),r.optimistic&&r.rollback())}),o=null,a=this.api.hooks.subscribe(function(e){if("agent-state-changed"===e.type||"received-completed-event"===e.type||"received-event"===e.type){var t=r.api.hooks.has("agent-state-changed")||r.api.hooks.has("received-completed-event")||r.api.hooks.has("received-event");t&&!o?o=r.updates.subscribe(function(){}):!t&&o&&(o.unsubscribe(),o=null)}});this.api.teardown(function(){i.unsubscribe(),a(),null==o||o.unsubscribe()})}return(0,f._)(e,[{key:"isOptimisticEvent",value:function(e){var t=this.buffer.filter(function(e){return"event-modified"===e.kind}).find(function(t){return t.event.id===e});return!!t&&t.type}},{key:"getOptimisticEvent",value:function(e){var t=this.buffer.filter(function(e){return"event-modified"===e.kind}).find(function(t){return t.event.id===e});if(!t)throw Error("Event not found in optimistic state");return t.event}},{key:"apply",value:function(e){var n=new Set,r=!0,i=!1,o=void 0;try{for(var a,s=this.handles[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l,p=(0,t._)(a.value,2),u=p[0],c=p[1];if(e.optimistic&&c!==W.None){(null==(d=u.update)?void 0:d.call(u,e))&&n.add(u);continue}if(e.optimistic&&c===W.None){var d,y,T=u.snapshot();(null==(y=u.update)?void 0:y.call(u,e))&&(this.handles.set(u,T),n.add(u));continue}if(!e.optimistic&&c!==W.None){u.rollback(c),(null==(m=u.update)?void 0:m.call(u,e))&&n.add(u);var f=u.snapshot(),g=!0,h=!1,v=void 0;try{for(var m,S,E=this.buffer[Symbol.iterator]();!(g=(S=E.next()).done);g=!0){var b,R=S.value;(null==(b=u.update)?void 0:b.call(u,R))&&(this.handles.set(u,f),n.add(u))}}catch(e){h=!0,v=e}finally{try{g||null==E.return||E.return()}finally{if(h)throw v}}continue}!e.optimistic&&c===W.None&&(null==(l=u.update)?void 0:l.call(u,e))&&n.add(u)}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}var C=!0,I=!1,O=void 0;try{for(var A,_=n[Symbol.iterator]();!(C=(A=_.next()).done);C=!0){var k,U=A.value;null==(k=U.notify)||k.call(U)}}catch(e){I=!0,O=e}finally{try{C||null==_.return||_.return()}finally{if(I)throw O}}}},{key:"rollback",value:function(){if(!this.optimistic)throw Error("Cannot rollback while not optimistic");this.optimistic=!1,this.buffer.length=0,this.refs.clear(),this.conditions.clear();var e=new Set,n=!0,r=!1,i=void 0;try{for(var o,a=this.handles[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=(0,t._)(o.value,2),l=s[0],p=s[1];p!==W.None&&(l.rollback(p),this.handles.set(l,W.None),e.add(l))}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}var u=!0,c=!1,d=void 0;try{for(var y,T=e[Symbol.iterator]();!(u=(y=T.next()).done);u=!0){var f,g=y.value;null==(f=g.notify)||f.call(g)}}catch(e){c=!0,d=e}finally{try{u||null==T.return||T.return()}finally{if(c)throw d}}}},{key:"commit",value:function(){if(!this.optimistic)throw Error("Cannot commit while not optimistic");var e=!0,t=!1,n=void 0;try{for(var r,i=this.buffer[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;switch(o.kind){case"event-modified":es.events.emplace(o.event);break;case"session-modified":es.sessions.emplace(o.session)}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this.optimistic=!1,this.buffer.length=0,this.refs.clear(),this.conditions.clear();var a=!0,s=!1,l=void 0;try{for(var p,u=this.handles.keys()[Symbol.iterator]();!(a=(p=u.next()).done);a=!0){var c=p.value;this.handles.set(c,W.None)}}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}}},{key:"stage",value:function(e,t){var n,r=this;if((0,ef._)(e,em))n={kind:"effect",effect:e,data:t};else if(e)n=e;else throw Error("Invalid effect or update");if("connected"!==this.api.status.current)throw Error("Cannot notify while not connected");var i=n.condition,o=(0,ev._)(n,["condition"]),a=(0,eh._)((0,eg._)({},o),{optimistic:!0});this.buffer.push(a),i&&this.conditions.add(i);var s=function(e){r.refs.has(s)&&(r.refs.delete(s),e?0===r.refs.size&&r.commit():(r.rollback(),r.api.hooks.trigger("client-state-rollback",{failed:a})),i&&r.conditions.delete(i))};return this.refs.add(s),this.optimistic=!0,this.listeners.notify(a),[function(){return s(!0)},function(){return s(!1)}]}},{key:"register",value:function(e){var t=this;return null!=this.onUpdateHandlers||(this.onUpdateHandlers=this.updates.subscribe(function(e){t.apply(e)})),this.handles.set(e,W.None),this.optimistic&&e.update&&Promise.resolve().then(function(){if(t.handles.has(e)&&t.optimistic){var n,r=e.snapshot(),i=!1,o=!0,a=!1,s=void 0;try{for(var l,p=t.buffer[Symbol.iterator]();!(o=(l=p.next()).done);o=!0){var u,c=l.value;(null==(u=e.update)?void 0:u.call(e,c))&&(i=!0)}}catch(e){a=!0,s=e}finally{try{o||null==p.return||p.return()}finally{if(a)throw s}}i&&(t.handles.set(e,r),null==(n=e.notify)||n.call(e))}}),{get optimistic(){return t.handles.get(e)!==W.None},rollback:function(){var n=t.handles.get(e);n!==W.None&&(e.rollback(n),t.handles.set(e,W.None))},commit:function(){t.handles.set(e,W.None)},rebase:function(n){var r=t.handles.get(e);if(r===W.None){n()&&(null==(c=e.notify)||c.call(e));return}var i=e.snapshot();if(e.rollback(r),t.handles.set(e,W.None),!n()){t.handles.set(e,r),e.rollback(i);return}var o=!1,a=e.snapshot(),s=!0,l=!1,p=void 0;try{for(var u,c,d,y=t.buffer[Symbol.iterator]();!(s=(d=y.next()).done);s=!0){var T,f=d.value;(null==(T=e.update)?void 0:T.call(e,f))&&!o&&(t.handles.set(e,a),o=!0)}}catch(e){l=!0,p=e}finally{try{s||null==y.return||y.return()}finally{if(l)throw p}}null==(u=e.notify)||u.call(e)},unsubscribe:function(){if(t.handles.delete(e),0===t.handles.size){var n;null==(n=t.onUpdateHandlers)||n.unsubscribe(),t.onUpdateHandlers=null}}}}}]),e}(),eE=new em,eb=new em,eR=new em,eC=function(){function e(t){var n=this;(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"state",new m.Multicast(function(e){var t=null,r=n.api.state.register({snapshot:function(){return t},rollback:function(e){return t=e},notify:function(){t&&e.next(t)},update:function(e){if(t){if(eE.is(e)){var n=(0,R.create)(t,function(t){var n=t.find(function(t){return t.id===e.data.id});n&&(n.contents=e.data.contents)}),r=n!==t;return t=n,r}if(eb.is(e)){var i=(0,R.create)(t,function(t){var n=!0,r=!1,i=void 0;try{for(var o,a=e.data.ids[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)!function(){var e=o.value,n=t.findIndex(function(t){return t.id===e});-1!==n&&t.splice(n,1)}()}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}),o=i!==t;return t=i,o}if(eR.is(e)){var a=(0,R.create)(t,function(t){var n=t.findIndex(function(t){return t.id===e.data.id}),r=t[n];if(r){if(null===e.data.after){t.splice(n,1),t.unshift(r);return}var i=t.findIndex(function(t){return t.id===e.data.after});-1!==i&&(n<i&&i--,t.splice(n,1),t.splice(i+1,0,r))}}),s=a!==t;return t=a,s}}}}),i=n.api.connected.lift(e,function(i){return(0,h._)(function(){var n,o,a,s,l,p,u,c,d,y;return(0,v._)(this,function(T){switch(T.label){case 0:n=this.api.chort.queue.state.subscribe({},{signal:i}).resReadable,o=!1,a=!1,T.label=1;case 1:T.trys.push([1,6,7,12]),p=function(){var n=c.value;return(0,S.isError)(n,"UNEXPECTED_DISCONNECT","CANCEL")?{v:void 0}:n.ok?void r.rebase(function(){return t=n.payload,!0}):{v:l.api.error(n,e)}},u=(0,E._)(n),T.label=2;case 2:return[4,u.next()];case 3:if(!(o=!(c=T.sent()).done))return[3,5];if(l=this,d=p(),"object"===(0,b._)(d))return[2,d.v];T.label=4;case 4:return o=!1,[3,2];case 5:return[3,12];case 6:return y=T.sent(),a=!0,s=y,[3,12];case 7:if(T.trys.push([7,,10,11]),!(o&&null!=u.return))return[3,9];return[4,u.return()];case 8:T.sent(),T.label=9;case 9:return[3,11];case 10:if(a)throw s;return[7];case 11:return[7];case 12:return[2]}})}).call(n)});return function(){i(),r.unsubscribe()}})),this.api=t}return(0,f._)(e,[{key:"get",value:function(){return(0,h._)(function(){var e;return(0,v._)(this,function(t){switch(t.label){case 0:return[4,this.api.chort.queue.get.rpc({})];case 1:if(!(e=t.sent()).ok)return[2,this.api.error(e)];return[2,(0,S.Ok)(e.payload)]}})}).call(this)}},{key:"enqueue",value:function(e){return(0,h._)(function(e){var t,n;return(0,v._)(this,function(r){switch(r.label){case 0:return t=e.contents,[4,this.api.chort.queue.enqueue.rpc({contents:t})];case 1:if(!(n=r.sent()).ok)return[2,this.api.error(n)];return[2,(0,S.Ok)(n.payload)]}})}).apply(this,arguments)}},{key:"update",value:function(e){return(0,h._)(function(e){var n,r,i,o,a,s;return(0,v._)(this,function(l){switch(l.label){case 0:return n=e.id,r=e.contents,o=(i=(0,t._)(this.api.state.stage(eE,{id:n,contents:r}),2))[0],a=i[1],[4,this.api.chort.queue.update.rpc({id:n,contents:r})];case 1:if(!(s=l.sent()).ok)return a(),[2,this.api.error(s)];return o(),[2,(0,S.Ok)(s.payload)]}})}).apply(this,arguments)}},{key:"reorder",value:function(e){return(0,h._)(function(e){var n,r,i,o,a,s;return(0,v._)(this,function(l){switch(l.label){case 0:return n=e.id,r=e.after,o=(i=(0,t._)(this.api.state.stage(eR,{id:n,after:r}),2))[0],a=i[1],[4,this.api.chort.queue.reorder.rpc({id:n,after:r})];case 1:if(!(s=l.sent()).ok)return a(),[2,this.api.error(s)];return o(),[2,(0,S.Ok)(s.payload)]}})}).apply(this,arguments)}},{key:"flush",value:function(e){return(0,h._)(function(e){var n,r,i,o,a,s;return(0,v._)(this,function(l){switch(l.label){case 0:return n=e.ids,r=e.session,o=(i=(0,t._)(this.api.state.stage(eb,{ids:n}),2))[0],a=i[1],[4,this.api.chort.queue.flush.rpc({ids:n,session:r})];case 1:if(!(s=l.sent()).ok)return a(),[2,this.api.error(s)];return o(),[2,(0,S.Ok)(s.payload)]}})}).apply(this,arguments)}},{key:"delete",value:function(e){return(0,h._)(function(e){var n,r,i,o,a;return(0,v._)(this,function(s){switch(s.label){case 0:return n=e.ids,i=(r=(0,t._)(this.api.state.stage(eb,{ids:n}),2))[0],o=r[1],[4,this.api.chort.queue.delete.rpc({ids:n})];case 1:if(!(a=s.sent()).ok)return o(),[2,this.api.error(a)];return i(),[2,(0,S.Ok)(a.payload)]}})}).apply(this,arguments)}}]),e}(),eI=function(){function e(t){var n=this;(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"sessions",void 0),(0,g._)(this,"queue",void 0),this.api=t,this.sessions={query:function(e){return new eT(n.api,e)},create:function(e){return n.api.createSession(e)},rollback:function(e){return n.api.revertToCommit(e)},get:function(e){return n.api.getSessionObservableById(e)},chat:{all:new eT(t,{types:[p.SessionType.CHAT]}),open:new eT(t,{types:[p.SessionType.CHAT],archived:!1}),archived:new eT(t,{types:[p.SessionType.CHAT],archived:!0})},agent:{all:new eT(t,{types:[p.SessionType.AGENT_SESSION]}),current:this.api.currentAgentSession,readonly:new eT(t,{types:[p.SessionType.AGENT_SESSION],readonly:!0})}},this.queue=new eC(this.api)}return(0,f._)(e,[{key:"hook",value:function(e,t){return this.api.hooks.add(e,t)}},{key:"usage",value:function(e){return this.api.createUsageWatcher({start:e})}}]),e}(),eO=e.i(693482),eA=e.i(452723),e_=e.i(346715),ek=function(){function e(t){(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"hooks",{}),(0,g._)(this,"listeners",new Y.ListenerList),this.api=t}return(0,f._)(e,[{key:"has",value:function(e){return void 0!==this.hooks[e]}},{key:"add",value:function(e,t){var n=this,r=this.hooks[e];r||(r=new Map,this.hooks[e]=r);var i=function(){r&&r.has(i)&&(r.delete(i),0===r.size&&(delete n.hooks[e],r=void 0),n.listeners.notify({kind:"hook-unregistered",type:e}))};return r.set(i,t),this.listeners.notify({kind:"hook-registered",type:e}),i}},{key:"trigger",value:function(e,t){var n=this.hooks[e];if(n){var r=!0,i=!1,o=void 0;try{for(var a,s=(0,e_._)(n.values())[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;try{l(t)}catch(e){this.api.error(e)}}}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}}},{key:"subscribe",value:function(e){return this.listeners.add(e)}},{key:"dispose",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=Object.values(this.hooks)[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=!0,s=!1,l=void 0;try{for(var p,u=o.keys()[Symbol.iterator]();!(a=(p=u.next()).done);a=!0)(0,p.value)()}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}]),e}(),eU=e.i(395266),eN=function(){function e(n){var r,i,o,a,s=this,l=n.connection,u=n.chortConnection,c=n.user,d=n.hasAdvancedModel,y=n.overrideModel,f=n.logger,E=n.onError;(0,T._)(this,e),(0,g._)(this,"connection",void 0),(0,g._)(this,"chortConnection",void 0),(0,g._)(this,"user",void 0),(0,g._)(this,"hasAdvancedModel",void 0),(0,g._)(this,"overrideModel",void 0),(0,g._)(this,"onError",void 0),(0,g._)(this,"hooks",void 0),(0,g._)(this,"disposed",!1),(0,g._)(this,"teardowns",new Y.ListenerList),(0,g._)(this,"logger",void 0),(0,g._)(this,"status",void 0),(0,g._)(this,"connected",new m.Multicast(function(e){var t=null,n=s.teardowns.add(function(){null==t||t.abort(),t=null,e.complete()}),r=s.status.subscribe(function(n){"connected"!==n?(null==t||t.abort(),t=null,"closed"===n?e.complete():"error"===n&&e.error(Error("Connection error"))):t||(t=new AbortController,e.next(t.signal))});return function(){null==t||t.abort(),t=null,n(),r.unsubscribe()}})),(0,g._)(this,"closed",new m.Multicast(function(e){var t=s.teardowns.add(function(){e.next(),e.complete()}),n=s.status.subscribe(function(t){("closed"===t||"error"===t)&&(e.next(),e.complete())});return function(){t(),n.unsubscribe()}})),(0,g._)(this,"models",new m.Multicast(function(e){var n=0;return P.Observable.combine(s.connected,s.overrideModel).filter(function(e){return!(0,t._)(e,1)[0].aborted}).lift(e,function(r){var i=(0,t._)(r,2),o=i[0],a=i[1];return(0,h._)(function(){var t,r,i,s,l;return(0,v._)(this,function(u){switch(u.label){case 0:return t=++n,[4,this.service.getAvailableModels.rpc({overrideModel:null!=a?a:""})];case 1:if(r=u.sent(),n!==t||o.aborted||(0,S.isError)(r,"UNEXPECTED_DISCONNECT"))return[2];if(!r.ok)return[2,this.error(r,e)];return i=r.payload.basicModel.map(function(e){return new eU.ChatModel({type:p.ModelType.BASIC,readable:e.readable,qualified:e.qualified})}),s=r.payload.advancedModel.map(function(e){return new eU.ChatModel({type:p.ModelType.ADVANCED,readable:e.readable,qualified:e.qualified})}),l=null,a&&r.payload.overrideModel&&r.payload.overrideModel.qualified===a&&(l=new eU.ChatModel({type:p.ModelType.OVERRIDE,readable:r.payload.overrideModel.readable,qualified:r.payload.overrideModel.qualified})),e.next({basic:i,advanced:s,override:l}),[2]}})}).call(s)})})),this.connection=l,this.chortConnection=null!=u?u:null,this.user=new ep.ObservableState(c),this.hasAdvancedModel=new ep.ObservableState(d),this.overrideModel=new ep.ObservableState(null!=y?y:null),this.logger=function(e){var t={},n="chatter: ";if(e.debug){var r=e.debug;t.debug=function(e,t){r(n+e,t)}}if(e.info){var i=e.info;t.info=function(e,t){i(n+e,t)}}if(e.warn){var o=e.warn;t.warn=function(e,t){o(n+e,t)}}if(e.error){var a=e.error;t.error=function(e,t){a(n+e,t)}}return t}(null!=f?f:{}),this.onError=E,this.hooks=new ek(this),this.teardown(function(){return s.hooks.dispose()});var b=new ep.ObservableState(eD(this.connection.status.current,null!=(a=null==(r=this.chortConnection)?void 0:r.status.current)?a:null));this.teardown(function(){"closed"!==b.current&&"error"!==b.current&&b.set("closed")}),this.status=b;var R=this.connection.status.subscribe(function(e){var t,n,r,i,o=null!=(i=null==(t=s.chortConnection)?void 0:t.status.current)?i:null;null==(n=(r=s.logger).info)||n.call(r,"connection status changed",{connectionStatus:e,chortConnectionStatus:o}),b.set(eD(e,o)),("closed"===e||"error"===e)&&s.dispose()});if(this.teardown(function(){return R.unsubscribe()}),this.chortConnection){var C=this.chortConnection.status.subscribe(function(e){var t,n,r=s.connection.status.current;null==(t=(n=s.logger).info)||t.call(n,"connection status changed",{connectionStatus:r,chortConnectionStatus:e}),b.set(eD(r,e)),("closed"===e||"error"===e)&&s.dispose()});this.teardown(function(){return C.unsubscribe()})}null==(i=(o=this.logger).info)||i.call(o,"API initialized")}return(0,f._)(e,[{key:"service",get:function(){return this.connection.service}},{key:"chort",get:function(){if(!this.chortConnection)throw Error("Chort connection is not set");return this.chortConnection.client}},{key:"error",value:function(e,t){var n=(0,S.Err)(e);if(!(0,S.isError)(n,"UNEXPECTED_DISCONNECT")&&!n.reported)if(n.reported=!0,this.onError){var r=null;(void 0===e?"undefined":(0,b._)(e))==="object"&&"payload"in e&&(r=n.payload),this.onError(n,r)}else setTimeout(function(){throw n},0);return t&&t.error(n),(0,S.isError)(n,"UNEXPECTED_DISCONNECT")?this.hooks.trigger("unexpected-disconnect",{error:n}):this.hooks.trigger("unhandled-exception",{error:n}),n}},{key:"teardown",value:function(e){return this.disposed?(e(),function(){}):this.teardowns.add(e)}},{key:"ping",value:function(){return(0,h._)(function(){var e,t;return(0,v._)(this,function(n){switch(n.label){case 0:return[4,this.service.pingPong.rpc({})];case 1:if(e=n.sent(),(0,S.isError)(e,"UNEXPECTED_DISCONNECT"))return[2,(0,S.Ok)(!1)];if(!e.ok)return[2,this.error(e)];if(!this.chortConnection)return[3,3];return[4,this.chort.debug.ping.rpc({})];case 2:if(t=n.sent(),(0,S.isError)(t,"UNEXPECTED_DISCONNECT"))return[2,(0,S.Ok)(!1)];if(!t.ok)return[2,this.error(t)];n.label=3;case 3:return[2,(0,S.Ok)(!0)]}})}).call(this)}},{key:"dispose",value:function(){if(!this.disposed){var e,t;this.disposed=!0,this.teardowns.notify(),this.teardowns.clear(),null==(t=this.logger)||null==(e=t.info)||e.call(t,"API disposed")}}},{key:"enhancePrompt",value:function(e,t){return(0,h._)(function(e){var t,n,r,i,o=arguments;return(0,v._)(this,function(a){switch(a.label){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:[],n=o.length>2&&void 0!==o[2]?o[2]:[],r=o.length>3?o[3]:void 0,[4,this.service.enhanceAgentPrompt.rpc({userPrompt:e,uploadedFiles:t,attachedUrls:n,selectedTheme:r||""})];case 1:if(!(i=a.sent()).ok)return[2,this.error(i)];return[2,(0,S.Ok)(i.payload.enhancedPrompt)]}})}).apply(this,arguments)}},{key:"generateReplName",value:function(e,t){return(0,h._)(function(){var n;return(0,v._)(this,function(r){switch(r.label){case 0:return[4,this.service.generateReplName.rpc({replId:e,prompt:t})];case 1:if(!(n=r.sent()).ok)return[2,this.error(n)];return[2,(0,S.Ok)(n.payload.replName)]}})}).call(this)}},{key:"getUrlScrapedContent",value:function(e){return(0,h._)(function(){var t;return(0,v._)(this,function(n){switch(n.label){case 0:return[4,this.service.getUrlScrapedContent.rpc({url:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,S.Ok)(t.payload.content)]}})}).call(this)}},{key:"getUrlScreenshot",value:function(e){return(0,h._)(function(){var t;return(0,v._)(this,function(n){switch(n.label){case 0:return[4,this.service.getUrlScreenshot.rpc({url:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,S.Ok)(t.payload.imageDownloadUrl)]}})}).call(this)}},{key:"getUrlBranding",value:function(e){return(0,h._)(function(){var t;return(0,v._)(this,function(n){switch(n.label){case 0:return[4,this.service.getUrlBranding.rpc({url:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,S.Ok)(t.payload.branding)]}})}).call(this)}},{key:"generateReplIcon",value:function(e,t){return(0,h._)(function(){var n;return(0,v._)(this,function(r){switch(r.label){case 0:return[4,this.service.generateIcon.rpc({replId:e,prompt:t})];case 1:if(!(n=r.sent()).ok)return[2,this.error(n)];return[2,(0,S.Ok)(n.payload.imageUrl)]}})}).call(this)}},{key:"classifyInitialUserPrompt",value:function(e){return(0,h._)(function(e){var t,n,r=arguments;return(0,v._)(this,function(i){switch(i.label){case 0:return t=r.length>1&&void 0!==r[1]?r[1]:[],[4,this.service.classifyInitialUserPrompt.rpc({userPrompt:e,uploadedFiles:t})];case 1:if(!(n=i.sent()).ok)return[2,this.error(n)];return[2,(0,S.Ok)(n.payload)]}})}).apply(this,arguments)}},{key:"uploadStackSelectionFile",value:function(e){return(0,h._)(function(e){var t,n,r,i,o,a,s,l,p,u,c,d,y,T,f,g,h,m;return(0,v._)(this,function(b){switch(b.label){case 0:t=e.fileName,n=e.mimeType,r=e.file;try{i=(0,ef._)(r,ArrayBuffer)?new Blob([r]).stream():r.stream()}catch(e){return[2,this.error(e)]}o=new AbortController,s=(a=this.chort.media.uploadStackSelectionFile.upload({fileName:t,mimeType:n},{signal:o.signal})).reqWritable,l=a.finalize,p=null,b.label=1;case 1:b.trys.push([1,14,,15]),u=!1,c=!1,b.label=2;case 2:var R;b.trys.push([2,7,8,13]),y=(0,E._)((R=i,(0,eA._)(function(){var e,t,n,r;return(0,v._)(this,function(i){switch(i.label){case 0:e=R.getReader(),i.label=1;case 1:i.trys.push([1,,6,7]),i.label=2;case 2:return[4,(0,eO._)(e.read())];case 3:if(n=(t=i.sent()).done,r=t.value,n)return[3,5];return[4,r];case 4:return i.sent(),[3,2];case 5:return[3,7];case 6:return e.releaseLock(),[7];case 7:return[2]}})})())),b.label=3;case 3:return[4,y.next()];case 4:if(!(u=!(T=b.sent()).done))return[3,6];if(f=T.value,o.signal.aborted)return p=Error("Upload aborted"),[3,6];try{s.write({chunk:f})}catch(e){return p=(0,ef._)(e,Error)?e:String(e),[3,6]}b.label=5;case 5:return u=!1,[3,3];case 6:return[3,13];case 7:return g=b.sent(),c=!0,d=g,[3,13];case 8:if(b.trys.push([8,,11,12]),!(u&&null!=y.return))return[3,10];return[4,y.return()];case 9:b.sent(),b.label=10;case 10:return[3,12];case 11:if(c)throw d;return[7];case 12:return[7];case 13:return[3,15];case 14:return h=b.sent(),p=(0,ef._)(h,Error)?h:String(h),o.abort(),[3,15];case 15:return[4,l()];case 16:if(m=b.sent(),p){if(o.signal.aborted||(0,ef._)(p,Error)&&p.message.includes("closed"))return[2,(0,S.Err)({code:"UPLOAD_CANCELLED",message:"Upload was cancelled"})];return[2,this.error(p)]}if(!m.ok)return[2,this.error(m)];return[2,(0,S.Ok)({url:m.payload.url,expires:m.payload.expires})]}})}).apply(this,arguments)}},{key:"getResourceUploadUrl",value:function(e){return(0,h._)(function(){var t;return(0,v._)(this,function(n){switch(n.label){case 0:return[4,this.service.getResourceUploadUrl.rpc({mimeType:e})];case 1:if(!(t=n.sent()).ok)return[2,this.error(t)];return[2,(0,S.Ok)(t.payload)]}})}).call(this)}}]),e}();function eD(e,t){return null===t?e:"closed"===e||"closed"===t?"closed":"error"===e||"error"===t?"error":"disconnected"===e||"disconnected"===t?"disconnected":"connecting"===e||"connecting"===t?"connecting":"connected"}var ew=function(){function e(){(0,T._)(this,e),(0,g._)(this,"current",0),(0,g._)(this,"resolves",[])}return(0,f._)(e,[{key:"count",get:function(){return this.current}},{key:"increment",value:function(){this.current++}},{key:"decrement",value:function(){if(this.current--,this.current<0)throw this.current=0,Error("Reference count cannot be negative");for(;0===this.current&&this.resolves.length>0;){var e=this.resolves.shift();null==e||e()}}},{key:"drained",value:function(){return(0,h._)(function(){var e;return(0,v._)(this,function(t){switch(t.label){case 0:if(e=this,0!==this.current)return[3,2];return[4,Promise.resolve()];case 1:if(t.sent(),0===this.current)return[2];t.label=2;case 2:return[2,new Promise(function(t){e.resolves.push(t)})]}})}).call(this)}},{key:"scope",value:function(e){return(0,h._)(function(){return(0,v._)(this,function(t){switch(t.label){case 0:this.increment(),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,e()];case 2:return[2,t.sent()];case 3:return this.decrement(),[7];case 4:return[2]}})}).call(this)}}]),e}(),eP=function(){function e(n){var r=this;(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"queue",new Map),(0,g._)(this,"store",es.events.store()),(0,g._)(this,"enqueued",null),(0,g._)(this,"events",new m.StatelessMulticast(function(e){var n=!1,i=r.api.closed.subscribe(function(){e.complete()});return r.enqueued=function(){n||(n=!0,(0,h._)(function(){var r,i,o,a,s,l,p,u,c,d,y,T,f,g,h,m,E,b,R,C,O,A,_,k,U,N,D,w,P,M,j,L,x,B,F,G,q,$,V,W,H,K,z,Y,Q,X,J,Z,ee,et,en,er,ei,eo,ea,el;return(0,v._)(this,function(v){switch(v.label){case 0:if(!this.queue.size)return[3,9];r=!0,i=!1,o=void 0,v.label=1;case 1:v.trys.push([1,6,7,8]),a=this.queue[Symbol.iterator](),v.label=2;case 2:if(r=(s=a.next()).done)return[3,5];if(p=(l=(0,t._)(s.value,2))[0],u=l[1],this.api.state.optimistic){y=[],T=!0,f=!1,g=void 0;try{for(h=u[Symbol.iterator]();!(T=(m=h.next()).done);T=!0)E=m.value,(b=this.api.state.isOptimisticEvent(E))&&(O=this.api.state.getOptimisticEvent(E),y.push(O),u.delete(E),null==(R=(C=this.api.logger).warn)||R.call(C,"materialized optimistic event",{sessionId:p,eventId:E,eventOptimisticType:b}))}catch(e){f=!0,g=e}finally{try{T||null==h.return||h.return()}finally{if(f)throw g}}if(y.length&&(this.store.untrack(y),e.next(y)),!u.size)return this.queue.delete(p),[3,4]}if(!es.events.empty){A=[],_=!0,k=!1,U=void 0;try{for(N=u[Symbol.iterator]();!(_=(D=N.next()).done);_=!0)w=D.value,(P=es.events.get(w))&&(A.push(P),u.delete(w))}catch(e){k=!0,U=e}finally{try{_||null==N.return||N.return()}finally{if(k)throw U}}A.length&&(this.store.untrack(A),e.next(A))}if(!u.size)return this.queue.delete(p),[3,4];return M=Date.now(),j=Array.from(u).slice(0,500),[4,this.api.service.batchGetEvents.rpc({sessionId:p,eventIds:j})];case 3:if(L=v.sent(),!n)return[2];if((0,S.isError)(L,"UNEXPECTED_DISCONNECT"))return[3,4];if(L.ok&&!L.payload.events.length){F=!0,G=!1,q=void 0;try{for($=j[Symbol.iterator]();!(F=(V=$.next()).done);F=!0)W=V.value,u.delete(W)}catch(e){G=!0,q=e}finally{try{F||null==$.return||$.return()}finally{if(G)throw q}}return u.size||this.queue.delete(p),this.store.untrack(j),null==(x=(B=this.api.logger).warn)||x.call(B,"detected infinite materialization loop",{sessionId:p,eventIds:j}),[3,4]}if(!L.ok){H=!0,K=!1,z=void 0;try{for(Y=j[Symbol.iterator]();!(H=(Q=Y.next()).done);H=!0)X=Q.value,u.delete(X)}catch(e){K=!0,z=e}finally{try{H||null==Y.return||Y.return()}finally{if(K)throw z}}return u.size||this.queue.delete(p),this.store.untrack(j),[2,this.api.error(L,e)]}J=L.payload.events,null==(d=this.api.logger)||null==(c=d.info)||c.call(d,"materialized events",{sessionId:p,duration:Date.now()-M,count:J.length}),this.api.hooks.trigger("events-materialized",{sessionId:p,duration:Date.now()-M,count:J.length}),Z=[],ee=!0,et=!1,en=void 0;try{for(er=J[Symbol.iterator]();!(ee=(ei=er.next()).done);ee=!0)eo=ei.value,(ea=es.events.get(eo.id))?eo=ea:((0,I.applyEventOperations)(eo),es.events.add(eo)),u.has(eo.id)&&(Z.push(eo),u.delete(eo.id))}catch(e){et=!0,en=e}finally{try{ee||null==er.return||er.return()}finally{if(et)throw en}}u.size||this.queue.delete(p),Z.length&&(this.store.untrack(Z),e.next(Z)),v.label=4;case 4:return r=!0,[3,2];case 5:return[3,8];case 6:return el=v.sent(),i=!0,o=el,[3,8];case 7:try{r||null==a.return||a.return()}finally{if(i)throw o}return[7];case 8:return[3,0];case 9:return n=!1,[2]}})}).call(r).catch(function(t){return e.error(t)}))},r.queue.size&&r.enqueued(),function(){n=!1,r.enqueued=null,i.unsubscribe()}})),this.api=n}return(0,f._)(e,[{key:"enqueue",value:function(e,t){if(t.length){var n=this.queue.get(e);n||(n=new Set,this.queue.set(e,n));var r=!0,i=!1,o=void 0;try{for(var a,s,l=t[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var p=s.value;n.add(p)}}catch(e){i=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}this.store.track(t),null==(a=this.enqueued)||a.call(this)}}},{key:"materialize",value:function(e,t){return(0,h._)(function(){var n,r,i,o,a,s,l,p,u,c,d,y,T,f,g,h,m;return(0,v._)(this,function(v){switch(v.label){case 0:n=this,r=new Set(t),i=es.events.store(t),o=!0,a=!1,s=void 0;try{for(l=i[Symbol.iterator]();!(o=(p=l.next()).done);o=!0)u=p.value,r.delete(u.id)}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}if(!r.size)return[3,2];return this.enqueue(e,Array.from(r)),[4,new Promise(function(e,t){var o=n.events.subscribe({next:function(t){var n=!0,i=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var p=s.value;r.has(p.id)&&r.delete(p.id)}}catch(e){i=!0,a=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw a}}r.size||(o.unsubscribe(),e())},error:function(e){i.release(),t(e)},complete:function(){i.release(),t(new P.CompletionError)}})})];case 1:v.sent(),v.label=2;case 2:c=[],d=!0,y=!1,T=void 0;try{for(f=t[Symbol.iterator]();!(d=(g=f.next()).done);d=!0){if(h=g.value,!(m=this.get(h)))throw i.release(),this.api.error("Unexpected missing event");c.push(m)}}catch(e){y=!0,T=e}finally{try{d||null==f.return||f.return()}finally{if(y)throw T}}return i.release(),[2,c]}})}).call(this)}},{key:"get",value:function(e){return this.api.state.isOptimisticEvent(e)?this.api.state.getOptimisticEvent(e):es.events.get(e)}}]),e}(),eM=function(e){function t(e){var n;if((0,T._)(this,t),!e.replId)throw Error("Chatter API is disabled");return n=(0,D._)(this,t,[e]),(0,g._)(n,"replId",void 0),(0,g._)(n,"materializer",void 0),(0,g._)(n,"state",void 0),(0,g._)(n,"queryFetchCounter",void 0),(0,g._)(n,"sessionObservables",new Map),(0,g._)(n,"currentAgentSession",new m.Multicast(function(e){var t=!1,r="",i=null,o=function(t){return(0,h._)(function(){var r,o,a,s;return(0,v._)(this,function(l){switch(l.label){case 0:if(null==i||i.abort(),!t)return[2,e.next(null)];if(r=es.sessions.get(t))return e.next(ed.create(n,t,r.created)),i=null,[2];return o=(i=new AbortController).signal,[4,n.service.getSessionEvents.rpc({excludeContents:!0,sessionId:t,limit:1})];case 1:if(a=l.sent(),o.aborted||(0,S.isError)(a,"UNEXPECTED_DISCONNECT"))return[2];if(!a.ok)return[2,n.error(a,e)];return a.payload.session.events=[],i=null,s=es.sessions.emplace(a.payload.session),e.next(ed.create(n,t,s.created)),[2]}})})()},a=n.state.updates.filter(function(e){return"agent-state-modified"===e.kind}).select(function(e){return e.session}).lift(e,function(e){r!==e&&(r=e,o(e))}),s=n.connected.lift(e,function(i){return(0,h._)(function(){var a,s,l,u,c,d,y,T,f,g;return(0,v._)(this,function(h){switch(h.label){case 0:return[4,n.service.getReplSessions.rpc({beforeTimestamp:new Date("2099-01-01"),limit:5,includeFirstSessionEvents:!1,firstSessionEventsLimit:1,replId:n.replId,sessionTypes:[p.SessionType.AGENT_SESSION],archived:void 0})];case 1:if(a=h.sent(),i.aborted||(0,S.isError)(a,"UNEXPECTED_DISCONNECT"))return[2];if(!a.ok)return[2,n.error(a,e)];s=!0,l=!1,u=void 0;try{for(c=a.payload.sessions[Symbol.iterator]();!(s=(d=c.next()).done);s=!0)(y=d.value).events=[],es.sessions.emplace(y)}catch(e){l=!0,u=e}finally{try{s||null==c.return||c.return()}finally{if(l)throw u}}return T=a.payload.replAgentState.activeAgentSessionId,f=a.payload.sessions.filter(function(e){return!e.readOnly}).sort(function(e,t){return t.created.getTime()-e.created.getTime()})[0],g=T||(null==f?void 0:f.id)||"",r===g&&t||(t=!0,r=g,o(g)),[2]}})})()});return function(){null==i||i.abort(),a.unsubscribe(),s.unsubscribe()}})),n.replId=e.replId,n.materializer=new eP(n),n.state=new eS(n),n.queryFetchCounter=new ew,n}return(0,w._)(t,e),(0,f._)(t,[{key:"getSessionObservableById",value:function(e){var t=this,n=this.sessionObservables.get(e);return n||(n=new m.Multicast(function(n){var r=null,i=es.sessions.get(e);i?n.next(ed.create(t,e,i.created)):r=t.connected.lift(n,function(i){return(0,h._)(function(){var t,o;return(0,v._)(this,function(a){switch(a.label){case 0:return[4,this.service.getSessionEvents.rpc({excludeContents:!0,sessionId:e,limit:1})];case 1:if(t=a.sent(),i.aborted||(0,S.isError)(t,"UNEXPECTED_DISCONNECT"))return[2];if(!t.ok)return[2,this.error(t,n)];return t.payload.session.events=[],o=es.sessions.emplace(t.payload.session),n.next(ed.create(this,e,o.created)),null==r||r.unsubscribe(),r=null,[2]}})}).call(t)});var o=t.teardown(function(){n.complete()});return function(){null==r||r.unsubscribe(),o()}}),this.sessionObservables.set(e,n)),n}},{key:"createSession",value:function(e){return(0,h._)(function(){var t,n,r;return(0,v._)(this,function(i){switch(i.label){case 0:return t=(0,_.createSessionRequest)((0,eh._)((0,eg._)({},e),{replId:this.replId})),[4,this.service.createSession.rpc(t)];case 1:if(!(n=i.sent()).ok)return[2,this.error(n)];return r=ed.create(this,n.payload.sessionId,new Date),this.hooks.trigger("client-created-session",{session:r,request:t}),[2,(0,S.Ok)(r)]}})}).call(this)}},{key:"revertToCommit",value:function(e){return(0,h._)(function(){var t,n,r,i,o,a,s,l,p,u;return(0,v._)(this,function(c){switch(c.label){case 0:return r=(0,eg._)({replId:this.replId,databaseRollbackTimestamp:null!=(t=e.databaseRollbackTimestamp)?t:"",deploymentBuildId:null!=(n=e.deploymentBuildId)?n:""},e),[4,this.service.revertToCommit.rpc(r)];case 1:if(!(i=c.sent()).ok)return[2,this.error(i)];if(o=i.payload.revertedSessionId,a=es.sessions.get(o))return s=ed.create(this,o,a.created),this.hooks.trigger("client-reverted-session",{session:s,request:r}),[2,(0,S.Ok)(s)];return[4,this.service.getSessionEvents.rpc({excludeContents:!0,sessionId:o,limit:1})];case 2:if(!(l=c.sent()).ok)return[2,this.error(l)];return l.payload.session.events=[],p=es.sessions.emplace(l.payload.session),u=ed.create(this,o,p.created),this.hooks.trigger("client-reverted-session",{session:u,request:r}),[2,(0,S.Ok)(u)]}})}).call(this)}},{key:"createUsageWatcher",value:function(e){var t=this,n=e.sessionId,r=e.start;return new m.Multicast(function(e){return t.connected.lift(e,function(i){return(0,h._)(function(){var t,o,a,s,l,p,u,c;return(0,v._)(this,function(d){switch(d.label){case 0:t=this.chort.agent.watchUsage.subscribe({sessionId:n,start:r},{signal:i}).resReadable,o=!1,a=!1,d.label=1;case 1:d.trys.push([1,6,7,12]),l=(0,E._)(t),d.label=2;case 2:return[4,l.next()];case 3:if(!(o=!(p=d.sent()).done))return[3,5];if(u=p.value,(0,S.isError)(u,"UNEXPECTED_DISCONNECT","CANCEL"))return[2];if(!u.ok)return[2,this.error(u,e)];e.next({cents:u.payload.cents}),d.label=4;case 4:return o=!1,[3,2];case 5:return[3,12];case 6:return c=d.sent(),a=!0,s=c,[3,12];case 7:if(d.trys.push([7,,10,11]),!(o&&null!=l.return))return[3,9];return[4,l.return()];case 8:d.sent(),d.label=9;case 9:return[3,11];case 10:if(a)throw s;return[7];case 11:return[7];case 12:return[2]}})}).call(t)})})}}]),t}(eN),ej=function(){function e(t){(0,T._)(this,e),(0,g._)(this,"api",void 0),(0,g._)(this,"_chatter",void 0),t.replId?(this.api=new eM(t),this._chatter=new eI(this.api)):(this.api=new eN(t),this._chatter=null)}return(0,f._)(e,[{key:"chatter",value:function(){if(!this._chatter)throw Error("Chatter API is disabled");return this._chatter}},{key:"hook",value:function(e,t){return this.api.hooks.add(e,t)}},{key:"status",get:function(){return this.api.status}},{key:"user",get:function(){return this.api.user}},{key:"hasAdvancedModel",get:function(){return this.api.hasAdvancedModel}},{key:"overrideModel",get:function(){return this.api.overrideModel}},{key:"models",get:function(){return this.api.models}},{key:"enhancePrompt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0;return this.api.enhancePrompt(e,t,n,r)}},{key:"getUrlScrapedContent",value:function(e){return this.api.getUrlScrapedContent(e)}},{key:"getUrlScreenshot",value:function(e){return this.api.getUrlScreenshot(e)}},{key:"getUrlBranding",value:function(e){return this.api.getUrlBranding(e)}},{key:"generateReplName",value:function(e,t){return this.api.generateReplName(e,t)}},{key:"generateReplIcon",value:function(e,t){return this.api.generateReplIcon(e,t)}},{key:"classifyInitialUserPrompt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.api.classifyInitialUserPrompt(e,t)}},{key:"uploadStackSelectionFile",value:function(e){return this.api.uploadStackSelectionFile(e)}},{key:"getResourceUploadUrl",value:function(e){return this.api.getResourceUploadUrl(e)}},{key:"dispose",value:function(){this.api.dispose()}}]),e}(),eL=e.i(98816),ex=e.i(664152),eB=e.i(814563);e.i(925218);var eF=e.i(641555),eG=(0,s.atom)({hasAccessToAdvancedModel:!1,defaultAssistantChatMode:"basic"});function eq(){return(0,y.useValue)(eG)}function e$(){var e=(0,y.useYapper)();return(0,eF.useObservableMemo)(function(){return e.status.map(function(e){return"connected"===e})},[e],{default:!1})}function eV(){var e=(0,y.useYapper)();return(0,eF.useObservableMemo)(function(){return e.status.map(function(e){return"error"===e})},[e],{default:!1})}var eW=(0,eB.atomWithDefault)(function(e){return e(eG).defaultAssistantChatMode});e.s(["assistantChatModeAtom",()=>eW,"configAtom",()=>eG,"useConfig",()=>eq,"useIsAiClientConnected",()=>e$,"useIsRiverProtocolError",()=>eV],51553);var eH=e.i(61524),eK=e.i(289074),ez=(0,s.atom)(!1);function eY(){return(0,y.useValue)(ez)}function eQ(e){var T,f,g,h,v,m,S,E,b,R,C,I,O,A,_,k,U,N,D,w,P,M,j,L,x,B,F,G,q,$,V=e.replId,W=e.currentUser,H=e.hasAccessToAdvancedModel,K=e.children,z=e.mockStore,Y=e.mockYapper,Q=e.orgId,X=e.renderEmptyState,J=(f=(T={replId:V,currentUser:W,hasAccessToAdvancedModel:H,mockStore:z,mockYapper:Y,orgId:Q}).replId,g=T.currentUser,h=T.orgId,v=T.hasAccessToAdvancedModel,m=T.mockStore,S=T.mockYapper,E=(0,eH.usePreferences)("assistantAdvancedModelOverride").preferences.assistantAdvancedModelOverride,b=(0,l.useSetAtom)(eK.connectionStateAtom),R=(0,r.useMemo)(function(){return S?new URL("ws://localhost/mock"):void 0},[S]),C=(0,d.useCreateChatConnection)({endpoint:R,replId:f,currentUserId:g.id,orgId:h,onProtocolError:function(e){(0,u.sendErrorToSentry)(e.message,{code:e.type})},onRetriesExceeded:function(e){(0,i.flushSync)(function(){O.set(ez,!0),b((0,a.produce)(function(e){e["ai-chat"]="fatal"}))}),o.captureException("Chat service connection retries exhausted in AiProvider"),(0,u.sendErrorToSentry)(e.message,{code:e.type})}}),I=(0,c.useCreateChortRiverConnection)({replId:f,userId:g.id,onProtocolError:function(e){(0,u.sendErrorToSentry)(e.message,{code:e.type})},onRetriesExceeded:function(e){b((0,a.produce)(function(e){e.chort="fatal"})),(0,u.sendErrorToSentry)(e.message,{code:e.type})}}),O=(0,t._)((0,r.useState)(function(){return m&&console.error("mockStore in only meant for tests or development, not production"),null!=m?m:(0,s.createStore)()}),1)[0],A=g.id,_=g.timeCreated,(0,r.useEffect)(function(){O.set(eG,{hasAccessToAdvancedModel:v,defaultAssistantChatMode:v?"advanced":"basic"})},[O,v,E]),U=(k={connection:C,chortConnection:I,replId:f,user:(0,r.useMemo)(function(){return{id:A.toString(),type:p.UserType.USER,isTeam:!1,roles:[],membership:v?p.MembershipType.CORE:p.MembershipType.FREE,orgId:"",username:"",timeCreated:new Date(_),flaggingContext:"",modelfarmDisabled:!1,openrouterDisabled:!1,openaiDisabled:!1,anthropicDisabled:!1,geminiDisabled:!1,isEnterprise:!1}},[A,v,_]),hasAdvancedModel:v,overrideModel:E||null,onError:function(e,t){setTimeout(function(){(0,u.sendErrorToSentry)(e,null!=t?t:void 0)})}}).connection,N=k.chortConnection,D=k.replId,w=k.user,P=k.hasAdvancedModel,j=void 0===(M=k.overrideModel)?null:M,L=k.onError,B=(x=(0,t._)((0,r.useState)(null),2))[0],F=x[1],G=(0,eL.default)(L),q=!!L,(0,r.useEffect)(function(){if(U&&N){var e=new ej({connection:U,chortConnection:N,replId:D,user:w,hasAdvancedModel:P,overrideModel:j,logger:ex.logger,onError:q?function(e,t){var n;return null==(n=G.current)?void 0:n.call(G,e,t)}:void 0});return F(e),function(){F(null),Promise.resolve().then(function(){return e.dispose()})}}},[U,N,D,q]),(0,r.useEffect)(function(){B&&(B.user.current!==w&&B.user.set(w),B.hasAdvancedModel.current!==P&&B.hasAdvancedModel.set(P),B.overrideModel.current!==j&&B.overrideModel.set(null!=j?j:null))},[B,w,P,j]),$=B,{store:O,yapper:null!=S?S:$}),Z=J.store,ee=J.yapper;return ee?(0,n.jsx)(y.StoreProvider,{store:Z,yapper:ee,children:K}):(0,n.jsx)(void 0===X?function(){return null}:X,{})}function eX(){var e=(0,y.useValue)(eW),t=(0,y.useSet)(eW),n=(0,y.useGet)(eW),i=(0,r.useCallback)(function(){return"basic"===n()?p.MessageAction.NONE:p.MessageAction.ITERATIVE_AGENT},[n]),o=(0,r.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n();return e.isAuthorized?"advanced"===t?p.ModelType.ADVANCED:p.ModelType.BASIC:p.ModelType.MODEL_TYPE_UNKNOWN},[n]);return{assistantMode:e,setAssistantMode:t,getAssistantMode:n,getAssistantMessageIntent:i,getAssistantMessageModel:o}}e.s(["AiProvider",()=>eQ,"useIsRiverRetryBudgetExceeded",()=>eY],204203),e.s(["useAssistantChatMode",()=>eX],970187);var eJ=e.i(629536),eZ=e.i(55796),e0=e.i(267103),e1=e.i(993796);function e2(){var e,n=(0,y.useYapper)(),i=(0,e0.useObservable)(n.models),o=(e=(0,e1.useFlag)({controlName:"flag-assistant-advanced-model",type:"string",default:eJ.CHAT_ENGINE_PREFERRED_ADVANCED_MODEL.name.qualified}),(0,r.useMemo)(function(){return(0,eZ.getModelNameFromQualified)(e)},[e]));return(0,r.useMemo)(function(){var e,n,r=(0,t._)(null!=(e=null==i?void 0:i.basic)?e:[],1)[0],a=null!=(n=null==i?void 0:i.advanced)?n:[],s=null==i?void 0:i.override,l=a.find(function(e){return e.name.readable===(null==o?void 0:o.readable)}),p=(0,t._)(a.filter(function(e){return e.name.readable!==(null==o?void 0:o.readable)}),1)[0],u=(0,eZ.isGhostwriterChatModelName)(null==p?void 0:p.name)?p:eJ.CHAT_ENGINE_DEFAULT_MODELS.advanced,c=(0,eZ.isGhostwriterChatModelName)(null==s?void 0:s.name)?s:void 0;return{basicModel:(0,eZ.isGhostwriterChatModelName)(null==r?void 0:r.name)?r:eJ.CHAT_ENGINE_DEFAULT_MODELS.basic,advancedModel:(0,eZ.isGhostwriterChatModelName)(null==l?void 0:l.name)?l:u,overrideModel:c}},[i,o])}function e3(){var e=(0,y.useYapper)(),n=(0,e0.useObservable)(e.models);return(0,r.useMemo)(function(){var e,r,i=(0,t._)(null!=(e=null==n?void 0:n.basic)?e:[],1)[0],o=(null!=(r=null==n?void 0:n.advanced)?r:[]).filter(function(e){return e.name.qualified!==eJ.CHAT_ENGINE_PREFERRED_ADVANCED_MODEL.name.qualified})[0];return{basicModel:(0,eZ.isGhostwriterChatModelName)(null==i?void 0:i.name)?i:eJ.INLINE_ACTION_ENGINE_DEFAULT_MODELS.basic,advancedModel:(0,eZ.isGhostwriterChatModelName)(null==o?void 0:o.name)?o:eJ.INLINE_ACTION_ENGINE_DEFAULT_MODELS.advanced,overrideModel:void 0}},[n])}e.s(["useChatEngineModels",()=>e2],765695),e.s(["useInlineActionModels",()=>e3],334712),e.i(17886);var e4=(0,s.atom)(null);function e6(){return(0,y.useValue)(e4)}function e8(){return(0,y.useGet)(e4)}function e5(){var e=(0,y.useSet)(e4);return(0,r.useCallback)(function(t){return e(t)},[e])}var e7=(0,s.atom)(void 0),e9=(0,s.atom)(void 0);function te(){return(0,y.useValue)(e7)}function tt(){var e=(0,y.useSet)(e7);return(0,r.useCallback)(function(t){return e(t)},[e])}function tn(){var e=(0,y.useSet)(e9);return(0,r.useCallback)(function(t){return e(t)},[e])}var tr=(0,s.atom)(void 0);function ti(){var e=(0,y.useGet)(tr);return(0,r.useCallback)(function(){return e()},[e])}function to(){var e=(0,y.useSet)(tr);return(0,r.useCallback)(function(){return e(void 0)},[e])}e.s(["useAgentPlanApprovalState",()=>e6,"useClearPlanProposalUserSecretsResponse",()=>to,"useGetAgentPlanApprovalState",()=>e8,"useGetPlanProposalUserSecretsResponse",()=>ti,"useProposedPlan",()=>te,"useSetAgentPlanApprovalState",()=>e5,"useSetApprovedPlan",()=>tn,"useSetProposedPlan",()=>tt],145864);var ta=(0,s.atom)(!1);function ts(){return(0,y.useValue)(ta)}function tl(){var e=(0,y.useSet)(ta);return(0,r.useCallback)(function(t){return e(t)},[e])}e.s(["useAgentPausedByUser",()=>ts,"useSetAgentPausedByUser",()=>tl],165680);var tp=e.i(63846),tu=e.i(351285),tc=e.i(416143);function td(e,t){var n,r,i=(n=(0,tp.getAiEndpoint)(),r=window.location.host.startsWith("staging")||n===tc.AiEndpoints.development||n===tc.AiEndpoints.staging,t===p.SessionType.AGENT_SESSION?r?"2a95b8aa-201c-481e-8ee3-858a19efdc53":"430ef9d3-abfe-4318-8a6d-4cadfe35d0ce":r?"c50da37d-4044-4795-b28e-8e1d21473f96":"cf9ea4d0-b92a-4076-b8f9-44441d907f6a"),o="".concat("https://smith.langchain.com","/o/").concat("ed54f928-4630-409b-b66a-947e0fbac288","/projects/p/").concat(i),a=encodeURIComponent('{"duration":"7d"}'),s=(0,tu.stringify)({timeModel:a,searchModel:'{"filter":"and(eq(is_root, true), and(eq(metadata_key, \\"session_id\\"), eq(metadata_value, \\"'.concat(e,'\\")))"}')});return"".concat(o,"?").concat(s)}function ty(e){var t,n=(0,tp.getAiEndpoint)(),r="https://cloud.temporal.io";switch(n){case tc.AiEndpoints.development:r="http://localhost:8233",t="default";break;case tc.AiEndpoints.staging:t="staging.ndbzr";break;case tc.AiEndpoints.production:default:t="production.ndbzr"}var i="".concat(r,"/namespaces/").concat(t,"/workflows"),o=(0,tu.stringify)({query:'session_id = "'.concat(e,'"')});return"".concat(i,"?").concat(o)}function tT(e){switch((0,tp.getAiEndpoint)()){case tc.AiEndpoints.development:t="5ad850f0-3a1a-4980-b889-d21d4116b5d7";break;case tc.AiEndpoints.staging:t="45b3aed2-3dde-4f0d-a22c-9af69ee8508e";break;case tc.AiEndpoints.production:default:t="ce8b1d97-5fef-4a21-bc60-8910fa6852d5"}var t,n=["f=is_root:eq:true","f=metadata.session_id:eq:".concat(encodeURIComponent(e))];return"".concat("https://traceforge.app","/projects/").concat(t,"?").concat(n.join("&"),"&t=1d")}function tf(e){switch((0,tp.getAiEndpoint)()){case tc.AiEndpoints.development:t="development";break;case tc.AiEndpoints.staging:t="staging";break;case tc.AiEndpoints.production:default:t="production"}var t,n="agent-".concat(t),r='is_root AND metadata.session_id = "'.concat(e,'"'),i=JSON.stringify({filter:[{label:r,text:r,originType:"btql"}]}),o=(0,tu.stringify)({qs:"spans",search:i});return"".concat("https://www.braintrust.dev/app/ai-replit","/p/").concat(n,"/logs?").concat(o)}function tg(e){return"https://us5.datadoghq.com/logs?query=%40replid%3A".concat(e)}function th(e){return"https://us5.datadoghq.com/apm/traces?query=%40replid%3A".concat(e)}e.s(["generateAiSessionBraintrustUrl",()=>tf,"generateAiSessionDatadogTracesUrl",()=>th,"generateAiSessionDatadogUrl",()=>tg,"generateAiSessionLangSmithUrl",()=>td,"generateAiSessionTemporalUrl",()=>ty,"generateAiSessionTraceforgeUrl",()=>tT],805763),e.s([],877212)}]);

//# debugId=bcab3178-9cb0-283b-23f2-8ad2ddd7e789
//# sourceMappingURL=2f103325490972f2.js.map