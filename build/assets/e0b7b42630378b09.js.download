;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="bda50307-77d5-b1cb-9d8f-0faf559923a3")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,422183,(e,r,t)=>{var n=e.r(365738);!function(){"use strict";var e={114:function(e){function r(e){if("string"!=typeof e)throw TypeError("Path must be a string. Received "+JSON.stringify(e))}function t(e,r){for(var t,n="",i=0,o=-1,a=0,s=0;s<=e.length;++s){if(s<e.length)t=e.charCodeAt(s);else if(47===t)break;else t=47;if(47===t){if(o===s-1||1===a);else if(o!==s-1&&2===a){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2)){if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",i=0):i=(n=n.slice(0,l)).length-1-n.lastIndexOf("/"),o=s,a=0;continue}}else if(2===n.length||1===n.length){n="",i=0,o=s,a=0;continue}}r&&(n.length>0?n+="/..":n="..",i=2)}else n.length>0?n+="/"+e.slice(o+1,s):n=e.slice(o+1,s),i=s-o-1;o=s,a=0}else 46===t&&-1!==a?++a:a=-1}return n}var i={resolve:function(){for(var e,n,i="",o=!1,a=arguments.length-1;a>=-1&&!o;a--)a>=0?n=arguments[a]:(void 0===e&&(e=""),n=e),r(n),0!==n.length&&(i=n+"/"+i,o=47===n.charCodeAt(0));if(i=t(i,!o),o)if(i.length>0)return"/"+i;else return"/";return i.length>0?i:"."},normalize:function(e){if(r(e),0===e.length)return".";var n=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return(0!==(e=t(e,!n)).length||n||(e="."),e.length>0&&i&&(e+="/"),n)?"/"+e:e},isAbsolute:function(e){return r(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0==arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var n=arguments[t];r(n),n.length>0&&(void 0===e?e=n:e+="/"+n)}return void 0===e?".":i.normalize(e)},relative:function(e,t){if(r(e),r(t),e===t||(e=i.resolve(e))===(t=i.resolve(t)))return"";for(var n=1;n<e.length&&47===e.charCodeAt(n);++n);for(var o=e.length,a=o-n,s=1;s<t.length&&47===t.charCodeAt(s);++s);for(var l=t.length-s,c=a<l?a:l,u=-1,f=0;f<=c;++f){if(f===c){if(l>c){if(47===t.charCodeAt(s+f))return t.slice(s+f+1);else if(0===f)return t.slice(s+f)}else a>c&&(47===e.charCodeAt(n+f)?u=f:0===f&&(u=0));break}var d=e.charCodeAt(n+f);if(d!==t.charCodeAt(s+f))break;47===d&&(u=f)}var h="";for(f=n+u+1;f<=o;++f)(f===o||47===e.charCodeAt(f))&&(0===h.length?h+="..":h+="/..");return h.length>0?h+t.slice(s+u):(s+=u,47===t.charCodeAt(s)&&++s,t.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(r(e),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,i=-1,o=!0,a=e.length-1;a>=1;--a)if(47===(t=e.charCodeAt(a))){if(!o){i=a;break}}else o=!1;return -1===i?n?"/":".":n&&1===i?"//":e.slice(0,i)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw TypeError('"ext" argument must be a string');r(e);var n,i=0,o=-1,a=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var s=t.length-1,l=-1;for(n=e.length-1;n>=0;--n){var c=e.charCodeAt(n);if(47===c){if(!a){i=n+1;break}}else -1===l&&(a=!1,l=n+1),s>=0&&(c===t.charCodeAt(s)?-1==--s&&(o=n):(s=-1,o=l))}return i===o?o=l:-1===o&&(o=e.length),e.slice(i,o)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!a){i=n+1;break}}else -1===o&&(a=!1,o=n+1);return -1===o?"":e.slice(i,o)},extname:function(e){r(e);for(var t=-1,n=0,i=-1,o=!0,a=0,s=e.length-1;s>=0;--s){var l=e.charCodeAt(s);if(47===l){if(!o){n=s+1;break}continue}-1===i&&(o=!1,i=s+1),46===l?-1===t?t=s:1!==a&&(a=1):-1!==t&&(a=-1)}return -1===t||-1===i||0===a||1===a&&t===i-1&&t===n+1?"":e.slice(t,i)},format:function(e){var r,t;if(null===e||(void 0===e?"undefined":n._(e))!=="object")throw TypeError('The "pathObject" argument must be of type Object. Received type '+(void 0===e?"undefined":n._(e)));return r=e.dir||e.root,t=e.base||(e.name||"")+(e.ext||""),r?r===e.root?r+t:r+"/"+t:t},parse:function(e){r(e);var t,n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var i=e.charCodeAt(0),o=47===i;o?(n.root="/",t=1):t=0;for(var a=-1,s=0,l=-1,c=!0,u=e.length-1,f=0;u>=t;--u){if(47===(i=e.charCodeAt(u))){if(!c){s=u+1;break}continue}-1===l&&(c=!1,l=u+1),46===i?-1===a?a=u:1!==f&&(f=1):-1!==a&&(f=-1)}return -1===a||-1===l||0===f||1===f&&a===l-1&&a===s+1?-1!==l&&(0===s&&o?n.base=n.name=e.slice(1,l):n.base=n.name=e.slice(s,l)):(0===s&&o?(n.name=e.slice(1,a),n.base=e.slice(1,l)):(n.name=e.slice(s,a),n.base=e.slice(s,l)),n.ext=e.slice(a,l)),s>0?n.dir=e.slice(0,s-1):o&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};i.posix=i,e.exports=i}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}},a=!0;try{e[r](o,o.exports,i),a=!1}finally{a&&delete t[r]}return o.exports}i.ab="/ROOT/node_modules/.pnpm/next@16.1.1_@babel+core@7.21.4_@opentelemetry+api@1.9.0_babel-plugin-macros@3.1.0_react_7fdb221be1b0a2ee62c2f7486bb51667/node_modules/next/dist/compiled/path-browserify/",r.exports=i(114)}()},116918,677075,703631,e=>{"use strict";var r=["zip","gz","tgz","tar","rar","7z"],t=function(e){return r.includes(e)};e.s(["isBinaryExtension",()=>t],116918);var n=new Map([["pdf","application/pdf"],["3gpp","video/3gpp"],["adp","audio/adpcm"],["au","audio/basic"],["snd","audio/basic"],["mid","audio/midi"],["midi","audio/midi"],["kar","audio/midi"],["rmi","audio/midi"],["mp3","audio/mpeg"],["m4a","audio/mp4"],["mp4a","audio/mp4"],["mpga","audio/mpeg"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["m2a","audio/mpeg"],["m3a","audio/mpeg"],["oga","audio/ogg"],["ogg","audio/ogg"],["spx","audio/ogg"],["s3m","audio/s3m"],["sil","audio/silk"],["uva","audio/vnd.dece.audio"],["uvva","audio/vnd.dece.audio"],["eol","audio/vnd.digital-winds"],["dra","audio/vnd.dra"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["lvp","audio/vnd.lucent.voice"],["pya","audio/vnd.ms-playready.media.pya"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["rip","audio/vnd.rip"],["wav","audio/wave"],["weba","audio/webm"],["aac","audio/x-aac"],["aif","audio/x-aiff"],["aiff","audio/x-aiff"],["aifc","audio/x-aiff"],["caf","audio/x-caf"],["flac","audio/x-flac"],["mka","audio/x-matroska"],["m3u","audio/x-mpegurl"],["wax","audio/x-ms-wax"],["wma","audio/x-ms-wma"],["ram","audio/x-pn-realaudio"],["ra","audio/x-pn-realaudio"],["rmp","audio/x-pn-realaudio-plugin"],["xm","audio/xm"],["exr","image/aces"],["apng","image/apng"],["bmp","image/bmp"],["cgm","image/cgm"],["drle","image/dicom-rle"],["emf","image/emf"],["fits","image/fits"],["g3","image/g3fax"],["gif","image/gif"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["hsj2","image/hsj2"],["ief","image/ief"],["jls","image/jls"],["jp2","image/jp2"],["jpg2","image/jp2"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["jpe","image/jpeg"],["jph","image/jph"],["jhc","image/jphc"],["jpm","image/jpm"],["jpx","image/jpx"],["jpf","image/jpx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["ktx","image/ktx"],["png","image/png"],["btif","image/prs.btif"],["pti","image/prs.pti"],["sgi","image/sgi"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["t38","image/t38"],["tif","image/tiff"],["tiff","image/tiff"],["tfx","image/tiff-fx"],["psd","image/vnd.adobe.photoshop"],["azv","image/vnd.airzip.accelerator.azv"],["uvi","image/vnd.dece.graphic"],["uvvi","image/vnd.dece.graphic"],["uvg","image/vnd.dece.graphic"],["uvvg","image/vnd.dece.graphic"],["djvu","image/vnd.djvu"],["djv","image/vnd.djvu"],["sub","image/vnd.dvb.subtitle"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["fbs","image/vnd.fastbidsheet"],["fpx","image/vnd.fpx"],["fst","image/vnd.fst"],["mmr","image/vnd.fujixerox.edmics-mmr"],["rlc","image/vnd.fujixerox.edmics-rlc"],["ico","image/vnd.microsoft.icon"],["dds","image/vnd.ms-dds"],["mdi","image/vnd.ms-modi"],["wdp","image/vnd.ms-photo"],["npx","image/vnd.net-fpx"],["tap","image/vnd.tencent.tap"],["vtf","image/vnd.valve.source.texture"],["wbmp","image/vnd.wap.wbmp"],["xif","image/vnd.xiff"],["pcx","image/vnd.zbrush.pcx"],["webp","image/webp"],["wmf","image/wmf"],["3ds","image/x-3ds"],["ras","image/x-cmu-raster"],["cmx","image/x-cmx"],["fh","image/x-freehand"],["fhc","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["jng","image/x-jng"],["sid","image/x-mrsid-image"],["pic","image/x-pict"],["pct","image/x-pict"],["pnm","image/x-portable-anymap"],["pbm","image/x-portable-bitmap"],["pgm","image/x-portable-graymap"],["ppm","image/x-portable-pixmap"],["rgb","image/x-rgb"],["tga","image/x-tga"],["xbm","image/x-xbitmap"],["xpm","image/x-xpixmap"],["xwd","image/x-xwindowdump"],["3gp","video/3gpp"],["3g2","video/3gpp2"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["jpgv","video/jpeg"],["jpgm","video/jpm"],["mj2","video/mj2"],["mjp2","video/mj2"],["ts","video/mp2t"],["mp4","video/mp4"],["mp4v","video/mp4"],["mpg4","video/mp4"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpe","video/mpeg"],["m1v","video/mpeg"],["m2v","video/mpeg"],["ogv","video/ogg"],["qt","video/quicktime"],["mov","video/quicktime"],["uvh","video/vnd.dece.hd"],["uvvh","video/vnd.dece.hd"],["uvm","video/vnd.dece.mobile"],["uvvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvvs","video/vnd.dece.sd"],["uvv","video/vnd.dece.video"],["uvvv","video/vnd.dece.video"],["dvb","video/vnd.dvb.file"],["fvt","video/vnd.fvt"],["mxu","video/vnd.mpegurl"],["m4u","video/vnd.mpegurl"],["pyv","video/vnd.ms-playready.media.pyv"],["uvu","video/vnd.uvvu.mp4"],["uvvu","video/vnd.uvvu.mp4"],["viv","video/vnd.vivo"],["webm","video/webm"],["f4v","video/x-f4v"],["fli","video/x-fli"],["flv","video/x-flv"],["m4v","video/x-m4v"],["mkv","video/x-matroska"],["mk3d","video/x-matroska"],["mks","video/x-matroska"],["mng","video/x-mng"],["asf","video/x-ms-asf"],["asx","video/x-ms-asf"],["vob","video/x-ms-vob"],["wm","video/x-ms-wm"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wvx","video/x-ms-wvx"],["avi","video/x-msvideo"],["movie","video/x-sgi-movie"],["smv","video/x-smv"]]);function i(e){return""===e||e.endsWith("/")?e:e+"/"}function o(e,r){return r!==e&&r.startsWith(i(e))}function a(e,r){if(!o(e,r))return!1;var t=i(e),n=r.slice(t.length);return n.endsWith("/")&&(n=n.slice(-1)),!n.includes("/")}function s(e){return""===e||"./"===e?".":e.startsWith("./")?e.slice(2):e}e.s(["default",0,n],677075),e.s(["asDir",()=>i,"childOf",()=>a,"descendantOf",()=>o,"normalizePath",()=>s],703631)},903381,e=>{"use strict";var r,t,n,i,o,a,s,l=e.i(399119),c=e.i(904851),u=e.i(721281),f=e.i(445789),d=e.i(463348),h=((r={})[r.UNKNOWN=0]="UNKNOWN",r[r.MANUAL_SAVE=1]="MANUAL_SAVE",r),p=((t={}).Create="CREATE",t.Move="MOVE",t.Delete="DELETE",t.Modify="MODIFY",t),v=((n={}).Local="LOCAL",n.Container="CONTAINER",n),m=((i={}).File="FILE",i.Directory="DIRECTORY",i),g=function(e){function r(){var e;return(0,c._)(this,r),e=(0,l._)(this,r,arguments),(0,u._)(e,"name","FileReadError"),(0,u._)(e,"message","could not read the uploaded file"),e}return(0,f._)(r,e),r}((0,d._)(Error)),y=((o={}).NotFound="NOT_FOUND",o.NotReadable="NOT_READABLE",o.AlreadyExists="ALREADY_EXIST",o.NotDirectory="NOT_DIRECTORY",o.IsDirectory="IS_DIRECTORY",o.InvalidPath="INVALID_PATH",o.DiskQuotaExceeded="DISK_QUOTA_EXCEEDED",o.PermissionDenied="PERMISSION_DENIED",o.FileSystemUnavailable="FileSystemUnavailable",o),E=((a={}).Syncing="SYNCING",a.Clean="CLEAN",a),C=((s={}).Dirty="DIRTY",s.Syncing="SYNCING",s.Clean="CLEAN",s);e.s(["ChangeEventType",()=>p,"ChangeSource",()=>v,"FileReadError",()=>g,"FileStatus",()=>C,"FileType",()=>m,"FlushSource",()=>h,"FsErrors",()=>y,"FsStatus",()=>E])},205104,968069,e=>{"use strict";var r=e.i(422183),t=e.i(116918),n=e.i(677075),i=e.i(703631),o=e.i(903381),a=e.i(346715),s=[".replitignore",".replit","replit.nix"];let l=(0,a._)(["package.json","package-lock.json","yarn.lock","bun.lockb","bun.lock","node_modules","pnpm-lock.yaml","poetry.lock","pyproject.toml","requirements.txt",".venv",".pythonlibs","uv.lock","go.mod","go.sum","Gemfile","Gemfile.lock","pom.xml","target","Rconfig.json","Rconfig.lock.json","composer.json","composer.lock","vendor",".upm"]).concat((0,a._)(s));function c(e){return(0,t.isBinaryExtension)(d(e))}function u(e){return n.default.get(d(e).toLowerCase())}function f(e){return!e.endsWith(".ts")&&!!u(e)}function d(e){return(0,r.extname)(e).slice(1)}e.s(["configFiles",()=>s,"default",0,l],968069);var h=function(e){return e.split("/").length};function p(e){return e.split("/").pop()}function v(e){return p(e).split(".")[0]}function m(e){return e.split("/").slice(0,-1).join("/")}function g(e){return p(e).replace(/[^a-z0-9-_]/gi,"-")}function y(e){return e.endsWith(".draw")}function E(e){return!(y(e)||f(e)||c(e))}function C(e){return e.endsWith(".md")}function b(e){return e.endsWith(".svg")}function _(e){return e.endsWith(".csv")}function w(e){var r,t=null!=(r=null==e?void 0:e.toString())?r:"",n=t;return(["=","+","-","@"].some(function(e){return t.charAt(0)===e})&&(n="'"+t),-1!==n.indexOf(",")||-1!==n.indexOf('"'))?'"'.concat(n.replace(/"/g,'""'),'"'):n}var F=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});function x(e,r){return e&&r?F.compare(e,r):0}var S=function(e){var r=e.sort(function(e,r){var t=h(e.path);return h(r.path)-t}),t=[];return r.forEach(function(e,n){for(var a=n+1;a<r.length;a++)if(r[a].type===o.FileType.Directory&&(0,i.descendantOf)(r[a].path,e.path))return;t.push(e)}),t};e.s(["coalesceFsNodes",()=>S,"compareFilePaths",()=>x,"escapeCsvCell",()=>w,"getBaseName",()=>v,"getExt",()=>d,"getFileName",()=>p,"getMediaMime",()=>u,"getParentPath",()=>m,"getPathDepth",()=>h,"isBinary",()=>c,"isCsvFile",()=>_,"isDrawFile",()=>y,"isMarkdownFile",()=>C,"isMedia",()=>f,"isOTFile",()=>E,"isSVGFile",()=>b,"sanitizeFilename",()=>g],205104)},193060,e=>{"use strict";function r(e){var r=e.toString();return r.endsWith("/")?r.slice(0,-1):r}function t(e){if(n(e))throw Error("Absolute paths are not allowed, got: ".concat(e));if(e.startsWith("~/"))throw Error("Tilde paths are not allowed, got: ".concat(e));return"."===e||"./"===e||""===e?".":e.startsWith("./")?r(e.slice(2)):r(e)}function n(e){return e.startsWith("/")}function i(e){var t;return null!=(t=r(e.toString()).split("/").pop())?t:""}function o(e){if(s(e))throw Error("Cannot get parent path of root path");return t(e.toString().split("/").slice(0,-1).join("/"))}function a(e){for(var r=e.toString().split("/"),n=["."],i=0;i<r.length;i++){var o=r.slice(0,i+1).join("/");n.push(t(o))}return n}function s(e){return"."===e}function l(e,r){if(e===r)return!1;if(s(e))return!0;if(s(r))return!1;var t=e.toString();return r.toString().startsWith(t+"/")}function c(e,r){if(!l(e,r))return!1;if(s(e))return!0;var t=e.toString();return r.toString().split("/").length-t.split("/").length==1}function u(e,r){return s(e)?t(r.toString()):t("".concat(e,"/").concat(r))}function f(e,r,n){if(!l(e,n))throw Error("Path is not a descendant of old ancestor path");if(s(e))return u(r,i(n));var o=n.toString();if(s(r))return t(o.replace("".concat(e.toString(),"/"),""));var a=e.toString(),c=r.toString();return t(o.replace(a+"/",c+"/"))}e.s(["getFsBaseName",()=>i,"getParentFsPath",()=>o,"isAbsolutePath",()=>n,"isChildOf",()=>c,"isDescendantOf",()=>l,"isRoot",()=>s,"joinFsPath",()=>u,"moveDescendantFsPath",()=>f,"splitFsPaths",()=>a,"toRelativeFsPath",()=>t])},804828,(e,r,t)=>{var n=e.r(954546),i=e.r(365738);!function(){"use strict";var e={864:function(e){var r,t=("undefined"==typeof Reflect?"undefined":i._(Reflect))==="object"?Reflect:null,o=t&&"function"==typeof t.apply?t.apply:function(e,r,t){return Function.prototype.apply.call(e,r,t)};r=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,r){return new Promise(function(t,n){var i,o,a;function s(t){e.removeListener(r,l),n(t)}function l(){"function"==typeof e.removeListener&&e.removeListener("error",s),t([].slice.call(arguments))}g(e,r,l,{once:!0}),"error"!==r&&(i=e,o=s,a={once:!0},"function"==typeof i.on&&g(i,"error",o,a))})},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var l=10;function c(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+(void 0===e?"undefined":i._(e)))}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function f(e,r,t,n){if(c(t),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",r,t.listener?t.listener:t),o=e._events),a=o[r]),void 0===a)a=o[r]=t,++e._eventsCount;else if("function"==typeof a?a=o[r]=n?[t,a]:[a,t]:n?a.unshift(t):a.push(t),(i=u(e))>0&&a.length>i&&!a.warned){a.warned=!0;var i,o,a,s=Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=r,s.count=a.length,console&&console.warn&&console.warn(s)}return e}function d(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,r,t){var n={fired:!1,wrapFn:void 0,target:e,type:r,listener:t},i=d.bind(n);return i.listener=t,n.wrapFn=i,i}function p(e,r,t){var n=e._events;if(void 0===n)return[];var i=n[r];return void 0===i?[]:"function"==typeof i?t?[i.listener||i]:[i]:t?function(e){for(var r=Array(e.length),t=0;t<r.length;++t)r[t]=e[t].listener||e[t];return r}(i):m(i,i.length)}function v(e){var r=this._events;if(void 0!==r){var t=r[e];if("function"==typeof t)return 1;if(void 0!==t)return t.length}return 0}function m(e,r){for(var t=Array(r),n=0;n<r;++n)t[n]=e[n];return t}function g(e,r,t,n){if("function"==typeof e.on)n.once?e.once(r,t):e.on(r,t);else if("function"==typeof e.addEventListener)e.addEventListener(r,function i(o){n.once&&e.removeEventListener(r,i),t(o)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+(void 0===e?"undefined":i._(e)))}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||a(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),s.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var r=[],t=1;t<arguments.length;t++)r.push(arguments[t]);var i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){if(r.length>0&&(s=r[0]),n._(s,Error))throw s;var s,l=Error("Unhandled error."+(s?" ("+s.message+")":""));throw l.context=s,l}var c=a[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,r);else for(var u=c.length,f=m(c,u),t=0;t<u;++t)o(f[t],this,r);return!0},s.prototype.addListener=function(e,r){return f(this,e,r,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,r){return f(this,e,r,!0)},s.prototype.once=function(e,r){return c(r),this.on(e,h(this,e,r)),this},s.prototype.prependOnceListener=function(e,r){return c(r),this.prependListener(e,h(this,e,r)),this},s.prototype.removeListener=function(e,r){var t,n,i,o,a;if(c(r),void 0===(n=this._events)||void 0===(t=n[e]))return this;if(t===r||t.listener===r)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,t.listener||r));else if("function"!=typeof t){for(i=-1,o=t.length-1;o>=0;o--)if(t[o]===r||t[o].listener===r){a=t[o].listener,i=o;break}if(i<0)return this;0===i?t.shift():function(e,r){for(;r+1<e.length;r++)e[r]=e[r+1];e.pop()}(t,i),1===t.length&&(n[e]=t[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||r)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var r,t,n;if(void 0===(t=this._events))return this;if(void 0===t.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0==arguments.length){var i,o=Object.keys(t);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(r=t[e]))this.removeListener(e,r);else if(void 0!==r)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,r){return"function"==typeof e.listenerCount?e.listenerCount(r):v.call(e,r)},s.prototype.listenerCount=v,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}},a=!0;try{e[r](i,i.exports,o),a=!1}finally{a&&delete t[r]}return i.exports}o.ab="/ROOT/node_modules/.pnpm/next@16.1.1_@babel+core@7.21.4_@opentelemetry+api@1.9.0_babel-plugin-macros@3.1.0_react_7fdb221be1b0a2ee62c2f7486bb51667/node_modules/next/dist/compiled/events/",r.exports=o(864)}()},353579,e=>{"use strict";var r=e.i(331762);e.i(297083),e.i(817556);var t=e.i(671901);function n(e){var n=e.split(".");if(4!==n.length)throw Error("Invalid token: should have exactly 4 parts: "+e);for(var i=n[2].replace(/-/g,"+").replace(/_/g,"/");i.length%4;)i+="=";var o=window.atob(i);if(o.length<64)throw Error("Invalid token: signed part is too short: "+o.length);var a=o.substring(0,o.length-64);return t.api.token.ReplToken.decode(r.Buffer.from(a,"base64"))}function i(e){var r,t=null!=(r=({"infra-staging":"platform-infra-staging","ukg-usc1":"platform-ukg",mark:"platform-replit"})[e])?r:"platform";return"https://zipper.".concat(e,".").concat(t,".replit.com")}e.s(["getZipperUrl",()=>i,"parseToken",()=>n])},240913,e=>{"use strict";var r=e.i(193060),t=(0,r.toRelativeFsPath)("."),n=(0,r.toRelativeFsPath)(".env");(0,r.toRelativeFsPath)(".lesson"),(0,r.toRelativeFsPath)(".tutorial"),e.s(["DOT_ENV",()=>n,"ROOT_PATH",()=>t])},469546,(e,r,t)=>{var n,i=e.r(365738),o=function(e){e.version="1.2.2";var r=function(){for(var e=0,r=Array(256),t=0;256!=t;++t)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=t)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1,r[t]=e;return"undefined"!=typeof Int32Array?new Int32Array(r):r}(),t=function(e){var r=0,t=0,n=0,i="undefined"!=typeof Int32Array?new Int32Array(4096):Array(4096);for(n=0;256!=n;++n)i[n]=e[n];for(n=0;256!=n;++n)for(t=e[n],r=256+n;r<4096;r+=256)t=i[r]=t>>>8^e[255&t];var o=[];for(n=1;16!=n;++n)o[n-1]="undefined"!=typeof Int32Array?i.subarray(256*n,256*n+256):i.slice(256*n,256*n+256);return o}(r),n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],f=t[8],d=t[9],h=t[10],p=t[11],v=t[12],m=t[13],g=t[14];e.table=r,e.bstr=function(e,t){for(var n=-1^t,i=0,o=e.length;i<o;)n=n>>>8^r[(n^e.charCodeAt(i++))&255];return~n},e.buf=function(e,t){for(var y=-1^t,E=e.length-15,C=0;C<E;)y=g[e[C++]^255&y]^m[e[C++]^y>>8&255]^v[e[C++]^y>>16&255]^p[e[C++]^y>>>24]^h[e[C++]]^d[e[C++]]^f[e[C++]]^u[e[C++]]^c[e[C++]]^l[e[C++]]^s[e[C++]]^a[e[C++]]^o[e[C++]]^i[e[C++]]^n[e[C++]]^r[e[C++]];for(E+=15;C<E;)y=y>>>8^r[(y^e[C++])&255];return~y},e.str=function(e,t){for(var n=-1^t,i=0,o=e.length,a=0,s=0;i<o;)(a=e.charCodeAt(i++))<128?n=n>>>8^r[(n^a)&255]:a<2048?n=(n=n>>>8^r[(n^(192|a>>6&31))&255])>>>8^r[(n^(128|63&a))&255]:a>=55296&&a<57344?(a=(1023&a)+64,s=1023&e.charCodeAt(i++),n=(n=(n=(n=n>>>8^r[(n^(240|a>>8&7))&255])>>>8^r[(n^(128|a>>2&63))&255])>>>8^r[(n^(128|s>>6&15|(3&a)<<4))&255])>>>8^r[(n^(128|63&s))&255]):n=(n=(n=n>>>8^r[(n^(224|a>>12&15))&255])>>>8^r[(n^(128|a>>6&63))&255])>>>8^r[(n^(128|63&a))&255];return~n}};if("undefined"==typeof DO_NOT_EXPORT_CRC)if("object"===i._(t))o(t);else if("function"==typeof define&&define.amd)e.r,o(n={}),void 0!==n&&e.v(n);else o({});else o({})},435575,e=>{"use strict";var r=e.i(716499),t=e.i(980768),n=e.i(529131);function i(e,i){(0,n.default)(2,arguments);var o=(0,r.default)(i);return(0,t.default)(e,1e3*o)}e.s(["addSeconds",()=>i],435575)},494065,e=>{"use strict";var r=e.i(968069),t=/^(\.npm$|\.npm\/|__pycache__|\.cache|\.breakpoints|\.git$|\.git\/|\.upm$|\.upm\/|node_modules$|node_modules\/|_test_runner|\.local)/;function n(e){return t.test(e)}function i(e){return e.startsWith(".")&&!r.default.includes(e)}var o=[".git",".upm",".cache","__pycache__","node_modules","venv",".pythonlibs",".local"];e.s(["ignoredDirs",()=>o,"isDotFile",()=>i,"isHiddenFile",()=>n])},880581,(e,r,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniToStrPos=t.strPosToUni=void 0,t.strPosToUni=function(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,t=0,n=0;n<r;n++){var i=e.charCodeAt(n);i>=55296&&i<=57343&&(t++,n++)}if(n!==r)throw Error("Invalid offset - splits unicode bytes");return n-t},t.uniToStrPos=function(e,r){for(var t=0;r>0;r--){var n=e.charCodeAt(t);t+=n>=55296&&n<=57343?2:1}return t}},118074,(e,r,t)=>{"use strict";var n=e.r(365738);Object.defineProperty(t,"__esModule",{value:!0});var i=e.r(880581),o=function(e){if(!Array.isArray(e))throw Error("Op must be an array of components");for(var r=null,t=0;t<e.length;t++){var i=e[t];switch(void 0===i?"undefined":n._(i)){case"object":if(!("number"==typeof i.d&&i.d>0))throw Error("Object components must be deletes of size > 0");break;case"string":if(!(i.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(i>0))throw Error("Skip components must be >0");if("number"==typeof r)throw Error("Adjacent skip components should be combined")}r=i}if("number"==typeof r)throw Error("Op has a trailing skip")},a=function(e){for(var r=[],t=s(r),n=0;n<e.length;n++)t(e[n]);return u(r)},s=function(e){return function(r){r&&0!==r.d&&(0===e.length?e.push(r):(void 0===r?"undefined":n._(r))===n._(e[e.length-1])?(void 0===r?"undefined":n._(r))==="object"?e[e.length-1].d+=r.d:e[e.length-1]+=r:e.push(r))}},l=function(e){return"number"==typeof e?e:"string"==typeof e?i.strPosToUni(e):e.d},c=function(e){var r=0,t=0;return{take:function(n,o){if(r===e.length)return -1===n?null:n;var a,s=e[r];if("number"==typeof s)if(-1===n||s-t<=n)return a=s-t,++r,t=0,a;else return t+=n,n;if("string"==typeof s)if(-1===n||"i"===o||i.strPosToUni(s.slice(t))<=n)return a=s.slice(t),++r,t=0,a;else{var l=t+i.uniToStrPos(s.slice(t),n);return a=s.slice(t,l),t=l,a}return -1===n||"d"===o||s.d-t<=n?(a={d:s.d-t},++r,t=0,a):(t+=n,{d:n})},peek:function(){return e[r]}}},u=function(e){return e.length>0&&"number"==typeof e[e.length-1]&&e.pop(),e};function f(e,r,t){if("left"!==t&&"right"!==t)throw Error("side ("+t+") must be 'left' or 'right'");o(e),o(r);for(var a,f=[],d=s(f),h=c(e),p=h.take,v=h.peek,m=0;m<r.length;m++){var g=r[m],y=void 0,E=void 0;switch(void 0===g?"undefined":n._(g)){case"number":for(y=g;y>0;)d(E=p(y,"i")),"string"!=typeof E&&(y-=l(E));break;case"string":"left"===t&&"string"==typeof v()&&d(p(-1)),d(i.strPosToUni(g));break;case"object":for(y=g.d;y>0;)switch(void 0===(E=p(y,"i"))?"undefined":n._(E)){case"number":y-=E;break;case"string":d(E);break;case"object":y-=E.d}}}for(;a=p(-1);)d(a);return u(f)}function d(e,r){o(e),o(r);for(var t,a=[],f=s(a),d=c(e).take,h=0;h<r.length;h++){var p=r[h],v=void 0,m=void 0;switch(void 0===p?"undefined":n._(p)){case"number":for(v=p;v>0;)f(m=d(v,"d")),(void 0===m?"undefined":n._(m))!=="object"&&(v-=l(m));break;case"string":f(p);break;case"object":for(v=p.d;v>0;)switch(void 0===(m=d(v,"d"))?"undefined":n._(m)){case"number":f({d:m}),v-=m;break;case"string":v-=i.strPosToUni(m);break;case"object":f(m)}}}for(;t=d(-1);)f(t);return u(a)}var h=function(e,r){for(var t=0,o=0;o<r.length&&e>t;o++){var a=r[o];switch(void 0===a?"undefined":n._(a)){case"number":t+=a;break;case"string":var s=i.strPosToUni(a);t+=s,e+=s;break;case"object":e-=Math.min(a.d,e-t)}}return e},p=function(e,r){return"number"==typeof e?h(e,r):e.map(function(e){return h(e,r)})};t.default=function(e){return{name:"text-unicode",uri:"http://sharejs.org/types/text-unicode",trim:u,normalize:a,checkOp:o,create:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("string"!=typeof r)throw Error("Initial data must be a string");return e.create(r)},apply:function(r,t){o(t);for(var i=e.builder(r),a=0;a<t.length;a++){var s=t[a];switch(void 0===s?"undefined":n._(s)){case"number":i.skip(s);break;case"string":i.append(s);break;case"object":i.del(s.d)}}return i.build()},transform:f,compose:d,transformPosition:h,transformSelection:p}}},753221,(e,r,t)=>{"use strict";var n=e.r(365738);Object.defineProperty(t,"__esModule",{value:!0});var i=e.r(880581);function o(e,r){return{get:e,getLength:function(){return e().length},insert:function(t,n,o){return r([i.strPosToUni(e(),t),n],o)},remove:function(t,n,o){return r([i.strPosToUni(e(),t),{d:n}],o)},_onOp:function(e){for(var r=0,t=0,i=0;i<e.length;i++){var o=e[i];switch(void 0===o?"undefined":n._(o)){case"number":r+=o,t+=o;break;case"string":this.onInsert&&this.onInsert(r,o),r+=o.length;break;case"object":this.onRemove&&this.onRemove(r,o.d),t+=o.d}}},onInsert:null,onRemove:null}}t.default=o,o.provides={text:!0}},402238,(e,r,t)=>{"use strict";var n=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.type=void 0;var i=e.r(880581),o=n(e.r(118074)),a=n(e.r(753221));t.type=Object.assign(Object.assign({},o.default({create:function(e){return e},toString:function(e){return e},builder:function(e){if("string"!=typeof e)throw Error("Invalid document snapshot: "+e);var r=[];return{skip:function(t){var n=i.uniToStrPos(e,t);if(n>e.length)throw Error("The op is too long for this document");r.push(e.slice(0,n)),e=e.slice(n)},append:function(e){r.push(e)},del:function(r){e=e.slice(i.uniToStrPos(e,r))},build:function(){return r.join("")+e}}}})),{api:a.default});var s=e.r(118074);Object.defineProperty(t,"makeType",{enumerable:!0,get:function(){return s.default}})},629712,798680,e=>{"use strict";e.i(148382);var r=e.i(297083),t=e.i(878420),n=e.i(64386),i=e.i(633600),o=e.i(346715),a=e.i(817556),s=e.i(830675),l=e.i(790155),c=e.i(960933),u=e.i(862927),f=e.i(469546),d=e.i(435575),h=e.i(753950),p=e.i(328751),v=e.i(671901),m=e.i(644920),g=e.i(968263),y=e.i(995683),E=e.i(193060),C=e.i(205104),b=e.i(353579),_=e.i(494065),w=e.i(240913),F=e.i(399119),x=e.i(904851),S=e.i(90659),T=e.i(721281),k=e.i(445789),O=e.i(804828),D=e.i(223808),R=e.i(402238),P=e.i(827444),j=e.i(709485),A=e.i(272391),L=e.i(119468);function N(e){return e.map(function(e){return(void 0===e?"undefined":(0,L._)(e))==="object"?{delete:e.d}:"number"==typeof e?{skip:e}:{insert:e}})}function I(e){return e.map(function(e){if("delete"in e&&e.delete)return{d:e.delete};if("skip"in e&&e.skip)return e.skip;if("insert"in e&&"string"==typeof e.insert)return e.insert;throw Error("Unexpected op type")})}function M(e,r){var t=[],n=r,i=0,o=0,a=0,s=0,l=function(e){var t=e-o;if(e<o)throw Error("expected changeset to be ordered");for(var n=o+a;n<o+t+a;n++){var i=r.charCodeAt(n);i>=55296&&i<=57343?(s++,n++):13===i&&10===r.charCodeAt(n+1)&&(a++,n++)}o+=t};return e.iterChanges(function(e,r,c,u,f){if(e>0){var d=o+a,h=d-s;l(e);var p=o+a,v=p-s;t.push(v-h),i+=p-d}if(e!==r){var m=o+a,g=m-s;l(r);var y=o+a,E=y-s;t.push({d:E-g}),n=n.slice(0,i)+n.slice(i+(y-m))}if(f.length){var C=f.sliceString(0);t.push(C),n=n.slice(0,i)+C+n.slice(i),i+=C.length}}),{op:t,docAfter:n}}function U(e,r){var t=[],n=r,i=0,o=0,a=0,s=0,l=function(e){for(var t=o+a;t<o+e+a;t++){var n=r.charCodeAt(t);n>=55296&&n<=57343?(a++,t++):13===n&&10===r.charCodeAt(t+1)&&(s++,t++)}o+=e},c=!0,u=!1,f=void 0;try{for(var d,p,v=e[Symbol.iterator]();!(c=(p=v.next()).done);c=!0){var m=p.value;if("string"==typeof m){var g=m;n=n.slice(0,i)+g+n.slice(i),i+=g.length;var y=o+a;if(g.endsWith("\r")&&"\n"===r.slice(y,y+1)&&(g=g.slice(0,-1),0===g.length))continue;var E=B(g),C=y-s;(null==d?void 0:d.to)===C?d.insert=d.insert?d.insert.append(E):E:(d={from:y-s,insert:E},t.push(d))}else if("number"==typeof m){var b=a;l(m);var _=a-b;i+=m+_}else if("d"in m){var w=o+a,F=s;l(m.d);var x=o+a,S=x-w;n=n.slice(0,i)+n.slice(i+S);var T=w-F,k=x-s;if("\r\n"===r.slice(w-1,w+1)&&(T+=1,(k-=1)-T<=0))continue;(null==d?void 0:d.to)===T?d.to=k:(d={from:T,to:k},t.push(d))}}}catch(e){u=!0,f=e}finally{try{c||null==v.return||v.return()}finally{if(u)throw f}}if(o+a!==r.length){var O=r.slice(o+a);s+=O.split("\r\n").length-1}return{changes:h.ChangeSet.of(t,r.length-s),docAfter:n}}var z=/\r\n?|\n/;function V(e){return e.replaceAll("\r\n","\n").replaceAll("\r","\n")}function B(e){return h.Text.of(e.split(z))}e.s(["asCodeMirrorText",()=>B,"changeSetToOp",()=>M,"fromProtocolOp",()=>I,"opToChangeSet",()=>U,"toCodeMirrorString",()=>V,"toProtocolOp",()=>N],798680);var q=e.i(257982),W=e.i(903381);function Q(e,r){var t=!0,n=!1,i=void 0;try{for(var o,a=r[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;switch(s){case W.FsErrors.NotFound:if(e.includes("no such file")||e.includes("file does not exist"))return W.FsErrors.NotFound;break;case W.FsErrors.AlreadyExists:if(e.includes("file exist"))return W.FsErrors.AlreadyExists;break;case W.FsErrors.NotDirectory:if(e.includes("not a directory"))return W.FsErrors.NotDirectory;break;case W.FsErrors.IsDirectory:if(e.includes("is a directory"))return W.FsErrors.IsDirectory;break;case W.FsErrors.InvalidPath:if(e.includes("absolute paths are not supported"))return W.FsErrors.InvalidPath;break;case W.FsErrors.DiskQuotaExceeded:if(e.includes("disk quota exceeded"))return W.FsErrors.DiskQuotaExceeded;break;case W.FsErrors.PermissionDenied:if(e.includes("permission denied"))return W.FsErrors.PermissionDenied;break;case W.FsErrors.FileSystemUnavailable:if(e.includes("input/output error"))return W.FsErrors.FileSystemUnavailable;break;case W.FsErrors.NotReadable:if(e.includes("could not read the uploaded file"))return W.FsErrors.NotReadable;break;default:(0,q.default)(s)}}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}return null}var Y=function(e){function i(e,o,s,l,c,u){(0,x._)(this,i),d=(0,F._)(this,i),(0,T._)(d,"linkedFile",void 0),(0,T._)(d,"channel",void 0),(0,T._)(d,"destroy",void 0),(0,T._)(d,"metadata",void 0),(0,T._)(d,"pending",void 0),(0,T._)(d,"inflight",void 0),(0,T._)(d,"inflightOpsPromise",void 0),(0,T._)(d,"version",void 0),(0,T._)(d,"serverContent",void 0),(0,T._)(d,"localContent",void 0),(0,T._)(d,"pendingCursors",void 0),(0,T._)(d,"flushedCursorIds",void 0),(0,T._)(d,"user",void 0),(0,T._)(d,"debounceSend",void 0),(0,T._)(d,"debounceCommit",void 0),(0,T._)(d,"commitPromise",void 0),(0,T._)(d,"isReconnecting",void 0),(0,T._)(d,"shouldTrackDataLoss",void 0),(0,T._)(d,"replId",void 0),(0,T._)(d,"uncommittedOps",void 0),(0,T._)(d,"hasUncommittedMultiplayerOps",void 0),(0,T._)(d,"committedVersion",void 0),(0,T._)(d,"committedContent",void 0),(0,T._)(d,"flushFailed",void 0),(0,T._)(d,"bufferedReconnectingOps",void 0),(0,T._)(d,"didEditOffline",void 0),(0,T._)(d,"reconnectTrackedData",void 0),(0,T._)(d,"timeDisconnected",void 0),(0,T._)(d,"logger",void 0),(0,T._)(d,"track",void 0),(0,T._)(d,"dataloss",void 0),(0,T._)(d,"writeChanges",function(e,r){if(!d.channel&&!d.isReconnecting)throw Error("Trying to send changes before ever coming online");d.isReconnecting&&(d.didEditOffline=!0);var n=M(e,d.localContent),i=n.op,o=n.docAfter;if(.1>Math.random()){var a=V(R.type.apply(d.localContent,i)),s=e.apply(B(d.localContent));(a!==s.sliceString(0)||a!==V(o))&&d.onError("changeset to op mismatch",{originalError:null,changes:e,otContent:a,changeSetContent:s,docAfter:o})}var l=(null==r?void 0:r.author)==="ghostwriter"?{author:v.api.OTPacket.Author.GHOSTWRITER}:{};d.metadata=(0,t._)({},d.metadata,l);try{d.pending=R.type.compose(d.pending,i)}catch(e){throw A.default.wrap(e).setExtras({op:i,pending:d.pending})}d.localContent=o,0!==d.pending.length?d.emit("fileDirty"):d.commitPromise&&d.emit("commitStart"),d.debounceSend()}),(0,T._)(d,"updateCursors",function(e){d.pendingCursors=e,d.debounceSend()}),(0,T._)(d,"isClean",function(){return d.committedVersion===d.version&&0===d.inflight.length&&0===d.pending.length}),(0,T._)(d,"onError",function(e,r){if(r.originalError){var i="string"==typeof r.originalError?r.originalError:r.originalError.message,o=Q(i,[W.FsErrors.NotFound,W.FsErrors.IsDirectory,W.FsErrors.DiskQuotaExceeded,W.FsErrors.InvalidPath,W.FsErrors.PermissionDenied,W.FsErrors.FileSystemUnavailable]);if(o)return void d.emit("fsError",o,i)}d.destroy();var a=Error("OT Error: "+e);d.emit("error",a,(0,n._)((0,t._)({},r),{filePath:d.linkedFile,version:d.version}))}),(0,T._)(d,"sendOp",function(){if(d.channel&&"open"===d.channel.status&&!d.isReconnecting&&!(d.inflight.length>0)){if(0!==d.pending.length){var e=N(d.pending);d.inflight=d.pending,d.pending=[],d.inflightOpsPromise=d.channel.request({ot:(0,t._)({spookyVersion:d.version,op:e},d.metadata)}),d.metadata={},d.inflightOpsPromise.then(function(r){r.error&&d.onError("error accepting packet",{originalError:r.error,op:e})})}if(0!==d.pendingCursors.length){var r=!0,n=!1,i=void 0;try{for(var o,a=d.flushedCursorIds[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;d.channel.send({otDeleteCursor:{id:s}})}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}d.flushedCursorIds=[];var l=!0,c=!1,u=void 0;try{for(var f,h=d.pendingCursors[Symbol.iterator]();!(l=(f=h.next()).done);l=!0){var p=f.value,v=Number(Math.random().toString().split(".")[1]).toString(36);d.flushedCursorIds.push(v),d.channel.send({otNewCursor:(0,t._)({id:v,user:d.user},p)})}}catch(e){c=!0,u=e}finally{try{l||null==h.return||h.return()}finally{if(c)throw u}}d.pendingCursors=[]}}}),(0,T._)(d,"handlePacket",function(e,r){var t,n,i,o=e.op,a=e.version,s=e.crc32,l=e.userId,c=r.overrideReconnectingBuffer;if(d.isReconnecting&&!c)return void d.bufferedReconnectingOps.push({crc32:s,op:o,version:a,userId:l});if(-1===d.version)return void d.onError("Got packet while version is still -1, expected version to be set in handleStatus",{originalError:null});if(d.version++,a!==d.version){var u={originalError:null,expectedVersion:d.version,receivedVersion:a,incomingOp:o};d.logger.error("OT Error: invalid server version",(0,P.flattenExtra)({details:u})),d.onError("invalid server version",u);return}try{d.serverContent=R.type.apply(d.serverContent,o)}catch(e){d.onError("unable to apply updated content",{originalError:e,incomingOp:o});return}var h=f.str(d.serverContent)>>>0;if(h!==s){var p={originalError:null,incomingVersion:a,server:s,client:h,incomingOp:o};d.logger.error("OT Error: crc32 mismatch",(0,P.flattenExtra)({details:p})),d.onError("crc32 mismatch",p);return}if(d.uncommittedOps.push({version:a,crc32:s,op:o,userId:l}),d.dataloss&&d.shouldTrackDataLoss&&d.dataloss.storeOp({replId:d.replId,filePath:d.linkedFile.toString(),opType:"latestOp",op:{version:a,crc32:s},logger:d.logger,isReconnecting:d.isReconnecting}),JSON.stringify(o)===JSON.stringify(d.inflight)){d.dataloss&&d.shouldTrackDataLoss&&d.dataloss.storeOp({replId:d.replId,filePath:d.linkedFile.toString(),opType:"latestOwnOp",op:{version:a,crc32:s},logger:d.logger,isReconnecting:d.isReconnecting}),d.debounceCommit(),d.inflight=[],d.inflightOpsPromise=null,d.debounceSend(),d.debounceSend.flush();return}if(d.commitPromise||d.emit("fileDirty"),d.debounceCommit(),d.hasUncommittedMultiplayerOps=!0,d.inflight.length){var v=R.type.transform(d.inflight,o,"right");o=R.type.transform(o,d.inflight,"left"),d.inflight=v}if(d.pending.length){var m=R.type.transform(d.pending,o,"right");o=R.type.transform(o,d.pending,"left"),d.pending=m}try{t=(i=U(o,d.localContent)).changes,n=i.docAfter}catch(e){d.onError("unable to apply updated op",{originalError:e,incomingOp:o});return}if(.1>Math.random()){var g=V(R.type.apply(d.localContent,o)),y=t.apply(B(d.localContent));(g!==y.sliceString(0)||g!==V(n))&&d.onError("op to changeset mismatch",{originalError:null,op:o,otContent:g,changeSetContent:y,docAfter:n})}d.localContent=n,d.emit("changes",t,l)}),(0,T._)(d,"handleNewCursor",function(e){d.emit("cursor",e)}),(0,T._)(d,"handleDeleteCursor",function(e){var r=e.id;d.emit("removeCursor",r)}),(0,T._)(d,"handleStatus",function(e){return(0,r._)(function(){var r,t,n,i,o;return(0,a._)(this,function(a){switch(a.label){case 0:if(!d.channel||"open"!==d.channel.status)return[2];if(e.linkedFile){if(null==e.contents)return d.onError("expected status contents, got null or undefined",{originalError:null}),[2];if(null==e.cursors)return d.onError("expected status cursors, got null or undefined",{originalError:null}),[2];if(null==e.version)return d.onError("expected status version, got null or undefined",{originalError:null}),[2];if(d.isReconnecting)return d.handleReconnect(e.contents,e.version),[2];return d.dataloss&&d.shouldTrackDataLoss&&d.dataloss.checkAndTrack({serverContent:e.contents,serverVersion:e.version,replId:d.replId,filePath:d.linkedFile.toString(),fetchOps:d.fetchOps,logger:d.logger}),d.serverContent=e.contents,d.localContent=d.serverContent,d.version=e.version,d.emit("firstConnect"),d.emit("changes",h.ChangeSet.of({from:0,insert:d.serverContent},0)),e.cursors.forEach(d.handleNewCursor),d.emit("fileDirty"),d.debounceCommit(),[2]}return[4,d.channel.request({otLinkFile:{file:{path:d.linkedFile.toString()}}})];case 1:if((t=a.sent()).channelClosed)return[2];if(t.error)return d.onError("link file error "+t.error.replace(d.linkedFile.toString(),"$FILENAME"),{originalError:t.error}),[2];if(!t.otLinkFileResponse)return d.onError("unexpected link file response: "+JSON.stringify(t.toJSON()),{originalError:null}),[2];if(n=t.otLinkFileResponse.version,o=y.default.from(null!=(i=null==(r=t.otLinkFileResponse.linkedFile)?void 0:r.content)?i:"").toString(),d.isReconnecting)return d.handleReconnect(o,n),[2];return d.dataloss&&d.shouldTrackDataLoss&&d.dataloss.checkAndTrack({serverContent:o,serverVersion:n,replId:d.replId,filePath:d.linkedFile.toString(),fetchOps:d.fetchOps,logger:d.logger}),d.serverContent=o,d.localContent=d.serverContent,d.version=n,d.committedVersion=n,d.committedContent=d.serverContent,d.emit("firstConnect"),d.emit("changes",h.ChangeSet.of({from:0,insert:d.serverContent},0)),[2]}})})()}),(0,T._)(d,"handleReconnect",function(e,i){return(0,r._)(function(){var r,o,s,l,c,u,f,h,p,v,m,g,y,E,C,b,_,w,F,x,S,T,k,O,D,A,L,N,I,M,U,z,V,B,q,W,Q,Y,K,H,J,G,X,$,Z,ee,er,et,en,ei,eo;return(0,a._)(this,function(a){switch(a.label){case 0:if(!d.timeDisconnected)throw Error("wat");if(r=Date.now()-d.timeDisconnected,o={case:"other",remoteContent:e,localContent:d.localContent},s=function(o){d.reconnectTrackedData=(0,n._)((0,t._)({},o),{serverVersion:i,ourVersion:d.version,ourCommittedVersion:d.committedVersion,areContentsEqual:d.serverContent===e,areCommittedContentsEqual:d.committedContent===e,didReceiveOpsWhileReconnecting:!!d.bufferedReconnectingOps.length,didEditOffline:d.didEditOffline,hasPendingOps:!!d.pending.length,hasUncommittedMultiplayerOps:d.hasUncommittedMultiplayerOps,disconnectDuration:r});var a={};("has_inflight"===o.case||"same_version_different_content"===o.case||"multiplayer"===o.case)&&.1>Math.random()&&(a={hasAdditionalLogs:!0,localContent:String(d.localContent),ourContent:String(d.serverContent),ourCommittedContent:String(d.committedContent),ourInflight:JSON.stringify(d.inflight),ourPending:JSON.stringify(d.pending),serverContent:String(e)}),d.logger.info("OT Client: Reconnect",(0,P.flattenExtra)((0,t._)({},d.reconnectTrackedData,a))),d.track&&d.track(j.events.FILE_RECONNECTED_STATUS2,d.reconnectTrackedData)},l=function(e,r){s({case:e,originCase:r,prompted:!1}),d.isReconnecting=!1,d.bufferedReconnectingOps=[],d.didEditOffline=!1,d.timeDisconnected=null,d.debounceSend(),d.debounceCommit(),d.emit("transparentReconnect",{case:e,originCase:r})},c=function(r){if(o.remoteContent===o.localContent){d.version=i,d.committedVersion=i,d.localContent=e,d.committedContent=e,d.serverContent=e,d.inflight=[],d.pending=[],l("unprompted_because_identical",r);return}s({case:r,prompted:!0}),o.case=r,d.emit("promptUserReconnect",o)},d.inflight.length){if(i===d.version&&d.serverContent===e)return d.pending=R.type.compose(d.inflight,d.pending),d.inflight=[],d.inflightOpsPromise=null,l("has_inflight_happy_path_ops_unreached"),[2];u=!1,f=d.serverContent;try{f=R.type.apply(f,d.inflight)}catch(e){u=!0}if(!u&&d.version+1===i&&f===e)return d.inflight=[],d.inflightOpsPromise=null,d.serverContent=e,d.version=i,l("has_inflight_happy_path_ops_reached"),[2];return c("has_inflight"),[2]}if(d.hasUncommittedMultiplayerOps)return c("multiplayer"),[2];if(d.version===i){if(e===d.serverContent)return l("happy_path"),[2];return c("same_version_different_content"),[2]}if(d.committedVersion===i){h=e;try{p=!0,v=!1,m=void 0;try{for(g=d.uncommittedOps[Symbol.iterator]();!(p=(y=g.next()).done);p=!0)E=y.value.op,h=R.type.apply(h,E)}catch(e){v=!0,m=e}finally{try{p||null==g.return||g.return()}finally{if(v)throw m}}}catch(e){return c("same_committed_version_unable_to_apply_ops"),[2]}if(h===d.serverContent){C=[],b=!0,_=!1,w=void 0;try{for(F=d.uncommittedOps[Symbol.iterator]();!(b=(x=F.next()).done);b=!0)S=x.value.op,C=R.type.compose(C,S)}catch(e){_=!0,w=e}finally{try{b||null==F.return||F.return()}finally{if(_)throw w}}return d.pending=R.type.compose(C,d.pending),d.uncommittedOps=[],d.version=i,d.serverContent=e,l("happy_path_uncommitted"),[2]}return c("same_committed_version_different_content_fixed"),[2]}if(!(d.version<i))return[3,3];return[4,d.fetchOps(d.version+1,i)];case 1:T=a.sent(),k=!1,O=d.serverContent;try{D=!0,A=!1,L=void 0;try{for(N=T[Symbol.iterator]();!(D=(I=N.next()).done);D=!0)M=I.value.op,O=R.type.apply(O,M)}catch(e){A=!0,L=e}finally{try{D||null==N.return||N.return()}finally{if(A)throw L}}}catch(e){k=!0}if(!k&&O===e){U=!0,z=!1,V=void 0;try{for(B=T[Symbol.iterator]();!(U=(q=B.next()).done);U=!0)W=q.value,d.handlePacket(W,{overrideReconnectingBuffer:!0})}catch(e){z=!0,V=e}finally{try{U||null==B.return||B.return()}finally{if(z)throw V}}Q=!0,Y=!1,K=void 0;try{for(H=d.bufferedReconnectingOps[Symbol.iterator]();!(Q=(J=H.next()).done);Q=!0)G=J.value,d.handlePacket(G,{overrideReconnectingBuffer:!0})}catch(e){Y=!0,K=e}finally{try{Q||null==H.return||H.return()}finally{if(Y)throw K}}return l("happy_path_server_ahead"),[2]}return[4,d.fetchOps(d.committedVersion+1,i)];case 2:X=a.sent(),$=!1,Z=d.committedContent;try{ee=!0,er=!1,et=void 0;try{for(en=X[Symbol.iterator]();!(ee=(ei=en.next()).done);ee=!0)eo=ei.value.op,Z=R.type.apply(Z,eo)}catch(e){er=!0,et=e}finally{try{ee||null==en.return||en.return()}finally{if(er)throw et}}}catch(e){$=!0}if(!$&&Z===e)return c("happy_path_uncommitted_server_ahead"),[2];return c("uncommitted_server_ahead"),[2];case 3:return c("other"),[2]}})})()}),(0,T._)(d,"flush",function(){return(0,r._)(function(){return(0,a._)(this,function(e){switch(e.label){case 0:return[4,d.commitPromise];case 1:return e.sent(),d.debounceCommit(),d.debounceCommit.flush(),[4,d.commitPromise];case 2:return e.sent(),[2]}})})()}),(0,T._)(d,"isFileSaved",function(){return!0}),(0,T._)(d,"fetchOps",function(e,t){return(0,r._)(function(){var r;return(0,a._)(this,function(n){switch(n.label){case 0:if(!d.channel)throw Error("No channel, cannot fetchOps");return[4,d.channel.request({otFetchRequest:{versionFrom:e,versionTo:t}})];case 1:if((r=n.sent()).channelClosed)throw Error("Channel closed while requesting");if(r.error)throw Error("Fetch ops returned an error: "+r.error);if(!r.otFetchResponse)throw Error("Expected otFetchResponse");if(!r.otFetchResponse.packets)throw Error("Expected otFetchResponse.packets");return[2,r.otFetchResponse.packets.map(function(e){var r=e.crc32,t=e.op,n=e.version,i=e.userId,o=e.committed,a=e.author;if(null==r)throw Error("Expected crc32 in packet");if(null==t)throw Error("Expected op in packet");if(null==n)throw Error("Expected version in packet");return{crc32:r,version:n,op:I(t),userId:i,timestamp:o?1e3*o.seconds:0,author:a}})]}})})()}),(0,T._)(d,"fetchChanges",function(e,t,n){return(0,r._)(function(){var r,i;return(0,a._)(this,function(o){switch(o.label){case 0:return[4,d.fetchOps(e,t)];case 1:return r=o.sent(),i=n,[2,r.map(function(e){var r=e.op,t=e.version,n=e.userId,o=e.timestamp,a=e.crc32,s=U(r,i),l=s.changes,c=s.docAfter,u=l.invert(B(i));return i=c,{changes:l,invertedChanges:u,userId:n,version:t,timestamp:o,crc32:a}})]}})})()}),(0,T._)(d,"transformSelection",function(e){var t=e.indexStart,n=e.indexEnd,i=e.versionFrom,o=e.versionTo;return(0,r._)(function(){var e,r,s,l;return(0,a._)(this,function(a){switch(a.label){case 0:if(!d.channel)throw Error("No channel, cannot transformSelection");return[4,d.channel.request({otTransformSelectionRequest:{indexStart:t,indexEnd:n,versionFrom:i,versionTo:o}})];case 1:if(!(e=a.sent()).otTransformSelectionResponse)throw Error("Expected otTransformSelectionResponse");return[2,{indexStart:null!=(r=e.otTransformSelectionResponse.indexStart)?r:0,indexEnd:null!=(s=e.otTransformSelectionResponse.indexEnd)?s:0,version:null!=(l=e.otTransformSelectionResponse.version)?l:0}]}})})()}),(0,T._)(d,"getLocalContent",function(){return V(d.localContent)}),(0,T._)(d,"getRawLocalContent",function(){return d.localContent}),d.shouldTrackDataLoss=!1,d.replId="",d.linkedFile=e,d.channel=null,d.inflight=[],d.inflightOpsPromise=null,d.uncommittedOps=[],d.hasUncommittedMultiplayerOps=!1,d.committedVersion=-1,d.isReconnecting=!1,d.bufferedReconnectingOps=[],d.didEditOffline=!1,d.pending=[],d.metadata={},d.version=-1,d.serverContent="",d.localContent="",d.committedContent="",d.flushedCursorIds=[],d.pendingCursors=[],d.user=null,d.flushFailed=0,d.debounceSend=(0,D.default)(function(){return d.sendOp()},20,{maxWait:60});var d,p=(0,D.default)(function(){return d.commitToDisk()},1e3,{maxWait:3e3}),m=function(){if(!d.channel)throw Error("Tryna commit while offline");if(d.isReconnecting)throw Error("Committing while reconnecting");return p()};m.cancel=p.cancel,m.flush=p.flush,d.debounceCommit=m,d.commitPromise=null,d.timeDisconnected=null;var g=!1;return d.destroy=function(){g=!0},d.logger=l,d.track=u,d.dataloss=c,s.then(function(){g||(d.destroy=o.openChannel({service:"ot",name:"ot:".concat(e)},function(r){var t=r.channel,n=r.context;return d.shouldTrackDataLoss=!window.navigator.userAgent.includes("Firefox"),d.replId=n.repl.id,d.dataloss&&d.shouldTrackDataLoss&&d.dataloss.ensureTrackedFile({replId:d.replId,filePath:e.toString()}),d.user=n.currentUser?{name:n.currentUser.username,id:n.currentUser.id}:null,d.channel=t,t.onCommand(function(e){switch(e.body){case"ot":if(!e.ot||null==e.ot.op||null==e.ot.spookyVersion||null==e.ot.crc32)return void d.onError("missing data in ot packet",{originalError:null,op:null==(r=e.ot)?void 0:r.op,spookyVersion:null==(t=e.ot)?void 0:t.spookyVersion,crc32:null==(n=e.ot)?void 0:n.crc32});if(-1===d.version)return;var r,t,n,i,o={crc32:e.ot.crc32,op:I(e.ot.op),version:e.ot.spookyVersion,userId:null!=(i=e.ot.userId)?i:0};return d.handlePacket(o,{overrideReconnectingBuffer:!1});case"otstatus":return d.handleStatus(e.otstatus);case"error":if(e.ref)return;return d.onError("Unknown protocol error OT channel",{originalError:e.error||"no error"});case"otNewCursor":return d.handleNewCursor(e.otNewCursor);case"otDeleteCursor":return d.handleDeleteCursor(e.otDeleteCursor)}}),function(){d.channel=null,d.isReconnecting=!0,d.debounceSend.cancel(),d.debounceCommit.cancel(),d.timeDisconnected||(d.timeDisconnected=Date.now())}}))}),d}return(0,k._)(i,e),(0,S._)(i,[{key:"commitToDisk",value:function(){return(0,r._)(function(){var e,r,t,n,i,o,s;return(0,a._)(this,function(a){switch(a.label){case 0:if(e=this,!this.channel)throw Error("Tryna commit while offline");if("open"!==this.channel.status)return[2];if(this.isReconnecting)throw Error("Committing while reconnecting");if(this.isClean())return[2];if(this.commitPromise)return this.debounceCommit(),[2];if(r=function(){},this.commitPromise=new Promise(function(e){return r=e}),!this.inflightOpsPromise)return[3,2];return[4,this.inflightOpsPromise];case 1:if(a.sent().channelClosed)return this.commitPromise=null,r(),[2];a.label=2;case 2:if(!(this.pending.length>0))return[3,4];if(this.debounceSend(),this.debounceSend.flush(),!this.inflightOpsPromise)return this.commitPromise=null,r(),this.onError("expected inflight promise",{originalError:null}),[2];return[4,this.inflightOpsPromise];case 3:if(a.sent().channelClosed)return this.commitPromise=null,r(),[2];a.label=4;case 4:return this.emit("commitStart"),t=this.version,n=this.serverContent,[4,this.channel.request({flush:{consistency:v.api.Flush.Consistency.Disk}})];case 5:if((i=a.sent()).channelClosed)return this.flushFailed=0,this.commitPromise=null,r(),[2];if("ok"!==i.body){if(this.commitPromise=null,r(),Q(o=i.error||i.toString(),[W.FsErrors.NotFound,W.FsErrors.AlreadyExists,W.FsErrors.NotDirectory,W.FsErrors.IsDirectory,W.FsErrors.DiskQuotaExceeded]))return this.onError("unable to flush",{originalError:o}),[2];return this.flushFailed++,setTimeout(function(){e.isReconnecting||e.channel&&"open"===e.channel.status&&e.debounceCommit()},Math.min(Math.random()*(Math.pow(2,this.flushFailed)-1)*1e3,1024e3)),[2]}return this.dataloss&&this.shouldTrackDataLoss&&(s=this.uncommittedOps[this.uncommittedOps.length-1])&&this.dataloss.storeOp({replId:this.replId,filePath:this.linkedFile.toString(),op:{crc32:s.crc32,version:s.version},opType:"latestFlushedOp",logger:this.logger,isReconnecting:this.isReconnecting}),this.uncommittedOps=[],this.hasUncommittedMultiplayerOps=!1,this.committedVersion=t,this.committedContent=n,this.flushFailed=0,this.emit("commitComplete",t),this.isClean()&&this.emit("fileClean"),this.commitPromise=null,r(),[2,i]}})}).call(this)}}]),i}(O.EventEmitter),K=e.i(837399);function H(e){var c,u=e.container,d=e.dataloss,b=e.track,F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,r=[];return{enqueue:function(t){for(var n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];if(r.length>=e)throw Error("fs: We retried too many things during a closed channel.");return new Promise(function(e){r.push(e)}).then(function(){return t.apply(void 0,(0,o._)(i))})},flush:function(){r.splice(0,r.length).forEach(function(e){return e()})}}}(),x=F.enqueue,S=F.flush,T=!1,k=null,O=null,D=null,R=0,P=new Map,j=new Map,A=new Map,L=[],N=new Map,I=new Set;u.openChannel({service:"fsevents"},function(e){var r=e.channel;k=r,r.onCommand(function(e){if("fileEvent"===e.body){if(!e.fileEvent)throw Error("Expected fileEvent");var r=e.fileEvent,t=r.file,n=r.dest,i=r.op;if(t){var o=t.path;if(null!==o&&null!==i&&void 0!==o&&void 0!==i){var a=(0,E.toRelativeFsPath)(o);if(K(),P.get(a)||t.type===v.api.File.Type.DIRECTORY)l=W.FileType.Directory;else{var l,c,u=Array.from(P.keys()).find(function(e){return(0,E.isChildOf)(e,a)}),f=u&&(null==(c=P.get(u))?void 0:c.children.find(function(e){return e.filename===(0,E.getFsBaseName)(a)}));l=f?f.type:W.FileType.File}switch(i){case v.api.FileEvent.Op.Create:$({eventType:W.ChangeEventType.Create,node:{path:a,type:l}});break;case v.api.FileEvent.Op.Modify:if(l===W.FileType.Directory){s.withScope(function(e){e.setTag("service","fs"),e.setExtra("path-str",o),e.setExtra("op",i),e.setExtra("file-type",l),s.captureException(Error("Unexpected modify directory event"))});break}$({eventType:W.ChangeEventType.Modify,node:{path:a,type:l}});break;case v.api.FileEvent.Op.Remove:$({eventType:W.ChangeEventType.Delete,node:{path:a,type:l}});break;case v.api.FileEvent.Op.Move:if(null==n||null==n.path)throw Error("Expected dest path");var d=n.path;$({eventType:W.ChangeEventType.Move,node:{path:a,type:l},to:(0,E.toRelativeFsPath)(d)})}}}}});var t=(0,o._)(new Set((0,o._)(P.keys()).concat((0,o._)(j.keys()),(0,o._)(A.keys()))));return t.length&&r.send({subscribeFile:{files:t.map(function(e){return{path:e.toString()}})}}),function(){k=null}});var M=new Promise(function(e){return c=e});u.openChannel({service:function(e){return e.repl.authorizations.editFileContents.isAuthorized?"gcsfiles":"files"}},function(e){var r=e.channel;c(r),S();var t=(0,o._)(P.keys()).sort(),n=!0,i=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(n=(s=l.next()).done);n=!0)!function(){var e=s.value;et.readDir(e).then(function(r){var t=P.get(e);if(t){if(r.error)return void $({eventType:W.ChangeEventType.Delete,node:{path:e,type:W.FileType.Directory}});var n=r.children,i=t.children,o=i.filter(function(e){return!n.some(function(r){return r.filename===e.filename&&r.type===e.type})}),a=!0,s=!1,l=void 0;try{for(var c,u=o[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var f=c.value;$({eventType:W.ChangeEventType.Delete,node:{path:(0,E.joinFsPath)(e,f.filename),type:f.type}})}}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}var d=n.filter(function(e){return!i.some(function(r){return r.filename===e.filename&&r.type===e.type})}),h=!0,p=!1,v=void 0;try{for(var m,g=d[Symbol.iterator]();!(h=(m=g.next()).done);h=!0){var y=m.value;$({eventType:W.ChangeEventType.Create,node:{path:(0,E.joinFsPath)(e,y.filename),type:y.type}})}}catch(e){p=!0,v=e}finally{try{h||null==g.return||g.return()}finally{if(p)throw v}}}})}()}catch(e){i=!0,a=e}finally{try{n||null==l.return||l.return()}finally{if(i)throw a}}var u=!0,f=!1,d=void 0;try{for(var h,p=A.keys()[Symbol.iterator]();!(u=(h=p.next()).done);u=!0)!function(){var e=h.value;et.readFile(e,{fromDisk:!0}).then(function(r){var t=A.get(e);!t||(r.error?$({eventType:W.ChangeEventType.Delete,node:{path:e,type:W.FileType.File}}):r.content.toBuffer().equals(t.latestContent.toBuffer())||$({eventType:W.ChangeEventType.Modify,node:{path:e,type:W.FileType.File}}))})}()}catch(e){f=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(f)throw d}}return function(){M=new Promise(function(e){return c=e})}});var U=(0,g.default)();U.promise.catch(function(e){return e});var z=(0,m.default)(function(){return(0,r._)(function(){var e;return(0,a._)(this,function(r){switch(r.label){case 0:return[4,U.promise];case 1:return[4,r.sent().request({fsSnapshot:{}})];case 2:if((e=r.sent()).channelClosed)return[2,{success:!1,error:"channel closed"}];if(e.error)return[2,{success:!1,error:e.error}];return[2,{error:null,success:!0}]}})})()},{wait:5e3,maxWait:1e4});u.openChannel({service:"snapshot",skip:function(e){return!e.repl.authorizations.editFileContents.isAuthorized}},function(e){var r=e.channel;return U.resolve(r),function(){U.isFulfilled&&(U=(0,g.default)()).promise.catch(function(e){return e})}});var V=W.FsStatus.Clean,B=[],q=0;function K(){return(0,r._)(function(){var e;return(0,a._)(this,function(r){switch(r.label){case 0:return q++,H(),[4,et.persist()];case 1:return(e=r.sent()).error&&l.logger.error("Failed to persist, something very bad has probably happened",{originalError:e.error}),q--,H(),[2]}})})()}function H(){return(0,r._)(function(){var e;return(0,a._)(this,function(r){return(e=0===q&&0===J.length&&Array.from(j.values()).every(function(e){return e.otClient.isClean()}))===(V===W.FsStatus.Clean)||(V=e?W.FsStatus.Clean:W.FsStatus.Syncing,B.forEach(function(e){e(V,{hasUserChanged:T})})),[2]})})()}var J=[];function G(e){T=!0,J.push(e),H(),e.then(function(){var r=J.indexOf(e);r>-1&&J.splice(r,1),K()})}function X(e,t){return(0,r._)(function(){var n,i;return(0,a._)(this,function(o){return i=(n=function(){return(0,r._)(function(){var r,t,i;return(0,a._)(this,function(o){switch(o.label){case 0:return[4,M];case 1:if("open"!==(r=o.sent()).status)return[2,x(n)];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,r.request(e)];case 3:return t=o.sent(),[3,5];case 4:return i=o.sent(),s.captureException(Error("Send request failed with error: ".concat(i))),[2,x(n)];case 5:if(t.channelClosed)return[2,x(n)];return[2,t]}})})()})(),t.isMutative&&G(i),[2,i]})})()}function $(e){D=null;var r=(0,E.getParentFsPath)(e.node.path),i=P.get(r),a=(0,E.getFsBaseName)(e.node.path);if(!a)throw Error("Expected filename");var l=null;if(e.eventType===W.ChangeEventType.Move){var c=(0,E.getParentFsPath)(e.to);l=P.get(c)}if(i||l)switch(e.eventType){case W.ChangeEventType.Create:if(!i)break;var u=(0,o._)(i.children.filter(function(e){return e.filename!==a})).concat([{type:e.node.type,filename:a}]),f=!0,d=!1,h=void 0;try{for(var p,v=i.listeners[Symbol.iterator]();!(f=(p=v.next()).done);f=!0)(0,p.value.onChange)(u)}catch(e){d=!0,h=e}finally{try{f||null==v.return||v.return()}finally{if(d)throw h}}i.children=u;break;case W.ChangeEventType.Move:var m=(0,E.getFsBaseName)(e.to);if(i&&i===l){var g=(0,o._)(i.children.filter(function(e){return e.filename!==a&&e.filename!==m})).concat([{type:e.node.type,filename:m}]),y=!0,C=!1,b=void 0;try{for(var _,w=i.listeners[Symbol.iterator]();!(y=(_=w.next()).done);y=!0)(0,_.value.onChange)(g)}catch(e){C=!0,b=e}finally{try{y||null==w.return||w.return()}finally{if(C)throw b}}i.children=g;break}if(i){var F=i.children.filter(function(e){return e.filename!==a}),x=!0,S=!1,T=void 0;try{for(var k,O=i.listeners[Symbol.iterator]();!(x=(k=O.next()).done);x=!0)(0,k.value.onChange)(F)}catch(e){S=!0,T=e}finally{try{x||null==O.return||O.return()}finally{if(S)throw T}}i.children=F}if(l){var R=(0,o._)(l.children.filter(function(e){return e.filename!==a&&e.filename!==m})).concat([{type:e.node.type,filename:m}]),L=!0,N=!1,I=void 0;try{for(var M,U=l.listeners[Symbol.iterator]();!(L=(M=U.next()).done);L=!0)(0,M.value.onChange)(R)}catch(e){N=!0,I=e}finally{try{L||null==U.return||U.return()}finally{if(N)throw I}}l.children=R}break;case W.ChangeEventType.Delete:if(!i)break;var z=i.children.filter(function(e){return e.filename!==a}),V=!0,B=!1,q=void 0;try{for(var Q,Y=i.listeners[Symbol.iterator]();!(V=(Q=Y.next()).done);V=!0)(0,Q.value.onChange)(z)}catch(e){B=!0,q=e}finally{try{V||null==Y.return||Y.return()}finally{if(B)throw q}}i.children=z;break;case W.ChangeEventType.Modify:break;default:throw Error("unknown event")}switch(e.eventType){case W.ChangeEventType.Move:case W.ChangeEventType.Delete:var K=[j.get(e.node.path),A.get(e.node.path),P.get(e.node.path)],H=!0,J=!1,G=void 0;try{for(var X,Z=K[Symbol.iterator]();!(H=(X=Z.next()).done);H=!0){var ee=X.value;if(ee){var er=!0,en=!1,ei=void 0;try{for(var eo,ea=ee.listeners[Symbol.iterator]();!(er=(eo=ea.next()).done);er=!0){var es=eo.value,el=es.onMoveOrDelete,ec=es.dispose;el&&el(e),ec()}}catch(e){en=!0,ei=e}finally{try{er||null==ea.return||ea.return()}finally{if(en)throw ei}}}}}catch(e){J=!0,G=e}finally{try{H||null==Z.return||Z.return()}finally{if(J)throw G}}if(e.node.type===W.FileType.File)break;var eu=(0,o._)(new Set((0,o._)(P.keys()).concat((0,o._)(A.keys()),(0,o._)(j.keys())))).map(function(e){var r=j.get(e)||A.get(e)||P.get(e);if(!r)throw Error("expected node");return r}),ef=[],ed=!0,eh=!1,ep=void 0;try{for(var ev,em=eu.sort()[Symbol.iterator]();!(ed=(ev=em.next()).done);ed=!0){var eg=ev.value;if((0,E.isDescendantOf)(e.node.path,eg.path)){var ey=ef.slice(-1)[0];if(!(ey&&(0,E.isDescendantOf)(ey,eg.path))){var eE={eventType:W.ChangeEventType.Delete,node:{path:eg.path,type:eg.type}};e.eventType===W.ChangeEventType.Move&&(eE=(0,n._)((0,t._)({},eE),{eventType:W.ChangeEventType.Move,to:(0,E.moveDescendantFsPath)(e.node.path,e.to,eg.path)})),ef.push(eg.path),$(eE)}}}}catch(e){eh=!0,ep=e}finally{try{ed||null==em.return||em.return()}finally{if(eh)throw ep}}break;case W.ChangeEventType.Create:case W.ChangeEventType.Modify:if(!A.has(e.node.path))break;et.readFile(e.node.path,{fromDisk:!0}).then(function(r){var t=A.get(e.node.path);if(t){if(r.error)return void $({eventType:W.ChangeEventType.Delete,node:{path:e.node.path,type:W.FileType.File}});t.latestContent=r.content;var n=!0,i=!1,o=void 0;try{for(var a,s=t.listeners[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value.onChange;l&&l(r.content)}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}}).catch(function(e){e.message="File read after modify error: "+e.message,s.captureException(e)})}}function Z(e){var r=!0,t=!1,n=void 0;try{for(var i,o=L[Symbol.iterator]();!(r=(i=o.next()).done);r=!0)(0,i.value)(e)}catch(e){t=!0,n=e}finally{try{r||null==o.return||o.return()}finally{if(t)throw n}}}var ee=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,r._)(function(){var o,s,l,c,u,d,h,p,v,m,g,y;function E(e){return(0,r._)(function(){var r;return(0,a._)(this,function(t){switch(t.label){case 0:return[4,o.request(e)];case 1:if((r=t.sent()).channelClosed)throw Error("channelClosed");if(r.error)throw Error(r.error);return[2,r]}})})()}return(0,a._)(this,function(r){switch(r.label){case 0:if(!i&&e===w.DOT_ENV)return[2,{error:W.FsErrors.InvalidPath}];return[4,M];case 1:o=r.sent(),s={eventType:W.ChangeEventType.Create,node:{path:e,type:W.FileType.File}},r.label=2;case 2:return r.trys.push([2,12,,13]),l=t.size,[4,E({transferStart:{path:e.toString(),size:l}})];case 3:if(!(c=r.sent().transfer))throw Error("Failed to start a transfer (no transfer id)");u=524288,n(l,0),d=0,h=0,p=void 0,v=void 0,r.label=4;case 4:if(!(d<l))return[3,10];r.label=5;case 5:return r.trys.push([5,7,,8]),[4,(p=t.slice(d,d+u)).arrayBuffer()];case 6:return v=r.sent(),[3,8];case 7:throw r.sent(),new W.FileReadError;case 8:return m=new Uint8Array(v),[4,E({transferChunk:{id:c.id,content:m}})];case 9:return r.sent(),h=f.buf(m,h),d+=p.size,n(l,d),[3,4];case 10:return[4,E({transferComplete:{id:c.id,crc32:h}})];case 11:return r.sent(),[3,13];case 12:if("channelClosed"===(g=r.sent()).message)return[2,x(et.transferFile,e,t,n)];if((y=Q(g.message,[W.FsErrors.NotDirectory,W.FsErrors.AlreadyExists,W.FsErrors.DiskQuotaExceeded,W.FsErrors.NotReadable]))===W.FsErrors.DiskQuotaExceeded&&Z(s),y===W.FsErrors.AlreadyExists&&(y=W.FsErrors.IsDirectory),y)return[2,{error:y}];throw g;case 13:return $(s),[2,{error:null}]}})})()};function er(e){var r=new Y(e,u,Promise.all((0,o._)(J).map(function(e){return e.catch(function(){})})).then(function(){}),u.logger,d,b);return r.on("commitComplete",K),r.on("fileDirty",H),r.on("fileClean",H),r.on("commitStart",H),r}var et={getStatus:function(){return V},onStatusChange:function(e){return B.push(e),function(){var r=B.indexOf(e);r>-1&&B.splice(r,1)}},watchDir:function(e,r){var i=!1,o=function(){i=!0;var r=P.get(e);r&&(r.listeners=r.listeners.filter(function(e){return e.dispose!==o}),0===r.listeners.length&&P.delete(e))};return et.readDir(e).then(function(a){if(!i){if(a.error){var s=Error(a.error);s.code=a.error,r.onError(s),o();return}var l=P.get(e);!l&&(l={path:e,type:W.FileType.Directory,children:a.children,listeners:[]},P.set(e,l),k&&k.send({subscribeFile:{files:[{path:e.toString()}]}})),l.listeners.push((0,n._)((0,t._)({},r),{dispose:o})),r.onChange(a.children)}}).catch(function(e){o(),r.onError(e)}),o},watchPathStat:function(e,r){var t=0,n=!1,o=function(a,s,l){if(s===W.FileType.File)return function(){};var c=(0,i._)(l),u=c[0],f=c.slice(1),d=u===e;if(d&&0!==f.length)throw Error("Invariant: child is target but has more children");var h=null,p=et.watchDir(a,{onChange:function(i){var a=i.find(function(e){return e.filename===(0,E.getFsBaseName)(u)});if(!a){n||(r.onNewStat({exists:!1}),n=!0),h&&(h.dispose(),h=null);return}if(h&&a.type!==h.node.type&&(h.dispose(),h=null),!h){if(d){var s=++t;et.stat(e).then(function(e){s!==t||e.exists&&(r.onNewStat(e),n=!1,h={node:a,dispose:function(){}})});return}h={node:a,dispose:o(u,a.type,f)}}},onError:r.onError});return function(){null==h||h.dispose(),p()}},a=(0,i._)((0,E.splitFsPaths)(e)),s=a[0],l=a.slice(1);return o(s,W.FileType.Directory,l)},watchFilePath:function(e,r){var t,n=function(e,t){if(0===t.length){var i=et.watchFile((0,E.toRelativeFsPath)(e),r);return function(){i()}}var o,a=t[0],s=!1,l=et.watchDir((0,E.toRelativeFsPath)(e),{onChange:function(r){var i=r.find(function(e){return e.filename.toString()===a});if(!s&&i){o=n("".concat(e,"/").concat(a),t.slice(1)),s=!0;return}s=!1},onMoveOrDelete:function(){null==o||o()},onError:function(){}});return function(){null==o||o(),l()}},i=e.toString().split("/"),o=!1,a=et.watchDir((0,E.toRelativeFsPath)(""),{onChange:function(e){var r=e.find(function(e){return e.filename.toString()===i[0]});if(!o&&r){t=n(i[0],i.slice(1)),o=!0;return}o=!1},onError:function(){}});return function(){null==t||t(),a()}},writeFile:function(e,t){return(0,r._)(function(){var r,n,i,o,s,l;return(0,a._)(this,function(a){switch(a.label){case 0:return n="string"==typeof t?y.default.from(t).toBuffer():t.toBuffer(),[4,X({write:{path:e.toString(),content:n}},{isMutative:!0})];case 1:if(i=a.sent(),s=null==(r=P.get((0,E.getParentFsPath)(e)))?void 0:r.children.some(function(r){return r.filename===(0,E.getFsBaseName)(e)}),o=A.has(e)||j.has(e)||s?{eventType:W.ChangeEventType.Modify,node:{path:e,type:W.FileType.File}}:{eventType:W.ChangeEventType.Create,node:{path:e,type:W.FileType.File}},i.error){if((l=Q(i.error,[W.FsErrors.NotDirectory,W.FsErrors.AlreadyExists,W.FsErrors.DiskQuotaExceeded]))===W.FsErrors.DiskQuotaExceeded&&Z(o),l===W.FsErrors.AlreadyExists&&(l=W.FsErrors.IsDirectory),!l)throw Error(i.error);return[2,{error:l}]}return $(o),[2,{error:null}]}})})()},transferFile:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r._)(function(){var e;return(0,a._)(this,function(r){return G(e=ee.apply(void 0,(0,o._)(t))),[2,e]})})()},readFile:function(e){return(0,r._)(function(e){var r,t,n,i=arguments;return(0,a._)(this,function(o){switch(o.label){case 0:if(!(i.length>1&&void 0!==i[1]?i[1]:{fromDisk:!1}).fromDisk&&(r=j.get(e))&&r.otClient.getRawLocalContent()&&!r.otClient.isReconnecting)return[2,{content:y.default.from(r.otClient.getRawLocalContent()),error:null}];return[4,X({read:{path:e.toString()}},{isMutative:!1})];case 1:if((t=o.sent()).error){if(!(n=Q(t.error,[W.FsErrors.NotFound,W.FsErrors.IsDirectory])))throw Error(t.error);return[2,{error:n}]}if(!t.file||!t.file.path||!t.file.content)throw Error("Expected file");return[2,{content:y.default.from(t.file.content),error:null}]}})}).apply(this,arguments)},createDir:function(e){return(0,r._)(function(){var r,t,n;return(0,a._)(this,function(i){switch(i.label){case 0:return[4,X({mkdir:{path:e.toString()}},{isMutative:!0})];case 1:if(r=i.sent(),t={eventType:W.ChangeEventType.Create,node:{path:e,type:W.FileType.Directory}},r.error){if((n=Q(r.error,[W.FsErrors.NotDirectory,W.FsErrors.DiskQuotaExceeded]))===W.FsErrors.DiskQuotaExceeded&&Z(t),!n)throw Error(r.error);return[2,{error:n}]}return $(t),[2,{error:null}]}})})()},moveDir:function(e,t){return(0,r._)(function(){var r,n,i;return(0,a._)(this,function(o){switch(o.label){case 0:return[4,X({move:{oldPath:e.toString(),newPath:t.toString()}},{isMutative:!0})];case 1:if(r=o.sent(),n={eventType:W.ChangeEventType.Move,node:{path:e,type:W.FileType.Directory},to:t},r.error){if((i=Q(r.error,[W.FsErrors.NotFound,W.FsErrors.AlreadyExists,W.FsErrors.NotDirectory,W.FsErrors.DiskQuotaExceeded]))===W.FsErrors.DiskQuotaExceeded&&Z(n),!i)throw Error(r.error);return[2,{error:i}]}return $(n),[2,{error:null}]}})})()},moveFile:function(e,t){return(0,r._)(function(){var r,n,i;return(0,a._)(this,function(o){switch(o.label){case 0:return[4,X({move:{oldPath:e.toString(),newPath:t.toString()}},{isMutative:!0})];case 1:if(r=o.sent(),n={eventType:W.ChangeEventType.Move,node:{path:e,type:W.FileType.File},to:t},r.error){if((i=Q(r.error,[W.FsErrors.NotFound,W.FsErrors.AlreadyExists,W.FsErrors.NotDirectory,W.FsErrors.DiskQuotaExceeded]))===W.FsErrors.DiskQuotaExceeded&&Z(n),!i)throw Error(r.error);return[2,{error:i}]}return $(n),[2,{error:null}]}})})()},copyFile:function(e,t){return(0,r._)(function(){var r;return(0,a._)(this,function(n){switch(n.label){case 0:return[4,et.readFile(e)];case 1:if((r=n.sent()).error)return[2,r];return[2,et.writeFile(t,r.content)]}})})()},copyDirFromRemote:function(e,t,n){return(0,r._)(function(){var r,i,o,s,l,c,u,f,d,h,p,v,m;return(0,a._)(this,function(a){switch(a.label){case 0:return[4,this.deleteDir(e)];case 1:return a.sent(),[4,n.readDir(e)];case 2:if((r=a.sent()).error)return[2,r];return[4,this.readDir(t)];case 3:if((i=a.sent()).error!==W.FsErrors.NotFound)return[3,5];return[4,this.createDir(e)];case 4:return a.sent(),[3,6];case 5:if(i.error===W.FsErrors.NotDirectory)return[2,i];a.label=6;case 6:o=!0,s=!1,l=void 0,a.label=7;case 7:a.trys.push([7,15,16,17]),c=r.children[Symbol.iterator](),a.label=8;case 8:if(o=(u=c.next()).done)return[3,14];if(f=u.value,d=(0,E.joinFsPath)(e,f.filename),f.type!==W.FileType.File)return[3,11];return[4,n.readFile(d)];case 9:if((h=a.sent()).error)return[2,h];return[4,this.writeFile((0,E.joinFsPath)(t,f.filename),h.content)];case 10:if((p=a.sent()).error)return[2,p];return[3,13];case 11:if(f.type!==W.FileType.Directory)return[3,13];return[4,this.copyDirFromRemote(d,(0,E.joinFsPath)(t,f.filename),n)];case 12:if((v=a.sent()).error)return[2,v];a.label=13;case 13:return o=!0,[3,8];case 14:return[3,17];case 15:return m=a.sent(),s=!0,l=m,[3,17];case 16:try{o||null==c.return||c.return()}finally{if(s)throw l}return[7];case 17:return[2,{error:null}]}})}).call(this)},copyFileFromRemote:function(e,t,n){return(0,r._)(function(){var r,i;return(0,a._)(this,function(o){switch(o.label){case 0:return[4,n.readFile(e)];case 1:if((r=o.sent()).error)return[2,r];return[4,this.writeFile(t,r.content)];case 2:if((i=o.sent()).error)return[2,i];return[2,{error:null}]}})}).call(this)},deleteFile:function(e){return(0,r._)(function(){var r,t;return(0,a._)(this,function(n){switch(n.label){case 0:return[4,X({remove:{path:e.toString()}},{isMutative:!0})];case 1:if((r=n.sent()).error){if(!(t=Q(r.error,[W.FsErrors.NotFound])))throw Error(r.error);return[2,{error:t}]}return $({eventType:W.ChangeEventType.Delete,node:{path:e,type:W.FileType.File}}),[2,{error:null}]}})})()},deleteDir:function(e){return(0,r._)(function(){var r,t;return(0,a._)(this,function(n){switch(n.label){case 0:return[4,X({remove:{path:e.toString()}},{isMutative:!0})];case 1:if((r=n.sent()).error){if(!(t=Q(r.error,[W.FsErrors.NotFound])))throw Error(r.error);return[2,{error:t}]}return $({eventType:W.ChangeEventType.Delete,node:{path:e,type:W.FileType.Directory}}),[2,{error:null}]}})})()},readDir:function(e){return(0,r._)(function(){var r,t,n;return(0,a._)(this,function(i){switch(i.label){case 0:return[4,X({readdir:{path:e.toString()}},{isMutative:!1})];case 1:if((t=i.sent()).error){if(!(n=Q(t.error,[W.FsErrors.NotFound,W.FsErrors.NotDirectory,W.FsErrors.FileSystemUnavailable])))throw Error(t.error);return[2,{error:n}]}if(!(null==(r=t.files)?void 0:r.files))throw Error("Expected filesChannel");return[2,{children:t.files.files.map(function(e){if(!e.path)throw Error("Expected path");return{filename:(0,E.getFsBaseName)((0,E.toRelativeFsPath)(e.path)),type:e.type===v.api.File.Type.DIRECTORY?W.FileType.Directory:W.FileType.File}}),error:null}]}})})()},stat:function(e){return(0,r._)(function(){var r;return(0,a._)(this,function(t){switch(t.label){case 0:return[4,X({stat:{path:e.toString()}},{isMutative:!1})];case 1:if((r=t.sent()).error)throw Error(r.error);if(!r.statRes)throw Error("expected stat result");if(!r.statRes.exists)return[2,{exists:!1}];if(r.statRes.type===v.api.File.Type.DIRECTORY)return[2,{exists:!0,type:W.FileType.Directory,lastModified:new Date(1e3*r.statRes.modTime)}];return[2,{exists:!0,type:W.FileType.File,lastModified:new Date(1e3*r.statRes.modTime),byteLength:Number(r.statRes.size)}]}})})()},watchTextFile:function(e,i){var s=this;if(!(0,E.isAbsolutePath)(e)&&(0,E.isRoot)((0,E.toRelativeFsPath)(e)))throw Error("Cannot watch root directory");var l=j.get(e);if(l||(l={path:e,type:W.FileType.File,listeners:[],otClient:er(e)},j.set(e,l)),!l)throw Error("Expected watchedOtFile");var c=!1,u=!1,f=function(){},d=[],v=function(t){if(f(),!l)throw Error("Expected watchedOtFile");var n,g=function(e){var r;return null==(r=i.onFlush)?void 0:r.call(i,e)};l.otClient.on("commitComplete",g);var y=function(){var e;return null==(e=i.onStatusChange)?void 0:e.call(i,W.FileStatus.Dirty)};l.otClient.on("fileDirty",y);var E=function(){var e;return null==(e=i.onStatusChange)?void 0:e.call(i,W.FileStatus.Clean)};l.otClient.on("fileClean",E);var C=function(){var e;return null==(e=i.onStatusChange)?void 0:e.call(i,W.FileStatus.Syncing)};l.otClient.on("commitStart",C);var b=function(e){var r;return null==(r=i.onCursor)?void 0:r.call(i,e)};l.otClient.on("cursor",b);var _=function(e){var r;return null==(r=i.onRemoveCursor)?void 0:r.call(i,e)};l.otClient.on("removeCursor",_);var w=function(e){var r;return null==(r=i.onFileSavedChanged)?void 0:r.call(i,e)};l.otClient.on("fileSavedChanged",w);var F=function(t){return(0,r._)(function(){var r,n,i,o,s,c,u,f,h,v,m,g;return(0,a._)(this,function(a){switch(a.label){case 0:if(!l)throw Error("Expected watchedOtFile");return(r=l.otClient).destroy(),n=er(e),[4,new Promise(function(e,r){n.once("changes",function(){return e()}),n.once("error",function(e){return r(e)})})];case 1:if(a.sent(),i=r.getLocalContent(),o=n.getLocalContent(),s="local"===t?(0,p.changeSetFromDiff)(o,i):null,c="remote"===t?(0,p.changeSetFromDiff)(i,o):null,!l)throw Error("Expected watchedOtFile");l.otClient=n,u=!0,f=!1,h=void 0;try{for(v=l.listeners[Symbol.iterator]();!(u=(m=v.next()).done);u=!0)(0,m.value.reregister)(c)}catch(e){f=!0,h=e}finally{try{u||null==v.return||v.return()}finally{if(f)throw h}}for(s&&n.writeChanges(s);d.length>0;)null==(g=d.pop())||g({isDisposed:!1});return[4,this.flush()];case 2:return a.sent(),[2]}})}).call(s)},x=function(e){var r;return null==(r=i.onReconnectFail)?void 0:r.call(i,F,e)};l.otClient.on("promptUserReconnect",x),l.listeners[0].reregister===v&&l.otClient.on("promptUserReconnect",function(){if(j.has(e)){if(!l)throw Error("Expected watchedOtFile");l.listeners.some(function(e){return e.onReconnectFail})||F("remote")}});var S=function(e,r){i.onError&&i.onError(e,r),m()};l.otClient.on("error",S);var k=function(r,t){if(r===W.FsErrors.DiskQuotaExceeded&&Z({eventType:W.ChangeEventType.Modify,node:{path:e,type:W.FileType.File}}),i.onError){var n=Error(t);n.code=r,i.onError(n)}m()};l.otClient.on("fsError",k);var O=function(e,r){if(!l)throw Error("Expected watchedOtFile");T=!0;var t=h.ChangeSet.of(e,l.otClient.getLocalContent().length,"\n");l.otClient.writeChanges(t,r);var n=!0,o=!1,a=void 0;try{for(var s,c=l.listeners[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var u=s.value.onChange;u&&u!==i.onChange&&u({changes:t,changeSource:W.ChangeSource.Local,version:l.otClient.version,latestContent:l.otClient.getLocalContent()})}}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}},D=function(){return(0,r._)(function(){return(0,a._)(this,function(e){return(null==l?void 0:l.otClient.isReconnecting)?[2,new Promise(function(e,r){l?d.push(e):r(Error("Expected watchedOtFile"))})]:[2,{isDisposed:c}]})})()},R=function(){for(;d.length>0;){var e;null==(e=d.pop())||e({isDisposed:!1})}};l.otClient.on("transparentReconnect",R);var P=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r._)(function(){var e,r;return(0,a._)(this,function(n){switch(n.label){case 0:if(!l)throw Error("Expected watchedOtFile");n.label=1;case 1:return n.trys.push([1,3,,4]),[4,D()];case 2:if(n.sent().isDisposed)return[2,{isDisposed:!0,result:null}];return[3,4];case 3:if(r=n.sent(),c)return[2,{isDisposed:!0,result:null}];throw r;case 4:return[4,(e=l.otClient).fetchChanges.apply(e,(0,o._)(t))];case 5:return[2,{isDisposed:!1,result:n.sent()}]}})})()},A=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r._)(function(){var e;return(0,a._)(this,function(r){switch(r.label){case 0:if(!l)throw Error("Expected watchedOtFile");return[4,D()];case 1:if(r.sent().isDisposed)throw Error("File was disposed");return[2,(e=l.otClient).transformSelection.apply(e,(0,o._)(t))]}})})()},L=function(e){if(!l)throw Error("Expected watchedOtFile");l.otClient.updateCursors(e)};-1!==l.otClient.version&&setTimeout(function(){var e;if(!u){if(!l)throw Error("Expected watchedOtFile");u=!0,null==(e=i.onReady)||e.call(i,{initialContent:l.otClient.getLocalContent(),writeChange:O,updateSelections:L,fetchChanges:P,transformSelection:A,version:l.otClient.version})}}),t&&(null==(n=i.onChange)||n.call(i,{changes:t,changeSource:W.ChangeSource.Container,version:l.otClient.version,latestContent:l.otClient.getLocalContent(),userId:0}));var N=function(e,r){var t,n;if(!l)throw Error("Expected watchedOtFile");if(!u){u=!0,null==(n=i.onReady)||n.call(i,{initialContent:l.otClient.getLocalContent(),writeChange:O,updateSelections:L,fetchChanges:P,transformSelection:A,version:l.otClient.version});return}null==(t=i.onChange)||t.call(i,{changes:e,changeSource:W.ChangeSource.Container,version:l.otClient.version,latestContent:l.otClient.getLocalContent(),userId:r})};l.otClient.on("changes",N),f=function(){if(!l)throw Error("Expected watchedOtFile");l.otClient.removeListener("commitComplete",g),l.otClient.removeListener("fileDirty",y),l.otClient.removeListener("fileClean",E),l.otClient.removeListener("commitStart",C),l.otClient.removeListener("error",S),l.otClient.removeListener("fsError",k),l.otClient.removeListener("changes",N),l.otClient.removeListener("cursor",b),l.otClient.removeListener("removeCursor",_),l.otClient.removeListener("promptUserReconnect",x),l.otClient.removeListener("transparentReconnect",R),l.otClient.removeListener("fileSavedChanged",w)},H()},m=function(){for(;d.length>0;){var r;null==(r=d.pop())||r({isDisposed:!0})}if(!c&&j.has(e)){if(c=!0,u=!0,f(),!l)throw Error("Expected watchedOtFile");l.listeners=l.listeners.filter(function(e){return e.dispose!==m}),0===l.listeners.length&&(l.otClient.destroy(),j.delete(e))}};return l.listeners.push((0,n._)((0,t._)({},i),{dispose:m,reregister:v})),v(null),m},watchFile:function(e,r){if(!(0,E.isAbsolutePath)(e)&&(0,E.isRoot)((0,E.toRelativeFsPath)(e)))throw Error("Cannot watch root directory");var i=!1,o=function(){i=!0;var r=A.get(e);r&&(r.listeners=r.listeners.filter(function(e){return e.dispose!==o}),0===r.listeners.length&&A.delete(e))};return et.readFile(e).then(function(a){if(!i){if(a.error){var s=Error(a.error);s.code=a.error,r.onError&&r.onError(s),o();return}var l=A.get(e);if(!l&&(l={path:e,type:W.FileType.File,listeners:[],latestContent:a.content},A.set(e,l),k&&k.send({subscribeFile:{files:[{path:e.toString()}]}})),!l)throw Error("Expected watched file");l.listeners.push((0,n._)((0,t._)({},r),{dispose:o})),r.onChange(a.content)}}),o},listFiles:function(){return(0,r._)(function(){var e;return(0,a._)(this,function(t){switch(t.label){case 0:if(D&&u.performance.now()-R<1e4)return[2,D];return O||(O=(0,r._)(function(){var e,r,t,n,i;return(0,a._)(this,function(a){switch(a.label){case 0:return[4,(e=u).execImmediately.apply(e,["rg","--hidden","--files"].concat((0,o._)(_.ignoredDirs.flatMap(function(e){return["--glob","!".concat(e)]}))))];case 1:if(t=(r=a.sent()).output,n=r.error,i=function(e){return!(!e||(0,_.isHiddenFile)(e))},!n&&t)return[2,D={error:null,files:t.split("\n").filter(i)}];if("exit status 1"===n)return[2,D={error:null,files:[]}];return s.captureException(Error("Find file command failed with error: ".concat(n))),[2,{error:n,files:null}]}})})(),R=u.performance.now()),[4,O];case 1:return e=t.sent(),O=null,[2,e]}})})()},flush:function(e){return(0,r._)(function(e){var t,n,i,o,s,l,c,u,f,d,h,p,v,m,g,y,E,C,b,_,w,F,x,S,T,k,O,D,R,P,A,L,M,U,z,V,B,q,Q,Y,K,H,G,X,$,Z=arguments;return(0,a._)(this,function(ee){switch(ee.label){case 0:if(t=Z.length>1&&void 0!==Z[1]?Z[1]:W.FlushSource.UNKNOWN,n=function(e){return(0,r._)(function(){var r,n,i,o,s,l,c,u;return(0,a._)(this,function(a){switch(a.label){case 0:if(r=e.path,!(n=N.get(r)))return[2];i=!0,o=!1,s=void 0,a.label=1;case 1:a.trys.push([1,6,7,8]),l=n[Symbol.iterator](),a.label=2;case 2:if(i=(c=l.next()).done)return[3,5];return[4,(0,c.value)(e.otClient.getLocalContent(),t)];case 3:a.sent(),a.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return u=a.sent(),o=!0,s=u,[3,8];case 7:try{i||null==l.return||l.return()}finally{if(o)throw s}return[7];case 8:return[2]}})})()},i=function(e){var r=e.path,n=!0,i=!1,o=void 0;try{for(var a,s=I[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)(0,a.value)(r,t)}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}},o=[],s=function(e){null===e.otClient.channel||e.otClient.isReconnecting||o.push(e.otClient.flush())},void 0!==e)return[3,9];l=!0,c=!1,u=void 0,ee.label=1;case 1:ee.trys.push([1,6,7,8]),f=j.values()[Symbol.iterator](),ee.label=2;case 2:if(l=(d=f.next()).done)return[3,5];return h=d.value,[4,n(h)];case 3:ee.sent(),ee.label=4;case 4:return l=!0,[3,2];case 5:return[3,8];case 6:return p=ee.sent(),c=!0,u=p,[3,8];case 7:try{l||null==f.return||f.return()}finally{if(c)throw u}return[7];case 8:v=!0,m=!1,g=void 0;try{for(y=j.values()[Symbol.iterator]();!(v=(E=y.next()).done);v=!0)C=E.value,s(C)}catch(e){m=!0,g=e}finally{try{v||null==y.return||y.return()}finally{if(m)throw g}}return[3,18];case 9:b=!0,_=!1,w=void 0,ee.label=10;case 10:ee.trys.push([10,15,16,17]),F=e[Symbol.iterator](),ee.label=11;case 11:if(b=(x=F.next()).done)return[3,14];if(S=x.value,void 0===(T=j.get(S)))return[3,13];return[4,n(T)];case 12:ee.sent(),ee.label=13;case 13:return b=!0,[3,11];case 14:return[3,17];case 15:return p=ee.sent(),_=!0,w=p,[3,17];case 16:try{b||null==F.return||F.return()}finally{if(_)throw w}return[7];case 17:k=!0,O=!1,D=void 0;try{for(R=e[Symbol.iterator]();!(k=(P=R.next()).done);k=!0)A=P.value,L=j.get(A),void 0!==L&&s(L)}catch(e){O=!0,D=e}finally{try{k||null==R.return||R.return()}finally{if(O)throw D}}ee.label=18;case 18:return ee.trys.push([18,20,,21]),[4,Promise.all(o.concat(J))];case 19:if(ee.sent(),void 0===e){M=!0,U=!1,z=void 0;try{for(V=j.values()[Symbol.iterator]();!(M=(B=V.next()).done);M=!0)q=B.value,i(q)}catch(e){U=!0,z=e}finally{try{M||null==V.return||V.return()}finally{if(U)throw z}}}else{Q=!0,Y=!1,K=void 0;try{for(H=e[Symbol.iterator]();!(Q=(G=H.next()).done);Q=!0)X=G.value,$=j.get(X),void 0!==$&&i($)}catch(e){Y=!0,K=e}finally{try{Q||null==H.return||H.return()}finally{if(Y)throw K}}}return[3,21];case 20:return ee.sent(),[3,21];case 21:return[2]}})}).apply(this,arguments)},registerOnBeforeFlush:function(e,r){var t,n=null!=(t=N.get(e))?t:new Set;return n.add(r),N.set(e,n),function(){var t;return null==(t=N.get(e))?void 0:t.delete(r)}},registerOnFlushSuccess:function(e){return I.add(e),function(){I.delete(e)}},persist:function(e){var r=z();return e&&e.skipDebounce&&z.flush(),r},getOTVersion:function(e){if("SYNTHETIC_FILE_PATH.sql"===e)return 123;var r=j.get(e);if(!r)throw Error("No file with path ".concat(e," found."));return r.otClient.version},isFileOrDirSaved:function(e){if((0,C.isOTFile)(e)){var r=j.get(e);return!r||r.otClient.isFileSaved()}return!0},onDiskQuotaExceeded:function(e){return L.push(e),function(){L=L.filter(function(r){return r!==e})}}};return et}var J=c.Type.Object({cluster:c.Type.String(),sourceRepl:c.Type.String(),zipperToken:c.Type.String(),expirySeconds:c.Type.Number()});function G(e){return(0,r._)(function(e){var r,t,n,i,o,s,l,c,f,h,p,v,m;return(0,a._)(this,function(a){switch(a.label){case 0:return r=e.replId,[4,(0,e.getCaptcha)()];case 1:return n=(t=a.sent()).isEmbed,i=t.hCaptchaSiteKey,o=t.recaptchaToken,s={captcha:t.captcha,isEmbed:n,hCaptchaSiteKey:i,recaptchaToken:o,asViewer:!0},[4,fetch("/data/repls/".concat(r,"/get_zipper_token"),{credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},method:"post",body:JSON.stringify(s)})];case 2:if(!(l=a.sent()).ok)throw Error("Failed to get zipper token: ".concat(l.status," ").concat(l.statusText));return[4,l.json()];case 3:if(c=a.sent(),!u.Value.Check(J,c))throw(0,K.validationErrors)(J,c);return f=c.cluster,h=c.sourceRepl,p=c.zipperToken,v=c.expirySeconds,m=(0,d.addSeconds)(new Date,v-10),[2,{sourceReplId:h,baseUrl:(0,b.getZipperUrl)(f),token:p,exp:m}]}})}).apply(this,arguments)}function X(e){var n,i=e.replId,o=e.getCaptcha;function s(){return(0,r._)(function(){var e;return(0,a._)(this,function(r){switch(r.label){case 0:if(e=!n)return[3,2];return[4,n];case 1:e=r.sent().exp.getTime()<=new Date().getTime(),r.label=2;case 2:return e&&(n=G({replId:i,getCaptcha:o})),[4,n];case 3:return[2,r.sent()]}})})()}var l={watchDir:function(e,r){return l.readDir(e).then(function(e){if(e.error){var t=Error(e.error);t.code=e.error,r.onError&&r.onError(t);return}return r.onChange(e.children)}),function(){}},watchFile:function(e,r){return l.readFile(e).then(function(e){if(e.error){var t=Error(e.error);t.code=e.error,r.onError&&r.onError(t);return}return r.onChange(e.content)}),function(){}},stat:function(e){return(0,r._)(function(){var r;return(0,a._)(this,function(t){switch(t.label){case 0:return[4,l.readFile(e)];case 1:if((r=t.sent()).error)switch(r.error){case W.FsErrors.NotFound:return[2,{exists:!1}];case W.FsErrors.IsDirectory:return[2,{exists:!0,type:W.FileType.Directory,lastModified:new Date}]}return[2,{exists:!0,type:W.FileType.File,byteLength:r.content.length,lastModified:new Date}]}})})()},readDir:function(e){return(0,r._)(function(){var r,n,i,o,l,c,u;return(0,a._)(this,function(a){switch(a.label){case 0:return[4,s()];case 1:return n=(r=a.sent()).sourceReplId,i=r.baseUrl,o=r.token,[4,fetch("".concat(i,"/repls/").concat(n,"/files/dir?path=").concat(e),(0,t._)({},o&&{headers:{Authorization:"Bearer ".concat(o)}}))];case 2:if(!(l=a.sent()).ok)return[3,4];return[4,l.json()];case 3:return[2,{children:null!=(c=a.sent())?c:[],error:null}];case 4:return[4,l.text()];case 5:if(u=a.sent(),404===l.status&&"file not found"===u)return[2,{error:W.FsErrors.NotFound}];if(400===l.status&&"file is not a directory"===u)return[2,{error:W.FsErrors.NotDirectory}];throw Error("Error when trying to read dir through zipper, status: ".concat(l.status,", body: ").concat(u));case 6:return[2]}})})()},readFile:function(e,n){return(0,r._)(function(){var r,n,i,o,l,c,u,f;return(0,a._)(this,function(a){switch(a.label){case 0:return[4,s()];case 1:return n=(r=a.sent()).sourceReplId,i=r.baseUrl,o=r.token,[4,fetch("".concat(i,"/repls/").concat(n,"/files/file?path=").concat(encodeURIComponent(e)),(0,t._)({},o&&{headers:{Authorization:"Bearer ".concat(o)}}))];case 2:if(!(l=a.sent()).ok)return[3,4];return c={},u=y.default.bind,[4,l.arrayBuffer()];case 3:return[2,(c.content=new(u.apply(y.default,[void 0,a.sent()])),c.error=null,c)];case 4:return[4,l.text()];case 5:if(f=a.sent(),404===l.status&&"file not found"===f)return[2,{error:W.FsErrors.NotFound}];if(400===l.status&&"file is a directory"===f)return[2,{error:W.FsErrors.IsDirectory}];throw Error("Error when trying to read file through zipper, status: ".concat(l.status,", body: ").concat(f));case 6:return[2]}})})()}};return l}e.s(["createZipperFsService",()=>X,"default",()=>H,"getZipperToken",()=>G],629712)}]);

//# debugId=bda50307-77d5-b1cb-9d8f-0faf559923a3
//# sourceMappingURL=470705b358c2c25d.js.map