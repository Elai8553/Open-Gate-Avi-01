;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="d9bf1425-db59-7b84-5498-eb18319cf9fb")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16499,e=>{"use strict";var t=e.i(541793),i=e.i(852819),n=(0,t.atom)(null);function r(){return(0,i.useSet)(n)}function a(){return(0,i.useValue)(n)}e.s(["useAppKeyboardState",()=>a,"useSetAppKeyboardState",()=>r])},690821,e=>{"use strict";var t=e.i(721281),i=e.i(878420),n=e.i(276385),r=e.i(330666),a=e.i(183035),s=e.i(656077),o=e.i(927600),l=e.i(602686),c=e.i(480028),u=e.i(446530),d=e.i(123850),f=e.i(613355),h=e.i(140487),m=e.i(136540),p=e.i(960178),g=e.i(625484),v=(0,d.createCssVarTokens)(["padding","backgroundColor","borderColor"]),y=v.cssVars,_=v.styleTokens,T=(0,u.cssRecord)({root:[f.rcss.position.relative,f.rcss.border({width:1,style:"solid",color:_.borderColor}),f.rcss.pb(12),f.rcss.borderRadius(8),f.rcss.shadow(2),f.rcss.flex.column,{padding:_.padding,backgroundColor:_.backgroundColor,gap:_.padding}],closeIconButton:[f.rcss.position.absolute,f.rcss.top(_.padding),f.rcss.right(_.padding)],dot:[f.rcss.borderRadius("full"),f.rcss.width(c.tokens.space8),f.rcss.height(c.tokens.space8)]});function x(e){var r,u=e.title,d=e.subtitle,f=e.icon,v=e.content,_=e.containerStyle,x=e.colorway,w=void 0===x?"primary":x,I=e.totalSteps,A=void 0===I?1:I,k=e.currentStepIndex,C=void 0===k?0:k,S=e.onDismiss,E=e.onCurrentStepChange,j=e.cypressCloseData,N=e.compact,L=e.hideCloseButton,D=void 0!==L&&L,M=e.hideNavigation,P=e.doneText,F=e.hideBorder,R=!1===w?void 0:w,B=C>=A-1;return(0,n.jsxs)(g.View,{css:T.root,style:(0,i._)((r={},(0,t._)(r,y.padding,void 0===N||N?c.tokens.space8:c.tokens.space16),(0,t._)(r,y.backgroundColor,R?c.colormap[R].dimmest:c.tokens.backgroundDefault),(0,t._)(r,y.borderColor,R?c.colormap[R].dimmer:c.tokens.backgroundHighest),(0,t._)(r,"border",void 0!==F&&F?"none":void 0),(0,t._)(r,"paddingRight",u||D?void 0:c.tokens.space32),r),_),children:[D?null:(0,n.jsx)(m.IconButton,{alt:"Close",colorway:R,css:T.closeIconButton,onClick:S,dataCy:j,children:(0,n.jsx)(l.default,{})}),u?(0,n.jsxs)(g.View,{row:!0,gap:8,align:"center",children:[f?(0,n.jsx)(f,{}):null,(0,n.jsxs)(g.View,{row:!0,gap:8,align:"end",children:[(0,n.jsx)(p.Text,{variant:"subheadDefault",multiline:!1,children:u}),d?(0,n.jsx)(p.Text,{variant:"text",color:"dimmest",multiline:!1,css:{transform:"translateY(1.5px)"},children:d}):null]})]}):null,(0,n.jsx)(g.View,{children:"function"==typeof v?(0,n.jsx)(v,{}):(0,n.jsx)(p.Text,{children:v})}),A>1&&E&&!(void 0!==M&&M)?(0,n.jsxs)(g.View,{row:!0,align:"center",justify:"space-between",children:[(0,n.jsx)(h.Button,{css:{visibility:C<=0?"hidden":void 0},colorway:R,text:"Back",iconLeft:(0,n.jsx)(s.default,{}),onClick:function(){return E(C-1)}}),(0,n.jsx)(b,{colorway:R,total:A,current:C}),(0,n.jsx)(h.Button,{"data-autofocus":!0,colorway:B?"primary":R,text:B?void 0===P?"Done":P:"Next",iconLeft:B?(0,n.jsx)(a.default,{}):(0,n.jsx)(o.default,{}),onClick:function(){return B?S():E(C+1)}})]}):null]})}function b(e){var t=e.total,i=e.current,a=e.colorway;return(0,n.jsxs)(g.View,{children:[(0,n.jsx)(r.VisuallyHidden,{children:(0,n.jsx)("progress",{value:i+1,max:t,"aria-label":"Step"})}),(0,n.jsx)(g.View,{"aria-hidden":!0,row:!0,gap:8,children:Array(t).fill(0).map(function(e,t){return(0,n.jsx)(g.View,{style:{backgroundColor:t===i?a?c.colormap[a].stronger:c.tokens.foregroundDimmest:a?c.colormap[a].dimmer:c.tokens.outlineDimmest},css:T.dot},t)})})]})}e.s(["Tour",()=>x])},801704,e=>{e.v({bold:"slashCommand-module__9-6L-a__bold",emptyState:"slashCommand-module__9-6L-a__emptyState",footer:"slashCommand-module__9-6L-a__footer",limitText:"slashCommand-module__9-6L-a__limitText",listBox:"slashCommand-module__9-6L-a__listBox",listBoxItem:"slashCommand-module__9-6L-a__listBoxItem",popover:"slashCommand-module__9-6L-a__popover",popoverContent:"slashCommand-module__9-6L-a__popoverContent",removeButton:"slashCommand-module__9-6L-a__removeButton",searchInput:"slashCommand-module__9-6L-a__searchInput",searchInputWrapper:"slashCommand-module__9-6L-a__searchInputWrapper",selectedConnector:"slashCommand-module__9-6L-a__selectedConnector","slide-fade-in":"slashCommand-module__9-6L-a__slide-fade-in"})},656381,6013,164410,825423,257378,e=>{"use strict";var t=e.i(399119),i=e.i(904851),n=e.i(90659),r=e.i(721281),a=e.i(445789),s=e.i(167626),o=e.i(878420),l=e.i(64386),c=e.i(530658),u=e.i(346715),d=e.i(276385),f=e.i(652172),h=e.i(389959),m=e.i(654647),p=e.i(341190),g=e.i(415756),v=e.i(753950),y=e.i(179302);function _(e){return y.keymap.of([{key:"Backspace",run:function(t){var i=t.state,n=i.selection.main.head,r=e(i.doc),a=!0,s=!1,o=void 0;try{for(var l,c=r[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;if(n===u.to)return t.dispatch({changes:{from:u.from,to:u.to,insert:""},selection:{anchor:u.from}}),!0}}catch(e){s=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}return!1}},{key:"Delete",run:function(t){var i=t.state,n=i.selection.main.head,r=e(i.doc),a=!0,s=!1,o=void 0;try{for(var l,c=r[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;if(n===u.from)return t.dispatch({changes:{from:u.from,to:u.to,insert:""},selection:{anchor:u.from}}),!0}}catch(e){s=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}return!1}},{key:"Mod-Backspace",mac:"Alt-Backspace",run:function(t){var i=t.state,n=i.selection.main.head,r=e(i.doc),a=null,s=!0,o=!1,l=void 0;try{for(var c,u=r[Symbol.iterator]();!(s=(c=u.next()).done);s=!0){var d=c.value;d.to<=n&&(!a||d.to>a.to)&&(a=d)}}catch(e){o=!0,l=e}finally{try{s||null==u.return||u.return()}finally{if(o)throw l}}if(a){var f=i.doc.sliceString(a.to,n);return!/\w/.test(f)&&(t.dispatch({changes:{from:a.from,to:n,insert:""},selection:{anchor:a.from}}),!0)}return!1}},{key:"Mod-Delete",mac:"Alt-Delete",run:function(t){var i=t.state,n=i.selection.main.head,r=e(i.doc),a=null,s=!0,o=!1,l=void 0;try{for(var c,u=r[Symbol.iterator]();!(s=(c=u.next()).done);s=!0){var d=c.value;d.from>=n&&(!a||d.from<a.from)&&(a=d)}}catch(e){o=!0,l=e}finally{try{s||null==u.return||u.return()}finally{if(o)throw l}}if(a){var f=i.doc.sliceString(n,a.from);return!/\w/.test(f)&&(t.dispatch({changes:{from:n,to:a.to,insert:""},selection:{anchor:n}}),!0)}return!1}},{key:"ArrowLeft",run:function(t){var i=t.state,n=i.selection.main.head,r=e(i.doc),a=!0,s=!1,o=void 0;try{for(var l,c=r[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;if(n===u.to)return t.dispatch({selection:{anchor:u.from}}),!0}}catch(e){s=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}return!1}},{key:"ArrowRight",run:function(t){var i=t.state,n=i.selection.main.head,r=e(i.doc),a=!0,s=!1,o=void 0;try{for(var l,c=r[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;if(n===u.from)return t.dispatch({selection:{anchor:u.to}}),!0}}catch(e){s=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}return!1}}])}e.s(["createAtomicRangeKeymap",()=>_],6013);var T=e.i(928353),x=e.i(602686),b=e.i(752007),w=e.i(827529),I=e.i(870496),A=e.i(951884),k=e.i(346781),C=e.i(815900),S=e.i(596139),E=e.i(882793),j=e.i(58261),N=e.i(968783),L=e.i(993796),D=e.i(569384),M=e.i(973245),P=e.i(304277);e.i(566901);var F=e.i(755078);function R(){var e=(0,D._)(["\n  query IsModelfarmEnabled($orgId: String!) {\n    currentUser {\n      id\n      org(orgId: $orgId) {\n        ... on Org {\n          id\n          settings {\n            ... on OrgSettings {\n              ...OrgAppSettingsData\n            }\n          }\n        }\n      }\n    }\n  }\n  ","\n"]);return R=function(){return e},e}var B={},V=(0,M.gql)(R(),F.OrgAppSettingsDataFragmentDoc);function U(){var e,t,i,n=(0,N.useCurrentUserStoredOrgContext)().orgId,r=(e={skip:!n,variables:{orgId:null!=n?n:""}},t=(0,o._)({},B,e),P.useQuery(V,t)),a=r.data,s=r.loading,l=r.error,c="on"===(0,L.useFlag)({controlName:"flag-modelfarm-openrouter-blueprint",type:"string",default:"off"}),u="on"===(0,L.useFlag)({controlName:"flag-modelfarm-openai-blueprint",type:"string",default:"on"}),d="on"===(0,L.useFlag)({controlName:"flag-modelfarm-gemini-blueprint",type:"string",default:"off"}),f="on"===(0,L.useFlag)({controlName:"flag-modelfarm-anthropic-blueprint",type:"string",default:"off"});if(s||l)return{modelfarm:!1,openrouter:!1,openai:!1,anthropic:!1,gemini:!1};if(!n)return{modelfarm:!0,openrouter:c,openai:u,anthropic:f,gemini:d};var h=null==a||null==(i=a.currentUser)?void 0:i.org,m=(null==h?void 0:h.__typename)==="Org"?h.settings:void 0,p=(null==m?void 0:m.__typename)==="OrgSettings"&&m.modelfarmDisabled,g=(null==m?void 0:m.__typename)==="OrgSettings"&&m.openrouterDisabled,v=(null==m?void 0:m.__typename)==="OrgSettings"&&m.openaiDisabled,y=(null==m?void 0:m.__typename)==="OrgSettings"&&m.anthropicDisabled,_=(null==m?void 0:m.__typename)==="OrgSettings"&&m.geminiDisabled;return{modelfarm:!p,openrouter:c&&!g,openai:u&&!v,anthropic:f&&!y,gemini:d&&!_}}e.s(["useIsModelfarmEnabled",()=>U],164410);var O=e.i(441329),G=e.i(858248),K=e.i(709485),z=e.i(973519),H=e.i(443394),W=e.i(140487),q=e.i(607278),Z=e.i(624782),J=e.i(604963),$=e.i(960178),Y=e.i(751273),Q=e.i(625484),X=e.i(947108),ee=e.i(801704),et=[{id:"blueprint-openai",displayName:"OpenAI",type:"blueprint"},{id:"blueprint-gemini",displayName:"Google Gemini",type:"blueprint"},{id:"blueprint-anthropic",displayName:"Anthropic",type:"blueprint"},{id:"blueprint-openrouter",displayName:"OpenRouter",type:"blueprint"}],ei=function(e,t){switch(e){case"blueprint-openai":return(0,d.jsx)(I.default,{size:t});case"blueprint-gemini":return(0,d.jsx)(w.default,{size:t});case"blueprint-anthropic":return(0,d.jsx)(b.default,{size:t});case"blueprint-openrouter":return(0,d.jsx)(A.default,{size:t});default:return null}},en=function(e,t){return"blueprint"===e.type?ei(e.id,t):"iconPath"in e&&e.iconPath?(0,d.jsx)(f.default,{src:e.iconPath,alt:e.displayName,width:t,height:t}):null},er=function(e,t){"blueprint"===e.type?(0,G.track)(K.events.SLASH_COMMAND,{type:"modelfarm",action:t,displayName:e.displayName}):"blueprint"!==e.type&&(0,G.track)(K.events.SLASH_COMMAND,{type:"integration",action:t,connectorName:e.connectorName,connectorType:e.connectorType,displayName:e.displayName})};function ea(e){return"blueprint"!==e.type&&"connectorName"in e&&null!==e.connectorName&&void 0!==e.connectorName&&E.MCP_CONNECTORS.has(e.connectorName)}function es(e){return ea(e)?"".concat(e.displayName," (MCP)"):e.displayName}var eo=function(e){var t,i,n,r=e.onSelect,a=e.onCancel,s=e.onCancelWithSpace,o=e.isEditingExisting,l=void 0!==o&&o,f=(0,j.useConnectorContext)(),v=f.slashCommandConnectorItems,y=f.isSubscribed,_=!!(0,N.useCurrentUserStoredOrgContext)().orgId,T=(0,z.useGlobalModal)().show,x=(0,H.getCurrentUrl)(),b=(0,c._)((0,h.useState)(""),2),w=b[0],I=b[1],A=(0,h.useRef)(null),C=(0,h.useRef)(null),E=U(),D=(0,L.useFlag)({controlName:"flag-slash-ai",default:!1}),M=(0,L.useFlag)({controlName:"flag-free-plan",default:!1}),P=(0,h.useMemo)(function(){return E.modelfarm&&D?et.filter(function(e){switch(e.id){case"blueprint-openai":return E.openai;case"blueprint-gemini":return E.gemini;case"blueprint-anthropic":return E.anthropic;case"blueprint-openrouter":return E.openrouter;default:return!1}}):[]},[E,D]),F=(0,h.useMemo)(function(){var e=(0,u._)(P).sort(function(e,t){return e.displayName.localeCompare(t.displayName)}),t=(0,u._)(v).sort(function(e,t){return e.displayName.localeCompare(t.displayName)});return(0,u._)(e).concat((0,u._)(t))},[P,v]);(0,h.useEffect)(function(){A.current&&A.current.focus()},[]);var R=(0,h.useMemo)(function(){return new g.Fzf(F,{fuzzy:!1,selector:function(e){return e.displayName.toLowerCase()}})},[F]),B=(0,h.useMemo)(function(){return w?R.find(w.toLowerCase()).map(function(e){return e.item}):F},[R,w,F]),V=(0,h.useMemo)(function(){var e=B.filter(function(e){return"blueprint"===e.type}),t=B.filter(function(e){return"blueprint"!==e.type});return(0,u._)(e).concat((0,u._)(t))},[B]),O=null!=(n=null==(t=V[0])?void 0:t.id)?n:"",G=null==(i=V.find(function(e){return"blueprint"!==e.type}))?void 0:i.id;return 0===F.length?null:(0,d.jsxs)(Q.View,{className:ee.default.popover,children:[(0,d.jsxs)(Q.View,{className:ee.default.popoverContent,children:[(0,d.jsx)(Q.View,{p:8,children:(0,d.jsx)(q.DecoratedInput,{ref:A,placeholder:"Search…",value:w,onChange:function(e){return I(e.target.value)},onKeyDown:function(e){if("Escape"===e.key){e.preventDefault(),null==a||a(w);return}if(("Backspace"===e.key||"Delete"===e.key)&&""===w){null==a||a(w);return}if(" "===e.key&&""===w&&!l){e.preventDefault(),null==s||s();return}if("ArrowDown"===e.key){e.preventDefault();var t,i=null==(t=C.current)?void 0:t.querySelector('[role="option"]');i&&i.focus()}if("Enter"===e.key)if(e.preventDefault(),B.length>0){var n=B[0],o="blueprint"===n.type;if(!y&&!_&&!o){null==a||a(w),M?T("UpgradeEducationModal",{context:"agent_chat_slash_command",highlightedFeature:"connectors"}):T("MembershipPurchaseModal",{headingText:"Connect ".concat(n.displayName),subHeadingText:"Upgrade to ".concat(S.corePlanName," to use integrations and unlock the full power of Replit Agent."),analyticsContext:{upgrade:{context:"agent_chat_slash_command"}},redirectPath:x});return}er(n,"selected"),r(n)}else w&&(null==a||a(w))},className:ee.default.searchInputWrapper,inputClassName:ee.default.searchInput,iconLeft:(0,d.jsx)(k.default,{size:12})})}),(0,d.jsx)("div",{ref:C,role:"presentation",onKeyDown:function(e){if("Escape"===e.key&&(e.preventDefault(),null==a||a(w)),"ArrowUp"===e.key){var t,i,n=null==(t=C.current)?void 0:t.querySelector('[role="option"]');if(n&&document.activeElement===n){e.preventDefault(),null==(i=A.current)||i.focus();return}}("ArrowUp"===e.key||"ArrowDown"===e.key)&&e.preventDefault()},children:(0,d.jsx)(m.ListBox,{"aria-label":"Integrations",className:ee.default.listBox,items:V,selectionMode:"single",onSelectionChange:function(e){if("all"!==e){var t=Array.from(e)[0];if(t){var i=F.find(function(e){return e.id===t});if(i){er(i,"selected");var n="blueprint"===i.type;if(!y&&!_&&!n){null==a||a(w),M?T("UpgradeEducationModal",{context:"agent_chat_slash_command",highlightedFeature:"connectors"}):T("MembershipPurchaseModal",{headingText:"Connect ".concat(i.displayName),subHeadingText:"Upgrade to ".concat(S.corePlanName," to use integrations and unlock the full power of Replit Agent."),analyticsContext:{upgrade:{context:"agent_chat_slash_command"}},redirectPath:x});return}r(i)}}}},renderEmptyState:function(){return(0,d.jsx)("div",{className:ee.default.emptyState,children:(0,d.jsx)($.Text,{variant:"small",color:"dimmer",children:"No matching integrations"})})},children:function(e){return(0,d.jsxs)(d.Fragment,{children:[e.id===G?(0,d.jsx)(p.Header,{children:(0,d.jsxs)(Q.View,{row:!0,justify:"space-between",align:"center",pt:8,pl:8,pb:4,children:[(0,d.jsx)($.Text,{color:"dimmer",className:ee.default.bold,variant:"small",children:"Connectors"}),y||_?null:(0,d.jsx)(X.default,{plan:S.corePlanName,size:"small"})]})}):null,(0,d.jsxs)(m.ListBoxItem,{id:e.id,textValue:e.displayName,className:ee.default.listBoxItem,children:[(0,d.jsxs)(Q.View,{row:!0,gap:8,align:"center",children:[en(e,20),(0,d.jsx)($.Text,{variant:"small",children:e.displayName}),ea(e)?(0,d.jsx)(Y.Tooltip,{tooltip:"This is an MCP Server that Agent can use to access external data and tools while working.",children:(0,d.jsx)(Z.Pill,{text:"MCP",variant:"muted",compact:!0,colorway:"grey"})}):null]}),e.id===O&&y?(0,d.jsx)($.Text,{variant:"small",color:"dimmest",children:"Enter"}):null]})]})}},O)})]}),(0,d.jsx)(Q.View,{className:ee.default.footer,onClick:function(){return null==a?void 0:a(w)},role:"button",tabIndex:0,onKeyDown:function(e){("Enter"===e.key||" "===e.key)&&(e.preventDefault(),null==a||a(w))},children:(0,d.jsxs)(Q.View,{row:!0,gap:4,justify:"space-between",align:"center",children:[(0,d.jsx)($.Text,{className:ee.default.limitText,variant:"small",color:"dimmer",children:l?"Close":w?"Type '/".concat(w,"' on page"):"Type '/' on page"}),(0,d.jsx)($.Text,{variant:"small",color:"dimmest",children:"esc"})]})})]})},el=function(e){var t=e.item,i=e.onSelect,n=e.onRemove,r=(0,c._)((0,h.useState)(!1),2),a=r[0],s=r[1];return(0,d.jsxs)(J.PopoverTrigger,{isOpen:a,onOpenChange:s,label:"Select connector",children:[function(e){return(0,d.jsx)(W.BaseButton,(0,l._)((0,o._)({clsx:ee.default.selectedConnector},e),{onPress:function(){e.onClick()},children:(0,d.jsxs)(Q.View,{row:!0,gap:4,align:"center",children:[en(t,16),(0,d.jsx)($.Text,{variant:"small",children:t.displayName}),(0,d.jsx)("span",{className:ee.default.removeButton,onClick:function(e){e.stopPropagation(),n(),er(t,"cancelled")},role:"button",tabIndex:0,"aria-label":"Remove",onKeyDown:function(e){("Enter"===e.key||" "===e.key)&&(e.preventDefault(),e.stopPropagation(),n(),er(t,"cancelled"))},children:(0,d.jsx)(x.default,{size:12})})]})}))},(0,d.jsx)(Q.View,{p:0,children:(0,d.jsx)(eo,{onSelect:function(e){s(!1),i(e)},onCancel:function(e){s(!1)},isEditingExisting:!0})})]})},ec=function(e){var t=e.connectorId,i=e.onSelect,n=e.onRemove,r=(0,j.useConnectorContext)().slashCommandConnectorItems,a=U(),s=(0,h.useMemo)(function(){var e=a.modelfarm?et.filter(function(e){switch(e.id){case"blueprint-openai":return a.openai;case"blueprint-gemini":return a.gemini;case"blueprint-anthropic":return a.anthropic;case"blueprint-openrouter":return a.openrouter;default:return!1}}):[],i=(0,u._)(e).concat((0,u._)(r)).find(function(e){return e.id===t});return i||{id:t,displayName:"Select an integration",type:"blueprint"}},[t,a,r]);return(0,d.jsx)(el,{item:s,onSelect:i,onRemove:n})},eu=function(e){function o(e,n,a,s){var l;return(0,i._)(this,o),l=(0,t._)(this,o),(0,r._)(l,"connectorId",void 0),(0,r._)(l,"view",void 0),(0,r._)(l,"from",void 0),(0,r._)(l,"to",void 0),l.connectorId=e,l.view=n,l.from=a,l.to=s,l}return(0,a._)(o,e),(0,n._)(o,[{key:"eq",value:function(e){return(0,s._)(e,o)&&e.connectorId===this.connectorId&&e.from===this.from&&e.to===this.to}},{key:"toDOM",value:function(){var e=this,t=document.createElement("span");t.setAttribute("aria-hidden","true"),t.style.display="inline-flex",t.style.verticalAlign="middle",t.style.lineHeight="1",t.style.userSelect="none",t.style.pointerEvents="auto";var i=(0,T.createCodeMirrorElement)((0,d.jsx)(ec,{connectorId:this.connectorId,onSelect:function(t){var i=es(t),n="blueprint"===t.type?'{{"replit-type": "blueprint", "name": '.concat(JSON.stringify(i),"}}"):'{{"replit-type": "connector", "id": '.concat(JSON.stringify(t.id),', "name": ').concat(JSON.stringify(i),"}}");e.view.dispatch({changes:{from:e.from,to:e.to,insert:n},selection:v.EditorSelection.cursor(e.from+n.length)}),window.requestAnimationFrame(function(){e.view.focus()})},onRemove:function(){var t=e.to<e.view.state.doc.length&&" "===e.view.state.doc.sliceString(e.to,e.to+1)?e.to+1:e.to;e.view.dispatch({changes:{from:e.from,to:t,insert:""}}),window.requestAnimationFrame(function(){e.view.focus()})}}));return t.appendChild(i),t}},{key:"ignoreEvent",value:function(){return!1}}]),o}(y.WidgetType),ed=new y.MatchDecorator({regexp:/\{\{[\s\S]*?"replit-type"\s*:\s*"(connector|blueprint)"[\s\S]*?\}\}/g,decorate:function(e,t,i,n,r){try{var a,s=n[0],o=n[1];if("connector"===o){var l=s.match(C.connectorIdJsonRegex);if(!l)return;a=l[1]}else{var c=s.match(C.blueprintNameJsonRegex);if(!c)return;var u=c[1],d=et.find(function(e){return e.displayName===u});if(!d)return;a=d.id}e(t,i,y.Decoration.replace({widget:new eu(a,r,t,i)}))}catch(e){}}}),ef=v.StateEffect.define(),eh=v.StateField.define({create:function(){return null},update:function(e,t){var i=!0,n=!1,r=void 0;try{for(var a,s=t.effects[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var o=a.value;if(o.is(ef))return o.value}}catch(e){n=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return t.docChanged?null:e},provide:function(e){return y.showTooltip.from(e)}}),em=y.ViewPlugin.fromClass(function(){function e(t){(0,i._)(this,e),(0,r._)(this,"view",void 0),(0,r._)(this,"showMenuTimeout",void 0),this.view=t,this.showMenuTimeout=null}return(0,n._)(e,[{key:"destroy",value:function(){this.showMenuTimeout&&(clearTimeout(this.showMenuTimeout),this.showMenuTimeout=null)}},{key:"clearPendingShow",value:function(){this.showMenuTimeout&&(clearTimeout(this.showMenuTimeout),this.showMenuTimeout=null)}},{key:"update",value:function(e){var t=this;if(e.docChanged){var i=e.state,n=!1,r=-1;if(e.changes.iterChanges(function(e,t,i,a,s){1===s.length&&"/"===s.sliceString(0,1)&&(n=!0,r=i)}),n){var a=r>0?i.doc.sliceString(r-1,r):"";(0===r||" "===a||"\n"===a||"	"===a)&&(this.clearPendingShow(),this.showMenuTimeout=setTimeout(function(){t.showMenuTimeout=null,t.showMenu()},200))}else this.clearPendingShow(),Promise.resolve().then(function(){return t.removeMenu()})}e.selectionSet&&this.view.state.field(eh)&&(this.clearPendingShow(),Promise.resolve().then(function(){return t.removeMenu()}))}},{key:"showMenu",value:function(){var e=this,t=this.view.state.selection.main.head,i=(0,O.isInBonsaiWebviewWindow)();this.view.dispatch({effects:ef.of({pos:t,above:i,strictSide:i,create:function(t){return{dom:(0,T.createCodeMirrorElement)((0,d.jsx)(eo,{onSelect:function(t){e.replaceSlashWithConnector(t),e.view.dispatch({effects:ef.of(null)}),window.requestAnimationFrame(function(){e.view.focus()})},onCancel:function(t){t&&e.insertTextAtSlash(t),e.view.dispatch({effects:ef.of(null)}),window.requestAnimationFrame(function(){e.view.focus()})},onCancelWithSpace:function(){e.addSpace(),e.view.dispatch({effects:ef.of(null)}),window.requestAnimationFrame(function(){e.view.focus()})}}))}}})})}},{key:"replaceSlashWithConnector",value:function(e){var t=this.view,i=t.state,n=t.dispatch,r=i.selection.main.head,a=es(e),s="blueprint"===e.type?'{{"replit-type": "blueprint", "name": '.concat(JSON.stringify(a),"}}"):'{{"replit-type": "connector", "id": '.concat(JSON.stringify(e.id),', "name": ').concat(JSON.stringify(a),"}}");n(i.update({changes:{from:r-1,to:r,insert:s+" "},selection:v.EditorSelection.cursor(r-1+s.length+1)}))}},{key:"insertTextAtSlash",value:function(e){var t=this.view,i=t.state,n=t.dispatch,r=i.selection.main.head;n(i.update({changes:{from:r,to:r,insert:e},selection:v.EditorSelection.cursor(r+e.length)}))}},{key:"addSpace",value:function(){var e=this.view,t=e.state,i=e.dispatch,n=t.selection.main.head;i(t.update({changes:{from:n,to:n,insert:" "},selection:v.EditorSelection.cursor(n+1)}))}},{key:"removeMenu",value:function(){(0,this.view.dispatch)({effects:ef.of(null)})}}]),e}()),ep=y.ViewPlugin.fromClass(function(){function e(t){(0,i._)(this,e),(0,r._)(this,"decorations",void 0),this.decorations=ed.createDeco(t)}return(0,n._)(e,[{key:"update",value:function(e){this.decorations=ed.updateDeco(e,this.decorations)}}]),e}(),{decorations:function(e){return e.decorations},provide:function(e){return y.EditorView.atomicRanges.of(function(t){var i;return(null==(i=t.plugin(e))?void 0:i.decorations)||y.Decoration.none})}}),eg=_(function(e){var t=[],i=e.toString(),n=i.matchAll(C.connectorRegex),r=!0,a=!1,s=void 0;try{for(var o,l=n[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var c=o.value;void 0!==c.index&&t.push({from:c.index,to:c.index+c[0].length})}}catch(e){a=!0,s=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw s}}var u=i.matchAll(C.blueprintRegex),d=!0,f=!1,h=void 0;try{for(var m,p=u[Symbol.iterator]();!(d=(m=p.next()).done);d=!0){var g=m.value;void 0!==g.index&&t.push({from:g.index,to:g.index+g[0].length})}}catch(e){f=!0,h=e}finally{try{d||null==p.return||p.return()}finally{if(f)throw h}}return t.sort(function(e,t){return e.from-t.from}),t}),ev=y.keymap.of([{key:"Escape",run:function(e){return!!e.state.field(eh)&&(e.dispatch({effects:[ef.of(null)]}),!0)}}]),ey=[eh,em,ep,eg,ev];e.s(["slashCommandExtension",()=>ey],656381);var e_=y.EditorView.contentAttributes.of({autocapitalize:"on"});e.s(["autocapitalizeExtension",()=>e_],825423);var eT=y.EditorView.contentAttributes.of({autocorrect:"on"});e.s(["autocorrectExtension",()=>eT],257378)},112801,e=>{e.v({container:"FigmaUrlInput-module__dzOMQW__container",mediumFont:"FigmaUrlInput-module__dzOMQW__mediumFont"})},56641,e=>{e.v({animatedContainer:"FigmaUrlInputAnimated-module__1iGfba__animatedContainer","smooth-slide-down-and-fade-in":"FigmaUrlInputAnimated-module__1iGfba__smooth-slide-down-and-fade-in"})},564416,600572,e=>{"use strict";var t=e.i(167626),i=e.i(878420),n=e.i(886513),r=e.i(530658),a=e.i(346715),s=e.i(276385),o=e.i(485273),l=e.i(389959),c=e.i(830675),u=e.i(72158),d=e.i(488566),f=e.i(753950),h=e.i(179302),m=e.i(266159),p=e.i(893255),g=e.i(210736),v=e.i(555970),y=e.i(738705),_=e.i(684481),T=e.i(221250),x=e.i(248327),b=e.i(966684),w=e.i(945698),I=e.i(442234),A=e.i(342965),k=e.i(703613),C=e.i(786962),S=e.i(993796),E=e.i(650587),j=e.i(98816),N=e.i(343252),L=e.i(441329),D=e.i(703774),M=h.keymap.of([{key:"Shift-Enter",run:d.insertNewlineAndIndent,shift:d.insertNewlineAndIndent},{key:"ArrowDown",run:(0,u.moveCompletionSelection)(!0)},{key:"ArrowUp",run:(0,u.moveCompletionSelection)(!1)},{key:"PageDown",run:(0,u.moveCompletionSelection)(!0,"page")},{key:"PageUp",run:(0,u.moveCompletionSelection)(!1,"page")},{key:"Enter",run:u.acceptCompletion},{key:"Mod-z",run:d.undo,preventDefault:!0},{key:"Mod-y",run:d.redo,preventDefault:!0},{key:"Mod-Shift-z",run:d.redo,preventDefault:!0}]),P=h.keymap.of([{key:"Enter",run:d.insertNewlineAndIndent,shift:d.insertNewlineAndIndent}]),F=h.EditorView.domEventHandlers({drop:function(e){var t;return!!(null==(t=e.dataTransfer)?void 0:t.files.length)&&(e.preventDefault(),!0)}}),R=(0,l.forwardRef)(function(e,u){var d,R,B,V,U,O,G,K,z,H,W,q,Z,J,$,Y,Q,X=e.elementRef,ee=e.initialDoc,et=e.fontSize,ei=e.readOnly,en=e.extensions,er=e.initializing,ea=e.loading,es=e.onException,eo=(0,n._)(e,["elementRef","initialDoc","fontSize","readOnly","extensions","initializing","loading","onException"]),el=(0,r._)((0,l.useState)(null),2),ec=el[0],eu=el[1],ed=(0,r._)((0,l.useState)(null),2),ef=ed[0],eh=ed[1],em=(0,l.useRef)(ee),ep=(0,r._)((0,l.useState)(0),2),eg=ep[0],ev=ep[1],ey=(0,l.useRef)(eg),e_=(0,l.useCallback)(function(){ev(function(e){if(e-ey.current>=5)throw Error("CodeMirror error refresh loop detected");return e+1})},[]);(0,l.useEffect)(function(){var e=setTimeout(function(){ey.current=eg},1e3);return function(){return clearTimeout(e)}},[eg]),(0,l.useImperativeHandle)(u,function(){return{view:ec,dom:ef}},[ec,ef]),(0,T.assertClientSide)();var eT=(0,j.default)(null!=es?es:T.defaultOnException),ex=(R=(d={fontSize:et,readOnly:ei,extensions:en,initializing:er,loading:ea}).fontSize,B=d.readOnly,V=d.extensions,U=d.initializing,O=d.loading,G=(0,o.useRouter)(),K=(0,E.useIsMobile)(),z=(0,L.isInBonsaiWebview)(G),H=(0,L.useIsInMobileWorkspace)(),W=(0,S.useFlag)({controlName:"flag-editor-root-level-tooltips",logFlagToAnalytics:!1}),q=(0,T.useMemoizedExtensions)(V),J=(Z=(0,D.useTheme)()).values,$=Z.isDarkColorScheme,Y=w.ThemeCompartment.use(J,$,R),Q=[x.EditableCompartment.use(B,z,W,!1),b.HistoryCompartment.use(B),T.ExtensionsCompartment.use(q),Y,I.LineWrappingCompartment.use(!0),v.InitializingCompartment.use(U),y.LoadingCompartment.use(O),_.IsMobileCompartment.use(H)],[f.Prec.highest(C.EditorReactRoot),k.StateListenerPlugin,y.BindLoadingPlugin,p.HasHadUserInput,m.AnimatedRanges,K?P:M,A.DisableGrammarly,F].concat((0,a._)(Q)));(0,l.useEffect)(function(){var e,i=function(e){if(eT.current(e),(0,T.shouldRefreshForError)(e)){var i=(0,t._)(e,Error)?e.message:void 0;c.addBreadcrumb({category:"codemirror",message:"Codemirror refresh called",data:{error:i},level:"error"}),e_()}};if(ef){var n=null;try{n=new h.EditorView({doc:null!=(e=em.current)?e:void 0,parent:ef,extensions:[h.EditorView.exceptionSink.of(i)].concat((0,a._)(ex))})}catch(e){i(e)}return n&&eu(n),function(){if(n){eu(null);try{n.destroy()}catch(e){i(e)}}}}},[ef,eg]),(0,g.useObserveCodeMirrorResize)(ec);var eb=(0,N.useMergeRefs)([eh,X],{breadcrumb:"client/codemirror/react/ProseCodeMirror.tsx:353"});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",(0,i._)({ref:eb},eo)),(0,s.jsx)(C.EditorReactRootMount,{view:ec})]})});e.s(["default",0,R],564416);var B=e.i(64386),V=e.i(828043),U=e.i(645674),O=e.i(222878),G=e.i(89078),K=e.i(162914),z=e.i(858248),H=e.i(709485),W=e.i(480028),q=e.i(140487),Z=e.i(607278),J=e.i(818503),$=e.i(624782),Y=e.i(960178),Q=e.i(625484),X=e.i(112801),ee="Invalid Figma URL. Please ensure link is a valid Figma frame for your connected account in the format https://www.figma.com/design/...";function et(e){var t=e.source,i=e.onCancel,n=e.onSubmit,a=e.title,o=e.submitButtonText,c=e.showHelpText,u=e.className,d=e.autoFocus,f=void 0===d||d,h=(0,r._)((0,l.useState)(null),2),m=h[0],p=h[1],g=(0,r._)((0,l.useState)(""),2),v=g[0],y=g[1],_=(0,l.useRef)(null),T=(0,K.default)(v,500),x="workspace"===t,b=x?H.events.AGENT_USED:H.events.START_WITH_AI_USED,w=(0,l.useCallback)(function(){(0,z.track)(b,{action:"attachment_import_from_figma_cancelled"}),i()},[i,b]);(0,l.useEffect)(function(){T?p((0,r._)((0,V.isValidFigmaUrl)(T),1)[0]?null:ee):p(null)},[T]);var I=(0,l.useCallback)(function(){var e=v.trim();if(!e)return void p("Please enter a Figma URL");var t=(0,r._)((0,V.isValidFigmaUrl)(e),2),i=t[0],a=t[1];i&&a?(p(null),(0,z.track)(b,{action:"attachment_import_from_figma_attached",figma_url:e}),n(e)):p(ee)},[v,n,b]),A=(0,l.useCallback)(function(e){"Enter"===e.key?(e.preventDefault(),I()):"Escape"===e.key&&(e.preventDefault(),w())},[I,w]);return(0,l.useEffect)(function(){if(f){var e;null==(e=_.current)||e.focus()}},[f]),(0,s.jsxs)(Q.View,{clsx:[X.default.container,u],children:[(0,s.jsxs)(Q.View,{row:!0,gap:8,align:"center",children:[(0,s.jsx)(U.default,{size:20}),(0,s.jsx)(Y.Header,{variant:"subheadDefault",level:3,children:void 0===a?"Import Figma design":a}),x?(0,s.jsx)($.Pill,{text:"Beta",colorway:"primary",compact:!0}):null]}),(0,s.jsxs)(Q.View,{gap:8,children:[(0,s.jsx)(J.Label,{htmlFor:"figmaUrl",className:X.default.mediumFont,children:"Figma frame URL"}),(0,s.jsx)(Z.Input,{id:"figmaUrl",ref:_,placeholder:"https://www.figma.com/file/...",value:v,onChange:function(e){return y(e.target.value)},onKeyDown:A,autoFocus:f}),m?(0,s.jsx)(Q.View,{pb:8,py:4,children:(0,s.jsx)(G.default,{children:m})}):null,void 0===c||c?(0,s.jsxs)(Q.View,{row:!0,gap:8,align:"center",children:[(0,s.jsx)(Q.View,{shrink:!1,children:(0,s.jsx)(O.default,{color:W.tokens.foregroundDimmer})}),(0,s.jsx)(Q.View,{grow:!0,shrink:!0,children:(0,s.jsxs)(Y.Text,{color:"dimmer",variant:"small",multiline:!0,children:[(0,s.jsx)("span",{className:X.default.mediumFont,children:"How to find your frame URL:"})," ",'In Figma Design, right click on the frame you want to import, then click "Copy/Paste as" and finally "Copy link to selection".']})})]}):null,(0,s.jsxs)(Q.View,{row:!0,gap:8,justify:"end",children:[(0,s.jsx)(q.Button,{text:"Cancel",variant:"outlined",onClick:w}),(0,s.jsx)(q.Button,{variant:"outlined",colorway:!v.trim()||m?"grey":"primary",text:void 0===o?"Attach to prompt":o,disabled:!v.trim()||!!m,onClick:I})]})]})]})}var ei=e.i(56641);function en(e){return(0,s.jsx)(et,(0,B._)((0,i._)({},e),{className:ei.default.animatedContainer}))}function er(e){var t=e.source,i=e.onCancel,n=e.onSubmit;return(0,s.jsx)(en,{source:t,onCancel:i,onSubmit:n,title:"Import Figma design"})}e.s(["FigmaUrlInput",()=>er],600572)},518056,e=>{"use strict";var t=e.i(878420),i=e.i(64386),n=e.i(276385),r=e.i(116235);function a(e){return(0,n.jsx)(r.default,(0,i._)((0,t._)({},e),{children:(0,n.jsx)("path",{d:"M16.001 1.25a4.75 4.75 0 0 1 3.358 8.11v-.001l-8.408 8.58-.006.007a2.751 2.751 0 0 1-3.89-3.89l8.41-8.581a.75.75 0 0 1 1.071 1.05L8.122 15.11l-.006.006a1.25 1.25 0 1 0 1.769 1.767l8.408-8.58.006-.006a3.25 3.25 0 1 0-4.597-4.595L5.33 12.247l-.01.01a5.253 5.253 0 0 0 1.683 8.598 5.252 5.252 0 0 0 5.741-1.173l8.378-8.55a.75.75 0 0 1 1.071 1.05l-8.378 8.55-.002.002a6.75 6.75 0 1 1-9.545-9.546l8.37-8.541.005-.005c.89-.89 2.1-1.392 3.359-1.392Z"})}))}e.s(["default",()=>a])},66830,e=>{"use strict";var t=e.i(276385),i=e.i(389959),n=e.i(445059),r=(0,i.createContext)(null);function a(e){var i=e.children,a=e.sessionId,s=e.uploadFiles,o=e.onError,l=(0,n.useAttachmentsImpl)({sessionId:a,uploadFiles:s,onError:o});return(0,t.jsx)(r.Provider,{value:l,children:i})}function s(){var e=(0,i.useContext)(r);if(!e)throw Error("useAiChatAttachments(must be used within an AiChatAttachmentsProvider");return e}e.s(["AiChatAttachmentsProvider",()=>a,"useAiChatAttachments",()=>s])},157918,e=>{"use strict";var t=e.i(721281);e.i(276385);var i=e.i(753950),n=e.i(179302);e.i(508987);var r=e.i(457103);e.i(703613);var a=e.i(700170),s=e.i(480028),o=e.i(446530),l=e.i(613355);e.i(960178);var c=i.Facet.define({combine:function(e){var t;return null!=(t=e[0])?t:0}}),u=new a.ReactCompartment(function(e){return c.of(e)}),d="cm-empty-state-dom",f=n.EditorView.theme((0,t._)({},".".concat(d),{backgroundColor:s.tokens.redDefault,opacity:"0.2"})),h=i.StateField.define({create:function(e){return e.doc.length},update:function(e,t){return t.state.doc.length}}),m=function(e){return Math.max(e.doc.length-e.facet(c),0)},p=i.StateField.define({create:m,update:function(e,t){return(0,r.hasChanged)(t,"doc",c)?m(t.state):e},provide:function(e){return[h,f,(0,n.layer)({above:!1,update:function(t){return(0,r.hasChanged)(t,e)},markers:function(t){var r=t.state.field(e);if(0===r)return[];var a=t.state.doc.length;return n.RectangleMarker.forRange(t,d,i.EditorSelection.range(a-r,a))}})]}});(0,o.cssRecord)({charLimit:[l.rcss.color.redDefault]}),e.s(["MaxLength",()=>u,"characterLimit",()=>p])},683389,e=>{"use strict";var t,i,n=e.i(721281),r=e.i(389959),a=e.i(753950),s=e.i(179302);e.i(508987);var o=e.i(457103),l=e.i(969932),c=e.i(546833),u=e.i(197649),d=e.i(480028),f=e.i(585225),h="cm-placeholder-layer",m="cm-placeholder-dom",p=s.EditorView.theme((t={},(0,n._)(t,".".concat(h),{width:"100%",height:"100%",pointerEvents:"none"}),(0,n._)(t,".".concat(m),{position:"absolute",width:"100%",pointerEvents:"none",fontFamily:d.tokens.fontFamilyDefault,color:d.tokens.foregroundDimmest}),t)),g=s.EditorView.theme((i={},(0,n._)(i,".".concat(h),{width:"100%",height:"100%",pointerEvents:"none"}),(0,n._)(i,".".concat(m),{position:"absolute",width:"100%",pointerEvents:"none",fontFamily:d.tokens.fontFamilyDefault}),i)),v=function(e){return 0===e.doc.toString().trim().length},y=a.StateEffect.define(),_=a.StateField.define({create:v,update:function(e,t){return v(t.state)}});function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,i=void 0===t?"Type message…":t,a=e.disableAnimation,d=void 0!==a&&a,v=(0,f.useIsShadesSupported)();return(0,r.useMemo)(function(){var e;return[_,v?g:p,(0,s.layer)((e=Date.now(),{above:!1,class:h,update:function(t){var i=!1;return(0,l.forEachEffect)(t,y,function(){i=!0,e=Date.now()}),i||(0,o.hasChanged)(t,_)},markers:function(t){if(!t.state.field(_))return[];var r,a,s,o,l,f,h,p,g=t.coordsAtPos(0);if(!g)return[];var y=t.dom.getBoundingClientRect(),T=g.left-y.left;return[(a=(r={top:g.top-y.top,left:T,height:g.bottom-g.top,animateTimestamp:e,text:i,disableAnimation:d,isShadesSupported:v}).top,s=r.left,o=r.height,l=r.animateTimestamp,f=r.text,h=r.disableAnimation,p=r.isShadesSupported,{draw:function(){var e=document.createElement("div");e.className=(0,u.default)(m,(0,n._)({},c.classes.placeholderText,p)),e.style.width="100%",e.style.paddingTop=a+"px",e.style.paddingLeft=s+"px",e.style.height=o+"px";var t=f.length;return h?e.textContent=f:!function i(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;requestAnimationFrame(function(){e.textContent=f.slice(0,n),n<t&&i(n+1)})}(),e},animateTimestamp:l,eq:function(e){return this.animateTimestamp===e.animateTimestamp}})]}}))]},[i,d,v])}e.s(["animateTextEffect",()=>y,"isEmpty",()=>_,"usePlaceholder",()=>T])},900433,456594,e=>{"use strict";var t=e.i(530658),i=e.i(848415),n=e.i(288148);function r(e){var r=e.addAttachments,a=(0,t._)((0,i.useDrop)(function(){return{accept:[n.NativeTypes.FILE],drop:function(e){e.dirContent.then(function(e){r(e.filter(function(e){return".DS_Store"!==e.name}).map(function(e){return{fileName:e.name,file:e}}))})},collect:function(e){return{isOver:!0===e.isOver()}}}}),2);return{isDraggedOver:a[0].isOver,drop:a[1]}}e.s(["useDropTarget",()=>r],900433);var a=e.i(878420),s=e.i(64386),o=e.i(276385),l=e.i(116235);function c(e){return(0,o.jsxs)(l.default,(0,s._)((0,a._)({},e),{children:[(0,o.jsx)("path",{d:"M12.025 11.251a.636.636 0 0 1 .134.017.739.739 0 0 1 .098.03c.012.004.026.006.038.012.019.008.036.02.055.03.023.012.048.024.07.039a.754.754 0 0 1 .11.09l3 3a.75.75 0 0 1-1.06 1.061l-1.72-1.72V18a.75.75 0 0 1-1.5 0v-4.19l-1.72 1.72a.75.75 0 1 1-1.06-1.06l3-3 .056-.052c.01-.008.022-.015.033-.022a.74.74 0 0 1 .26-.122l.06-.014a.737.737 0 0 1 .121-.01l.025.001Z"}),(0,o.jsx)("path",{fillRule:"evenodd",d:"M14 1.25a3.152 3.152 0 0 1 2.234.926l3.586 3.586A3.156 3.156 0 0 1 20.75 8v12A2.75 2.75 0 0 1 18 22.75H6A2.75 2.75 0 0 1 3.25 20V4A2.75 2.75 0 0 1 6 1.25h8Zm-8 1.5A1.25 1.25 0 0 0 4.75 4v16A1.25 1.25 0 0 0 6 21.25h12A1.25 1.25 0 0 0 19.25 20V8.75H15A1.75 1.75 0 0 1 13.25 7V2.75H6ZM14.75 7a.25.25 0 0 0 .25.25h4.07a1.65 1.65 0 0 0-.306-.424l-3.591-3.59a1.648 1.648 0 0 0-.423-.306V7Z",clipRule:"evenodd"})]}))}e.s(["default",()=>c],456594)},959559,e=>{e.v({button:"AttachmentButton-module__Ewwhga__button",colorForegroundDimmer:"AttachmentButton-module__Ewwhga__colorForegroundDimmer"})},956515,482853,342469,908320,706510,934226,e=>{"use strict";var t=e.i(297083),i=e.i(721281),n=e.i(817556),r=e.i(276385),a=e.i(389959),s=e.i(252204),o=e.i(645674),l=e.i(456594),c=e.i(518056),u=e.i(394572),d=e.i(709485),f=e.i(878420),h=e.i(64386),m=e.i(530658),p=e.i(992785),g=e.i(82259),v=e.i(629536),y=e.i(179302),_=e.i(700170);e.i(925218);var T=e.i(641555),x=e.i(802088),b=e.i(917095),w=e.i(650587),I=e.i(631936),A=e.i(904851),k=e.i(90659),C=e.i(886513),S=e.i(828043);e.i(242933);var E=e.i(790164),j=e.i(858248),N=e.i(576255);function L(e,t,i){var n,r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(0,f._)({},t,e),o="Design"===s.stackKey?s.stackKey:null!=(n=s.fastModeStackOverride)?n:s.stackKey;"Auto"===o&&(o=s.agentMode===g.AgentMode.AGENT_MODE_INITIAL_PLANNING?void 0:"Modern web app");var l=s.themeId,c=s.themeConfig;o&&!b.STACKS_THAT_SUPPORT_APP_THEMES.has(o)&&(l=void 0,c=void 0);var u=s.customStackReplId;"Stack from existing App"!==o&&"OrgStackTemplate"!==o&&(u=void 0);var d=null!=(r=s.agentMode)?r:g.AgentMode.AGENT_MODE_GENERAL;"Automation"===o&&(d=g.AgentMode.AGENT_MODE_INITIAL_PLANNING),"Expert Mode"===o&&(d=g.AgentMode.AGENT_MODE_GENERAL),"Design"===o&&(d=g.AgentMode.AGENT_MODE_GENERAL),a&&(d=g.AgentMode.AGENT_MODE_GENERAL);var m=s.buildTier;"Modern web app"!==o&&(m=g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO),void 0===m&&"Modern web app"===o&&(m="paid"===i||"org"===i?g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO:g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE),m===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO&&("free"===i||"anon"===i)&&"Modern web app"===o&&(m=g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE),void 0!==e.buildTier&&void 0===e.agentMode&&d===g.AgentMode.AGENT_MODE_INITIAL_PLANNING&&"Modern web app"===o&&(d=g.AgentMode.AGENT_MODE_GENERAL);var p=s.enableAutomatedTesting;m===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE&&(p=void 0);var v="Design"===o?g.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_DESIGN:g.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_BUILD;return(0,h._)((0,f._)({},s),{stackKey:o,themeId:l,themeConfig:c,customStackReplId:u,buildTier:m,agentMode:d,initialBuildMode:v,enableAutomatedTesting:p})}var D="Modern web app",M="Design";function P(e){return"Design"===e}var F=function(){function e(t){var n=this,r=t.classifier,a=t.initialSettings,s=t.userType;(0,A._)(this,e),(0,i._)(this,"data",void 0),(0,i._)(this,"detectedUrls",void 0),(0,i._)(this,"settings",void 0),(0,i._)(this,"validatedSettings",void 0),(0,i._)(this,"classifier",void 0),(0,i._)(this,"userType",void 0),(0,i._)(this,"hadContentDuringSession",!1),(0,i._)(this,"userConfiguredSettings",new Set),(0,i._)(this,"setPrompt",function(e){n.data.update(function(t){return(0,h._)((0,f._)({},t),{prompt:e})}),n.classify("prompt")}),(0,i._)(this,"setAttachments",function(e){n.data.update(function(t){return(0,h._)((0,f._)({},t),{attachments:e})}),n.classify("attachments")}),(0,i._)(this,"updateSettings",function(e){var t,i,r={},a={};n.settings.update(function(t){r=e(t);var i=!0,s=!1,o=void 0;try{for(var l,c=Object.keys(r)[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value;"stackKey"!==u&&"prevTabSettings"!==u&&"fastModeStackOverride"!==u&&n.userConfiguredSettings.add(u)}}catch(e){s=!0,o=e}finally{try{i||null==c.return||c.return()}finally{if(s)throw o}}var d=P(t.stackKey)!==P(null!=(m=r.stackKey)?m:t.stackKey);if(void 0!==r.buildTier&&(Object.assign(a,n.computeBuildTierCapabilityUpdates(r.buildTier)),t.buildTier===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE&&r.buildTier!==g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE)){n.userConfiguredSettings.delete("enableAutomatedTesting");var m,p,v,y=null!=(v=null!=(p=r.stackKey)?p:t.stackKey)?v:D;Object.assign(a,n.computeStackCapabilityUpdates(y))}if(void 0!==r.stackKey&&Object.assign(a,n.computeStackCapabilityUpdates(r.stackKey)),!d)return(0,f._)({},t,r,a);var _=t.prevTabSettings,T=(0,C._)(t,["prevTabSettings"]),x=("Auto"===r.stackKey||"Design"===r.stackKey)&&_?_:(0,f._)({},t,r),b=x.stackKey;return b&&(a=n.computeStackCapabilityUpdates(b)),(0,h._)((0,f._)({},x,a),{prevTabSettings:T})}),n.validatedSettings=L((0,f._)({},r,a),n.settings.current,n.userType,n.hasFigmaLinks());var s=P(n.settings.current.stackKey)===P(null!=(t=r.stackKey)?t:n.settings.current.stackKey)&&"stackKey"in r&&"Auto"!==r.stackKey&&"Design"!==r.stackKey,o="agentMode"in r&&r.agentMode===g.AgentMode.AGENT_MODE_INITIAL_PLANNING;(s||o)&&(null==(i=n.classifier)||i.disable())}),(0,i._)(this,"getValidatedSettings",function(){var e=n.validatedSettings,t=n.data.current,i=t.prompt,r=t.attachments,a=e.agentMode===g.AgentMode.AGENT_MODE_INITIAL_PLANNING;if(("paid"===n.userType||"org"===n.userType)&&!P(e.stackKey)&&!a&&0===r.length&&i.length<5){e.customStackReplId;var s=(0,C._)(e,["customStackReplId"]);return(0,h._)((0,f._)({},s),{stackKey:"Modern web app",agentMode:g.AgentMode.AGENT_MODE_INITIAL_PLANNING,buildTier:g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO})}return e}),(0,i._)(this,"setDetectedUrls",function(e){if(n.detectedUrls.update(function(){return e}),e.filter(function(e){return(0,S.isValidFigmaUrl)(e)[0]}).length>0){var t=n.settings.current.stackKey;if(!b.STACKS_THAT_SUPPORT_FIGMA_LINKS.has(null!=t?t:"Auto")||"Auto"===t)return void n.updateSettings(function(){return{stackKey:"Modern web app"}})}n.validatedSettings=L({},n.settings.current,n.userType,n.hasFigmaLinks())}),(0,i._)(this,"clearUserConfiguredBuildTier",function(){n.userConfiguredSettings.delete("buildTier")}),(0,i._)(this,"reset",function(){n.data.update(function(){return{prompt:"",attachments:[]}}),n.detectedUrls.update(function(){return[]}),null==(e=n.classifier)||e.reset(),n.hadContentDuringSession=!1,n.userConfiguredSettings.clear();var e,t=n.settings.current,i=t.stackKey,r=t.buildTier;n.settings.update(function(){return{stackKey:P(i)?M:D,buildTier:r}}),n.validatedSettings=L({},n.settings.current,n.userType,n.hasFigmaLinks())}),(0,i._)(this,"destroy",function(){var e;null==(e=n.classifier)||e.destroy()}),(0,i._)(this,"awaitClassification",function(){return n.classifier?Promise.race([n.classifier.awaitClassification(),new Promise(function(e){return setTimeout(e,4e3)})]):Promise.resolve()}),this.classifier=r,this.userType=null!=s?s:"anon",this.data=new E.ObservableState({prompt:"",attachments:[]}),this.detectedUrls=new E.ObservableState([]);var o="paid"===this.userType||"org"===this.userType?g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO:g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,l=(0,f._)({stackKey:M,buildTier:o},a);l.buildTier===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE&&Object.assign(l,this.computeBuildTierCapabilityUpdates(g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE)),this.settings=new E.ObservableState(l),this.validatedSettings=L({},l,this.userType,this.hasFigmaLinks()),this.classifier&&this.classifier.result.subscribe({next:function(e){return n.handleClassificationResult(e)}})}return(0,k._)(e,[{key:"hasFigmaLinks",value:function(){return this.detectedUrls.current.some(function(e){return(0,S.isValidFigmaUrl)(e)[0]})}},{key:"isEmpty",value:function(){var e=this.data.current,t=e.prompt,i=e.attachments;return!t.trim()&&0===i.length}},{key:"classify",value:function(e){if(this.classifier){if(this.isEmpty()){if(this.classifier.reset(),this.userConfiguredSettings.delete("buildTier"),this.hadContentDuringSession&&!P(this.settings.current.stackKey)){var t="paid"===this.userType||"org"===this.userType?g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO:g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,i=t===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE?"Modern web app":void 0,n=this.computeStackCapabilityUpdates("Modern web app"),r="free"===this.userType||"anon"===this.userType?(0,f._)({buildTier:g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE},this.computeBuildTierCapabilityUpdates(g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE)):{};this.settings.update(function(e){return(0,f._)((0,h._)((0,f._)({},e),{stackKey:"Modern web app",buildTier:t,fastModeStackOverride:i,paidStackFallbackMessage:null}),n,r)}),this.validatedSettings=L((0,f._)({stackKey:"Modern web app",buildTier:t},n,r),this.settings.current,this.userType,this.hasFigmaLinks())}return}this.hadContentDuringSession=!0,this.classifier.classify((0,h._)((0,f._)({},this.data.current),{debounceType:e}))}}},{key:"handleClassificationResult",value:function(e){if(null==e?void 0:e.ok){var t=(0,v.getStackOptionFromBlueprint)(e.payload.stackType);if(t){var i=this.settings.current.stackKey;if(!P(i)){i!==t&&(0,j.track)(d.events.APP_TYPE_AUTO_SELECTED_CLIENT,{appType:t,previousAppType:i,promptLength:this.data.current.prompt.length});var n=this.computeStackCapabilityUpdates(t),r=e.payload.agentInitialBuildTier,a="Modern web app"===t,s=r===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE||r===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO,o=this.userConfiguredSettings.has("buildTier"),l="paid"===this.userType||"org"===this.userType,c=(0,f._)({stackKey:t},n);if(a&&s&&!o&&l){var u=this.settings.current.buildTier===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,h=r===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE;c.buildTier=r,c.fastModeStackOverride=h?"Modern web app":void 0,h?c.enableAutomatedTesting=void 0:u&&(this.userConfiguredSettings.delete("enableAutomatedTesting"),Object.assign(c,this.computeStackCapabilityUpdates(t)))}this.settings.update(function(e){return(0,f._)({},e,c)}),this.validatedSettings=L(c,this.settings.current,this.userType,this.hasFigmaLinks())}}}}},{key:"computeStackCapabilityUpdates",value:function(e){var t=(0,N.getStackCapabilities)(e),i=this.settings.current,n={},r=(0,N.applyAutomatedTestingCapability)(i.enableAutomatedTesting,this.userConfiguredSettings.has("enableAutomatedTesting"),t);r!==i.enableAutomatedTesting&&(n.enableAutomatedTesting=r);var a=i.buildTier===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,s="Modern web app"!==e&&"Auto"!==e;return a&&s&&(n.buildTier=g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO,Object.assign(n,this.computeBuildTierCapabilityUpdates(g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO))),n}},{key:"computeBuildTierCapabilityUpdates",value:function(e){var t={};return e===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE?(t.fastModeStackOverride="Modern web app",t.enableAutomatedTesting=void 0):t.fastModeStackOverride=void 0,t}}]),e}(),R=e.i(596139),B="buildDesignModePreference",V={REQUIRES_CORE:"Selected app type requires ".concat(R.corePlanName),FALLBACK:function(e){return e?"'".concat(e,"' is available with ").concat(R.corePlanName,". To continue with Free, build a web app instead."):"Selected app type requires ".concat(R.corePlanName,". To continue with Free, build a web app instead.")}};e.s(["BUILD_DESIGN_MODE_PREFERENCE_STORAGE_KEY",()=>B,"PREMIUM_STACK_SUPPORTING_TEXT",()=>V],482853);var U=e.i(180703),O=e.i(424360),G=e.i(279606),K=function(){function e(t){var n=t.uploadFile;(0,A._)(this,e),(0,i._)(this,"uploadFile",void 0),(0,i._)(this,"fileState",new Map),(0,i._)(this,"destroyed",!1),this.uploadFile=n}return(0,k._)(e,[{key:"getFileUrls",value:function(e){return(0,t._)(function(){var i,r,a,s,o,l,c,u,d,f,h,p,g,v,y,_,T,x,b,w,I,A,k;return(0,n._)(this,function(C){switch(C.label){case 0:if(i=this,this.destroyed)return[2,new Map];r=new Set(e.map(function(e){return e.path})),a=!0,s=!1,o=void 0;try{for(l=this.fileState[Symbol.iterator]();!(a=(c=l.next()).done);a=!0)u=(0,m._)(c.value,1)[0],r.has(u)||this.fileState.delete(u)}catch(e){s=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw o}}d=[],f=!0,h=!1,p=void 0;try{for(g=e[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){if(_=(y=v.value).path,(null==(T=this.fileState.get(_))?void 0:T.status)==="uploaded"){if(!(T.response.payload.expires.getTime()<Date.now()))continue;this.fileState.set(_,{status:"unprocessed"})}(null==T?void 0:T.status)!=="error"&&(null==T?void 0:T.status)!=="uploading"&&(T||this.fileState.set(_,{status:"unprocessed"}),d.push(y))}}catch(e){h=!0,p=e}finally{try{f||null==g.return||g.return()}finally{if(h)throw p}}if(0===d.length)return[2,this.getUploadedUrls(e)];x=!0,b=!1,w=void 0;try{for(I=d[Symbol.iterator]();!(x=(A=I.next()).done);x=!0)k=A.value,this.fileState.set(k.path,{status:"uploading"})}catch(e){b=!0,w=e}finally{try{x||null==I.return||I.return()}finally{if(b)throw w}}return[4,Promise.all(d.map(function(e){return(0,t._)(function(){var t;return(0,n._)(this,function(i){switch(i.label){case 0:return[4,this.uploadFile(e)];case 1:if(t=i.sent(),this.destroyed)return[2];return t.ok?this.fileState.set(e.path,{status:"uploaded",response:t}):this.fileState.set(e.path,{status:"error",response:t}),[2]}})}).call(i)}))];case 1:return C.sent(),[2,this.getUploadedUrls(e)]}})}).call(this)}},{key:"getUploadedUrls",value:function(e){var t=new Map,i=!0,n=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var o=a.value,l=this.fileState.get(o.path);(null==l?void 0:l.status)==="uploaded"&&t.set(o.path,l.response.payload.url)}}catch(e){n=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}return t}},{key:"destroy",value:function(){this.destroyed=!0,this.fileState.clear()}}]),e}(),z=function(){function e(t){var n,r,a=this,s=t.classifyFn,o=t.uploadFile,l=t.minPromptLength,c=t.characterThreshold,u=t.periodicCharacterThreshold,d=t.initialCharacterThreshold,f=t.debounce,h=void 0===f?{}:f,m=t.maxTypingInterval;(0,A._)(this,e),(0,i._)(this,"state",void 0),(0,i._)(this,"debounceTimer",null),(0,i._)(this,"initialClassificationTimer",null),(0,i._)(this,"currentVersion",0),(0,i._)(this,"isDisabled",!1),(0,i._)(this,"isInitialClassificationInProgress",!1),(0,i._)(this,"isPeriodicClassificationInProgress",!1),(0,i._)(this,"hasInitialClassificationFired",!1),(0,i._)(this,"hasAnyClassificationCompleted",!1),(0,i._)(this,"lastPeriodicClassifiedPrompt",""),(0,i._)(this,"classifyingVersion",null),(0,i._)(this,"minPromptLength",void 0),(0,i._)(this,"characterThreshold",void 0),(0,i._)(this,"periodicCharacterThreshold",void 0),(0,i._)(this,"initialCharacterThreshold",void 0),(0,i._)(this,"lastClassifiedPrompt",""),(0,i._)(this,"lastClassificationHadAttachments",!1),(0,i._)(this,"debounce",void 0),(0,i._)(this,"maxTypingInterval",void 0),(0,i._)(this,"classifyFn",void 0),(0,i._)(this,"fileUploader",void 0),(0,i._)(this,"uploadFile",void 0),(0,i._)(this,"rateLimitTokens",void 0),(0,i._)(this,"rateLimitLastRefill",void 0),(0,i._)(this,"latestPrompt",""),(0,i._)(this,"latestAttachments",[]),(0,i._)(this,"latestRunPromise",Promise.resolve()),(0,i._)(this,"isClassifying",new O.Multicast(function(e){return G.Observable.from(a.state).select(function(e){return e.isClassifying}).subscribe(e)})),(0,i._)(this,"result",new O.Multicast(function(e){return G.Observable.from(a.state).select(function(e){return e.result}).subscribe(e)})),(0,i._)(this,"hasEverFailed",new O.Multicast(function(e){return G.Observable.from(a.state).select(function(e){return e.hasEverFailed}).subscribe(e)})),(0,i._)(this,"disable",function(){a.isDisabled=!0,null!==a.debounceTimer&&(clearTimeout(a.debounceTimer),a.debounceTimer=null),null!==a.initialClassificationTimer&&(clearTimeout(a.initialClassificationTimer),a.initialClassificationTimer=null)}),(0,i._)(this,"enable",function(){a.isDisabled=!1}),(0,i._)(this,"awaitClassification",function(){return a.isDisabled?Promise.resolve():null!==a.debounceTimer?(clearTimeout(a.debounceTimer),a.debounceTimer=null,null!==a.initialClassificationTimer&&(clearTimeout(a.initialClassificationTimer),a.initialClassificationTimer=null),a.latestPrompt.trim().length>=a.minPromptLength||a.latestAttachments.length>0)?(a.currentVersion++,a.run(a.currentVersion,a.latestPrompt,a.latestAttachments,{isInitial:!1})):Promise.resolve():a.latestRunPromise}),this.classifyFn=s,this.uploadFile=o,this.fileUploader=new K({uploadFile:o}),this.minPromptLength=void 0===l?5:l,this.characterThreshold=void 0===c?2:c,this.periodicCharacterThreshold=void 0===u?7:u,this.initialCharacterThreshold=void 0===d?8:d,this.debounce={prompt:null!=(n=h.prompt)?n:300,attachments:null!=(r=h.attachments)?r:100},this.maxTypingInterval=void 0===m?3e3:m,this.state=new E.ObservableState({result:null,isClassifying:!1,hasEverFailed:!1}),this.rateLimitTokens=30,this.rateLimitLastRefill=Date.now()}return(0,k._)(e,[{key:"refillTokens",value:function(){var e=Date.now(),t=(e-this.rateLimitLastRefill)/1e3;this.rateLimitTokens=Math.min(30,this.rateLimitTokens+ +t),this.rateLimitLastRefill=e}},{key:"tryConsumeToken",value:function(){return this.refillTokens(),this.rateLimitTokens>=1&&(this.rateLimitTokens-=1,!0)}},{key:"classify",value:function(e){var t=this,i=e.prompt,n=e.attachments,r=e.debounceType;if(!this.isInitialClassificationInProgress&&!this.isPeriodicClassificationInProgress&&this.currentVersion++,null!==this.debounceTimer&&clearTimeout(this.debounceTimer),!this.isDisabled){this.latestPrompt=i,this.latestAttachments=n;var a=this.debounce[r],s=i.trim(),o=s.length>=this.minPromptLength||n.length>0;!this.hasInitialClassificationFired&&!this.isInitialClassificationInProgress&&o&&s.length>=this.initialCharacterThreshold&&(null!==this.initialClassificationTimer&&(clearTimeout(this.initialClassificationTimer),this.initialClassificationTimer=null),this.hasInitialClassificationFired=!0,this.runInitialClassification()),this.hasAnyClassificationCompleted&&!this.isPeriodicClassificationInProgress&&Math.abs(s.length-this.lastPeriodicClassifiedPrompt.length)>=this.periodicCharacterThreshold&&o&&this.runPeriodicClassification(),this.debounceTimer=setTimeout(function(){t.debounceTimer=null,t.currentVersion++,t.run(t.currentVersion,i,n,{isInitial:!1})},a),null!==this.initialClassificationTimer||this.hasInitialClassificationFired||(this.initialClassificationTimer=setTimeout(function(){t.initialClassificationTimer=null,t.hasInitialClassificationFired=!0,null!==t.debounceTimer&&t.runInitialClassification()},this.maxTypingInterval))}}},{key:"runInitialClassification",value:function(){return(0,t._)(function(){var e;return(0,n._)(this,function(t){switch(t.label){case 0:this.isInitialClassificationInProgress=!0,e=this.currentVersion,t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.run(e,this.latestPrompt,this.latestAttachments,{isInitial:!0})];case 2:return t.sent(),[3,4];case 3:return this.isInitialClassificationInProgress=!1,[7];case 4:return[2]}})}).call(this)}},{key:"runPeriodicClassification",value:function(){return(0,t._)(function(){var e;return(0,n._)(this,function(t){switch(t.label){case 0:this.lastPeriodicClassifiedPrompt=this.latestPrompt.trim(),this.isPeriodicClassificationInProgress=!0,e=this.currentVersion,t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.run(e,this.latestPrompt,this.latestAttachments,{isInitial:!0})];case 2:return t.sent(),[3,4];case 3:return this.isPeriodicClassificationInProgress=!1,[7];case 4:return[2]}})}).call(this)}},{key:"run",value:function(e,i,r,a){var s=a.isInitial;return this.latestRunPromise=(0,t._)(function(){var t,a,o,l,c,u,d,m,p,g,v;return(0,n._)(this,function(n){switch(n.label){case 0:var y,_,T;if(this.currentVersion!==e||(t=i.trim(),0===r.length&&!this.lastClassificationHadAttachments&&(y=this.lastClassifiedPrompt,_=t,T=this.characterThreshold,!(!y||Math.abs(_.length-y.length)>=T))||t.length<this.minPromptLength&&0===r.length||!this.tryConsumeToken()))return[2];return[4,this.fileUploader.getFileUrls(r)];case 1:if(a=n.sent(),this.currentVersion!==e)return this.classifyingVersion===e&&(this.classifyingVersion=null,this.state.update(function(e){return(0,h._)((0,f._)({},e),{isClassifying:!1})})),[2];o=[],l=!0,c=!1,u=void 0;try{for(d=r[Symbol.iterator]();!(l=(m=d.next()).done);l=!0)p=m.value,(g=a.get(p.path))&&o.push({path:g,mimeType:p.mimeType})}catch(e){c=!0,u=e}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}s||(this.classifyingVersion=e,this.state.update(function(e){return(0,h._)((0,f._)({},e),{isClassifying:!0})})),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,this.classifyFn(i,o)];case 3:return v=n.sent(),[3,5];case 4:return n.sent(),s||(this.classifyingVersion=null,this.state.update(function(e){return(0,h._)((0,f._)({},e),{isClassifying:!1})})),[2];case 5:if(this.currentVersion!==e)return this.classifyingVersion===e&&(this.classifyingVersion=null,this.state.update(function(e){return(0,h._)((0,f._)({},e),{isClassifying:!1})})),[2];if(!v.ok)return s||(this.classifyingVersion=null,this.state.update(function(e){return(0,h._)((0,f._)({},e),{isClassifying:!1,hasEverFailed:!0})})),[2];return s||(this.lastClassifiedPrompt=t,this.lastClassificationHadAttachments=r.length>0),this.hasAnyClassificationCompleted||(this.hasAnyClassificationCompleted=!0,this.lastPeriodicClassifiedPrompt=t),s||(this.classifyingVersion=null),this.state.update(function(e){return(0,h._)((0,f._)({},e),{result:v,isClassifying:!!s&&e.isClassifying})}),[2]}})}).call(this),this.latestRunPromise}},{key:"reset",value:function(){this.currentVersion++,null!==this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),null!==this.initialClassificationTimer&&(clearTimeout(this.initialClassificationTimer),this.initialClassificationTimer=null),this.isDisabled=!1,this.isInitialClassificationInProgress=!1,this.isPeriodicClassificationInProgress=!1,this.hasInitialClassificationFired=!1,this.hasAnyClassificationCompleted=!1,this.lastPeriodicClassifiedPrompt="",this.classifyingVersion=null,this.lastClassifiedPrompt="",this.lastClassificationHadAttachments=!1,this.latestPrompt="",this.latestAttachments=[],this.rateLimitTokens=30,this.rateLimitLastRefill=Date.now(),this.latestRunPromise=Promise.resolve(),this.state.update(function(e){return(0,h._)((0,f._)({},e),{result:null,isClassifying:!1,hasEverFailed:!1})}),this.fileUploader.destroy(),this.fileUploader=new K({uploadFile:this.uploadFile})}},{key:"destroy",value:function(){null!==this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),null!==this.initialClassificationTimer&&(clearTimeout(this.initialClassificationTimer),this.initialClassificationTimer=null),this.fileUploader.destroy()}}]),e}();e.s(["Classifier",()=>z],342469);var H=(0,a.createContext)({});function W(e){var t,i,n,s,o,l,c,u,d,p,g,v,y,_,T,b=e.children,w=e.classifier,I=e.initialSettings,A=e.userType,k=e.promptApiRef,C=(n=(t={classifier:w,initialSettings:void 0===I?{stackKey:"Modern web app"}:I,userType:A,forceDesignMode:e.forceDesignMode}).classifier,s=t.initialSettings,o=t.userType,l=t.forceDesignMode,u=(c=(0,m._)((0,U.default)(B,null),3))[0],d=c[1],p=c[2],g=(0,a.useRef)((0,h._)((0,f._)({},s),{stackKey:l?M:null!=(i=null==s?void 0:s.stackKey)?i:D})),v=(0,a.useRef)(o),y=(0,a.useRef)(l),_=(0,a.useMemo)(function(){return new F({classifier:n,initialSettings:g.current,userType:v.current})},[n]),T=(0,a.useRef)(!1),(0,a.useEffect)(function(){if(!y.current&&!T.current)switch(u){case"Design":_.settings.current.stackKey!==M&&_.updateSettings(function(){return{stackKey:M}}),T.current=!0;break;case"Build":_.settings.current.stackKey===M&&_.updateSettings(function(){return{stackKey:D}}),T.current=!0}},[u,_]),(0,x.useObserver)((0,a.useMemo)(function(){return _.settings.select(function(e){return e.stackKey})},[_]),{next:function(e){p&&d("Design"===e?e:"Build")}}),_);return(0,a.useImperativeHandle)(k,function(){return C},[C]),(0,r.jsx)(H.Provider,{value:C,children:b})}var q=function(){var e=(0,a.useContext)(H);if(!e)throw Error("useAgentEntryPointProvider must be used within AgentEntryPointProvider");return e};e.s(["AgentInputProvider",()=>W,"useAgentInputContext",()=>q],908320);var Z=new _.ReactCompartment(function(e){return y.EditorView.updateListener.of(function(t){t.docChanged&&e(t.view.state.doc.toString())})});function J(e){var t,i,n=q();return(0,x.useObserver)(e,{next:n.setAttachments}),{cmExtension:Z.use(n.setPrompt),isClassifying:null==(t=n.classifier)?void 0:t.isClassifying,disable:null==(i=n.classifier)?void 0:i.disable}}function $(e){var t=q();(0,a.useEffect)(function(){t.setDetectedUrls(e)},[e,t])}function Y(e,t){var i={},n=!0,r=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var l=s.value;i[l]=e[l]}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return i}function Q(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=q(),r=t.join(",");return(0,T.useObservableMemo)(function(){return n.settings.select(function(e){return Y(e,t)},p.default)},[n,r],{default:Y(n.settings.current,t)})}function X(){var e=q();return(0,a.useCallback)(function(){var t=e.settings.current.stackKey;return{settings:e.getValidatedSettings(),usedAutoStackFallback:"Auto"===t}},[e])}function ee(){var e=q(),i=(0,m._)((0,a.useState)(!1),2),r=i[0],s=i[1];return{awaitClassification:(0,a.useCallback)(function(){return(0,t._)(function(){return(0,n._)(this,function(t){switch(t.label){case 0:s(!0),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,e.awaitClassification()];case 2:return t.sent(),[3,4];case 3:return s(!1),[7];case 4:return[2]}})})()},[e]),isAwaitingClassification:r}}function et(){return q().updateSettings}function ei(e){return P(e.stackKey)?"Design":"Auto"}function en(){var e=q().settings;return(0,T.useObservableMemo)(function(){return e.select(ei)},[e],{default:ei(e.current)})}function er(e){return e.stackKey&&"Auto"!==e.stackKey&&b.STACKS_THAT_SUPPORT_APP_THEMES.has(e.stackKey)&&e.stackKey?{supported:!0,stackKey:e.stackKey,themeId:e.themeId}:{supported:!1}}function ea(e){return 0===e.prompt.trim().length&&0===e.attachments.length}function es(){var e=q().data;return(0,T.useObservableMemo)(function(){return e.select(ea)},[e],{default:ea(e.current)})}function eo(){var e=q().settings;return(0,T.useObservableMemo)(function(){return e.select(er,p.default)},[e],{default:er(e.current)})}function el(){var e=q();return(0,T.useObservableMemo)(function(){return e.data.select(function(t){var i=t.prompt.trim();return("paid"===e.userType||"org"===e.userType)&&i.length>=5})},[e.data,e.userType],{default:!1})}function ec(){var e,t=q(),i=en(),n=Q("agentMode","buildTier","stackKey"),r=n.agentMode,s=n.buildTier,o=n.stackKey,l=(0,I.useAgentInputFigmaContext)().hasFigmaLinks,c=s===g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,u=(0,a.useCallback)(function(e){if(e===g.AgentMode.AGENT_MODE_INITIAL_PLANNING)t.updateSettings(function(t){var i,n,r;return(0,f._)({agentMode:e,stackKey:"Auto",prevChatModeSettings:{stackKey:t.stackKey&&"Auto"!==t.stackKey?t.stackKey:null==(i=t.prevChatModeSettings)?void 0:i.stackKey,buildTier:null!=(r=t.buildTier)?r:null==(n=t.prevChatModeSettings)?void 0:n.buildTier}},c&&{buildTier:g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO})});else{t.updateSettings(function(t){var i,n,r;return(0,h._)((0,f._)({agentMode:e,stackKey:null!=(r=null==(i=t.prevChatModeSettings)?void 0:i.stackKey)?r:"Modern web app"},(null==(n=t.prevChatModeSettings)?void 0:n.buildTier)&&{buildTier:t.prevChatModeSettings.buildTier}),{prevChatModeSettings:void 0})}),t.clearUserConfiguredBuildTier(),null==(i=t.classifier)||i.enable();var i,n,r=t.data.current,a=r.prompt,s=r.attachments;(a.trim()||s.length>0)&&(null==(n=t.classifier)||n.classify({prompt:a,attachments:s,debounceType:"prompt"}))}},[t,c]),d=!1,m=r;return l?(d=!0,e="Figma imports are built directly without planning",m=g.AgentMode.AGENT_MODE_GENERAL):"Automation"===o&&(d=!0,e="Agent stack requires planning mode",m=g.AgentMode.AGENT_MODE_INITIAL_PLANNING),{show:"Auto"===i,requiresPaid:"free"===t.userType||"anon"===t.userType,agentMode:m,updateMode:u,disabled:d,disabledTooltipText:e}}function eu(){var e=q(),t=en(),i=Q("stackKey").stackKey,n=(0,I.useAgentInputFigmaContext)().hasFigmaLinks,r=(0,a.useCallback)(function(t){e.updateSettings(function(){return{stackKey:t,paidStackFallbackMessage:null}})},[e]),s=(0,a.useCallback)(function(t){e.updateSettings(function(){return{stackKey:"OrgStackTemplate",customStackReplId:t}})},[e]);return{show:"Auto"===t&&"anon"!==e.userType,stackKey:i,updateStack:r,setOrgTemplateStack:s,requiresPaid:"free"===e.userType||"anon"===e.userType,hasFigmaLinks:n}}function ed(){var e,t=q(),i=Q("stackKey").stackKey,n=(0,b.useFreeStacks)(),r=!!(i&&"Auto"!==i&&!n.has(i)),a="free"===t.userType||"anon"===t.userType;return{isPremiumStackSelected:r,isBlockedByPlan:r&&a,selectedStackLabel:i?null==(e=b.STACK_PILL_OPTIONS_MAP.get(i))?void 0:e.label:void 0}}function ef(){var e=q(),t=Q("buildTier").buildTier,i=(0,a.useCallback)(function(t){e.updateSettings(function(){return{buildTier:t}})},[e]),n="paid"===e.userType||"org"===e.userType?g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO:g.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE;return{buildTier:null!=t?t:n,updateBuildTier:i}}function eh(){var e=q();return{selectedTab:en(),updateTab:(0,a.useCallback)(function(t){e.updateSettings(function(){return{stackKey:t}})},[e])}}function em(){return q().userType}function ep(e){var t=e.stackKey,i=e.isMobile,n=e.userType,r=P(t);if("anon"===n)return r?v.PLACEHOLDER_TEXT_ANON_DESIGN:v.PLACEHOLDER_TEXT_ANON_APP;var a=i?"Describe the idea you want to build…":"Describe your idea, '/' for integrations…";return"org"===n&&(a="Describe your idea…"),r&&(a="Describe the idea you want to design…"),a}function eg(){var e=(0,w.useIsMobile)(),t=q(),i=t.settings,n=t.userType;return(0,T.useObservableMemo)(function(){return i.select(function(t){return ep({stackKey:t.stackKey,isMobile:e,userType:n})})},[i,e,n],{default:ep({stackKey:i.current.stackKey,isMobile:e,userType:n})})}e.s(["useAgentModeState",()=>ec,"useAppTheme",()=>eo,"useAwaitClassification",()=>ee,"useClassifyPrompt",()=>J,"useEnhancePromptButtonVisibility",()=>el,"useFastBuildType",()=>ef,"useGetValidatedSettings",()=>X,"useIsEmpty",()=>es,"usePlaceholderText",()=>eg,"usePremiumStackState",()=>ed,"usePromptSettings",()=>Q,"useSelectedTab",()=>en,"useStackSelectState",()=>eu,"useSyncDetectedUrls",()=>$,"useTabs",()=>eh,"useUpdatePromptSettings",()=>et,"useUserType",()=>em],706510);var ev=e.i(441329);function ey(e){var t=e.uploadFiles,i=e.fileUploadInputRef,n=e.dirUploadInputRef;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{style:{display:"none"},ref:i,type:"file",onChange:function(e){var i=e.target.files;i&&t({files:Array.from(i)})},onClick:function(e){e.currentTarget.value=""},multiple:!0,accept:"*"}),(0,r.jsx)("input",{style:{display:"none"},ref:n,type:"file",onChange:function(e){var i=e.target.files;i&&t({files:Array.from(i)})},onClick:function(e){e.currentTarget.value=""},webkitdirectory:"true",mozdirectory:"true",msdirectory:"true",odirectory:"true",directory:"true",accept:"*"})]})}e.s(["UploadInputs",()=>ey],934226);var e_=e.i(197649),eT=e.i(480028),ex=e.i(585225),eb=e.i(136540),ew=e.i(119274),eI=e.i(625484),eA=e.i(959559);function ek(e){var f=e.source,h=e.disabled,m=e.disabledReason,p=e.status,g=e.addAttachments,v=e.onInteract,y=e.onFigmaImportClick,_=e.size,T=em(),x=(0,ex.useIsShadesSupported)(),b=(0,ev.useIsInBonsaiWebview)(),w="workspace"===f,I=w?d.events.AGENT_USED:d.events.START_WITH_AI_USED,A=(0,a.useRef)(null),k=(0,a.useRef)(null),C=function(){(0,j.track)(I,{action:"attachment_import_from_figma_clicked"}),null==y||y()};return(0,r.jsxs)(eI.View,{children:[(0,r.jsxs)(ew.PopupMenu,{trigger:(0,r.jsx)(eb.IconButton,{alt:"Attach file",size:void 0===_?24:_,disabled:h||"loading"===p,tooltipContents:m||"Add attachment",tooltipPlacement:"top-start",clsx:(0,e_.default)(eA.default.button,(0,i._)({},eA.default.colorForegroundDimmer,!x)),onClick:function(){(0,j.track)(I,{action:"attachment_button_clicked"})},children:(0,r.jsx)(c.default,{})}),isDisabled:h||"loading"===p,placement:"top start",children:[(0,r.jsx)(ew.MenuHeader,{text:"Add attachments"}),(0,r.jsx)(ew.MenuItem,{label:"Upload a file",icon:(0,r.jsx)(l.default,{}),onAction:function(){var e;(0,j.track)(I,{action:"attachment_upload_file_clicked"}),null==v||v(),null==(e=A.current)||e.click()}}),"anon"===T?null:(0,r.jsx)(r.Fragment,{children:w?(0,r.jsx)(function(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ew.Separator,{}),(0,r.jsx)(ew.MenuItem,{label:"Attach a Figma design",icon:(0,r.jsx)(o.default,{}),onAction:C})]})},{}):(0,r.jsx)(function(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ew.Separator,{}),(0,r.jsx)(ew.MenuHeader,{text:"Add a starting point"}),(0,r.jsx)(ew.MenuItem,{label:"Import a Figma design",icon:(0,r.jsx)(o.default,{}),onAction:C}),!b&&(0,r.jsx)(ew.MenuItem,{label:"Import an existing project",icon:(0,r.jsx)(u.default,{}),iconRight:(0,r.jsx)(s.default,{color:eT.tokens.foregroundDimmest}),href:"/import",target:"_blank",onAction:function(){(0,j.track)(I,{action:"attachment_import_from_existing_project_clicked"})}})]})},{})})]}),(0,r.jsx)(ey,{fileUploadInputRef:A,dirUploadInputRef:k,uploadFiles:function(e){return(0,t._)(function(){return(0,n._)(this,function(t){switch(t.label){case 0:return[4,g(e.files.map(function(e){return{fileName:e.name,file:e}}))];case 1:return t.sent(),[2]}})})()}})]})}e.s(["AttachmentButton",()=>ek],956515)},655335,e=>{e.v({colorLabel:"BrandingViewer-module__vxxTbW__colorLabel",colorSwatch:"BrandingViewer-module__vxxTbW__colorSwatch",colorsFontsTypographyGrid:"BrandingViewer-module__vxxTbW__colorsFontsTypographyGrid",image:"BrandingViewer-module__vxxTbW__image",imageBg:"BrandingViewer-module__vxxTbW__imageBg",imageCard:"BrandingViewer-module__vxxTbW__imageCard",jsonFallback:"BrandingViewer-module__vxxTbW__jsonFallback",modalScrollContainer:"BrandingViewer-module__vxxTbW__modalScrollContainer",monoText:"BrandingViewer-module__vxxTbW__monoText",monoTextBrandColor:"BrandingViewer-module__vxxTbW__monoTextBrandColor",ogImage:"BrandingViewer-module__vxxTbW__ogImage",typographyLabel:"BrandingViewer-module__vxxTbW__typographyLabel"})},628576,624714,709696,777110,e=>{"use strict";var t=e.i(297083),i=e.i(530658),n=e.i(346715),r=e.i(119468),a=e.i(817556),s=e.i(276385),o=e.i(389959),l=e.i(736266),c=e.i(539865);e.i(877212);var u=e.i(924908),d=e.i(629536),f=e.i(828043),h=e.i(183035),m=e.i(402099),p=e.i(878420),g=e.i(64386),v=e.i(116235);function y(e){return(0,s.jsx)(v.default,(0,g._)((0,p._)({},e),{children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M15.838.027A4.491 4.491 0 0 1 18.32 8.26a4.49 4.49 0 0 1-2.483 8.231h-.097a4.473 4.473 0 0 1-2.991-1.141v4.085c0 2.513-2.064 4.539-4.564 4.539-2.474 0-4.515-2.005-4.515-4.49 0-1.562.797-2.938 2.007-3.743a4.487 4.487 0 0 1 0-7.481A4.492 4.492 0 0 1 8.162.028h7.676ZM8.162 16.491a2.992 2.992 0 0 0-2.991 2.991c0 1.646 1.357 2.99 3.015 2.99 1.684 0 3.064-1.366 3.064-3.038V16.49H8.162Zm0-7.482a2.991 2.991 0 1 0 0 5.981h3.088V9.01H8.162Zm7.58 0a2.992 2.992 0 0 0 0 5.981h.096a2.99 2.99 0 1 0 0-5.981h-.097Zm-7.58-7.482a2.992 2.992 0 0 0 0 5.982h3.088V1.527H8.162ZM12.75 7.51h3.088a2.99 2.99 0 1 0 0-5.982H12.75V7.51Z",clipRule:"evenodd"})}))}var _=e.i(399245),T=e.i(493166),x=e.i(416746),b=e.i(393428),w=e.i(820228),I=e.i(90319),A=e.i(631936),k=e.i(993796),C=e.i(187505),S=e.i(664152),E=e.i(652172),j=e.i(759317),N=e.i(308521),L=e.i(200260),D=e.i(173703),M=e.i(624782),P=e.i(960178),F=e.i(625484),R=e.i(579886),B=e.i(655335);function V(e){var t,n,r,a,o,l,c=e.data;return(0,s.jsxs)(F.View,{gap:20,p:8,children:[c.colorScheme?(0,s.jsx)(U,{title:"Theme",children:(0,s.jsx)(F.View,{align:"start",children:(0,s.jsx)(M.Pill,{colorway:"grey",iconLeft:"dark"===c.colorScheme?(0,s.jsx)(j.default,{}):(0,s.jsx)(N.default,{}),text:c.colorScheme,style:{textTransform:"capitalize"}})})}):null,(null==(t=c.images)?void 0:t.logo)||(null==(n=c.images)?void 0:n.ogImage)?(0,s.jsx)(U,{title:"Images",children:(0,s.jsxs)(F.View,{row:!0,gap:12,wrap:!0,children:[c.images.logo?(0,s.jsx)(D.ShadesSurface,{className:B.default.imageCard,children:(0,s.jsxs)(F.View,{align:"center",p:16,gap:12,children:[(0,s.jsx)(P.Text,{variant:"small",color:"dimmer",children:"Logo"}),(0,s.jsx)(F.View,{className:B.default.imageBg,p:8,children:(0,s.jsx)(E.default,{src:c.images.logo,alt:"Logo",width:100,height:60,className:B.default.image,unoptimized:!0})})]})}):null,c.images.ogImage?(0,s.jsx)(D.ShadesSurface,{className:B.default.imageCard,children:(0,s.jsxs)(F.View,{align:"center",p:16,gap:12,children:[(0,s.jsx)(P.Text,{variant:"small",color:"dimmer",children:"OG Image"}),(0,s.jsx)(E.default,{src:c.images.ogImage,alt:"OG",width:160,height:80,className:B.default.ogImage,unoptimized:!0})]})}):null]})}):null,(0,s.jsxs)(F.View,{gap:32,className:B.default.colorsFontsTypographyGrid,children:[c.colors&&Object.keys(c.colors).length>0?(0,s.jsx)(U,{title:"Colors",children:(0,s.jsx)(F.View,{gap:6,children:Object.entries(c.colors).filter(function(e){var t=(0,i._)(e,2);return t[0],t[1]}).map(function(e){var t=(0,i._)(e,2),n=t[0],r=t[1];return(0,s.jsxs)(F.View,{row:!0,gap:8,align:"center",children:[(0,s.jsxs)(P.Text,{variant:"small",color:"dimmer",className:B.default.colorLabel,children:[n.charAt(0).toUpperCase()+n.slice(1).replace(/([A-Z])/g," $1"),":"]}),(0,s.jsx)(P.Text,{variant:"small",className:B.default.monoText,children:r}),(0,s.jsx)(F.View,{className:B.default.colorSwatch,style:{backgroundColor:r}})]},n)})})}):null,c.fonts&&c.fonts.length>0||(null==(r=c.typography)?void 0:r.fontFamilies)?(0,s.jsx)(U,{title:"Fonts",children:(0,s.jsxs)(F.View,{gap:4,children:[null==(a=c.fonts)?void 0:a.map(function(e,t){return(0,s.jsxs)(F.View,{row:!0,gap:6,align:"center",children:[(0,s.jsx)(P.Text,{variant:"small",children:e.family}),e.role&&"string"==typeof e.role?(0,s.jsxs)(P.Text,{variant:"small",color:"dimmer",children:["(",e.role,")"]}):null]},t)}),!c.fonts&&(null==(o=c.typography)?void 0:o.fontFamilies)?Object.entries(c.typography.fontFamilies).map(function(e){var t=(0,i._)(e,2),n=t[0],r=t[1];return(0,s.jsxs)(F.View,{row:!0,gap:6,align:"center",children:[(0,s.jsx)(P.Text,{variant:"small",children:r}),(0,s.jsxs)(P.Text,{variant:"small",color:"dimmer",children:["(",n,")"]})]},n)}):null]})}):null,(null==(l=c.typography)?void 0:l.fontSizes)?(0,s.jsx)(U,{title:"Typography",children:(0,s.jsx)(F.View,{gap:4,children:Object.entries(c.typography.fontSizes).map(function(e){var t=(0,i._)(e,2),n=t[0],r=t[1];return(0,s.jsxs)(F.View,{row:!0,gap:6,align:"center",children:[(0,s.jsxs)(P.Text,{variant:"small",color:"dimmer",className:B.default.typographyLabel,children:[n,":"]}),(0,s.jsx)(P.Text,{variant:"small",clsx:[B.default.monoText,B.default.monoTextBrandColor],children:r})]},n)})})}):null]}),c.spacing?(0,s.jsx)(U,{title:"Spacing",children:(0,s.jsxs)(F.View,{row:!0,gap:16,children:[c.spacing.baseUnit?(0,s.jsxs)(F.View,{row:!0,gap:6,align:"center",children:[(0,s.jsx)(P.Text,{variant:"small",color:"dimmer",children:"Base unit:"}),(0,s.jsx)(P.Text,{variant:"small",clsx:[B.default.monoText,B.default.monoTextBrandColor],children:c.spacing.baseUnit})]}):null,c.spacing.borderRadius?(0,s.jsxs)(F.View,{row:!0,gap:6,align:"center",children:[(0,s.jsx)(P.Text,{variant:"small",color:"dimmer",children:"Border radius:"}),(0,s.jsx)(P.Text,{variant:"small",clsx:[B.default.monoText,B.default.monoTextBrandColor],children:c.spacing.borderRadius})]}):null]})}):null,c.personality?(0,s.jsx)(U,{title:"Personality",children:(0,s.jsxs)(F.View,{gap:4,children:[c.personality.tone?(0,s.jsxs)(F.View,{row:!0,gap:6,children:[(0,s.jsx)(P.Text,{variant:"small",color:"dimmer",children:"Tone:"}),(0,s.jsx)(P.Text,{variant:"small",children:c.personality.tone})]}):null,c.personality.energy?(0,s.jsxs)(F.View,{row:!0,gap:6,children:[(0,s.jsx)(P.Text,{variant:"small",color:"dimmer",children:"Energy:"}),(0,s.jsx)(P.Text,{variant:"small",children:c.personality.energy})]}):null,c.personality.targetAudience?(0,s.jsxs)(F.View,{row:!0,gap:6,children:[(0,s.jsx)(P.Text,{variant:"small",color:"dimmer",children:"Audience:"}),(0,s.jsx)(P.Text,{variant:"small",children:c.personality.targetAudience})]}):null]})}):null]})}function U(e){var t=e.title,i=e.children;return(0,s.jsxs)(F.View,{gap:8,children:[(0,s.jsx)(P.Text,{variant:"subheadDefault",children:t}),i]})}function O(e){var t,i=e.brandingData,n=e.url,r=(0,o.useMemo)(function(){try{return new URL(n.startsWith("http")?n:"https://".concat(n)).hostname}catch(e){return n}},[n]);if(!i)return(0,s.jsx)(F.View,{gap:8,p:16,children:(0,s.jsx)(P.Text,{color:"dimmer",children:"No branding data available"})});if("string"==typeof i)try{t=JSON.parse(i)}catch(e){return(0,s.jsx)(F.View,{gap:8,p:16,children:(0,s.jsx)(P.Text,{color:"dimmer",children:"Failed to parse branding data"})})}else t=i;return(0,s.jsxs)(F.View,{children:[(0,s.jsx)(L.FileAttachmentModalHeader,{viewerIcon:(0,s.jsx)(b.default,{size:16}),viewerTitle:"Brand identity",fileName:r}),(0,s.jsx)(F.View,{className:B.default.modalScrollContainer,p:8,children:(0,s.jsx)(R.default,{sentryTag:"branding-viewer-crashed",fallback:function(){return(0,s.jsxs)(F.View,{gap:12,p:16,children:[(0,s.jsx)(P.Text,{color:"dimmer",children:"Branding data"}),(0,s.jsx)(F.View,{p:12,className:B.default.jsonFallback,children:(0,s.jsx)(P.Text,{children:JSON.stringify(i,null,2)})})]})},children:(0,s.jsx)(V,{data:t})})})]})}var G=e.i(64256),K=e.i(445059),z=e.i(480028),H=e.i(446530),W=e.i(6338),q=e.i(613355),Z=e.i(140487),J=e.i(739521),$=e.i(751273),Y=[q.rcss.border({color:z.tokens.outlineDimmer}),q.rcss.borderRadius("container"),q.rcss.overflow("hidden"),{cursor:"default",userSelect:"none"}],Q=(0,H.cssRecord)({container:Y,containerDisabled:(0,n._)(Y).concat([{cursor:"default",userSelect:"none",pointerEvents:"none",opacity:.5}]),header:[q.rcss.width("100%"),{height:24}],faviconContainer:[{width:16,height:16,borderRadius:4,backgroundColor:z.tokens.interactiveBackground}],favicon:[{width:12,height:12}],urlText:[q.rcss.truncate,q.rcss.maxWidth(2*L.SMALL_FILE_ATTACHMENT_WIDTH-20),{fontSize:z.tokens.fontSizeSmall}],option:[q.rcss.reset.button,q.rcss.align.center,q.rcss.justify.center,q.rcss.colWithGap(4),q.rcss.p(4),q.rcss.borderRadius("container"),q.rcss.border({color:z.tokens.outlineDefault}),q.rcss.width(L.SMALL_FILE_ATTACHMENT_WIDTH),q.rcss.height(L.SMALL_ATTACHMENT_HEIGHT),q.rcss.cursor.pointer,{transition:"background-color 0.2s ease, color 0.2s ease",":not(:disabled):hover":{backgroundColor:z.tokens.interactiveBackgroundActive},":not(:disabled):hover .option-text":{color:z.tokens.foregroundDefault},":not(:disabled):hover .option-icon":{color:z.tokens.foregroundDefault},":disabled":{cursor:"default"}}],loadingOption:[q.rcss.align.center,q.rcss.justify.center,q.rcss.p(8),q.rcss.borderRadius("container"),q.rcss.width(L.SMALL_FILE_ATTACHMENT_WIDTH),q.rcss.height(L.SMALL_ATTACHMENT_HEIGHT),W.loadingStyle.backgroundPulse(z.tokens.backgroundHighest,z.tokens.backgroundHigher)],icon:[{color:z.tokens.foregroundDimmer,transition:"color 0.2s ease"}],errorIcon:[{color:z.tokens.accentNegativeDefault,transition:"color 0.2s ease"}],successIcon:[{color:z.tokens.accentPositiveDefault,transition:"color 0.2s ease"}],optionText:[q.rcss.textAlign.center,{lineHeight:"1.3"}],brandingCard:[q.rcss.align.center,q.rcss.justify.center,q.rcss.colWithGap(4),q.rcss.p(8),q.rcss.borderRadius("container"),q.rcss.border({color:z.tokens.outlineDefault}),q.rcss.width(L.SMALL_FILE_ATTACHMENT_WIDTH),q.rcss.height(L.SMALL_ATTACHMENT_HEIGHT),q.rcss.cursor.pointer,{transition:"background-color 0.2s ease",":hover":{backgroundColor:z.tokens.interactiveBackgroundActive}}]});function X(e){var n=e.source,l=e.url,p=e.addUrlAttachment,g=e.removeUrlAttachment,v=e.onError,y=e.isDisabled,I=(0,k.useFlag)({controlName:"flag-brand-fetch-agent-input"}),A=l.replace(/^https?:\/\//,""),E=(0,u.useYapper)(),j=(0,C.useTrackClick)().trackClick,N=(0,i._)((0,o.useState)(!1),2),R=N[0],B=N[1],V=(0,i._)((0,o.useState)(!1),2),U=V[0],H=V[1],W=(0,i._)((0,o.useState)(!1),2),q=W[0],Y=W[1],X=(0,i._)((0,o.useState)(null),2),ee=X[0],ei=X[1],en=(0,i._)((0,o.useState)(null),2),er=en[0],ea=en[1],es=(0,i._)((0,o.useState)(null),2),eo=es[0],el=es[1],ec=(0,i._)((0,o.useState)(null),2),eu=ec[0],ed=ec[1],ef=(0,i._)((0,o.useState)(!1),2),eh=ef[0],em=ef[1],ep=(0,i._)((0,o.useState)(null),2),eg=ep[0],ev=ep[1],ey=(0,i._)((0,o.useState)(null),2),e_=ey[0],eT=ey[1],ex=(0,i._)((0,o.useState)(null),2),eb=ex[0],ew=ex[1],eI=(0,i._)((0,o.useState)(!1),2),eA=eI[0],ek=eI[1],eC=(0,o.useRef)(null),eS=(0,o.useMemo)(function(){try{var e=l.trim();return/^[a-zA-Z][a-zA-Z\d+\-.]*:\/\//.test(e)||(e="http://"+e),new URL(e).origin+"/"}catch(e){return null}},[l]),eE=(0,o.useMemo)(function(){return(0,f.isValidFigmaUrl)(l)[0]},[l]),ej=function(e){ev(e),v(e)},eN=function(e){eT(e),v(e)},eL=function(e){ew(e),v(e)};return(0,o.useEffect)(function(){if(eC.current){var e=eC.current,t=e.offsetWidth;ek(e.scrollWidth>t)}},[A]),(0,o.useEffect)(function(){eo?(0,t._)(function(){return(0,a._)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,eo.file.text()];case 1:return ed(JSON.parse(e.sent())),[3,3];case 2:return e.sent(),ed(null),[3,3];case 3:return[2]}})})():ed(null)},[eo]),(0,s.jsxs)(D.ShadesSurface,{css:y?Q.containerDisabled:Q.container,children:[(0,s.jsxs)(D.ShadesSurface,{elevate:"2x",row:!0,gap:8,align:"center",css:Q.header,px:8,py:0,children:[eS?(0,s.jsx)(F.View,{css:Q.faviconContainer,align:"center",justify:"center",children:(0,s.jsx)("img",{css:Q.favicon,src:"https://www.google.com/s2/favicons?domain=".concat(eS,"&sz=32"),alt:A})}):(0,s.jsx)(_.default,{color:z.tokens.foregroundDimmest,size:16}),eE?(0,s.jsx)(F.View,{children:(0,s.jsxs)(F.View,{gap:4,row:!0,align:"center",children:[(0,s.jsx)(P.Text,{multiline:!1,ref:eC,children:"Figma design"}),eE&&"workspace"===n?(0,s.jsx)(M.Pill,{text:"Beta",colorway:"primary",compact:!0}):null]})}):(0,s.jsx)($.Tooltip,{tooltip:l,isDisabled:!eA,placement:"top",children:(0,s.jsx)(P.Text,{multiline:!1,css:Q.urlText,ref:eC,children:A})})]}),(0,s.jsxs)(F.View,{row:!0,gap:8,px:8,py:6,justify:"space-between",children:[eE?null:(0,s.jsxs)(s.Fragment,{children:[ee?(0,s.jsx)(L.FileAttachment,{attachment:ee,getAttachmentTypeDisclaimer:(0,G.getAttachmentTypeDisclaimer)({aiName:(0,d.getAgentName)({capitalizeFirstChar:!0})}),removeAttachment:function(){g(ee.path),ei(null)},size:"small"},ee.path):R?(0,s.jsx)(F.View,{css:Q.loadingOption,children:(0,s.jsxs)(P.Text,{color:"dimmer",variant:"small",css:Q.optionText,children:["Taking ",(0,s.jsx)("br",{})," screenshot..."]})}):(0,s.jsx)($.Tooltip,{tooltip:eg,isDisabled:!eg,placement:"top",children:(0,s.jsxs)(Z.BaseButton,{css:Q.option,onPress:function(){return(0,t._)(function(){var e,t,i,n,r,s;return(0,a._)(this,function(a){switch(a.label){case 0:j({productArea:"agent",target:"url_screenshot_button"}),B(!0),ev(null),e="screenshot-".concat(Date.now(),".png"),t=(0,K.getAttachedAssetsPath)(e),a.label=1;case 1:return a.trys.push([1,7,8,9]),p({url:l,file:{path:t,mimeType:"image/png",file:new File([],e,{type:"image/png"}),isLoading:!0}}),[4,E.getUrlScreenshot(l)];case 2:if(!(i=a.sent()).ok)return[3,5];return[4,fetch(i.payload)];case 3:if(!(n=a.sent()).ok)throw Error("Failed to fetch image: ".concat(n.status," ").concat(n.statusText));return[4,n.blob()];case 4:return r=new File([a.sent()],e,{type:"image/png"}),p({url:l,file:s={path:t,mimeType:"image/png",file:r,isLoading:!1}}),ei(s),[3,6];case 5:g(t),ej("Failed to take screenshot. Check the URL or try again later."),a.label=6;case 6:return[3,9];case 7:return a.sent(),g(t),ej("Error taking screenshot. Please try again later."),[3,9];case 8:return B(!1),[7];case 9:return[2]}})})()},isDisabled:y,children:[eg?(0,s.jsx)(w.default,{css:Q.errorIcon,className:"option-icon",size:16}):(0,s.jsx)(T.default,{css:Q.icon,className:"option-icon",size:16}),(0,s.jsx)(P.Text,{color:"dimmer",variant:"small",css:Q.optionText,className:"option-text",children:"Take screenshot"})]})}),er?(0,s.jsx)(L.FileAttachment,{attachment:er,getAttachmentTypeDisclaimer:(0,G.getAttachmentTypeDisclaimer)({aiName:(0,d.getAgentName)({capitalizeFirstChar:!0})}),removeAttachment:function(){g(er.path),ea(null)},size:"small"},er.path):U?(0,s.jsx)(F.View,{css:Q.loadingOption,children:(0,s.jsxs)(P.Text,{color:"dimmer",variant:"small",css:Q.optionText,children:["Getting ",(0,s.jsx)("br",{})," content..."]})}):(0,s.jsx)($.Tooltip,{tooltip:e_,isDisabled:!e_,placement:"top",children:(0,s.jsxs)(Z.BaseButton,{css:Q.option,onPress:function(){return(0,t._)(function(){var e,t,i,n,r;return(0,a._)(this,function(a){switch(a.label){case 0:j({productArea:"agent",target:"url_content_button"}),H(!0),eT(null),e="content-".concat(Date.now(),".md"),t=(0,K.getAttachedAssetsPath)(e),a.label=1;case 1:return a.trys.push([1,3,4,5]),p({url:l,file:{path:t,mimeType:"text/markdown",file:new File([],e,{type:"text/markdown"}),isLoading:!0}}),[4,E.getUrlScrapedContent(l)];case 2:return(i=a.sent()).ok?(n=new File([new Blob([i.payload],{type:"text/markdown"})],e,{type:"text/markdown"}),p({url:l,file:r={path:t,mimeType:"text/markdown",file:n,isLoading:!1}}),ea(r)):(g(t),eN("Failed to get content. Check the URL or try again later.")),[3,5];case 3:return a.sent(),g(t),eN("Error getting text content. Please try again later."),[3,5];case 4:return H(!1),[7];case 5:return[2]}})})()},isDisabled:y,children:[e_?(0,s.jsx)(w.default,{css:Q.errorIcon,className:"option-icon",size:16}):(0,s.jsx)(m.default,{css:Q.icon,className:"option-icon",size:16}),(0,s.jsx)(P.Text,{color:"dimmer",variant:"small",css:Q.optionText,className:"option-text",children:"Get text content"})]})}),I&&(eo?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Z.BaseButton,{css:Q.brandingCard,onPress:function(){return em(!0)},children:[(0,s.jsx)(h.default,{css:Q.successIcon,size:16}),(0,s.jsx)(P.Text,{color:"dimmer",variant:"small",css:Q.optionText,className:"option-text",children:"Brand identity"})]}),(0,s.jsx)(J.Modal,{isOpen:eh&&!!eu,onRequestClose:function(){return em(!1)},maxWidth:800,centered:!0,noPadding:!0,children:(0,s.jsx)(O,{brandingData:eu,url:l})})]}):q?(0,s.jsx)(F.View,{css:Q.loadingOption,children:(0,s.jsxs)(P.Text,{color:"dimmer",variant:"small",css:Q.optionText,children:["Extracting ",(0,s.jsx)("br",{})," branding..."]})}):(0,s.jsx)($.Tooltip,{tooltip:eb,isDisabled:!eb,placement:"top",children:(0,s.jsxs)(Z.BaseButton,{css:Q.option,onPress:function(){return(0,t._)(function(){var e,n,s,o,u,d,f,h,m,v,y,_,T,x,b,w,I,A,k,C,N,L,D,M;return(0,a._)(this,function(P){switch(P.label){case 0:j({productArea:"agent",target:"url_branding_button"}),Y(!0),ew(null),e="branding-".concat(Date.now(),".json"),n=(0,K.getAttachedAssetsPath)(e),P.label=1;case 1:return P.trys.push([1,13,14,15]),p({url:l,file:{path:n,mimeType:"application/json",file:new File([],e,{type:"application/json"}),isLoading:!0}}),[4,E.getUrlBranding(l)];case 2:if(!(s=P.sent()).ok)return g(n),eL("Failed to extract branding. Check the URL or try again later."),[2];if(!("images"in(u=JSON.parse(o=s.payload))&&"object"===(0,r._)(u.images)))return[3,12];d=u.images,f=!0,h=!1,m=void 0,P.label=3;case 3:P.trys.push([3,10,11,12]),v=Object.entries(d)[Symbol.iterator](),P.label=4;case 4:if(f=(y=v.next()).done)return[3,9];T=(_=(0,i._)(y.value,2))[0],x=_[1],P.label=5;case 5:var F;return P.trys.push([5,7,,8]),[4,(F=x,(0,t._)(function(){var e,t,i,n,r,s,o,l;return(0,a._)(this,function(a){switch(a.label){case 0:if(!F.startsWith("data:"))return[3,3];return t=(e=F.match(/^data:([^;]+);/))?e[1]:"application/octet-stream",[4,fetch(F)];case 1:return[4,a.sent().blob()];case 2:if(i=a.sent(),!(n=c.default.extension(t)))throw Error("Failed to get extension for mime type: ".concat(t));return[2,{mimeType:t,blob:i,extension:n}];case 3:return[4,fetch(F)];case 4:if(!(r=a.sent()).ok)throw Error("Failed to fetch image: ".concat(r.status," ").concat(r.statusText));return[4,r.blob()];case 5:if(s=a.sent(),o=r.headers.get("content-type")||s.type||"application/octet-stream",!(l=c.default.extension(o)))throw Error("Failed to get extension for mime type: ".concat(o));return[2,{mimeType:o,blob:s,extension:l}];case 6:return[2]}})})())];case 6:return w=(b=P.sent()).blob,I=b.extension,A=b.mimeType,k=(0,K.getAttachedAssetsPath)("".concat(T,".").concat(I)),C=new File([w],"".concat(T,".").concat(I),{type:A}),p({url:l,file:{path:k,mimeType:A,file:C,isLoading:!1}}),u.images[T]="File saved at: ".concat(k),[3,8];case 7:return N=P.sent(),S.logger.warn("Failed to fetch image from crawl: ".concat(x),{errorMessage:N.message}),[3,8];case 8:return f=!0,[3,4];case 9:return[3,12];case 10:return L=P.sent(),h=!0,m=L,[3,12];case 11:try{f||null==v.return||v.return()}finally{if(h)throw m}return[7];case 12:return D=new Blob([o],{type:"application/json"}),el({path:n,mimeType:"application/json",file:new File([D],"branding.json",{type:"application/json"}),isLoading:!1}),M=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),p({url:l,file:{path:n,mimeType:"application/json",file:new File([M],e,{type:"application/json"}),isLoading:!1}}),[3,15];case 13:return P.sent(),g(n),eL("Error extracting branding. Please try again later."),[3,15];case 14:return Y(!1),[7];case 15:return[2]}})})()},isDisabled:y,children:[eb?(0,s.jsx)(w.default,{css:Q.errorIcon,className:"option-icon",size:16}):(0,s.jsx)(b.default,{css:Q.icon,className:"option-icon",size:16}),(0,s.jsx)(P.Text,{color:"dimmer",variant:"small",css:Q.optionText,className:"option-text",children:"Extract branding"})]})}))]}),(0,s.jsx)(et,{url:l})]}),eE&&"workspace"===n?(0,s.jsxs)(F.View,{row:!0,gap:2,px:8,align:"center",style:{marginTop:-4,marginBottom:2,opacity:.5},children:[(0,s.jsx)(x.default,{size:12,color:z.tokens.foregroundDimmer}),(0,s.jsx)(P.Text,{multiline:!1,style:{fontSize:10},children:"Available for Dev/Full Figma seats"})]}):null]})}var ee=[q.rcss.viewStyle,Q.option];function et(e){var t=e.url,n=(0,A.useAgentInputFigmaContext)(),r=n.showFigmaAuthModal,a=n.isFigmaAuthenticated,o=n.isLoadingFigmaAuthentication;if(!(0,i._)((0,f.isValidFigmaUrl)(t),1)[0])return null;var c={state:"unauthenticated",title:"Login with Figma",tooltip:"Login with Figma to import",icon:(0,s.jsx)(I.default,{css:Q.icon,className:"option-icon",size:16}),isDisabled:!1,onPress:function(){r({surface:"figma_attachment_card",trigger:"login_button_clicked"})}};return a&&(c={state:"authenticated",title:"Connected",tooltip:"You are connected to Figma",icon:(0,s.jsx)(h.default,{css:Q.successIcon,className:"option-icon",size:16}),isDisabled:!0}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)($.Tooltip,{tooltip:o?"Checking if you are authenticated with Figma":c.tooltip,placement:"top",children:o?(0,s.jsx)(F.View,{css:Q.loadingOption,children:(0,s.jsxs)(P.Text,{color:"dimmer",variant:"small",css:Q.optionText,children:["Checking ",(0,s.jsx)("br",{})," connection..."]})}):(0,s.jsxs)(Z.BaseButton,{css:ee,onPress:c.onPress,isDisabled:c.isDisabled,children:[c.icon,(0,s.jsx)(P.Text,{color:"dimmer",variant:"small",css:Q.optionText,className:"option-text",children:c.title})]})}),(0,s.jsxs)(l.Link,{css:ee,href:t,target:"_blank",rel:"noopener noreferrer",children:[(0,s.jsx)(y,{css:Q.icon,className:"option-icon",size:16}),(0,s.jsx)(P.Text,{color:"dimmer",variant:"small",css:Q.optionText,className:"option-text",children:"View in Figma"})]})]})}e.s(["default",()=>X],628576);var ei=e.i(179302),en=e.i(700170),er=new en.ReactCompartment(function(e){var t=e.addAttachments,i=e.onAutoAttachedLargePaste;return ei.EditorView.domEventHandlers({paste:function(e){if(!e.clipboardData)return!1;var n=e.clipboardData.items,r=!1,a=!0,s=!1,o=void 0;try{for(var l,c=n[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;if(0===u.type.indexOf("image")){e.preventDefault();var d=u.getAsFile();if(d){var f={fileName:d.name,file:d};t([f]),r=!0;break}}}}catch(e){s=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}if(r)return!0;var h=e.clipboardData.getData("text");if(h.length<2e3)return!1;e.preventDefault();var m="Pasted-".concat(h.slice(0,100).replace(/[^a-zA-Z0-9-]/g,"-").replace(/-+/g,"-"),"-").concat(Date.now(),".txt"),p=new File([h],m,{type:"text/plain"});return t([{fileName:m,file:p}]),null==i||i(p.size),!0}})});e.s(["HandlePasteCompartment",()=>er],624714);var ea=e.i(167626),es=e.i(131141),eo=e.i(82259),el=e.i(753950),ec=e.i(319122),eu=e.i(676566),ed=["py","md"],ef=eu.default.filter(function(e){return!ed.includes(e)}).map(function(e){return new RegExp("\\.".concat(e.replace(".",""),"$"))}),eh=/(https?:\/\/)?[\w~@#$%&+=\-.]+\.[^\s]+/g,em=new Set(["sh","md"]);function ep(e){for(var t,i=[];null!==(t=eh.exec(e));){for(var r=t[0];r.length>0&&/[.,!?)]$/.test(r);)r=r.slice(0,-1);if(!/@/.test(r)||/^https?:\/\//.test(r)){var a=/^https?:\/\//.test(r);if(!a){var s=(function(e){var t,i;return null!=(i=(null!=(t=e.replace(/^https?:\/\//,"").split(/[/?#]/)[0])?t:"").split(":")[0])?i:""})(r).toLowerCase(),o=s.lastIndexOf("."),l=o>=0?s.slice(o+1):"";if(em.has(l))continue}(a?(0,ec.default)(r,{host_whitelist:(0,n._)(ef).concat((0,n._)(Array.from(em).map(function(e){return new RegExp("\\.".concat(e,"$"))})))}):(0,ec.default)(r,{host_whitelist:ef}))&&i.push({url:r,start:t.index,end:t.index+r.length})}}return i}eo.UrlIntent.URL_SCREENSHOT,T.default,eo.UrlIntent.URL_CRAWL_CONTENT,m.default,eo.UrlIntent.URL_CRAWL_BRANDING,b.default;var eg=el.StateField.define({create:function(e){return[]},update:function(e,t){return(0,es.produce)(e,function(e){var i=!0,n=!1,r=void 0;try{for(var a,s=t.effects[Symbol.iterator]();!(i=(a=s.next()).done);i=!0)!function(){var t=a.value;if(t.is(ev)){var i=t.value;0>e.findIndex(function(e){return e===i})&&e.push(i)}t.is(ey)&&e.splice(0,e.length)}()}catch(e){n=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}})}}),ev=el.StateEffect.define(),ey=el.StateEffect.define(),e_=el.StateField.define({create:function(){return ei.Decoration.none},update:function(e,t){var i=[],n=ep(t.state.doc.toString()),r=!0,a=!1,s=void 0;try{for(var o,l=n[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var c=o.value,u=c.start,d=c.end,f=c.url,h=f.startsWith("http://")||f.startsWith("https://")?f:"https://".concat(f),m=ei.Decoration.mark({class:"cm-url-underline",tagName:"a",attributes:{style:'--favicon-url: url("https://www.google.com/s2/favicons?domain='.concat(function(e){var t=eI.get(e);if(t)return t;var i=e;try{i=new URL(e).hostname}catch(t){i=e}return eI.set(e,i),i}(h),'&sz=32")'),href:h,target:"_blank",rel:"noreferrer noopener nofollow",title:"".concat(!function(){if(void 0===ew){var e;ew=null==(e=window)?void 0:e.navigator.userAgent.includes("Macintosh")}return ew}()?"CTRL":"CMD"," + Click to open in a new tab")}});i.push(m.range(u,d))}}catch(e){a=!0,s=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw s}}return ei.Decoration.set(i)},provide:function(e){return ei.EditorView.decorations.from(e)}}),eT=ei.EditorView.baseTheme({".cm-url-underline":{textDecoration:"underline 0.5px ".concat(z.tokens.blueDefault),textUnderlineOffset:"2px","--favicon-url":"none","--icon-size":"16px","--gap":"4px","--padding-h":"2px",position:"relative",backgroundColor:"color-mix(in srgb, ".concat(z.tokens.accentPrimaryDefault," 10%, ").concat(z.tokens.interactiveBackground,")"),padding:"2px var(--padding-h)",borderRadius:"4px",color:"".concat(z.tokens.accentPrimaryDefault),paddingLeft:"calc(var(--icon-size) + (var(--padding-h) * 2))",transition:"all 0.2s"},".cm-url-underline:hover":{backgroundColor:"color-mix(in srgb, ".concat(z.tokens.accentPrimaryDefault," 20%, ").concat(z.tokens.interactiveBackground,")")},".cm-url-underline::after":{content:"''",position:"absolute",top:"4px",left:"var(--padding-h)",width:"var(--icon-size)",height:"var(--icon-size)",backgroundImage:"var(--favicon-url)",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",borderRadius:"2px",pointerEvents:"none"},".cm-url-underline::selection":{color:"".concat(z.tokens.foregroundDimmer)}}),ex=ei.EditorView.updateListener.of(function(e){if(e.docChanged){var t=ep(e.state.doc.toString()),i=e.view,n=i.state.field(eg),r=t.map(function(e){return e.url});if(!function(e,t){if(e.length!==t.length)return!1;var i=new Set(e);return t.every(function(e){return i.has(e)})}(n,r)&&(i.dispatch({effects:ey.of(null)}),r.length>0)){var a=!0,s=!1,o=void 0;try{for(var l,c=r[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;i.dispatch({effects:ev.of(u)})}}catch(e){s=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}}}}),eb=ei.EditorView.domEventHandlers({click:function(e){var t=(0,ea._)(e.target,HTMLElement)&&e.target.closest("a.cm-url-underline");if(!t)return!1;if(!(e.metaKey||e.ctrlKey))return e.preventDefault(),!0;e.preventDefault();var i=t.getAttribute("href");return i&&window.open(i,"_blank","noopener,noreferrer"),!0}}),ew=void 0,eI=new Map,eA=[e_,eT,eg,ex,eb],ek=[e_,eT,eb];e.s(["AnonSafeUrlAttachmentExtensions",()=>ek,"UrlAttachmentExtensions",()=>eA,"clearDetectedUrlsEffect",()=>ey,"detectedUrlsState",()=>eg],709696);var eC=e.i(282453),eS=function(e,t){return(0,o.useEffect)(function(){if(e&&(null==t||!t.state.doc.toString())){var i=eC.default.get(e,"string");if(i){if(!t)return;t.dispatch({changes:{from:0,to:t.state.doc.length,insert:i}})}}},[e,t]),{persistPromptDraftCompartment:eE.use(e),clearPersistedPromptDraft:function(){e&&eC.default.remove(e)}}},eE=new en.ReactCompartment(function(e){return e?ei.EditorView.updateListener.of(function(t){if(t.docChanged){var i=t.state.doc.toString();eC.default.set(e,i)}}):[]});e.s(["usePersistPromptDraft",()=>eS],777110)},986212,e=>{e.v({"agent-input-glow":"index-module__VnT05G__agent-input-glow",attachments:"index-module__VnT05G__attachments",autoHeight:"index-module__VnT05G__autoHeight",codemirror:"index-module__VnT05G__codemirror",outer:"index-module__VnT05G__outer",primaryButtonGroup:"index-module__VnT05G__primaryButtonGroup",surface:"index-module__VnT05G__surface",withDrawer:"index-module__VnT05G__withDrawer",wrapper:"index-module__VnT05G__wrapper"})},61511,245218,e=>{"use strict";var t=e.i(389959),i=e.i(179302),n=e.i(98816),r=e.i(441329),a=e.i(337761),s=e.i(683389),o=e.i(16499),l=e.i(480028),c=e.i(986212);function u(e){var u=e.view,d=e.setPromptEditor,f=(0,t.useRef)(null),h=(0,r.useIsInMobileWorkspace)(),m=function(){try{return(0,o.useAppKeyboardState)()}catch(e){return null}}(),p=(0,t.useRef)(!1);(0,t.useEffect)(function(){(null==m?void 0:m.isShown)&&(p.current=!0)},[null==m?void 0:m.isShown]);var g=(0,n.default)(d);return(0,t.useEffect)(function(){if(u&&g.current){var e=g.current,t=null;return e({setValue:function(e,n){if(null!==t&&(cancelAnimationFrame(t),t=null),u.state.doc.toString()!==e||(null==n?void 0:n.animate))if(null==n?void 0:n.animate){null==(r=n.onStart)||r.call(n);var r,a,s=u.contentDOM;s.style.color=l.tokens.foregroundDimmer,u.dispatch({changes:{from:0,to:u.state.doc.length}});var o=e.length,c=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t=requestAnimationFrame(function(){var r,a;if(!u){s.style.color="",null==(r=n.onComplete)||r.call(n);return}u.dispatch({changes:{from:i,to:i,insert:e[i]},selection:{anchor:i+1}}),i<o-1?c(i+1):(t=null,s.style.color="",u.focus(),null==(a=n.onComplete)||a.call(n))})};o>0?c():(s.style.color="",null==(a=n.onComplete)||a.call(n))}else u.dispatch({changes:{from:0,to:u.state.doc.length,insert:e}}),requestAnimationFrame(function(){var e=u.state.doc.lines,t=u.state.doc.line(e).from;u.dispatch({effects:i.EditorView.scrollIntoView(t,{y:"end"})})})},getValue:function(){return u.state.doc.toString()},focus:function(e){h&&p.current||((null==e?void 0:e.triggerNativeScroll)&&u.contentDOM.focus(),u.focus(),u.dispatch({selection:{anchor:u.state.doc.length}}))},animatePlaceholder:function(){u.dispatch({effects:s.animateTextEffect.of(!0)}),(0,a.styleSet)(f,"border-color",l.tokens.accentPrimaryDefault),setTimeout(function(){requestAnimationFrame(function(){var e;null==(e=f.current)||e.style.removeProperty("border-color")})},60)},animateBorder:function(){var e=f.current;e&&(e.style.setProperty("animation","".concat(c.default["agent-input-glow"]," 1.5s")),e.addEventListener("animationend",function(){return e.style.removeProperty("animation")},{once:!0}),h&&p.current||u.focus())},get isFocused(){return u.hasFocus}}),function(){null!==t&&cancelAnimationFrame(t),e(null)}}},[u,g,h]),f}e.s(["useSetPromptEditor",()=>u],61511);var d=e.i(993796);function f(){return(0,d.useFlag)({controlName:"flag-url-context-feature-killswitch"})}e.s(["useUrlContextFeatureKillswitch",()=>f],245218)}]);

//# debugId=d9bf1425-db59-7b84-5498-eb18319cf9fb
//# sourceMappingURL=20ac8c8fd6a1e36c.js.map